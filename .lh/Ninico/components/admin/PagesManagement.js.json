{
    "sourceFile": "Ninico/components/admin/PagesManagement.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 25,
            "patches": [
                {
                    "date": 1753107753818,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1753110070264,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,7 +1,8 @@\n 'use client'\r\n import React, { useState, useEffect } from 'react'\r\n import { get, post, put } from '@/util/apiService'\r\n+import SectionManager from './sections/SectionManager'\r\n \r\n const PAGES = [\r\n   { \r\n     key: \"home\", \r\n@@ -19,8 +20,11 @@\n   const [selectedPage, setSelectedPage] = useState(\"home\")\r\n   const [loading, setLoading] = useState(false)\r\n   const [error, setError] = useState('')\r\n   const [success, setSuccess] = useState('')\r\n+  const [showSectionModal, setShowSectionModal] = useState(false)\r\n+  const [modalSectionKey, setModalSectionKey] = useState(null)\r\n+  const [modalSectionData, setModalSectionData] = useState(null)\r\n \r\n   // Define sections for each page\r\n   const homeSections = [\r\n     { \r\n@@ -183,8 +187,39 @@\n     setSuccess('Section order updated!')\r\n     setTimeout(() => setSuccess(''), 2000)\r\n   }\r\n \r\n+  // Open section management modal\r\n+  const handleManageSection = (sectionKey) => {\r\n+    const sections = getCurrentSections()\r\n+    const sectionData = sections.find(s => s.key === sectionKey)\r\n+    \r\n+    if (sectionData) {\r\n+      setModalSectionKey(sectionKey)\r\n+      setModalSectionData(sectionData)\r\n+      setShowSectionModal(true)\r\n+    }\r\n+  }\r\n+\r\n+  // Handle section updates from modal\r\n+  const handleSectionUpdate = (pageKey, sectionKey, updatedData) => {\r\n+    console.log('Updating section:', { pageKey, sectionKey, updatedData })\r\n+    \r\n+    // TODO: Send to backend API\r\n+    // await put(`/api/pages/${pageKey}/sections/${sectionKey}`, updatedData)\r\n+    \r\n+    setSuccess(`${updatedData.label} section updated successfully!`)\r\n+    setTimeout(() => setSuccess(''), 3000)\r\n+    setShowSectionModal(false)\r\n+  }\r\n+\r\n+  // Close modal\r\n+  const closeSectionModal = () => {\r\n+    setShowSectionModal(false)\r\n+    setModalSectionKey(null)\r\n+    setModalSectionData(null)\r\n+  }\r\n+\r\n   // Load sections when page changes\r\n   useEffect(() => {\r\n     loadPageSections(selectedPage)\r\n   }, [selectedPage])\r\n@@ -279,9 +314,9 @@\n                                 <i className=\"bi bi-arrow-down\"></i>\r\n                               </button>\r\n                               <button\r\n                                 className=\"btn btn-outline-secondary\"\r\n-                                onClick={() => {/* TODO: Open section settings modal */}}\r\n+                                onClick={() => handleManageSection(section.key)}\r\n                                 title=\"Section Settings\"\r\n                                 disabled={loading}\r\n                               >\r\n                                 <i className=\"bi bi-gear\"></i>\r\n@@ -416,7 +451,18 @@\n             <span className=\"visually-hidden\">Loading...</span>\r\n           </div>\r\n         </div>\r\n       )}\r\n+\r\n+      {/* Section Management Modal */}\r\n+      {showSectionModal && modalSectionKey && modalSectionData && (\r\n+        <SectionManager\r\n+          pageKey={selectedPage}\r\n+          sectionKey={modalSectionKey}\r\n+          sectionData={modalSectionData}\r\n+          onClose={closeSectionModal}\r\n+          onUpdate={handleSectionUpdate}\r\n+        />\r\n+      )}\r\n     </div>\r\n   )\r\n }\r\n"
                },
                {
                    "date": 1753113503377,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -27,39 +27,39 @@\n \r\n   // Define sections for each page\r\n   const homeSections = [\r\n     { \r\n-      key: \"giftCategories\", \r\n+      key: \"categorySection\", \r\n       label: \"Gift Categories\", \r\n       description: \"Display category grid with gifts\",\r\n       order: 1\r\n     },\r\n     { \r\n-      key: \"slider\", \r\n+      key: \"sliderSection\", \r\n       label: \"Main Slider\", \r\n       description: \"Hero banner with promotional slides\",\r\n       order: 2\r\n     },\r\n     { \r\n-      key: \"services\", \r\n+      key: \"serviceSection\", \r\n       label: \"Services Section\", \r\n       description: \"Highlight key services and benefits\",\r\n       order: 3\r\n     },\r\n     { \r\n-      key: \"products\", \r\n+      key: \"productSection\", \r\n       label: \"Featured Products\", \r\n       description: \"Showcase featured/trending products\",\r\n       order: 4\r\n     },\r\n     { \r\n-      key: \"banner\", \r\n+      key: \"bannerSection\", \r\n       label: \"Promotional Banner\", \r\n       description: \"Secondary promotional content\",\r\n       order: 5\r\n     },\r\n     { \r\n-      key: \"dealProduct\", \r\n+      key: \"dealProductSection\", \r\n       label: \"Deal Products\", \r\n       description: \"Special offers and discounted items\",\r\n       order: 6\r\n     }\r\n@@ -94,14 +94,14 @@\n \r\n   // Section visibility state\r\n   const [visibleSections, setVisibleSections] = useState({\r\n     home: {\r\n-      giftCategories: true,\r\n-      slider: true,\r\n-      services: true,\r\n-      products: true,\r\n-      banner: true,\r\n-      dealProduct: true,\r\n+      categorySection: true,\r\n+      sliderSection: true,\r\n+      serviceSection: true,\r\n+      productSection: true,\r\n+      bannerSection: true,\r\n+      dealProductSection: true,\r\n     },\r\n     corporate: {\r\n       corporateBanner: true,\r\n       corporateServices: true,\r\n@@ -118,13 +118,26 @@\n     try {\r\n       setLoading(true)\r\n       localStorage.setItem('authToken', ADMIN_TOKEN)\r\n       \r\n-      // TODO: Replace with actual API call when backend is ready\r\n-      // const response = await get(`/api/pages/${pageKey}/sections`)\r\n-      // For now, use default state\r\n-      console.log(`Loading sections for page: ${pageKey}`)\r\n+      // Fetch page configuration from backend\r\n+      const response = await get(`/api/pages/${pageKey}`)\r\n       \r\n+      if (response && response.sections) {\r\n+        // Update visibleSections state based on backend data\r\n+        const sectionsState = {}\r\n+        response.sections.forEach(section => {\r\n+          sectionsState[section.sectionType] = section.enabled ?? true\r\n+        })\r\n+        \r\n+        setVisibleSections(prev => ({\r\n+          ...prev,\r\n+          [pageKey]: sectionsState\r\n+        }))\r\n+        \r\n+        console.log(`Loaded sections for page: ${pageKey}`, sectionsState)\r\n+      }\r\n+      \r\n       setError('')\r\n     } catch (err) {\r\n       console.error('Load page sections error:', err)\r\n       setError('Failed to load page sections: ' + err.message)\r\n@@ -138,12 +151,18 @@\n     try {\r\n       setLoading(true)\r\n       localStorage.setItem('authToken', ADMIN_TOKEN)\r\n       \r\n-      // TODO: Replace with actual API call when backend is ready\r\n-      // const response = await put(`/api/pages/${pageKey}/sections`, { sections })\r\n-      console.log(`Saving sections for page: ${pageKey}`, sections)\r\n+      // Update page configuration in backend\r\n+      const response = await put(`/api/pages/${pageKey}`, { \r\n+        sections: Object.entries(sections).map(([sectionType, enabled]) => ({\r\n+          sectionType,\r\n+          enabled\r\n+        }))\r\n+      })\r\n       \r\n+      console.log(`Saved sections for page: ${pageKey}`, sections)\r\n+      \r\n       setSuccess('Page sections updated successfully!')\r\n       setTimeout(() => setSuccess(''), 3000)\r\n       \r\n     } catch (err) {\r\n"
                },
                {
                    "date": 1753126463836,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,8 +1,7 @@\n 'use client'\r\n import React, { useState, useEffect } from 'react'\r\n import { get, post, put } from '@/util/apiService'\r\n-import SectionManager from './sections/SectionManager'\r\n \r\n const PAGES = [\r\n   { \r\n     key: \"home\", \r\n@@ -20,46 +19,56 @@\n   const [selectedPage, setSelectedPage] = useState(\"home\")\r\n   const [loading, setLoading] = useState(false)\r\n   const [error, setError] = useState('')\r\n   const [success, setSuccess] = useState('')\r\n-  const [showSectionModal, setShowSectionModal] = useState(false)\r\n-  const [modalSectionKey, setModalSectionKey] = useState(null)\r\n-  const [modalSectionData, setModalSectionData] = useState(null)\r\n+  const [showCategoryConfig, setShowCategoryConfig] = useState(false)\r\n+  const [availableCategories, setAvailableCategories] = useState([])\r\n+  const [pageConfig, setPageConfig] = useState(null)\r\n \r\n+  // Category section configuration state\r\n+  const [categoryConfig, setCategoryConfig] = useState({\r\n+    enabled: true,\r\n+    maxCategories: 6,\r\n+    categoryIds: [],\r\n+    layout: 'grid',\r\n+    showSubcategories: true\r\n+  })\r\n+\r\n   // Define sections for each page\r\n   const homeSections = [\r\n     { \r\n-      key: \"categorySection\", \r\n+      key: \"giftCategories\", \r\n       label: \"Gift Categories\", \r\n       description: \"Display category grid with gifts\",\r\n-      order: 1\r\n+      order: 1,\r\n+      hasConfig: true\r\n     },\r\n     { \r\n-      key: \"sliderSection\", \r\n+      key: \"slider\", \r\n       label: \"Main Slider\", \r\n       description: \"Hero banner with promotional slides\",\r\n       order: 2\r\n     },\r\n     { \r\n-      key: \"serviceSection\", \r\n+      key: \"services\", \r\n       label: \"Services Section\", \r\n       description: \"Highlight key services and benefits\",\r\n       order: 3\r\n     },\r\n     { \r\n-      key: \"productSection\", \r\n+      key: \"products\", \r\n       label: \"Featured Products\", \r\n       description: \"Showcase featured/trending products\",\r\n       order: 4\r\n     },\r\n     { \r\n-      key: \"bannerSection\", \r\n+      key: \"banner\", \r\n       label: \"Promotional Banner\", \r\n       description: \"Secondary promotional content\",\r\n       order: 5\r\n     },\r\n     { \r\n-      key: \"dealProductSection\", \r\n+      key: \"dealProduct\", \r\n       label: \"Deal Products\", \r\n       description: \"Special offers and discounted items\",\r\n       order: 6\r\n     }\r\n@@ -94,14 +103,14 @@\n \r\n   // Section visibility state\r\n   const [visibleSections, setVisibleSections] = useState({\r\n     home: {\r\n-      categorySection: true,\r\n-      sliderSection: true,\r\n-      serviceSection: true,\r\n-      productSection: true,\r\n-      bannerSection: true,\r\n-      dealProductSection: true,\r\n+      giftCategories: true,\r\n+      slider: true,\r\n+      services: true,\r\n+      products: true,\r\n+      banner: true,\r\n+      dealProduct: true,\r\n     },\r\n     corporate: {\r\n       corporateBanner: true,\r\n       corporateServices: true,\r\n@@ -112,70 +121,105 @@\n \r\n   // Hardcoded admin token for testing\r\n   const ADMIN_TOKEN = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY4NzZhYTJmYzc3YWY4ODU3Njk1ZDA5MiIsInJvbGUiOiJhZG1pbiIsImlhdCI6MTc1MjYwNzMyMCwiZXhwIjoxNzUzMjEyMTIwfQ.ugFuaDCq_ewqIE-dZaql3BB91kaXBIxE0TQmqdYnagI'\r\n \r\n-  // Load page sections configuration\r\n-  const loadPageSections = async (pageKey) => {\r\n+  // Load page configuration\r\n+  const loadPageConfig = async (pageKey) => {\r\n     try {\r\n       setLoading(true)\r\n       localStorage.setItem('authToken', ADMIN_TOKEN)\r\n       \r\n-      // Fetch page configuration from backend\r\n       const response = await get(`/api/pages/${pageKey}`)\r\n       \r\n-      if (response && response.sections) {\r\n-        // Update visibleSections state based on backend data\r\n-        const sectionsState = {}\r\n-        response.sections.forEach(section => {\r\n-          sectionsState[section.sectionType] = section.enabled ?? true\r\n-        })\r\n+      if (response.success) {\r\n+        setPageConfig(response.data)\r\n         \r\n-        setVisibleSections(prev => ({\r\n-          ...prev,\r\n-          [pageKey]: sectionsState\r\n-        }))\r\n-        \r\n-        console.log(`Loaded sections for page: ${pageKey}`, sectionsState)\r\n+        // Extract category section config\r\n+        const categorySection = response.data.sections.find(s => s.sectionType === 'categorySection')\r\n+        if (categorySection) {\r\n+          setCategoryConfig({\r\n+            enabled: categorySection.enabled,\r\n+            maxCategories: categorySection.config.maxCategories || 6,\r\n+            categoryIds: categorySection.config.categoryIds || [],\r\n+            layout: categorySection.config.layout || 'grid',\r\n+            showSubcategories: categorySection.config.showSubcategories || true\r\n+          })\r\n+          \r\n+          // Update visibility state\r\n+          setVisibleSections(prev => ({\r\n+            ...prev,\r\n+            [pageKey]: {\r\n+              ...prev[pageKey],\r\n+              giftCategories: categorySection.enabled\r\n+            }\r\n+          }))\r\n+        }\r\n       }\r\n       \r\n       setError('')\r\n     } catch (err) {\r\n-      console.error('Load page sections error:', err)\r\n-      setError('Failed to load page sections: ' + err.message)\r\n+      console.error('Load page config error:', err)\r\n+      setError('Failed to load page configuration: ' + err.message)\r\n     } finally {\r\n       setLoading(false)\r\n     }\r\n   }\r\n \r\n-  // Save page sections configuration\r\n-  const savePageSections = async (pageKey, sections) => {\r\n+  // Load available categories\r\n+  const loadCategories = async () => {\r\n     try {\r\n+      const response = await get('/api/categories')\r\n+      if (response.success) {\r\n+        setAvailableCategories(response.data)\r\n+      }\r\n+    } catch (err) {\r\n+      console.error('Load categories error:', err)\r\n+    }\r\n+  }\r\n+\r\n+  // Save category section configuration\r\n+  const saveCategoryConfig = async () => {\r\n+    try {\r\n       setLoading(true)\r\n       localStorage.setItem('authToken', ADMIN_TOKEN)\r\n       \r\n-      // Update page configuration in backend\r\n-      const response = await put(`/api/pages/${pageKey}`, { \r\n-        sections: Object.entries(sections).map(([sectionType, enabled]) => ({\r\n-          sectionType,\r\n-          enabled\r\n-        }))\r\n-      })\r\n+      const sectionData = {\r\n+        sectionType: 'categorySection',\r\n+        enabled: categoryConfig.enabled,\r\n+        order: 1,\r\n+        config: {\r\n+          maxCategories: categoryConfig.maxCategories,\r\n+          categoryIds: categoryConfig.categoryIds,\r\n+          layout: categoryConfig.layout,\r\n+          showSubcategories: categoryConfig.showSubcategories\r\n+        }\r\n+      }\r\n       \r\n-      console.log(`Saved sections for page: ${pageKey}`, sections)\r\n+      const response = await put(`/api/pages/${selectedPage}/sections/category`, sectionData)\r\n       \r\n-      setSuccess('Page sections updated successfully!')\r\n-      setTimeout(() => setSuccess(''), 3000)\r\n+      if (response.success) {\r\n+        setSuccess('Category section configuration saved successfully!')\r\n+        setTimeout(() => setSuccess(''), 3000)\r\n+        setShowCategoryConfig(false)\r\n+        await loadPageConfig(selectedPage) // Reload to get updated config\r\n+      }\r\n       \r\n     } catch (err) {\r\n-      console.error('Save page sections error:', err)\r\n-      setError('Failed to save page sections: ' + err.message)\r\n+      console.error('Save category config error:', err)\r\n+      setError('Failed to save category configuration: ' + err.message)\r\n     } finally {\r\n       setLoading(false)\r\n     }\r\n   }\r\n \r\n   // Toggle section visibility\r\n   const handleToggleSection = async (page, section) => {\r\n+    if (section === 'giftCategories') {\r\n+      // For category section, update the actual config\r\n+      setCategoryConfig(prev => ({ ...prev, enabled: !prev.enabled }))\r\n+      return\r\n+    }\r\n+    \r\n     const newVisibility = {\r\n       ...visibleSections,\r\n       [page]: {\r\n         ...visibleSections[page],\r\n@@ -183,13 +227,218 @@\n       }\r\n     }\r\n     \r\n     setVisibleSections(newVisibility)\r\n-    \r\n-    // Auto-save changes\r\n-    await savePageSections(page, newVisibility[page])\r\n   }\r\n \r\n+  // Open category configuration modal\r\n+  const openCategoryConfig = () => {\r\n+    setShowCategoryConfig(true)\r\n+  }\r\n+\r\n+  // Handle category selection\r\n+  const handleCategoryToggle = (categoryId) => {\r\n+    setCategoryConfig(prev => {\r\n+      const isSelected = prev.categoryIds.includes(categoryId)\r\n+      const newCategoryIds = isSelected \r\n+        ? prev.categoryIds.filter(id => id !== categoryId)\r\n+        : [...prev.categoryIds, categoryId]\r\n+      \r\n+      return { ...prev, categoryIds: newCategoryIds }\r\n+    })\r\n+  }\r\n+\r\n+  // Handle max categories change\r\n+  const handleMaxCategoriesChange = (value) => {\r\n+    const numValue = parseInt(value) || 0\r\n+    setCategoryConfig(prev => ({ ...prev, maxCategories: numValue }))\r\n+  }\r\n+\r\n+  // Load data when page changes\r\n+  useEffect(() => {\r\n+    loadPageConfig(selectedPage)\r\n+    loadCategories()\r\n+  }, [selectedPage])\r\n+\r\n+  // Get sections for current page\r\n+  const getCurrentSections = () => {\r\n+    return selectedPage === \"home\" ? homeSections : corporateSections\r\n+  }\r\n+\r\n+  // Render category configuration modal\r\n+  const renderCategoryConfigModal = () => {\r\n+    if (!showCategoryConfig) return null\r\n+\r\n+    return (\r\n+      <div className=\"modal show d-block\" style={{ backgroundColor: 'rgba(0,0,0,0.5)' }}>\r\n+        <div className=\"modal-dialog modal-lg\">\r\n+          <div className=\"modal-content\">\r\n+            <div className=\"modal-header\">\r\n+              <h5 className=\"modal-title\">\r\n+                <i className=\"bi bi-grid-3x3-gap me-2\"></i>\r\n+                Category Section Configuration\r\n+              </h5>\r\n+              <button \r\n+                type=\"button\" \r\n+                className=\"btn-close\" \r\n+                onClick={() => setShowCategoryConfig(false)}\r\n+              ></button>\r\n+            </div>\r\n+            <div className=\"modal-body\">\r\n+              {/* Enable/Disable Section */}\r\n+              <div className=\"row mb-4\">\r\n+                <div className=\"col-12\">\r\n+                  <div className=\"form-check form-switch\">\r\n+                    <input \r\n+                      className=\"form-check-input\" \r\n+                      type=\"checkbox\" \r\n+                      id=\"enableCategorySection\"\r\n+                      checked={categoryConfig.enabled}\r\n+                      onChange={(e) => setCategoryConfig(prev => ({ ...prev, enabled: e.target.checked }))}\r\n+                    />\r\n+                    <label className=\"form-check-label fw-semibold\" htmlFor=\"enableCategorySection\">\r\n+                      Enable Category Section\r\n+                    </label>\r\n+                  </div>\r\n+                  <small className=\"text-muted\">Turn on/off the category section on the homepage</small>\r\n+                </div>\r\n+              </div>\r\n+\r\n+              {categoryConfig.enabled && (\r\n+                <>\r\n+                  {/* Max Categories */}\r\n+                  <div className=\"row mb-4\">\r\n+                    <div className=\"col-md-6\">\r\n+                      <label className=\"form-label fw-semibold\">Maximum Categories to Show</label>\r\n+                      <input \r\n+                        type=\"number\" \r\n+                        className=\"form-control\"\r\n+                        min=\"1\"\r\n+                        max=\"20\"\r\n+                        value={categoryConfig.maxCategories}\r\n+                        onChange={(e) => handleMaxCategoriesChange(e.target.value)}\r\n+                      />\r\n+                      <small className=\"text-muted\">Limit how many categories appear (0 = no limit)</small>\r\n+                    </div>\r\n+                    <div className=\"col-md-6\">\r\n+                      <label className=\"form-label fw-semibold\">Layout Style</label>\r\n+                      <select \r\n+                        className=\"form-select\"\r\n+                        value={categoryConfig.layout}\r\n+                        onChange={(e) => setCategoryConfig(prev => ({ ...prev, layout: e.target.value }))}\r\n+                      >\r\n+                        <option value=\"grid\">Grid Layout</option>\r\n+                        <option value=\"carousel\">Carousel</option>\r\n+                        <option value=\"list\">List View</option>\r\n+                      </select>\r\n+                    </div>\r\n+                  </div>\r\n+\r\n+                  {/* Category Selection */}\r\n+                  <div className=\"row mb-4\">\r\n+                    <div className=\"col-12\">\r\n+                      <label className=\"form-label fw-semibold\">Select Categories to Display</label>\r\n+                      <div className=\"text-muted mb-3\">\r\n+                        Choose which categories to show. Leave empty to show all categories.\r\n+                      </div>\r\n+                      \r\n+                      <div className=\"row\">\r\n+                        {availableCategories.map(category => (\r\n+                          <div key={category.id} className=\"col-md-6 col-lg-4 mb-3\">\r\n+                            <div className={`card h-100 ${categoryConfig.categoryIds.includes(category.id) ? 'border-primary bg-light' : ''}`}>\r\n+                              <div className=\"card-body p-3\">\r\n+                                <div className=\"form-check\">\r\n+                                  <input \r\n+                                    className=\"form-check-input\" \r\n+                                    type=\"checkbox\" \r\n+                                    id={`category-${category.id}`}\r\n+                                    checked={categoryConfig.categoryIds.includes(category.id)}\r\n+                                    onChange={() => handleCategoryToggle(category.id)}\r\n+                                  />\r\n+                                  <label className=\"form-check-label\" htmlFor={`category-${category.id}`}>\r\n+                                    <div className=\"d-flex align-items-center\">\r\n+                                      {category.image && (\r\n+                                        <img \r\n+                                          src={category.image} \r\n+                                          alt={category.name}\r\n+                                          className=\"me-2\"\r\n+                                          style={{ width: '32px', height: '32px', objectFit: 'cover', borderRadius: '4px' }}\r\n+                                        />\r\n+                                      )}\r\n+                                      <div>\r\n+                                        <div className=\"fw-semibold\">{category.name}</div>\r\n+                                        {category.description && (\r\n+                                          <small className=\"text-muted\">{category.description}</small>\r\n+                                        )}\r\n+                                      </div>\r\n+                                    </div>\r\n+                                  </label>\r\n+                                </div>\r\n+                              </div>\r\n+                            </div>\r\n+                          </div>\r\n+                        ))}\r\n+                      </div>\r\n+                      \r\n+                      {availableCategories.length === 0 && (\r\n+                        <div className=\"text-center py-4\">\r\n+                          <i className=\"bi bi-folder2-open\" style={{ fontSize: '2rem', color: '#6c757d' }}></i>\r\n+                          <p className=\"mt-2 text-muted\">No categories available. Create categories first.</p>\r\n+                        </div>\r\n+                      )}\r\n+                    </div>\r\n+                  </div>\r\n+\r\n+                  {/* Additional Options */}\r\n+                  <div className=\"row\">\r\n+                    <div className=\"col-12\">\r\n+                      <div className=\"form-check\">\r\n+                        <input \r\n+                          className=\"form-check-input\" \r\n+                          type=\"checkbox\" \r\n+                          id=\"showSubcategories\"\r\n+                          checked={categoryConfig.showSubcategories}\r\n+                          onChange={(e) => setCategoryConfig(prev => ({ ...prev, showSubcategories: e.target.checked }))}\r\n+                        />\r\n+                        <label className=\"form-check-label\" htmlFor=\"showSubcategories\">\r\n+                          Show subcategories on hover\r\n+                        </label>\r\n+                      </div>\r\n+                    </div>\r\n+                  </div>\r\n+                </>\r\n+              )}\r\n+            </div>\r\n+            <div className=\"modal-footer\">\r\n+              <button \r\n+                type=\"button\" \r\n+                className=\"btn btn-secondary\" \r\n+                onClick={() => setShowCategoryConfig(false)}\r\n+              >\r\n+                Cancel\r\n+              </button>\r\n+              <button \r\n+                type=\"button\" \r\n+                className=\"btn btn-primary\" \r\n+                onClick={saveCategoryConfig}\r\n+                disabled={loading}\r\n+              >\r\n+                {loading ? (\r\n+                  <>\r\n+                    <span className=\"spinner-border spinner-border-sm me-2\"></span>\r\n+                    Saving...\r\n+                  </>\r\n+                ) : (\r\n+                  'Save Configuration'\r\n+                )}\r\n+              </button>\r\n+            </div>\r\n+          </div>\r\n+        </div>\r\n+      </div>\r\n+    )\r\n+  }\r\n+\r\n   // Move section up/down\r\n   const handleMoveSection = async (page, sectionKey, direction) => {\r\n     const sections = page === \"home\" ? homeSections : corporateSections\r\n     const currentIndex = sections.findIndex(s => s.key === sectionKey)\r\n@@ -206,49 +455,8 @@\n     setSuccess('Section order updated!')\r\n     setTimeout(() => setSuccess(''), 2000)\r\n   }\r\n \r\n-  // Open section management modal\r\n-  const handleManageSection = (sectionKey) => {\r\n-    const sections = getCurrentSections()\r\n-    const sectionData = sections.find(s => s.key === sectionKey)\r\n-    \r\n-    if (sectionData) {\r\n-      setModalSectionKey(sectionKey)\r\n-      setModalSectionData(sectionData)\r\n-      setShowSectionModal(true)\r\n-    }\r\n-  }\r\n-\r\n-  // Handle section updates from modal\r\n-  const handleSectionUpdate = (pageKey, sectionKey, updatedData) => {\r\n-    console.log('Updating section:', { pageKey, sectionKey, updatedData })\r\n-    \r\n-    // TODO: Send to backend API\r\n-    // await put(`/api/pages/${pageKey}/sections/${sectionKey}`, updatedData)\r\n-    \r\n-    setSuccess(`${updatedData.label} section updated successfully!`)\r\n-    setTimeout(() => setSuccess(''), 3000)\r\n-    setShowSectionModal(false)\r\n-  }\r\n-\r\n-  // Close modal\r\n-  const closeSectionModal = () => {\r\n-    setShowSectionModal(false)\r\n-    setModalSectionKey(null)\r\n-    setModalSectionData(null)\r\n-  }\r\n-\r\n-  // Load sections when page changes\r\n-  useEffect(() => {\r\n-    loadPageSections(selectedPage)\r\n-  }, [selectedPage])\r\n-\r\n-  // Get sections for current page\r\n-  const getCurrentSections = () => {\r\n-    return selectedPage === \"home\" ? homeSections : corporateSections\r\n-  }\r\n-\r\n   // Render section controls\r\n   const renderSections = () => {\r\n     const sections = getCurrentSections()\r\n     const currentPage = PAGES.find(p => p.key === selectedPage)\r\n@@ -261,9 +469,11 @@\n               <div>\r\n                 <h5 className=\"mb-1 fw-semibold\">{currentPage.label}</h5>\r\n                 <p className=\"text-muted mb-0 small\">{currentPage.description}</p>\r\n               </div>\r\n-              <span className=\"badge bg-primary\">{sections.filter(s => visibleSections[selectedPage][s.key]).length} active</span>\r\n+              <span className=\"badge bg-primary\">\r\n+                {sections.filter(s => visibleSections[selectedPage][s.key]).length} active\r\n+              </span>\r\n             </div>\r\n           </div>\r\n           \r\n           <div className=\"card-body p-0\">\r\n@@ -286,61 +496,71 @@\n                   </thead>\r\n                   <tbody>\r\n                     {sections.map((section, index) => {\r\n                       const isVisible = visibleSections[selectedPage][section.key]\r\n+                      const isCategorySection = section.key === 'giftCategories'\r\n+                      \r\n                       return (\r\n-                        <tr key={section.key} className={!isVisible ? 'table-secondary' : ''}>\r\n+                        <tr key={section.key} className={isVisible ? '' : 'table-secondary'}>\r\n                           <td className=\"ps-4\">\r\n                             <div className=\"d-flex align-items-center\">\r\n-                              <i className={`bi ${isVisible ? 'bi-eye' : 'bi-eye-slash'} me-2 ${isVisible ? 'text-success' : 'text-muted'}`}></i>\r\n-                              <strong>{section.label}</strong>\r\n+                              <div>\r\n+                                <div className=\"fw-semibold\">{section.label}</div>\r\n+                                {isCategorySection && categoryConfig.categoryIds.length > 0 && (\r\n+                                  <small className=\"text-muted\">\r\n+                                    {categoryConfig.categoryIds.length} categories selected\r\n+                                  </small>\r\n+                                )}\r\n+                              </div>\r\n                             </div>\r\n                           </td>\r\n                           <td>\r\n-                            <small className=\"text-muted\">{section.description}</small>\r\n+                            <span className=\"text-muted\">{section.description}</span>\r\n                           </td>\r\n                           <td>\r\n                             <span className=\"badge bg-light text-dark\">{section.order}</span>\r\n                           </td>\r\n                           <td>\r\n-                            <span className={`badge ${isVisible ? 'bg-success' : 'bg-secondary'}`}>\r\n-                              {isVisible ? 'Visible' : 'Hidden'}\r\n-                            </span>\r\n+                            <div className=\"form-check form-switch\">\r\n+                              <input \r\n+                                className=\"form-check-input\" \r\n+                                type=\"checkbox\" \r\n+                                checked={isCategorySection ? categoryConfig.enabled : isVisible}\r\n+                                onChange={() => handleToggleSection(selectedPage, section.key)}\r\n+                                id={`toggle-${section.key}`}\r\n+                              />\r\n+                              <label className=\"form-check-label\" htmlFor={`toggle-${section.key}`}>\r\n+                                {isCategorySection ? (categoryConfig.enabled ? 'Enabled' : 'Disabled') : (isVisible ? 'Visible' : 'Hidden')}\r\n+                              </label>\r\n+                            </div>\r\n                           </td>\r\n                           <td className=\"text-center\">\r\n-                            <div className=\"btn-group btn-group-sm\" role=\"group\">\r\n+                            <div className=\"btn-group btn-group-sm\">\r\n+                              {section.hasConfig && (\r\n+                                <button\r\n+                                  className=\"btn btn-outline-primary\"\r\n+                                  onClick={openCategoryConfig}\r\n+                                  title=\"Configure section\"\r\n+                                >\r\n+                                  <i className=\"bi bi-gear\"></i>\r\n+                                </button>\r\n+                              )}\r\n                               <button\r\n-                                className={`btn ${isVisible ? 'btn-outline-warning' : 'btn-outline-success'}`}\r\n-                                onClick={() => handleToggleSection(selectedPage, section.key)}\r\n-                                title={isVisible ? 'Hide Section' : 'Show Section'}\r\n-                                disabled={loading}\r\n-                              >\r\n-                                <i className={`bi ${isVisible ? 'bi-eye-slash' : 'bi-eye'}`}></i>\r\n-                              </button>\r\n-                              <button\r\n-                                className=\"btn btn-outline-primary\"\r\n+                                className=\"btn btn-outline-secondary\"\r\n                                 onClick={() => handleMoveSection(selectedPage, section.key, 'up')}\r\n-                                title=\"Move Up\"\r\n-                                disabled={loading || index === 0}\r\n+                                disabled={index === 0}\r\n+                                title=\"Move up\"\r\n                               >\r\n                                 <i className=\"bi bi-arrow-up\"></i>\r\n                               </button>\r\n                               <button\r\n-                                className=\"btn btn-outline-primary\"\r\n+                                className=\"btn btn-outline-secondary\"\r\n                                 onClick={() => handleMoveSection(selectedPage, section.key, 'down')}\r\n-                                title=\"Move Down\"\r\n-                                disabled={loading || index === sections.length - 1}\r\n+                                disabled={index === sections.length - 1}\r\n+                                title=\"Move down\"\r\n                               >\r\n                                 <i className=\"bi bi-arrow-down\"></i>\r\n                               </button>\r\n-                              <button\r\n-                                className=\"btn btn-outline-secondary\"\r\n-                                onClick={() => handleManageSection(section.key)}\r\n-                                title=\"Section Settings\"\r\n-                                disabled={loading}\r\n-                              >\r\n-                                <i className=\"bi bi-gear\"></i>\r\n-                              </button>\r\n                             </div>\r\n                           </td>\r\n                         </tr>\r\n                       )\r\n@@ -461,8 +681,11 @@\n         {renderPageSidebar()}\r\n         {renderSections()}\r\n       </div>\r\n \r\n+      {/* Category Configuration Modal */}\r\n+      {renderCategoryConfigModal()}\r\n+\r\n       {/* Loading Overlay */}\r\n       {loading && (\r\n         <div className=\"position-fixed top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center\" \r\n              style={{ backgroundColor: 'rgba(0,0,0,0.5)', zIndex: 9999 }}>\r\n@@ -470,18 +693,7 @@\n             <span className=\"visually-hidden\">Loading...</span>\r\n           </div>\r\n         </div>\r\n       )}\r\n-\r\n-      {/* Section Management Modal */}\r\n-      {showSectionModal && modalSectionKey && modalSectionData && (\r\n-        <SectionManager\r\n-          pageKey={selectedPage}\r\n-          sectionKey={modalSectionKey}\r\n-          sectionData={modalSectionData}\r\n-          onClose={closeSectionModal}\r\n-          onUpdate={handleSectionUpdate}\r\n-        />\r\n-      )}\r\n     </div>\r\n   )\r\n }\r\n"
                },
                {
                    "date": 1753162069707,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,7 +1,8 @@\n 'use client'\r\n import React, { useState, useEffect } from 'react'\r\n import { get, post, put } from '@/util/apiService'\r\n+import { CATEGORY } from '@/util/apiEndpoints'\r\n \r\n const PAGES = [\r\n   { \r\n     key: \"home\", \r\n@@ -128,14 +129,18 @@\n       setLoading(true)\r\n       localStorage.setItem('authToken', ADMIN_TOKEN)\r\n       \r\n       const response = await get(`/api/pages/${pageKey}`)\r\n+      console.log('Page config response:', response)\r\n       \r\n-      if (response.success) {\r\n-        setPageConfig(response.data)\r\n+      // Handle the double-wrapped response from apiService\r\n+      const actualData = response.data // This contains the backend response\r\n+      \r\n+      if (actualData && actualData.success) {\r\n+        setPageConfig(actualData.data)\r\n         \r\n         // Extract category section config\r\n-        const categorySection = response.data.sections.find(s => s.sectionType === 'categorySection')\r\n+        const categorySection = actualData.data.sections.find(s => s.sectionType === 'categorySection')\r\n         if (categorySection) {\r\n           setCategoryConfig({\r\n             enabled: categorySection.enabled,\r\n             maxCategories: categorySection.config.maxCategories || 6,\r\n@@ -163,17 +168,106 @@\n       setLoading(false)\r\n     }\r\n   }\r\n \r\n-  // Load available categories\r\n+  // Load available categories (same approach as CategoriesPage.js)\r\n   const loadCategories = async () => {\r\n     try {\r\n-      const response = await get('/api/categories')\r\n-      if (response.success) {\r\n-        setAvailableCategories(response.data)\r\n+      console.log('🔄 === LOADING CATEGORIES DEBUG ===')\r\n+      console.log('1. Setting auth token...')\r\n+      localStorage.setItem('authToken', ADMIN_TOKEN)\r\n+      \r\n+      console.log('2. Making API call to:', CATEGORY.GET_ALL)\r\n+      const response = await get(CATEGORY.GET_ALL)\r\n+      \r\n+      console.log('3. Raw API response received:')\r\n+      console.log('   - Response object:', response)\r\n+      console.log('   - Response type:', typeof response)\r\n+      console.log('   - Response keys:', Object.keys(response || {}))\r\n+      console.log('   - Response.success:', response?.success)\r\n+      console.log('   - Response.data:', response?.data)\r\n+      console.log('   - Response.data type:', typeof response?.data)\r\n+      console.log('   - Response.data is array:', Array.isArray(response?.data))\r\n+      \r\n+      if (!response.success) {\r\n+        console.error('4. ❌ API response failed:', response.error)\r\n+        throw new Error(response.error || 'Failed to fetch categories')\r\n       }\r\n+      \r\n+      console.log('4. ✅ API response successful')\r\n+      console.log('5. Processing response.data...')\r\n+      console.log('   - Raw response.data:', JSON.stringify(response.data, null, 2))\r\n+      \r\n+      // Ensure response.data is an array\r\n+      let categoriesData = []\r\n+      if (Array.isArray(response.data)) {\r\n+        console.log('   - Response.data is direct array with', response.data.length, 'items')\r\n+        categoriesData = response.data\r\n+      } else if (response.data && typeof response.data === 'object') {\r\n+        console.log('   - Response.data is object, checking for nested arrays...')\r\n+        if (Array.isArray(response.data.categories)) {\r\n+          console.log('   - Found response.data.categories array with', response.data.categories.length, 'items')\r\n+          categoriesData = response.data.categories\r\n+        } else if (Array.isArray(response.data.data)) {\r\n+          console.log('   - Found response.data.data array with', response.data.data.length, 'items')\r\n+          categoriesData = response.data.data\r\n+        } else {\r\n+          console.log('   - No recognizable array found in response.data')\r\n+          categoriesData = []\r\n+        }\r\n+      }\r\n+      \r\n+      console.log('6. Categories data to process:')\r\n+      console.log('   - Array length:', categoriesData.length)\r\n+      console.log('   - Sample items (first 3):')\r\n+      categoriesData.slice(0, 3).forEach((cat, index) => {\r\n+        console.log(`     ${index + 1}.`, cat)\r\n+      })\r\n+      \r\n+      // Transform categories for display in the admin panel\r\n+      console.log('7. Transforming categories...')\r\n+      const transformedCategories = categoriesData.map((cat, index) => {\r\n+        console.log(`   - Transforming category ${index + 1}:`, {\r\n+          originalId: cat._id,\r\n+          originalName: cat.name,\r\n+          hasParent: !!cat.parent,\r\n+          parentInfo: cat.parent\r\n+        })\r\n+        \r\n+        return {\r\n+          id: cat.id || cat._id,\r\n+          value: cat.id || cat._id,\r\n+          label: cat.name,\r\n+          name: cat.name,\r\n+          image: cat.image?.url || '/assets/img/product/category/default-category.svg',\r\n+          description: cat.description || '',\r\n+          parent: cat.parent\r\n+        }\r\n+      })\r\n+      \r\n+      console.log('8. Final transformed categories:')\r\n+      console.log('   - Total transformed:', transformedCategories.length)\r\n+      console.log('   - Main categories:', transformedCategories.filter(cat => !cat.parent).length)\r\n+      console.log('   - Sub categories:', transformedCategories.filter(cat => cat.parent).length)\r\n+      console.log('   - Full transformed data:', transformedCategories)\r\n+      \r\n+      console.log('9. Setting availableCategories state...')\r\n+      setAvailableCategories(transformedCategories)\r\n+      setError('')\r\n+      \r\n+      console.log('10. ✅ Categories loaded successfully!')\r\n+      console.log('🔚 === END LOADING CATEGORIES DEBUG ===')\r\n+      \r\n     } catch (err) {\r\n-      console.error('Load categories error:', err)\r\n+      console.error('❌ === LOAD CATEGORIES ERROR ===')\r\n+      console.error('Error details:', {\r\n+        message: err.message,\r\n+        stack: err.stack,\r\n+        name: err.name\r\n+      })\r\n+      console.error('Raw error object:', err)\r\n+      setError('Failed to load categories: ' + err.message)\r\n+      setAvailableCategories([])\r\n     }\r\n   }\r\n \r\n   // Save category section configuration\r\n@@ -181,27 +275,41 @@\n     try {\r\n       setLoading(true)\r\n       localStorage.setItem('authToken', ADMIN_TOKEN)\r\n       \r\n-      const sectionData = {\r\n-        sectionType: 'categorySection',\r\n+      const configData = {\r\n         enabled: categoryConfig.enabled,\r\n-        order: 1,\r\n-        config: {\r\n-          maxCategories: categoryConfig.maxCategories,\r\n-          categoryIds: categoryConfig.categoryIds,\r\n-          layout: categoryConfig.layout,\r\n-          showSubcategories: categoryConfig.showSubcategories\r\n-        }\r\n+        maxCategories: categoryConfig.maxCategories,\r\n+        categories: categoryConfig.categoryIds.map((id, index) => ({\r\n+          categoryId: id,\r\n+          enabled: true,\r\n+          order: index\r\n+        })),\r\n+        layout: categoryConfig.layout,\r\n+        showSubcategories: categoryConfig.showSubcategories\r\n       }\r\n       \r\n-      const response = await put(`/api/pages/${selectedPage}/sections/category`, sectionData)\r\n+      const response = await put('/api/pages/home/sections/category', configData)\r\n+      console.log('Save response:', response)\r\n       \r\n-      if (response.success) {\r\n+      // Handle the double-wrapped response from apiService\r\n+      const actualData = response.data // This contains the backend response\r\n+      \r\n+      if (actualData && actualData.success) {\r\n         setSuccess('Category section configuration saved successfully!')\r\n         setTimeout(() => setSuccess(''), 3000)\r\n         setShowCategoryConfig(false)\r\n+        \r\n+        // Trigger refresh notification (optional)\r\n+        try {\r\n+          await get('/api/pages/home/refresh/categorySection')\r\n+        } catch (refreshError) {\r\n+          console.log('Refresh notification failed, but save was successful')\r\n+        }\r\n+        \r\n         await loadPageConfig(selectedPage) // Reload to get updated config\r\n+      } else {\r\n+        setError('Failed to save configuration: ' + (actualData?.message || 'Unknown error'))\r\n       }\r\n       \r\n     } catch (err) {\r\n       console.error('Save category config error:', err)\r\n@@ -267,8 +375,23 @@\n   // Render category configuration modal\r\n   const renderCategoryConfigModal = () => {\r\n     if (!showCategoryConfig) return null\r\n \r\n+    console.log('🎨 === RENDERING CATEGORY MODAL DEBUG ===')\r\n+    console.log('1. Modal render triggered')\r\n+    console.log('2. availableCategories state:')\r\n+    console.log('   - Length:', availableCategories.length)\r\n+    console.log('   - Is array:', Array.isArray(availableCategories))\r\n+    console.log('   - Full data:', availableCategories)\r\n+    \r\n+    console.log('3. Category breakdown:')\r\n+    const mainCategories = availableCategories.filter(cat => !cat.parent)\r\n+    const subCategories = availableCategories.filter(cat => cat.parent)\r\n+    console.log('   - Main categories:', mainCategories.length, mainCategories)\r\n+    console.log('   - Sub categories:', subCategories.length, subCategories)\r\n+    \r\n+    console.log('4. About to map through categories for rendering...')\r\n+\r\n     return (\r\n       <div className=\"modal show d-block\" style={{ backgroundColor: 'rgba(0,0,0,0.5)' }}>\r\n         <div className=\"modal-dialog modal-lg\">\r\n           <div className=\"modal-content\">\r\n@@ -336,48 +459,109 @@\n                   {/* Category Selection */}\r\n                   <div className=\"row mb-4\">\r\n                     <div className=\"col-12\">\r\n                       <label className=\"form-label fw-semibold\">Select Categories to Display</label>\r\n-                      <div className=\"text-muted mb-3\">\r\n+                      <div className=\"text-muted mb-2\">\r\n                         Choose which categories to show. Leave empty to show all categories.\r\n                       </div>\r\n                       \r\n+                      {/* Debug Info - Temporary */}\r\n+                      <div className=\"alert alert-info small mb-3\">\r\n+                        <strong>Debug Info:</strong> Found {availableCategories.length} total categories \r\n+                        ({availableCategories.filter(cat => !cat.parent).length} main, {availableCategories.filter(cat => cat.parent).length} sub)\r\n+                      </div>\r\n+                      \r\n+                      {/* Category Statistics */}\r\n+                      {availableCategories.length > 0 && (\r\n+                        <div className=\"row mb-3\">\r\n+                          <div className=\"col-md-4\">\r\n+                            <div className=\"small bg-light p-2 rounded text-center\">\r\n+                              <strong>{availableCategories.filter(cat => !cat.parent).length}</strong>\r\n+                              <br />\r\n+                              <span className=\"text-muted\">Main Categories</span>\r\n+                            </div>\r\n+                          </div>\r\n+                          <div className=\"col-md-4\">\r\n+                            <div className=\"small bg-light p-2 rounded text-center\">\r\n+                              <strong>{availableCategories.filter(cat => cat.parent).length}</strong>\r\n+                              <br />\r\n+                              <span className=\"text-muted\">Sub Categories</span>\r\n+                            </div>\r\n+                          </div>\r\n+                          <div className=\"col-md-4\">\r\n+                            <div className=\"small bg-primary text-white p-2 rounded text-center\">\r\n+                              <strong>{categoryConfig.categoryIds.length}</strong>\r\n+                              <br />\r\n+                              <span>Selected</span>\r\n+                            </div>\r\n+                          </div>\r\n+                        </div>\r\n+                      )}\r\n+                      \r\n                       <div className=\"row\">\r\n-                        {availableCategories.map(category => (\r\n-                          <div key={category.id} className=\"col-md-6 col-lg-4 mb-3\">\r\n-                            <div className={`card h-100 ${categoryConfig.categoryIds.includes(category.id) ? 'border-primary bg-light' : ''}`}>\r\n-                              <div className=\"card-body p-3\">\r\n-                                <div className=\"form-check\">\r\n-                                  <input \r\n-                                    className=\"form-check-input\" \r\n-                                    type=\"checkbox\" \r\n-                                    id={`category-${category.id}`}\r\n-                                    checked={categoryConfig.categoryIds.includes(category.id)}\r\n-                                    onChange={() => handleCategoryToggle(category.id)}\r\n-                                  />\r\n-                                  <label className=\"form-check-label\" htmlFor={`category-${category.id}`}>\r\n-                                    <div className=\"d-flex align-items-center\">\r\n-                                      {category.image && (\r\n-                                        <img \r\n-                                          src={category.image} \r\n-                                          alt={category.name}\r\n-                                          className=\"me-2\"\r\n-                                          style={{ width: '32px', height: '32px', objectFit: 'cover', borderRadius: '4px' }}\r\n-                                        />\r\n-                                      )}\r\n-                                      <div>\r\n-                                        <div className=\"fw-semibold\">{category.name}</div>\r\n-                                        {category.description && (\r\n-                                          <small className=\"text-muted\">{category.description}</small>\r\n+                        {availableCategories.map((category, index) => {\r\n+                          console.log(`🎨 Rendering category ${index + 1}:`, category)\r\n+                          const isMainCategory = !category.parent;\r\n+                          \r\n+                          return (\r\n+                            <div key={category.id} className=\"col-md-6 col-lg-4 mb-3\">\r\n+                              <div className={`card h-100 ${categoryConfig.categoryIds.includes(category.id) ? 'border-primary bg-light' : ''}`}>\r\n+                                <div className=\"card-body p-3\">\r\n+                                  <div className=\"form-check\">\r\n+                                    <input \r\n+                                      className=\"form-check-input\" \r\n+                                      type=\"checkbox\" \r\n+                                      id={`category-${category.id}`}\r\n+                                      checked={categoryConfig.categoryIds.includes(category.id)}\r\n+                                      onChange={() => handleCategoryToggle(category.id)}\r\n+                                    />\r\n+                                    <label className=\"form-check-label w-100\" htmlFor={`category-${category.id}`}>\r\n+                                      <div className=\"d-flex align-items-start\">\r\n+                                        {category.image && (\r\n+                                          <img \r\n+                                            src={category.image} \r\n+                                            alt={category.name}\r\n+                                            className=\"me-2 flex-shrink-0\"\r\n+                                            style={{ width: '32px', height: '32px', objectFit: 'cover', borderRadius: '4px' }}\r\n+                                          />\r\n                                         )}\r\n+                                        <div className=\"flex-grow-1\">\r\n+                                          <div className=\"d-flex align-items-center\">\r\n+                                            {isMainCategory ? (\r\n+                                              <>\r\n+                                                <i className=\"bi bi-grid text-primary me-1\" style={{ fontSize: '14px' }}></i>\r\n+                                                <span className=\"fw-semibold\">{category.name}</span>\r\n+                                              </>\r\n+                                            ) : (\r\n+                                              <>\r\n+                                                <i className=\"bi bi-arrow-return-right text-muted me-1\" style={{ fontSize: '12px' }}></i>\r\n+                                                <i className=\"bi bi-tag text-secondary me-1\" style={{ fontSize: '12px' }}></i>\r\n+                                                <span className=\"fw-semibold\">{category.name}</span>\r\n+                                              </>\r\n+                                            )}\r\n+                                          </div>\r\n+                                          {category.parent && (\r\n+                                            <small className=\"text-muted d-block\">\r\n+                                              Under: {category.parent.name || category.parent}\r\n+                                            </small>\r\n+                                          )}\r\n+                                          {category.description && (\r\n+                                            <small className=\"text-muted d-block mt-1\">{category.description}</small>\r\n+                                          )}\r\n+                                          <div className=\"mt-1\">\r\n+                                            <span className={`badge ${isMainCategory ? 'bg-primary' : 'bg-secondary'}`} style={{ fontSize: '10px' }}>\r\n+                                              {isMainCategory ? 'Main Category' : 'Sub Category'}\r\n+                                            </span>\r\n+                                          </div>\r\n+                                        </div>\r\n                                       </div>\r\n-                                    </div>\r\n-                                  </label>\r\n+                                    </label>\r\n+                                  </div>\r\n                                 </div>\r\n                               </div>\r\n                             </div>\r\n-                          </div>\r\n-                        ))}\r\n+                          );\r\n+                        })}\r\n                       </div>\r\n                       \r\n                       {availableCategories.length === 0 && (\r\n                         <div className=\"text-center py-4\">\r\n@@ -631,9 +815,9 @@\n             </div>\r\n             <div className=\"d-flex gap-2\">\r\n               <button\r\n                 className=\"btn btn-outline-primary\"\r\n-                onClick={() => loadPageSections(selectedPage)}\r\n+                onClick={() => loadPageConfig(selectedPage)}\r\n                 disabled={loading}\r\n               >\r\n                 <i className=\"bi bi-arrow-clockwise me-2\"></i>\r\n                 Refresh\r\n"
                },
                {
                    "date": 1753164626280,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,8 +1,8 @@\n 'use client'\r\n import React, { useState, useEffect } from 'react'\r\n import { get, post, put } from '@/util/apiService'\r\n-import { CATEGORY } from '@/util/apiEndpoints'\r\n+import { CATEGORY, SUBCATEGORY } from '@/util/apiEndpoints'\r\n \r\n const PAGES = [\r\n   { \r\n     key: \"home\", \r\n@@ -22,8 +22,9 @@\n   const [error, setError] = useState('')\r\n   const [success, setSuccess] = useState('')\r\n   const [showCategoryConfig, setShowCategoryConfig] = useState(false)\r\n   const [availableCategories, setAvailableCategories] = useState([])\r\n+  const [subcategories, setSubcategories] = useState([])\r\n   const [pageConfig, setPageConfig] = useState(null)\r\n \r\n   // Category section configuration state\r\n   const [categoryConfig, setCategoryConfig] = useState({\r\n@@ -33,8 +34,11 @@\n     layout: 'grid',\r\n     showSubcategories: true\r\n   })\r\n \r\n+  // UI state for category selection\r\n+  const [selectedMainCategory, setSelectedMainCategory] = useState(null)\r\n+\r\n   // Define sections for each page\r\n   const homeSections = [\r\n     { \r\n       key: \"giftCategories\", \r\n@@ -269,8 +273,93 @@\n       setAvailableCategories([])\r\n     }\r\n   }\r\n \r\n+  // Load subcategories from separate subcategories collection\r\n+  const loadSubcategories = async () => {\r\n+    try {\r\n+      console.log('🔄 === LOADING SUBCATEGORIES DEBUG ===')\r\n+      console.log('1. Setting auth token...')\r\n+      localStorage.setItem('authToken', ADMIN_TOKEN)\r\n+      \r\n+      console.log('2. Making API call to:', SUBCATEGORY.GET_ALL)\r\n+      const response = await get(SUBCATEGORY.GET_ALL)\r\n+      \r\n+      console.log('3. Raw subcategories response:')\r\n+      console.log('   - Response object:', response)\r\n+      console.log('   - Response.success:', response?.success)\r\n+      console.log('   - Response.data:', response?.data)\r\n+      console.log('   - Response.data is array:', Array.isArray(response?.data))\r\n+      \r\n+      if (!response.success) {\r\n+        console.error('4. ❌ Subcategories API response failed:', response.error)\r\n+        throw new Error(response.error || 'Failed to fetch subcategories')\r\n+      }\r\n+      \r\n+      console.log('4. ✅ Subcategories API response successful')\r\n+      console.log('5. Processing subcategories data...')\r\n+      \r\n+      let subcategoriesData = []\r\n+      if (Array.isArray(response.data)) {\r\n+        subcategoriesData = response.data\r\n+      } else if (response.data && Array.isArray(response.data.data)) {\r\n+        subcategoriesData = response.data.data\r\n+      }\r\n+      \r\n+      console.log('6. Subcategories data to process:')\r\n+      console.log('   - Array length:', subcategoriesData.length)\r\n+      console.log('   - Sample items (first 3):')\r\n+      subcategoriesData.slice(0, 3).forEach((subcat, index) => {\r\n+        console.log(`     ${index + 1}.`, {\r\n+          id: subcat._id,\r\n+          name: subcat.name,\r\n+          parent: subcat.parent,\r\n+          status: subcat.status\r\n+        })\r\n+      })\r\n+      \r\n+      // Transform subcategories for display\r\n+      const transformedSubcategories = subcategoriesData.map((subcat, index) => {\r\n+        console.log(`   - Transforming subcategory ${index + 1}:`, {\r\n+          originalId: subcat._id,\r\n+          originalName: subcat.name,\r\n+          parentId: subcat.parent?._id || subcat.parent,\r\n+          parentName: subcat.parent?.name\r\n+        })\r\n+        \r\n+        return {\r\n+          id: subcat.id || subcat._id,\r\n+          value: subcat.id || subcat._id,\r\n+          label: subcat.name,\r\n+          name: subcat.name,\r\n+          image: subcat.image?.url || '/assets/img/product/category/default-subcategory.svg',\r\n+          description: subcat.description || '',\r\n+          parent: subcat.parent,\r\n+          status: subcat.status\r\n+        }\r\n+      })\r\n+      \r\n+      console.log('7. Final transformed subcategories:')\r\n+      console.log('   - Total transformed:', transformedSubcategories.length)\r\n+      console.log('   - Full transformed data:', transformedSubcategories)\r\n+      \r\n+      console.log('8. Setting subcategories state...')\r\n+      setSubcategories(transformedSubcategories)\r\n+      \r\n+      console.log('9. ✅ Subcategories loaded successfully!')\r\n+      console.log('🔚 === END LOADING SUBCATEGORIES DEBUG ===')\r\n+      \r\n+    } catch (err) {\r\n+      console.error('❌ === LOAD SUBCATEGORIES ERROR ===')\r\n+      console.error('Error details:', {\r\n+        message: err.message,\r\n+        stack: err.stack,\r\n+        name: err.name\r\n+      })\r\n+      setSubcategories([])\r\n+    }\r\n+  }\r\n+\r\n   // Save category section configuration\r\n   const saveCategoryConfig = async () => {\r\n     try {\r\n       setLoading(true)\r\n@@ -340,8 +429,13 @@\n \r\n   // Open category configuration modal\r\n   const openCategoryConfig = () => {\r\n     setShowCategoryConfig(true)\r\n+    // Reset to first main category when opening modal\r\n+    const mainCategories = availableCategories.filter(cat => !cat.parent)\r\n+    if (mainCategories.length > 0) {\r\n+      setSelectedMainCategory(mainCategories[0].id)\r\n+    }\r\n   }\r\n \r\n   // Handle category selection\r\n   const handleCategoryToggle = (categoryId) => {\r\n@@ -362,10 +456,14 @@\n   }\r\n \r\n   // Load data when page changes\r\n   useEffect(() => {\r\n-    loadPageConfig(selectedPage)\r\n-    loadCategories()\r\n+    const loadData = async () => {\r\n+      await loadPageConfig(selectedPage)\r\n+      await loadCategories()\r\n+      await loadSubcategories()\r\n+    }\r\n+    loadData()\r\n   }, [selectedPage])\r\n \r\n   // Get sections for current page\r\n   const getCurrentSections = () => {\r\n@@ -382,19 +480,38 @@\n     console.log('   - Length:', availableCategories.length)\r\n     console.log('   - Is array:', Array.isArray(availableCategories))\r\n     console.log('   - Full data:', availableCategories)\r\n     \r\n+    const mainCategories = availableCategories.filter(cat => !cat.parent)\r\n+    const subCategories = subcategories // Use the separate subcategories state\r\n+    \r\n     console.log('3. Category breakdown:')\r\n-    const mainCategories = availableCategories.filter(cat => !cat.parent)\r\n-    const subCategories = availableCategories.filter(cat => cat.parent)\r\n     console.log('   - Main categories:', mainCategories.length, mainCategories)\r\n     console.log('   - Sub categories:', subCategories.length, subCategories)\r\n     \r\n-    console.log('4. About to map through categories for rendering...')\r\n+    // Get subcategories for selected main category\r\n+    const getSubcategoriesForCategory = (categoryId) => {\r\n+      console.log('🔍 Getting subcategories for category ID:', categoryId)\r\n+      const filtered = subCategories.filter(subCat => {\r\n+        const parentId = subCat.parent?._id || subCat.parent\r\n+        console.log(`   - Checking subcategory \"${subCat.name}\": parent=${parentId}, matches=${parentId === categoryId}`)\r\n+        return parentId === categoryId\r\n+      })\r\n+      console.log(`   - Found ${filtered.length} subcategories for category ${categoryId}:`, filtered)\r\n+      return filtered\r\n+    }\r\n \r\n+    // Auto-select first main category if none selected\r\n+    if (!selectedMainCategory && mainCategories.length > 0) {\r\n+      setSelectedMainCategory(mainCategories[0].id)\r\n+    }\r\n+\r\n+    const selectedCategorySubcategories = selectedMainCategory ? \r\n+      getSubcategoriesForCategory(selectedMainCategory) : []\r\n+\r\n     return (\r\n       <div className=\"modal show d-block\" style={{ backgroundColor: 'rgba(0,0,0,0.5)' }}>\r\n-        <div className=\"modal-dialog modal-lg\">\r\n+        <div className=\"modal-dialog modal-xl\">\r\n           <div className=\"modal-content\">\r\n             <div className=\"modal-header\">\r\n               <h5 className=\"modal-title\">\r\n                 <i className=\"bi bi-grid-3x3-gap me-2\"></i>\r\n@@ -427,11 +544,11 @@\n               </div>\r\n \r\n               {categoryConfig.enabled && (\r\n                 <>\r\n-                  {/* Max Categories */}\r\n+                  {/* Configuration Options */}\r\n                   <div className=\"row mb-4\">\r\n-                    <div className=\"col-md-6\">\r\n+                    <div className=\"col-md-4\">\r\n                       <label className=\"form-label fw-semibold\">Maximum Categories to Show</label>\r\n                       <input \r\n                         type=\"number\" \r\n                         className=\"form-control\"\r\n@@ -441,9 +558,9 @@\n                         onChange={(e) => handleMaxCategoriesChange(e.target.value)}\r\n                       />\r\n                       <small className=\"text-muted\">Limit how many categories appear (0 = no limit)</small>\r\n                     </div>\r\n-                    <div className=\"col-md-6\">\r\n+                    <div className=\"col-md-4\">\r\n                       <label className=\"form-label fw-semibold\">Layout Style</label>\r\n                       <select \r\n                         className=\"form-select\"\r\n                         value={categoryConfig.layout}\r\n@@ -453,143 +570,387 @@\n                         <option value=\"carousel\">Carousel</option>\r\n                         <option value=\"list\">List View</option>\r\n                       </select>\r\n                     </div>\r\n+                    <div className=\"col-md-4\">\r\n+                      <div className=\"form-check mt-4\">\r\n+                        <input \r\n+                          className=\"form-check-input\" \r\n+                          type=\"checkbox\" \r\n+                          id=\"showSubcategories\"\r\n+                          checked={categoryConfig.showSubcategories}\r\n+                          onChange={(e) => setCategoryConfig(prev => ({ ...prev, showSubcategories: e.target.checked }))}\r\n+                        />\r\n+                        <label className=\"form-check-label\" htmlFor=\"showSubcategories\">\r\n+                          Show subcategories on hover\r\n+                        </label>\r\n+                      </div>\r\n+                    </div>\r\n                   </div>\r\n \r\n-                  {/* Category Selection */}\r\n+                  {/* Selection Summary */}\r\n                   <div className=\"row mb-4\">\r\n                     <div className=\"col-12\">\r\n-                      <label className=\"form-label fw-semibold\">Select Categories to Display</label>\r\n-                      <div className=\"text-muted mb-2\">\r\n-                        Choose which categories to show. Leave empty to show all categories.\r\n+                      <div className=\"alert alert-info d-flex align-items-center\">\r\n+                        <i className=\"bi bi-info-circle me-2\"></i>\r\n+                        <div>\r\n+                          <strong>Selection Summary:</strong> {categoryConfig.categoryIds.length} categories selected \r\n+                          ({categoryConfig.categoryIds.filter(id => mainCategories.some(cat => cat.id === id)).length} main categories, {categoryConfig.categoryIds.filter(id => subCategories.some(cat => cat.id === id)).length} subcategories)\r\n+                        </div>\r\n                       </div>\r\n+                    </div>\r\n+                  </div>\r\n+\r\n+                  {/* Category Selection Interface */}\r\n+                  <div className=\"row mb-4\">\r\n+                    <div className=\"col-12\">\r\n+                      <label className=\"form-label fw-semibold mb-3\">Select Categories and Subcategories</label>\r\n                       \r\n-                      {/* Debug Info - Temporary */}\r\n-                      <div className=\"alert alert-info small mb-3\">\r\n-                        <strong>Debug Info:</strong> Found {availableCategories.length} total categories \r\n-                        ({availableCategories.filter(cat => !cat.parent).length} main, {availableCategories.filter(cat => cat.parent).length} sub)\r\n-                      </div>\r\n-                      \r\n-                      {/* Category Statistics */}\r\n-                      {availableCategories.length > 0 && (\r\n-                        <div className=\"row mb-3\">\r\n-                          <div className=\"col-md-4\">\r\n-                            <div className=\"small bg-light p-2 rounded text-center\">\r\n-                              <strong>{availableCategories.filter(cat => !cat.parent).length}</strong>\r\n-                              <br />\r\n-                              <span className=\"text-muted\">Main Categories</span>\r\n+                      {mainCategories.length > 0 ? (\r\n+                        <div className=\"row\">\r\n+                          {/* Left Side - Main Categories */}\r\n+                          <div className=\"col-md-6\">\r\n+                            <div className=\"card\">\r\n+                              <div className=\"card-header bg-light d-flex justify-content-between align-items-center\">\r\n+                                <h6 className=\"mb-0\">\r\n+                                  <i className=\"bi bi-grid text-primary me-2\"></i>\r\n+                                  Main Categories ({mainCategories.length})\r\n+                                </h6>\r\n+                                <span className=\"badge bg-primary\">\r\n+                                  {categoryConfig.categoryIds.filter(id => mainCategories.some(cat => cat.id === id)).length} selected\r\n+                                </span>\r\n+                              </div>\r\n+                              <div className=\"card-body p-0\">\r\n+                                <div className=\"list-group list-group-flush\" style={{ maxHeight: '400px', overflowY: 'auto' }}>\r\n+                                  {mainCategories.map((category, index) => {\r\n+                                    const isSelected = categoryConfig.categoryIds.includes(category.id)\r\n+                                    const isActiveTab = selectedMainCategory === category.id\r\n+                                    const subcategoryCount = getSubcategoriesForCategory(category.id).length\r\n+                                    const selectedSubcategoryCount = getSubcategoriesForCategory(category.id)\r\n+                                      .filter(sub => categoryConfig.categoryIds.includes(sub.id)).length\r\n+                                    \r\n+                                    return (\r\n+                                      <div \r\n+                                        key={category.id} \r\n+                                        className={`list-group-item list-group-item-action border-0 ${isActiveTab ? 'active' : ''} ${isSelected ? 'bg-primary bg-opacity-10 border-start border-primary border-3' : ''}`}\r\n+                                        style={{ cursor: 'pointer' }}\r\n+                                        onClick={() => setSelectedMainCategory(category.id)}\r\n+                                      >\r\n+                                        <div className=\"d-flex align-items-center\">\r\n+                                          <div className=\"form-check me-3\" onClick={(e) => e.stopPropagation()}>\r\n+                                            <input \r\n+                                              className=\"form-check-input\" \r\n+                                              type=\"checkbox\" \r\n+                                              id={`main-category-${category.id}`}\r\n+                                              checked={isSelected}\r\n+                                              onChange={() => handleCategoryToggle(category.id)}\r\n+                                            />\r\n+                                          </div>\r\n+                                          \r\n+                                          {category.image && (\r\n+                                            <img \r\n+                                              src={category.image} \r\n+                                              alt={category.name}\r\n+                                              className=\"me-3 flex-shrink-0 border\"\r\n+                                              style={{ width: '42px', height: '42px', objectFit: 'cover', borderRadius: '8px' }}\r\n+                                            />\r\n+                                          )}\r\n+                                          \r\n+                                          <div className=\"flex-grow-1\">\r\n+                                            <div className=\"d-flex justify-content-between align-items-center\">\r\n+                                              <div>\r\n+                                                <h6 className={`mb-1 fw-semibold ${isActiveTab ? 'text-white' : 'text-dark'}`}>\r\n+                                                  <i className=\"bi bi-grid text-primary me-1\" style={{ fontSize: '14px' }}></i>\r\n+                                                  {category.name}\r\n+                                                </h6>\r\n+                                                {category.description && (\r\n+                                                  <p className={`mb-1 small ${isActiveTab ? 'text-white-50' : 'text-muted'}`}>\r\n+                                                    {category.description}\r\n+                                                  </p>\r\n+                                                )}\r\n+                                                <div className=\"d-flex gap-1 align-items-center\">\r\n+                                                  <span className={`badge ${isActiveTab ? 'bg-white text-primary' : 'bg-primary'}`} style={{ fontSize: '9px' }}>\r\n+                                                    Main Category\r\n+                                                  </span>\r\n+                                                  {isSelected && (\r\n+                                                    <span className={`badge ${isActiveTab ? 'bg-success text-white' : 'bg-success'}`} style={{ fontSize: '9px' }}>\r\n+                                                      <i className=\"bi bi-check-circle me-1\"></i>\r\n+                                                      Selected\r\n+                                                    </span>\r\n+                                                  )}\r\n+                                                </div>\r\n+                                              </div>\r\n+                                              <div className=\"text-end\">\r\n+                                                {subcategoryCount > 0 && (\r\n+                                                  <div className=\"mb-1\">\r\n+                                                    <span className={`badge ${isActiveTab ? 'bg-white text-primary' : 'bg-secondary'}`} style={{ fontSize: '10px' }}>\r\n+                                                      {subcategoryCount} subs\r\n+                                                    </span>\r\n+                                                  </div>\r\n+                                                )}\r\n+                                                {selectedSubcategoryCount > 0 && (\r\n+                                                  <div className=\"mb-1\">\r\n+                                                    <span className={`badge ${isActiveTab ? 'bg-success text-white' : 'bg-success'}`} style={{ fontSize: '10px' }}>\r\n+                                                      {selectedSubcategoryCount} selected\r\n+                                                    </span>\r\n+                                                  </div>\r\n+                                                )}\r\n+                                                <i className={`bi bi-chevron-right ${isActiveTab ? 'text-white' : 'text-muted'}`}></i>\r\n+                                              </div>\r\n+                                            </div>\r\n+                                          </div>\r\n+                                        </div>\r\n+                                      </div>\r\n+                                    )\r\n+                                  })}\r\n+                                </div>\r\n+                              </div>\r\n                             </div>\r\n                           </div>\r\n-                          <div className=\"col-md-4\">\r\n-                            <div className=\"small bg-light p-2 rounded text-center\">\r\n-                              <strong>{availableCategories.filter(cat => cat.parent).length}</strong>\r\n-                              <br />\r\n-                              <span className=\"text-muted\">Sub Categories</span>\r\n-                            </div>\r\n-                          </div>\r\n-                          <div className=\"col-md-4\">\r\n-                            <div className=\"small bg-primary text-white p-2 rounded text-center\">\r\n-                              <strong>{categoryConfig.categoryIds.length}</strong>\r\n-                              <br />\r\n-                              <span>Selected</span>\r\n-                            </div>\r\n-                          </div>\r\n-                        </div>\r\n-                      )}\r\n-                      \r\n-                      <div className=\"row\">\r\n-                        {availableCategories.map((category, index) => {\r\n-                          console.log(`🎨 Rendering category ${index + 1}:`, category)\r\n-                          const isMainCategory = !category.parent;\r\n-                          \r\n-                          return (\r\n-                            <div key={category.id} className=\"col-md-6 col-lg-4 mb-3\">\r\n-                              <div className={`card h-100 ${categoryConfig.categoryIds.includes(category.id) ? 'border-primary bg-light' : ''}`}>\r\n-                                <div className=\"card-body p-3\">\r\n-                                  <div className=\"form-check\">\r\n-                                    <input \r\n-                                      className=\"form-check-input\" \r\n-                                      type=\"checkbox\" \r\n-                                      id={`category-${category.id}`}\r\n-                                      checked={categoryConfig.categoryIds.includes(category.id)}\r\n-                                      onChange={() => handleCategoryToggle(category.id)}\r\n-                                    />\r\n-                                    <label className=\"form-check-label w-100\" htmlFor={`category-${category.id}`}>\r\n-                                      <div className=\"d-flex align-items-start\">\r\n-                                        {category.image && (\r\n-                                          <img \r\n-                                            src={category.image} \r\n-                                            alt={category.name}\r\n-                                            className=\"me-2 flex-shrink-0\"\r\n-                                            style={{ width: '32px', height: '32px', objectFit: 'cover', borderRadius: '4px' }}\r\n-                                          />\r\n-                                        )}\r\n-                                        <div className=\"flex-grow-1\">\r\n-                                          <div className=\"d-flex align-items-center\">\r\n-                                            {isMainCategory ? (\r\n-                                              <>\r\n-                                                <i className=\"bi bi-grid text-primary me-1\" style={{ fontSize: '14px' }}></i>\r\n-                                                <span className=\"fw-semibold\">{category.name}</span>\r\n-                                              </>\r\n-                                            ) : (\r\n-                                              <>\r\n-                                                <i className=\"bi bi-arrow-return-right text-muted me-1\" style={{ fontSize: '12px' }}></i>\r\n-                                                <i className=\"bi bi-tag text-secondary me-1\" style={{ fontSize: '12px' }}></i>\r\n-                                                <span className=\"fw-semibold\">{category.name}</span>\r\n-                                              </>\r\n-                                            )}\r\n+\r\n+                          {/* Right Side - Subcategories */}\r\n+                          <div className=\"col-md-6\">\r\n+                            <div className=\"card\">\r\n+                              <div className=\"card-header bg-light d-flex justify-content-between align-items-center\">\r\n+                                <h6 className=\"mb-0\">\r\n+                                  <i className=\"bi bi-tag text-secondary me-2\"></i>\r\n+                                  Subcategories\r\n+                                  {selectedMainCategory && (\r\n+                                    <span className=\"text-muted ms-2\">\r\n+                                      for \"{mainCategories.find(cat => cat.id === selectedMainCategory)?.name}\"\r\n+                                    </span>\r\n+                                  )}\r\n+                                </h6>\r\n+                                {selectedCategorySubcategories.length > 0 && (\r\n+                                  <span className=\"badge bg-secondary\">\r\n+                                    {selectedCategorySubcategories.length} subcategories\r\n+                                  </span>\r\n+                                )}\r\n+                              </div>\r\n+                              <div className=\"card-body p-0\">\r\n+                                {selectedMainCategory ? (\r\n+                                  selectedCategorySubcategories.length > 0 ? (\r\n+                                    <>\r\n+                                      {/* Subcategories Stats */}\r\n+                                      <div className=\"p-3 bg-light border-bottom\">\r\n+                                        <div className=\"row text-center\">\r\n+                                          <div className=\"col-6\">\r\n+                                            <div className=\"small\">\r\n+                                              <strong>{selectedCategorySubcategories.filter(sub => categoryConfig.categoryIds.includes(sub.id)).length}</strong>\r\n+                                              <br />\r\n+                                              <span className=\"text-muted\">Selected</span>\r\n+                                            </div>\r\n                                           </div>\r\n-                                          {category.parent && (\r\n-                                            <small className=\"text-muted d-block\">\r\n-                                              Under: {category.parent.name || category.parent}\r\n-                                            </small>\r\n-                                          )}\r\n-                                          {category.description && (\r\n-                                            <small className=\"text-muted d-block mt-1\">{category.description}</small>\r\n-                                          )}\r\n-                                          <div className=\"mt-1\">\r\n-                                            <span className={`badge ${isMainCategory ? 'bg-primary' : 'bg-secondary'}`} style={{ fontSize: '10px' }}>\r\n-                                              {isMainCategory ? 'Main Category' : 'Sub Category'}\r\n-                                            </span>\r\n+                                          <div className=\"col-6\">\r\n+                                            <div className=\"small\">\r\n+                                              <strong>{selectedCategorySubcategories.filter(sub => sub.status).length}</strong>\r\n+                                              <br />\r\n+                                              <span className=\"text-muted\">Active</span>\r\n+                                            </div>\r\n                                           </div>\r\n                                         </div>\r\n                                       </div>\r\n-                                    </label>\r\n+\r\n+                                      {/* Quick Actions for Subcategories */}\r\n+                                      <div className=\"p-2 border-bottom\">\r\n+                                        <div className=\"d-flex gap-1\">\r\n+                                          <button \r\n+                                            type=\"button\" \r\n+                                            className=\"btn btn-outline-success btn-sm\"\r\n+                                            onClick={() => {\r\n+                                              const currentSubIds = selectedCategorySubcategories.map(cat => cat.id)\r\n+                                              setCategoryConfig(prev => ({\r\n+                                                ...prev,\r\n+                                                categoryIds: [...new Set([...prev.categoryIds, ...currentSubIds])]\r\n+                                              }))\r\n+                                            }}\r\n+                                          >\r\n+                                            <i className=\"bi bi-check-all me-1\"></i>\r\n+                                            Select All\r\n+                                          </button>\r\n+                                          \r\n+                                          <button \r\n+                                            type=\"button\" \r\n+                                            className=\"btn btn-outline-secondary btn-sm\"\r\n+                                            onClick={() => {\r\n+                                              const currentSubIds = selectedCategorySubcategories.map(cat => cat.id)\r\n+                                              setCategoryConfig(prev => ({\r\n+                                                ...prev,\r\n+                                                categoryIds: prev.categoryIds.filter(id => !currentSubIds.includes(id))\r\n+                                              }))\r\n+                                            }}\r\n+                                          >\r\n+                                            <i className=\"bi bi-x-circle me-1\"></i>\r\n+                                            Clear All\r\n+                                          </button>\r\n+                                        </div>\r\n+                                      </div>\r\n+\r\n+                                      {/* Subcategories List */}\r\n+                                      <div className=\"list-group list-group-flush\" style={{ maxHeight: '350px', overflowY: 'auto' }}>\r\n+                                        {selectedCategorySubcategories.map((subcategory, index) => {\r\n+                                          const isSelected = categoryConfig.categoryIds.includes(subcategory.id)\r\n+                                          \r\n+                                          return (\r\n+                                            <div \r\n+                                              key={subcategory.id} \r\n+                                              className={`list-group-item list-group-item-action border-0 ${isSelected ? 'bg-success bg-opacity-10 border-start border-success border-3' : ''}`}\r\n+                                            >\r\n+                                              <div className=\"d-flex align-items-center\">\r\n+                                                <div className=\"form-check me-3\">\r\n+                                                  <input \r\n+                                                    className=\"form-check-input form-check-input-success\" \r\n+                                                    type=\"checkbox\" \r\n+                                                    id={`sub-category-${subcategory.id}`}\r\n+                                                    checked={isSelected}\r\n+                                                    onChange={() => handleCategoryToggle(subcategory.id)}\r\n+                                                  />\r\n+                                                </div>\r\n+                                                \r\n+                                                {subcategory.image && (\r\n+                                                  <img \r\n+                                                    src={subcategory.image} \r\n+                                                    alt={subcategory.name}\r\n+                                                    className=\"me-3 flex-shrink-0 border\"\r\n+                                                    style={{ width: '36px', height: '36px', objectFit: 'cover', borderRadius: '6px' }}\r\n+                                                  />\r\n+                                                )}\r\n+                                                \r\n+                                                <div className=\"flex-grow-1\">\r\n+                                                  <div className=\"d-flex justify-content-between align-items-start\">\r\n+                                                    <div>\r\n+                                                      <h6 className=\"mb-1 text-dark fw-semibold\">\r\n+                                                        <i className=\"bi bi-tag text-success me-1\" style={{ fontSize: '12px' }}></i>\r\n+                                                        {subcategory.name}\r\n+                                                      </h6>\r\n+                                                      {subcategory.description && (\r\n+                                                        <p className=\"mb-1 text-muted small\">{subcategory.description}</p>\r\n+                                                      )}\r\n+                                                      <div className=\"d-flex gap-1 align-items-center\">\r\n+                                                        <span className=\"badge bg-secondary\" style={{ fontSize: '9px' }}>\r\n+                                                          Subcategory\r\n+                                                        </span>\r\n+                                                        <span className={`badge ${subcategory.status ? 'bg-success' : 'bg-danger'}`} style={{ fontSize: '9px' }}>\r\n+                                                          {subcategory.status ? 'Active' : 'Inactive'}\r\n+                                                        </span>\r\n+                                                        {isSelected && (\r\n+                                                          <span className=\"badge bg-primary\" style={{ fontSize: '9px' }}>\r\n+                                                            <i className=\"bi bi-check-circle me-1\"></i>\r\n+                                                            Selected\r\n+                                                          </span>\r\n+                                                        )}\r\n+                                                      </div>\r\n+                                                    </div>\r\n+                                                    <div className=\"text-end\">\r\n+                                                      <small className=\"text-muted\">#{index + 1}</small>\r\n+                                                    </div>\r\n+                                                  </div>\r\n+                                                </div>\r\n+                                              </div>\r\n+                                            </div>\r\n+                                          )\r\n+                                        })}\r\n+                                      </div>\r\n+\r\n+                                      {/* Footer Info */}\r\n+                                      <div className=\"p-2 bg-light border-top text-center\">\r\n+                                        <small className=\"text-muted\">\r\n+                                          <i className=\"bi bi-info-circle me-1\"></i>\r\n+                                          Click checkboxes to select subcategories for homepage display\r\n+                                        </small>\r\n+                                      </div>\r\n+                                    </>\r\n+                                  ) : (\r\n+                                    <div className=\"text-center py-5\">\r\n+                                      <i className=\"bi bi-folder2-open text-muted\" style={{ fontSize: '2.5rem' }}></i>\r\n+                                      <h6 className=\"mt-3 text-muted\">No subcategories found</h6>\r\n+                                      <p className=\"text-muted mb-3\">\r\n+                                        The category \"{mainCategories.find(cat => cat.id === selectedMainCategory)?.name}\" doesn't have any subcategories yet.\r\n+                                      </p>\r\n+                                      <button \r\n+                                        className=\"btn btn-outline-primary btn-sm\"\r\n+                                        onClick={() => {\r\n+                                          // You can add navigation to create subcategory here\r\n+                                          alert('Navigate to Categories > Subcategories to create subcategories for this category')\r\n+                                        }}\r\n+                                      >\r\n+                                        <i className=\"bi bi-plus-circle me-1\"></i>\r\n+                                        Create Subcategories\r\n+                                      </button>\r\n+                                    </div>\r\n+                                  )\r\n+                                ) : (\r\n+                                  <div className=\"text-center py-5\">\r\n+                                    <i className=\"bi bi-arrow-left text-primary\" style={{ fontSize: '2.5rem' }}></i>\r\n+                                    <h6 className=\"mt-3 text-muted\">Select a main category</h6>\r\n+                                    <p className=\"text-muted mb-0\">\r\n+                                      Click on a main category from the left panel to view and select its subcategories.\r\n+                                    </p>\r\n                                   </div>\r\n-                                </div>\r\n+                                )}\r\n                               </div>\r\n                             </div>\r\n-                          );\r\n-                        })}\r\n-                      </div>\r\n-                      \r\n-                      {availableCategories.length === 0 && (\r\n-                        <div className=\"text-center py-4\">\r\n-                          <i className=\"bi bi-folder2-open\" style={{ fontSize: '2rem', color: '#6c757d' }}></i>\r\n-                          <p className=\"mt-2 text-muted\">No categories available. Create categories first.</p>\r\n+                          </div>\r\n                         </div>\r\n+                      ) : (\r\n+                        <div className=\"text-center py-5\">\r\n+                          <i className=\"bi bi-folder2-open text-muted\" style={{ fontSize: '3rem' }}></i>\r\n+                          <p className=\"mt-2 text-muted\">No categories available</p>\r\n+                          <small className=\"text-muted\">Create categories first to configure this section.</small>\r\n+                        </div>\r\n                       )}\r\n                     </div>\r\n                   </div>\r\n \r\n-                  {/* Additional Options */}\r\n-                  <div className=\"row\">\r\n-                    <div className=\"col-12\">\r\n-                      <div className=\"form-check\">\r\n-                        <input \r\n-                          className=\"form-check-input\" \r\n-                          type=\"checkbox\" \r\n-                          id=\"showSubcategories\"\r\n-                          checked={categoryConfig.showSubcategories}\r\n-                          onChange={(e) => setCategoryConfig(prev => ({ ...prev, showSubcategories: e.target.checked }))}\r\n-                        />\r\n-                        <label className=\"form-check-label\" htmlFor=\"showSubcategories\">\r\n-                          Show subcategories on hover\r\n-                        </label>\r\n+                  {/* Quick Actions */}\r\n+                  {mainCategories.length > 0 && (\r\n+                    <div className=\"row\">\r\n+                      <div className=\"col-12\">\r\n+                        <div className=\"d-flex gap-2 flex-wrap\">\r\n+                          <button \r\n+                            type=\"button\" \r\n+                            className=\"btn btn-outline-primary btn-sm\"\r\n+                            onClick={() => {\r\n+                              const allMainIds = mainCategories.map(cat => cat.id)\r\n+                              setCategoryConfig(prev => ({\r\n+                                ...prev,\r\n+                                categoryIds: [...new Set([...prev.categoryIds, ...allMainIds])]\r\n+                              }))\r\n+                            }}\r\n+                          >\r\n+                            <i className=\"bi bi-check-all me-1\"></i>\r\n+                            Select All Main Categories\r\n+                          </button>\r\n+                          \r\n+                          <button \r\n+                            type=\"button\" \r\n+                            className=\"btn btn-outline-success btn-sm\"\r\n+                            onClick={() => {\r\n+                              const allSubIds = subCategories.map(cat => cat.id)\r\n+                              setCategoryConfig(prev => ({\r\n+                                ...prev,\r\n+                                categoryIds: [...new Set([...prev.categoryIds, ...allSubIds])]\r\n+                              }))\r\n+                            }}\r\n+                          >\r\n+                            <i className=\"bi bi-tags me-1\"></i>\r\n+                            Select All Subcategories\r\n+                          </button>\r\n+                          \r\n+                          <button \r\n+                            type=\"button\" \r\n+                            className=\"btn btn-outline-secondary btn-sm\"\r\n+                            onClick={() => {\r\n+                              setCategoryConfig(prev => ({ ...prev, categoryIds: [] }))\r\n+                            }}\r\n+                          >\r\n+                            <i className=\"bi bi-x-circle me-1\"></i>\r\n+                            Clear All Selections\r\n+                          </button>\r\n+                        </div>\r\n                       </div>\r\n                     </div>\r\n-                  </div>\r\n+                  )}\r\n                 </>\r\n               )}\r\n             </div>\r\n             <div className=\"modal-footer\">\r\n"
                },
                {
                    "date": 1753173622144,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -25,17 +25,27 @@\n   const [availableCategories, setAvailableCategories] = useState([])\r\n   const [subcategories, setSubcategories] = useState([])\r\n   const [pageConfig, setPageConfig] = useState(null)\r\n \r\n-  // Category section configuration state\r\n+  // Category section configuration state - NEW HIERARCHICAL STRUCTURE\r\n   const [categoryConfig, setCategoryConfig] = useState({\r\n     enabled: true,\r\n-    maxCategories: 6,\r\n-    categoryIds: [],\r\n+    maxCategories: 10, // Keep for UI display\r\n     layout: 'grid',\r\n-    showSubcategories: true\r\n+    showSubcategories: true,\r\n+    // New hierarchical structure\r\n+    categories: [\r\n+      // Structure: { categoryId, enabled, order, type: 'main', subcategories: [...] }\r\n+    ],\r\n+    // Keep for backward compatibility and quick lookups\r\n+    categoryIds: []\r\n   })\r\n \r\n+  // Business rule constants\r\n+  const MAX_MAIN_CATEGORIES = 10\r\n+  const MIN_MAIN_CATEGORIES = 1\r\n+  const MAX_SUBCATEGORIES_PER_CATEGORY = 10\r\n+\r\n   // UI state for category selection\r\n   const [selectedMainCategory, setSelectedMainCategory] = useState(null)\r\n \r\n   // Define sections for each page\r\n@@ -126,8 +136,198 @@\n \r\n   // Hardcoded admin token for testing\r\n   const ADMIN_TOKEN = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY4NzZhYTJmYzc3YWY4ODU3Njk1ZDA5MiIsInJvbGUiOiJhZG1pbiIsImlhdCI6MTc1MjYwNzMyMCwiZXhwIjoxNzUzMjEyMTIwfQ.ugFuaDCq_ewqIE-dZaql3BB91kaXBIxE0TQmqdYnagI'\r\n \r\n+  // ========== HIERARCHICAL DATA MANAGEMENT HELPERS ==========\r\n+  \r\n+  // Get current counts for validation\r\n+  const getCurrentCounts = () => {\r\n+    const mainCategoriesCount = categoryConfig.categories.filter(cat => cat.enabled).length\r\n+    const subcategoryCounts = {}\r\n+    \r\n+    categoryConfig.categories.forEach(category => {\r\n+      subcategoryCounts[category.categoryId] = category.subcategories.filter(sub => sub.enabled).length\r\n+    })\r\n+    \r\n+    return { mainCategoriesCount, subcategoryCounts }\r\n+  }\r\n+\r\n+  // Check if we can select more main categories\r\n+  const canSelectMoreMainCategories = () => {\r\n+    const { mainCategoriesCount } = getCurrentCounts()\r\n+    return mainCategoriesCount < MAX_MAIN_CATEGORIES\r\n+  }\r\n+\r\n+  // Check if we can select more subcategories for a specific category\r\n+  const canSelectMoreSubcategories = (categoryId) => {\r\n+    const { subcategoryCounts } = getCurrentCounts()\r\n+    const currentCount = subcategoryCounts[categoryId] || 0\r\n+    return currentCount < MAX_SUBCATEGORIES_PER_CATEGORY\r\n+  }\r\n+\r\n+  // Check if a main category is selected\r\n+  const isMainCategorySelected = (categoryId) => {\r\n+    const category = categoryConfig.categories.find(cat => cat.categoryId === categoryId)\r\n+    return category ? category.enabled : false\r\n+  }\r\n+\r\n+  // Check if a subcategory is selected\r\n+  const isSubcategorySelected = (subcategoryId) => {\r\n+    return categoryConfig.categories.some(category => \r\n+      category.subcategories.some(sub => sub.categoryId === subcategoryId && sub.enabled)\r\n+    )\r\n+  }\r\n+\r\n+  // Find which main category a subcategory belongs to\r\n+  const findParentCategory = (subcategoryId) => {\r\n+    const subcategory = subcategories.find(sub => sub.id === subcategoryId)\r\n+    return subcategory?.parent?._id || subcategory?.parent\r\n+  }\r\n+\r\n+  // Update hierarchical category selection\r\n+  const updateCategorySelection = (categoryId, isSelected, isMainCategory) => {\r\n+    console.log('🔄 Updating category selection:', { categoryId, isSelected, isMainCategory })\r\n+    \r\n+    setCategoryConfig(prev => {\r\n+      const newCategories = [...prev.categories]\r\n+      let newCategoryIds = [...prev.categoryIds]\r\n+      \r\n+      if (isMainCategory) {\r\n+        // Handle main category selection\r\n+        const existingIndex = newCategories.findIndex(cat => cat.categoryId === categoryId)\r\n+        \r\n+        if (existingIndex >= 0) {\r\n+          // Category exists, update it\r\n+          newCategories[existingIndex] = {\r\n+            ...newCategories[existingIndex],\r\n+            enabled: isSelected\r\n+          }\r\n+          \r\n+          if (isSelected) {\r\n+            if (!newCategoryIds.includes(categoryId)) {\r\n+              newCategoryIds.push(categoryId)\r\n+            }\r\n+          } else {\r\n+            newCategoryIds = newCategoryIds.filter(id => id !== categoryId)\r\n+            // Also remove all subcategories when deselecting main category\r\n+            newCategories[existingIndex].subcategories.forEach(sub => {\r\n+              if (sub.enabled) {\r\n+                newCategoryIds = newCategoryIds.filter(id => id !== sub.categoryId)\r\n+              }\r\n+              sub.enabled = false\r\n+            })\r\n+          }\r\n+        } else if (isSelected) {\r\n+          // Add new main category\r\n+          newCategories.push({\r\n+            categoryId: categoryId,\r\n+            enabled: true,\r\n+            order: newCategories.length,\r\n+            type: 'main',\r\n+            subcategories: []\r\n+          })\r\n+          newCategoryIds.push(categoryId)\r\n+        }\r\n+      } else {\r\n+        // Handle subcategory selection\r\n+        const parentId = findParentCategory(categoryId)\r\n+        \r\n+        if (parentId) {\r\n+          let parentCategoryIndex = newCategories.findIndex(cat => cat.categoryId === parentId)\r\n+          \r\n+          // Create parent category if it doesn't exist\r\n+          if (parentCategoryIndex < 0 && isSelected) {\r\n+            newCategories.push({\r\n+              categoryId: parentId,\r\n+              enabled: false, // Parent not directly selected\r\n+              order: newCategories.length,\r\n+              type: 'main',\r\n+              subcategories: []\r\n+            })\r\n+            parentCategoryIndex = newCategories.length - 1\r\n+          }\r\n+          \r\n+          if (parentCategoryIndex >= 0) {\r\n+            const parentCategory = newCategories[parentCategoryIndex]\r\n+            const existingSubIndex = parentCategory.subcategories.findIndex(sub => sub.categoryId === categoryId)\r\n+            \r\n+            if (existingSubIndex >= 0) {\r\n+              // Update existing subcategory\r\n+              parentCategory.subcategories[existingSubIndex].enabled = isSelected\r\n+            } else if (isSelected) {\r\n+              // Add new subcategory\r\n+              parentCategory.subcategories.push({\r\n+                categoryId: categoryId,\r\n+                enabled: true,\r\n+                order: parentCategory.subcategories.length,\r\n+                parentId: parentId\r\n+              })\r\n+            }\r\n+            \r\n+            // Update flat categoryIds array\r\n+            if (isSelected) {\r\n+              if (!newCategoryIds.includes(categoryId)) {\r\n+                newCategoryIds.push(categoryId)\r\n+              }\r\n+            } else {\r\n+              newCategoryIds = newCategoryIds.filter(id => id !== categoryId)\r\n+            }\r\n+          }\r\n+        }\r\n+      }\r\n+      \r\n+      console.log('📊 Updated categories:', newCategories)\r\n+      console.log('📋 Updated categoryIds:', newCategoryIds)\r\n+      \r\n+      return {\r\n+        ...prev,\r\n+        categories: newCategories,\r\n+        categoryIds: newCategoryIds\r\n+      }\r\n+    })\r\n+  }\r\n+\r\n+  // Transform hierarchical data for backend save\r\n+  const transformForSave = () => {\r\n+    const saveData = {\r\n+      enabled: categoryConfig.enabled,\r\n+      maxCategories: categoryConfig.maxCategories,\r\n+      layout: categoryConfig.layout,\r\n+      showSubcategories: categoryConfig.showSubcategories,\r\n+      categories: []\r\n+    }\r\n+    \r\n+    // Flatten hierarchical structure for backend\r\n+    categoryConfig.categories.forEach(category => {\r\n+      if (category.enabled) {\r\n+        saveData.categories.push({\r\n+          categoryId: category.categoryId,\r\n+          enabled: true,\r\n+          order: category.order,\r\n+          type: 'main'\r\n+        })\r\n+      }\r\n+      \r\n+      category.subcategories.forEach(subcategory => {\r\n+        if (subcategory.enabled) {\r\n+          saveData.categories.push({\r\n+            categoryId: subcategory.categoryId,\r\n+            enabled: true,\r\n+            order: subcategory.order,\r\n+            type: 'subcategory',\r\n+            parentId: category.categoryId\r\n+          })\r\n+        }\r\n+      })\r\n+    })\r\n+    \r\n+    // Sort by order\r\n+    saveData.categories.sort((a, b) => a.order - b.order)\r\n+    \r\n+    console.log('💾 Data prepared for save:', saveData)\r\n+    return saveData\r\n+  }\r\n+\r\n   // Load page configuration\r\n   const loadPageConfig = async (pageKey) => {\r\n     try {\r\n       setLoading(true)\r\n@@ -143,25 +343,63 @@\n         setPageConfig(actualData.data)\r\n         \r\n         // Extract category section config\r\n         const categorySection = actualData.data.sections.find(s => s.sectionType === 'categorySection')\r\n-        if (categorySection) {\r\n-          setCategoryConfig({\r\n-            enabled: categorySection.enabled,\r\n-            maxCategories: categorySection.config.maxCategories || 6,\r\n-            categoryIds: categorySection.config.categoryIds || [],\r\n+        if (categorySection && categorySection.config) {\r\n+          // Convert the saved flat structure back to hierarchical state\r\n+          const hierarchicalConfig = {\r\n+            enabled: categorySection.enabled || false,\r\n+            maxCategories: categorySection.config.maxCategories || 10,\r\n             layout: categorySection.config.layout || 'grid',\r\n-            showSubcategories: categorySection.config.showSubcategories || true\r\n-          })\r\n+            showSubcategories: categorySection.config.showSubcategories || true,\r\n+            categories: {}\r\n+          }\r\n           \r\n+          // Rebuild hierarchical structure from saved config\r\n+          if (categorySection.config.categories && Array.isArray(categorySection.config.categories)) {\r\n+            categorySection.config.categories.forEach(cat => {\r\n+              if (cat.categoryId) {\r\n+                hierarchicalConfig.categories[cat.categoryId] = {\r\n+                  selected: cat.enabled || false,\r\n+                  order: cat.order || 0,\r\n+                  subcategories: {}\r\n+                }\r\n+                \r\n+                // Add subcategories if they exist\r\n+                if (cat.subcategories && Array.isArray(cat.subcategories)) {\r\n+                  cat.subcategories.forEach(sub => {\r\n+                    if (sub.subcategoryId) {\r\n+                      hierarchicalConfig.categories[cat.categoryId].subcategories[sub.subcategoryId] = {\r\n+                        selected: sub.enabled || false,\r\n+                        order: sub.order || 0\r\n+                      }\r\n+                    }\r\n+                  })\r\n+                }\r\n+              }\r\n+            })\r\n+          }\r\n+          \r\n+          setCategoryConfig(hierarchicalConfig)\r\n+          console.log('📂 Loaded hierarchical config:', hierarchicalConfig)\r\n+          \r\n           // Update visibility state\r\n           setVisibleSections(prev => ({\r\n             ...prev,\r\n             [pageKey]: {\r\n               ...prev[pageKey],\r\n               giftCategories: categorySection.enabled\r\n             }\r\n           }))\r\n+        } else {\r\n+          // Initialize with default hierarchical structure if no config exists\r\n+          setCategoryConfig({\r\n+            enabled: false,\r\n+            maxCategories: 10,\r\n+            layout: 'grid',\r\n+            showSubcategories: true,\r\n+            categories: {}\r\n+          })\r\n         }\r\n       }\r\n       \r\n       setError('')\r\n@@ -364,22 +602,27 @@\n     try {\r\n       setLoading(true)\r\n       localStorage.setItem('authToken', ADMIN_TOKEN)\r\n       \r\n-      const configData = {\r\n-        enabled: categoryConfig.enabled,\r\n-        maxCategories: categoryConfig.maxCategories,\r\n-        categories: categoryConfig.categoryIds.map((id, index) => ({\r\n-          categoryId: id,\r\n-          enabled: true,\r\n-          order: index\r\n-        })),\r\n-        layout: categoryConfig.layout,\r\n-        showSubcategories: categoryConfig.showSubcategories\r\n+      // Validate before save\r\n+      const { mainCategoriesCount } = getCurrentCounts()\r\n+      if (mainCategoriesCount < MIN_MAIN_CATEGORIES) {\r\n+        setError(`Please select at least ${MIN_MAIN_CATEGORIES} main category before saving.`)\r\n+        return\r\n       }\r\n       \r\n+      if (mainCategoriesCount > MAX_MAIN_CATEGORIES) {\r\n+        setError(`Too many main categories selected. Maximum ${MAX_MAIN_CATEGORIES} allowed.`)\r\n+        return\r\n+      }\r\n+      \r\n+      // Transform hierarchical data for save\r\n+      const configData = transformForSave()\r\n+      \r\n+      console.log('💾 Saving category configuration:', configData)\r\n+      \r\n       const response = await put('/api/pages/home/sections/category', configData)\r\n-      console.log('Save response:', response)\r\n+      console.log('📡 Save response:', response)\r\n       \r\n       // Handle the double-wrapped response from apiService\r\n       const actualData = response.data // This contains the backend response\r\n       \r\n@@ -436,18 +679,59 @@\n       setSelectedMainCategory(mainCategories[0].id)\r\n     }\r\n   }\r\n \r\n-  // Handle category selection\r\n+  // Handle category selection with validation\r\n   const handleCategoryToggle = (categoryId) => {\r\n-    setCategoryConfig(prev => {\r\n-      const isSelected = prev.categoryIds.includes(categoryId)\r\n-      const newCategoryIds = isSelected \r\n-        ? prev.categoryIds.filter(id => id !== categoryId)\r\n-        : [...prev.categoryIds, categoryId]\r\n+    const isMainCategory = availableCategories.some(cat => cat.id === categoryId && !cat.parent)\r\n+    \r\n+    console.log('🎯 Category toggle triggered:', { categoryId, isMainCategory })\r\n+    \r\n+    if (isMainCategory) {\r\n+      const isCurrentlySelected = isMainCategorySelected(categoryId)\r\n+      const { mainCategoriesCount } = getCurrentCounts()\r\n       \r\n-      return { ...prev, categoryIds: newCategoryIds }\r\n-    })\r\n+      console.log('📊 Main category status:', { isCurrentlySelected, currentCount: mainCategoriesCount })\r\n+      \r\n+      // Validation for main categories\r\n+      if (!isCurrentlySelected) {\r\n+        // Trying to select\r\n+        if (!canSelectMoreMainCategories()) {\r\n+          setError(`Cannot select more main categories. Maximum ${MAX_MAIN_CATEGORIES} allowed.`)\r\n+          return\r\n+        }\r\n+      } else {\r\n+        // Trying to deselect\r\n+        if (mainCategoriesCount <= MIN_MAIN_CATEGORIES) {\r\n+          setError(`Cannot deselect this category. At least ${MIN_MAIN_CATEGORIES} main category must be selected.`)\r\n+          return\r\n+        }\r\n+      }\r\n+      \r\n+      // Clear any existing errors\r\n+      setError('')\r\n+      updateCategorySelection(categoryId, !isCurrentlySelected, true)\r\n+      \r\n+    } else {\r\n+      // Subcategory logic\r\n+      const isCurrentlySelected = isSubcategorySelected(categoryId)\r\n+      const parentId = findParentCategory(categoryId)\r\n+      \r\n+      console.log('📊 Subcategory status:', { isCurrentlySelected, parentId })\r\n+      \r\n+      if (!isCurrentlySelected && parentId) {\r\n+        // Trying to select subcategory\r\n+        if (!canSelectMoreSubcategories(parentId)) {\r\n+          const parentName = availableCategories.find(cat => cat.id === parentId)?.name || 'this category'\r\n+          setError(`Cannot select more subcategories for ${parentName}. Maximum ${MAX_SUBCATEGORIES_PER_CATEGORY} per category allowed.`)\r\n+          return\r\n+        }\r\n+      }\r\n+      \r\n+      // Clear any existing errors\r\n+      setError('')\r\n+      updateCategorySelection(categoryId, !isCurrentlySelected, false)\r\n+    }\r\n   }\r\n \r\n   // Handle max categories change\r\n   const handleMaxCategoriesChange = (value) => {\r\n@@ -544,8 +828,64 @@\n               </div>\r\n \r\n               {categoryConfig.enabled && (\r\n                 <>\r\n+                  {/* Selection Summary and Validation */}\r\n+                  <div className=\"row mb-4\">\r\n+                    <div className=\"col-12\">\r\n+                      <div className=\"card border-info\">\r\n+                        <div className=\"card-header bg-info bg-opacity-10\">\r\n+                          <h6 className=\"mb-0 text-info\">\r\n+                            <i className=\"bi bi-info-circle me-2\"></i>\r\n+                            Selection Summary\r\n+                          </h6>\r\n+                        </div>\r\n+                        <div className=\"card-body\">\r\n+                          <div className=\"row\">\r\n+                            <div className=\"col-md-6\">\r\n+                              <div className={`d-flex justify-content-between align-items-center p-2 rounded ${getCurrentCounts().mainCategoriesCount >= MIN_MAIN_CATEGORIES && getCurrentCounts().mainCategoriesCount <= MAX_MAIN_CATEGORIES ? 'bg-success bg-opacity-10 text-success' : 'bg-warning bg-opacity-10 text-warning'}`}>\r\n+                                <span className=\"fw-semibold\">\r\n+                                  <i className=\"bi bi-grid me-1\"></i>\r\n+                                  Main Categories:\r\n+                                </span>\r\n+                                <span className=\"badge bg-primary\">\r\n+                                  {getCurrentCounts().mainCategoriesCount} / {MAX_MAIN_CATEGORIES}\r\n+                                </span>\r\n+                              </div>\r\n+                              {getCurrentCounts().mainCategoriesCount < MIN_MAIN_CATEGORIES && (\r\n+                                <small className=\"text-warning\">\r\n+                                  <i className=\"bi bi-exclamation-triangle me-1\"></i>\r\n+                                  Minimum {MIN_MAIN_CATEGORIES} main category required\r\n+                                </small>\r\n+                              )}\r\n+                            </div>\r\n+                            <div className=\"col-md-6\">\r\n+                              <div className=\"d-flex justify-content-between align-items-center p-2 rounded bg-info bg-opacity-10 text-info\">\r\n+                                <span className=\"fw-semibold\">\r\n+                                  <i className=\"bi bi-tags me-1\"></i>\r\n+                                  Total Subcategories:\r\n+                                </span>\r\n+                                <span className=\"badge bg-info\">\r\n+                                  {getCurrentCounts().totalSubcategoriesCount}\r\n+                                </span>\r\n+                              </div>\r\n+                              {selectedMainCategory && (\r\n+                                <small className=\"text-muted\">\r\n+                                  <i className=\"bi bi-arrow-right me-1\"></i>\r\n+                                  Selected category: {getCurrentCounts().selectedCategorySubCount} / {MAX_SUBCATEGORIES_PER_MAIN}\r\n+                                </small>\r\n+                              )}\r\n+                            </div>\r\n+                          </div>\r\n+                        </div>\r\n+                      </div>\r\n+                    </div>\r\n+                  </div>\r\n+                </>\r\n+              )}\r\n+\r\n+              {categoryConfig.enabled && (\r\n+                <>\r\n                   {/* Configuration Options */}\r\n                   <div className=\"row mb-4\">\r\n                     <div className=\"col-md-4\">\r\n                       <label className=\"form-label fw-semibold\">Maximum Categories to Show</label>\r\n@@ -615,19 +955,20 @@\n                                   <i className=\"bi bi-grid text-primary me-2\"></i>\r\n                                   Main Categories ({mainCategories.length})\r\n                                 </h6>\r\n                                 <span className=\"badge bg-primary\">\r\n-                                  {categoryConfig.categoryIds.filter(id => mainCategories.some(cat => cat.id === id)).length} selected\r\n+                                  {getCurrentCounts().mainCategoriesCount} selected\r\n                                 </span>\r\n                               </div>\r\n                               <div className=\"card-body p-0\">\r\n                                 <div className=\"list-group list-group-flush\" style={{ maxHeight: '400px', overflowY: 'auto' }}>\r\n                                   {mainCategories.map((category, index) => {\r\n-                                    const isSelected = categoryConfig.categoryIds.includes(category.id)\r\n+                                    const categoryData = categoryConfig.categories[category.id]\r\n+                                    const isSelected = categoryData?.selected || false\r\n                                     const isActiveTab = selectedMainCategory === category.id\r\n                                     const subcategoryCount = getSubcategoriesForCategory(category.id).length\r\n                                     const selectedSubcategoryCount = getSubcategoriesForCategory(category.id)\r\n-                                      .filter(sub => categoryConfig.categoryIds.includes(sub.id)).length\r\n+                                      .filter(sub => categoryData?.subcategories?.[sub.id]?.selected).length\r\n                                     \r\n                                     return (\r\n                                       <div \r\n                                         key={category.id} \r\n@@ -787,9 +1128,10 @@\n \r\n                                       {/* Subcategories List */}\r\n                                       <div className=\"list-group list-group-flush\" style={{ maxHeight: '350px', overflowY: 'auto' }}>\r\n                                         {selectedCategorySubcategories.map((subcategory, index) => {\r\n-                                          const isSelected = categoryConfig.categoryIds.includes(subcategory.id)\r\n+                                          const parentCategoryData = categoryConfig.categories[selectedMainCategory]\r\n+                                          const isSelected = parentCategoryData?.subcategories?.[subcategory.id]?.selected || false\r\n                                           \r\n                                           return (\r\n                                             <div \r\n                                               key={subcategory.id} \r\n@@ -801,9 +1143,9 @@\n                                                     className=\"form-check-input form-check-input-success\" \r\n                                                     type=\"checkbox\" \r\n                                                     id={`sub-category-${subcategory.id}`}\r\n                                                     checked={isSelected}\r\n-                                                    onChange={() => handleCategoryToggle(subcategory.id)}\r\n+                                                    onChange={() => handleCategoryToggle(subcategory.id, selectedMainCategory)}\r\n                                                   />\r\n                                                 </div>\r\n                                                 \r\n                                                 {subcategory.image && (\r\n@@ -909,13 +1251,37 @@\n                           <button \r\n                             type=\"button\" \r\n                             className=\"btn btn-outline-primary btn-sm\"\r\n                             onClick={() => {\r\n-                              const allMainIds = mainCategories.map(cat => cat.id)\r\n-                              setCategoryConfig(prev => ({\r\n-                                ...prev,\r\n-                                categoryIds: [...new Set([...prev.categoryIds, ...allMainIds])]\r\n-                              }))\r\n+                              const { mainCategoriesCount } = getCurrentCounts()\r\n+                              const availableSlots = MAX_MAIN_CATEGORIES - mainCategoriesCount\r\n+                              \r\n+                              if (availableSlots <= 0) {\r\n+                                setError(`Cannot select more categories. Maximum ${MAX_MAIN_CATEGORIES} main categories allowed.`)\r\n+                                return\r\n+                              }\r\n+                              \r\n+                              setCategoryConfig(prev => {\r\n+                                const newConfig = { ...prev, categories: { ...prev.categories } }\r\n+                                let added = 0\r\n+                                \r\n+                                mainCategories.forEach(cat => {\r\n+                                  if (added < availableSlots && !newConfig.categories[cat.id]?.selected) {\r\n+                                    newConfig.categories[cat.id] = {\r\n+                                      selected: true,\r\n+                                      order: Object.keys(newConfig.categories).filter(id => newConfig.categories[id]?.selected).length,\r\n+                                      subcategories: newConfig.categories[cat.id]?.subcategories || {}\r\n+                                    }\r\n+                                    added++\r\n+                                  }\r\n+                                })\r\n+                                \r\n+                                if (added < mainCategories.length - mainCategoriesCount) {\r\n+                                  setError(`Only selected ${added} more categories due to limit.`)\r\n+                                }\r\n+                                \r\n+                                return newConfig\r\n+                              })\r\n                             }}\r\n                           >\r\n                             <i className=\"bi bi-check-all me-1\"></i>\r\n                             Select All Main Categories\r\n@@ -924,13 +1290,55 @@\n                           <button \r\n                             type=\"button\" \r\n                             className=\"btn btn-outline-success btn-sm\"\r\n                             onClick={() => {\r\n-                              const allSubIds = subCategories.map(cat => cat.id)\r\n-                              setCategoryConfig(prev => ({\r\n-                                ...prev,\r\n-                                categoryIds: [...new Set([...prev.categoryIds, ...allSubIds])]\r\n-                              }))\r\n+                              if (!selectedMainCategory) {\r\n+                                setError('Please select a main category first to add subcategories.')\r\n+                                return\r\n+                              }\r\n+                              \r\n+                              const subcategoriesForMain = getSubcategoriesForCategory(selectedMainCategory)\r\n+                              const currentSubCount = subcategoriesForMain.filter(sub => \r\n+                                categoryConfig.categories[selectedMainCategory]?.subcategories?.[sub.id]?.selected\r\n+                              ).length\r\n+                              const availableSlots = MAX_SUBCATEGORIES_PER_MAIN - currentSubCount\r\n+                              \r\n+                              if (availableSlots <= 0) {\r\n+                                setError(`Cannot select more subcategories. Maximum ${MAX_SUBCATEGORIES_PER_MAIN} subcategories per main category allowed.`)\r\n+                                return\r\n+                              }\r\n+                              \r\n+                              setCategoryConfig(prev => {\r\n+                                const newConfig = { ...prev, categories: { ...prev.categories } }\r\n+                                \r\n+                                // Ensure main category is selected and has structure\r\n+                                if (!newConfig.categories[selectedMainCategory]) {\r\n+                                  newConfig.categories[selectedMainCategory] = {\r\n+                                    selected: true,\r\n+                                    order: Object.keys(newConfig.categories).filter(id => newConfig.categories[id]?.selected).length,\r\n+                                    subcategories: {}\r\n+                                  }\r\n+                                }\r\n+                                \r\n+                                let added = 0\r\n+                                subcategoriesForMain.forEach(sub => {\r\n+                                  if (added < availableSlots && !newConfig.categories[selectedMainCategory].subcategories[sub.id]?.selected) {\r\n+                                    newConfig.categories[selectedMainCategory].subcategories[sub.id] = {\r\n+                                      selected: true,\r\n+                                      order: Object.keys(newConfig.categories[selectedMainCategory].subcategories).filter(id => \r\n+                                        newConfig.categories[selectedMainCategory].subcategories[id]?.selected\r\n+                                      ).length\r\n+                                    }\r\n+                                    added++\r\n+                                  }\r\n+                                })\r\n+                                \r\n+                                if (added < subcategoriesForMain.length - currentSubCount) {\r\n+                                  setError(`Only selected ${added} more subcategories due to limit.`)\r\n+                                }\r\n+                                \r\n+                                return newConfig\r\n+                              })\r\n                             }}\r\n                           >\r\n                             <i className=\"bi bi-tags me-1\"></i>\r\n                             Select All Subcategories\r\n@@ -939,9 +1347,13 @@\n                           <button \r\n                             type=\"button\" \r\n                             className=\"btn btn-outline-secondary btn-sm\"\r\n                             onClick={() => {\r\n-                              setCategoryConfig(prev => ({ ...prev, categoryIds: [] }))\r\n+                              setCategoryConfig(prev => ({\r\n+                                ...prev,\r\n+                                categories: {}\r\n+                              }))\r\n+                              setSelectedMainCategory(null)\r\n                             }}\r\n                           >\r\n                             <i className=\"bi bi-x-circle me-1\"></i>\r\n                             Clear All Selections\r\n"
                },
                {
                    "date": 1753177989321,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -2,8 +2,13 @@\n import React, { useState, useEffect } from 'react'\r\n import { get, post, put } from '@/util/apiService'\r\n import { CATEGORY, SUBCATEGORY } from '@/util/apiEndpoints'\r\n \r\n+// Validation constants for category selection\r\n+const MIN_MAIN_CATEGORIES = 1\r\n+const MAX_MAIN_CATEGORIES = 10\r\n+const MAX_SUBCATEGORIES_PER_MAIN = 10\r\n+\r\n const PAGES = [\r\n   { \r\n     key: \"home\", \r\n     label: \"Home Page\",\r\n@@ -140,16 +145,50 @@\n   // ========== HIERARCHICAL DATA MANAGEMENT HELPERS ==========\r\n   \r\n   // Get current counts for validation\r\n   const getCurrentCounts = () => {\r\n-    const mainCategoriesCount = categoryConfig.categories.filter(cat => cat.enabled).length\r\n+    if (!categoryConfig.categories || typeof categoryConfig.categories !== 'object') {\r\n+      return {\r\n+        mainCategoriesCount: 0,\r\n+        totalSubcategoriesCount: 0,\r\n+        selectedCategorySubCount: 0,\r\n+        subcategoryCounts: {}\r\n+      }\r\n+    }\r\n+\r\n+    const mainCategoriesCount = Object.keys(categoryConfig.categories).filter(\r\n+      categoryId => categoryConfig.categories[categoryId]?.selected\r\n+    ).length\r\n+\r\n+    let totalSubcategoriesCount = 0\r\n     const subcategoryCounts = {}\r\n     \r\n-    categoryConfig.categories.forEach(category => {\r\n-      subcategoryCounts[category.categoryId] = category.subcategories.filter(sub => sub.enabled).length\r\n+    Object.keys(categoryConfig.categories).forEach(categoryId => {\r\n+      const categoryData = categoryConfig.categories[categoryId]\r\n+      if (categoryData && categoryData.subcategories) {\r\n+        const subCount = Object.keys(categoryData.subcategories).filter(\r\n+          subId => categoryData.subcategories[subId]?.selected\r\n+        ).length\r\n+        subcategoryCounts[categoryId] = subCount\r\n+        totalSubcategoriesCount += subCount\r\n+      } else {\r\n+        subcategoryCounts[categoryId] = 0\r\n+      }\r\n     })\r\n-    \r\n-    return { mainCategoriesCount, subcategoryCounts }\r\n+\r\n+    // Count for currently selected main category\r\n+    const selectedCategorySubCount = selectedMainCategory && categoryConfig.categories[selectedMainCategory] \r\n+      ? Object.keys(categoryConfig.categories[selectedMainCategory].subcategories || {}).filter(\r\n+          subId => categoryConfig.categories[selectedMainCategory].subcategories[subId]?.selected\r\n+        ).length \r\n+      : 0\r\n+\r\n+    return { \r\n+      mainCategoriesCount, \r\n+      totalSubcategoriesCount,\r\n+      selectedCategorySubCount,\r\n+      subcategoryCounts \r\n+    }\r\n   }\r\n \r\n   // Check if we can select more main categories\r\n   const canSelectMoreMainCategories = () => {\r\n@@ -160,133 +199,27 @@\n   // Check if we can select more subcategories for a specific category\r\n   const canSelectMoreSubcategories = (categoryId) => {\r\n     const { subcategoryCounts } = getCurrentCounts()\r\n     const currentCount = subcategoryCounts[categoryId] || 0\r\n-    return currentCount < MAX_SUBCATEGORIES_PER_CATEGORY\r\n+    return currentCount < MAX_SUBCATEGORIES_PER_MAIN\r\n   }\r\n \r\n   // Check if a main category is selected\r\n   const isMainCategorySelected = (categoryId) => {\r\n-    const category = categoryConfig.categories.find(cat => cat.categoryId === categoryId)\r\n-    return category ? category.enabled : false\r\n+    return categoryConfig.categories[categoryId]?.selected || false\r\n   }\r\n \r\n   // Check if a subcategory is selected\r\n-  const isSubcategorySelected = (subcategoryId) => {\r\n-    return categoryConfig.categories.some(category => \r\n-      category.subcategories.some(sub => sub.categoryId === subcategoryId && sub.enabled)\r\n-    )\r\n+  const isSubcategorySelected = (subcategoryId, parentCategoryId) => {\r\n+    return categoryConfig.categories[parentCategoryId]?.subcategories?.[subcategoryId]?.selected || false\r\n   }\r\n \r\n   // Find which main category a subcategory belongs to\r\n   const findParentCategory = (subcategoryId) => {\r\n     const subcategory = subcategories.find(sub => sub.id === subcategoryId)\r\n     return subcategory?.parent?._id || subcategory?.parent\r\n   }\r\n \r\n-  // Update hierarchical category selection\r\n-  const updateCategorySelection = (categoryId, isSelected, isMainCategory) => {\r\n-    console.log('🔄 Updating category selection:', { categoryId, isSelected, isMainCategory })\r\n-    \r\n-    setCategoryConfig(prev => {\r\n-      const newCategories = [...prev.categories]\r\n-      let newCategoryIds = [...prev.categoryIds]\r\n-      \r\n-      if (isMainCategory) {\r\n-        // Handle main category selection\r\n-        const existingIndex = newCategories.findIndex(cat => cat.categoryId === categoryId)\r\n-        \r\n-        if (existingIndex >= 0) {\r\n-          // Category exists, update it\r\n-          newCategories[existingIndex] = {\r\n-            ...newCategories[existingIndex],\r\n-            enabled: isSelected\r\n-          }\r\n-          \r\n-          if (isSelected) {\r\n-            if (!newCategoryIds.includes(categoryId)) {\r\n-              newCategoryIds.push(categoryId)\r\n-            }\r\n-          } else {\r\n-            newCategoryIds = newCategoryIds.filter(id => id !== categoryId)\r\n-            // Also remove all subcategories when deselecting main category\r\n-            newCategories[existingIndex].subcategories.forEach(sub => {\r\n-              if (sub.enabled) {\r\n-                newCategoryIds = newCategoryIds.filter(id => id !== sub.categoryId)\r\n-              }\r\n-              sub.enabled = false\r\n-            })\r\n-          }\r\n-        } else if (isSelected) {\r\n-          // Add new main category\r\n-          newCategories.push({\r\n-            categoryId: categoryId,\r\n-            enabled: true,\r\n-            order: newCategories.length,\r\n-            type: 'main',\r\n-            subcategories: []\r\n-          })\r\n-          newCategoryIds.push(categoryId)\r\n-        }\r\n-      } else {\r\n-        // Handle subcategory selection\r\n-        const parentId = findParentCategory(categoryId)\r\n-        \r\n-        if (parentId) {\r\n-          let parentCategoryIndex = newCategories.findIndex(cat => cat.categoryId === parentId)\r\n-          \r\n-          // Create parent category if it doesn't exist\r\n-          if (parentCategoryIndex < 0 && isSelected) {\r\n-            newCategories.push({\r\n-              categoryId: parentId,\r\n-              enabled: false, // Parent not directly selected\r\n-              order: newCategories.length,\r\n-              type: 'main',\r\n-              subcategories: []\r\n-            })\r\n-            parentCategoryIndex = newCategories.length - 1\r\n-          }\r\n-          \r\n-          if (parentCategoryIndex >= 0) {\r\n-            const parentCategory = newCategories[parentCategoryIndex]\r\n-            const existingSubIndex = parentCategory.subcategories.findIndex(sub => sub.categoryId === categoryId)\r\n-            \r\n-            if (existingSubIndex >= 0) {\r\n-              // Update existing subcategory\r\n-              parentCategory.subcategories[existingSubIndex].enabled = isSelected\r\n-            } else if (isSelected) {\r\n-              // Add new subcategory\r\n-              parentCategory.subcategories.push({\r\n-                categoryId: categoryId,\r\n-                enabled: true,\r\n-                order: parentCategory.subcategories.length,\r\n-                parentId: parentId\r\n-              })\r\n-            }\r\n-            \r\n-            // Update flat categoryIds array\r\n-            if (isSelected) {\r\n-              if (!newCategoryIds.includes(categoryId)) {\r\n-                newCategoryIds.push(categoryId)\r\n-              }\r\n-            } else {\r\n-              newCategoryIds = newCategoryIds.filter(id => id !== categoryId)\r\n-            }\r\n-          }\r\n-        }\r\n-      }\r\n-      \r\n-      console.log('📊 Updated categories:', newCategories)\r\n-      console.log('📋 Updated categoryIds:', newCategoryIds)\r\n-      \r\n-      return {\r\n-        ...prev,\r\n-        categories: newCategories,\r\n-        categoryIds: newCategoryIds\r\n-      }\r\n-    })\r\n-  }\r\n-\r\n   // Transform hierarchical data for backend save\r\n   const transformForSave = () => {\r\n     const saveData = {\r\n       enabled: categoryConfig.enabled,\r\n@@ -295,33 +228,40 @@\n       showSubcategories: categoryConfig.showSubcategories,\r\n       categories: []\r\n     }\r\n     \r\n-    // Flatten hierarchical structure for backend\r\n-    categoryConfig.categories.forEach(category => {\r\n-      if (category.enabled) {\r\n+    // Convert hierarchical structure to flat array for backend\r\n+    Object.keys(categoryConfig.categories).forEach(categoryId => {\r\n+      const categoryData = categoryConfig.categories[categoryId]\r\n+      if (categoryData?.selected) {\r\n         saveData.categories.push({\r\n-          categoryId: category.categoryId,\r\n+          categoryId: categoryId,\r\n           enabled: true,\r\n-          order: category.order,\r\n-          type: 'main'\r\n+          order: categoryData.order || 0,\r\n+          subcategories: []\r\n         })\r\n-      }\r\n-      \r\n-      category.subcategories.forEach(subcategory => {\r\n-        if (subcategory.enabled) {\r\n-          saveData.categories.push({\r\n-            categoryId: subcategory.categoryId,\r\n-            enabled: true,\r\n-            order: subcategory.order,\r\n-            type: 'subcategory',\r\n-            parentId: category.categoryId\r\n+        \r\n+        // Add subcategories for this main category\r\n+        if (categoryData.subcategories) {\r\n+          const categoryIndex = saveData.categories.length - 1\r\n+          Object.keys(categoryData.subcategories).forEach(subId => {\r\n+            const subData = categoryData.subcategories[subId]\r\n+            if (subData?.selected) {\r\n+              saveData.categories[categoryIndex].subcategories.push({\r\n+                subcategoryId: subId,\r\n+                enabled: true,\r\n+                order: subData.order || 0\r\n+              })\r\n+            }\r\n           })\r\n+          \r\n+          // Sort subcategories by order\r\n+          saveData.categories[categoryIndex].subcategories.sort((a, b) => a.order - b.order)\r\n         }\r\n-      })\r\n+      }\r\n     })\r\n     \r\n-    // Sort by order\r\n+    // Sort categories by order\r\n     saveData.categories.sort((a, b) => a.order - b.order)\r\n     \r\n     console.log('💾 Data prepared for save:', saveData)\r\n     return saveData\r\n@@ -332,9 +272,9 @@\n     try {\r\n       setLoading(true)\r\n       localStorage.setItem('authToken', ADMIN_TOKEN)\r\n       \r\n-      const response = await get(`/api/pages/${pageKey}`)\r\n+      const response = await get(`/pages/${pageKey}`)\r\n       console.log('Page config response:', response)\r\n       \r\n       // Handle the double-wrapped response from apiService\r\n       const actualData = response.data // This contains the backend response\r\n@@ -619,9 +559,9 @@\n       const configData = transformForSave()\r\n       \r\n       console.log('💾 Saving category configuration:', configData)\r\n       \r\n-      const response = await put('/api/pages/home/sections/category', configData)\r\n+      const response = await put('/pages/home/sections/category', configData)\r\n       console.log('📡 Save response:', response)\r\n       \r\n       // Handle the double-wrapped response from apiService\r\n       const actualData = response.data // This contains the backend response\r\n@@ -632,9 +572,9 @@\n         setShowCategoryConfig(false)\r\n         \r\n         // Trigger refresh notification (optional)\r\n         try {\r\n-          await get('/api/pages/home/refresh/categorySection')\r\n+          await get('/pages/home/refresh/categorySection')\r\n         } catch (refreshError) {\r\n           console.log('Refresh notification failed, but save was successful')\r\n         }\r\n         \r\n@@ -679,24 +619,26 @@\n       setSelectedMainCategory(mainCategories[0].id)\r\n     }\r\n   }\r\n \r\n-  // Handle category selection with validation\r\n-  const handleCategoryToggle = (categoryId) => {\r\n-    const isMainCategory = availableCategories.some(cat => cat.id === categoryId && !cat.parent)\r\n+  // Handle category selection with validation - Updated for hierarchical structure\r\n+  const handleCategoryToggle = (categoryId, parentCategoryId = null) => {\r\n+    const isMainCategory = !parentCategoryId && availableCategories.some(cat => cat.id === categoryId && !cat.parent)\r\n+    const isSubcategory = parentCategoryId && availableCategories.some(cat => cat.id === categoryId && cat.parent)\r\n     \r\n-    console.log('🎯 Category toggle triggered:', { categoryId, isMainCategory })\r\n+    console.log('🎯 Category toggle triggered:', { categoryId, parentCategoryId, isMainCategory, isSubcategory })\r\n     \r\n     if (isMainCategory) {\r\n-      const isCurrentlySelected = isMainCategorySelected(categoryId)\r\n+      // Handle main category selection\r\n+      const isCurrentlySelected = categoryConfig.categories[categoryId]?.selected || false\r\n       const { mainCategoriesCount } = getCurrentCounts()\r\n       \r\n       console.log('📊 Main category status:', { isCurrentlySelected, currentCount: mainCategoriesCount })\r\n       \r\n       // Validation for main categories\r\n       if (!isCurrentlySelected) {\r\n         // Trying to select\r\n-        if (!canSelectMoreMainCategories()) {\r\n+        if (mainCategoriesCount >= MAX_MAIN_CATEGORIES) {\r\n           setError(`Cannot select more main categories. Maximum ${MAX_MAIN_CATEGORIES} allowed.`)\r\n           return\r\n         }\r\n       } else {\r\n@@ -708,29 +650,92 @@\n       }\r\n       \r\n       // Clear any existing errors\r\n       setError('')\r\n-      updateCategorySelection(categoryId, !isCurrentlySelected, true)\r\n       \r\n-    } else {\r\n-      // Subcategory logic\r\n-      const isCurrentlySelected = isSubcategorySelected(categoryId)\r\n-      const parentId = findParentCategory(categoryId)\r\n+      // Update main category selection\r\n+      setCategoryConfig(prev => {\r\n+        const newConfig = { ...prev, categories: { ...prev.categories } }\r\n+        \r\n+        if (!isCurrentlySelected) {\r\n+          // Select main category\r\n+          newConfig.categories[categoryId] = {\r\n+            selected: true,\r\n+            order: Object.keys(newConfig.categories).filter(id => newConfig.categories[id]?.selected).length,\r\n+            subcategories: newConfig.categories[categoryId]?.subcategories || {}\r\n+          }\r\n+        } else {\r\n+          // Deselect main category and all its subcategories\r\n+          if (newConfig.categories[categoryId]) {\r\n+            newConfig.categories[categoryId].selected = false\r\n+            // Also deselect all subcategories\r\n+            Object.keys(newConfig.categories[categoryId].subcategories || {}).forEach(subId => {\r\n+              if (newConfig.categories[categoryId].subcategories[subId]) {\r\n+                newConfig.categories[categoryId].subcategories[subId].selected = false\r\n+              }\r\n+            })\r\n+          }\r\n+        }\r\n+        \r\n+        return newConfig\r\n+      })\r\n       \r\n-      console.log('📊 Subcategory status:', { isCurrentlySelected, parentId })\r\n+    } else if (isSubcategory && parentCategoryId) {\r\n+      // Handle subcategory selection\r\n+      const isCurrentlySelected = categoryConfig.categories[parentCategoryId]?.subcategories?.[categoryId]?.selected || false\r\n+      const { selectedCategorySubCount } = getCurrentCounts()\r\n       \r\n-      if (!isCurrentlySelected && parentId) {\r\n+      console.log('📊 Subcategory status:', { isCurrentlySelected, selectedCategorySubCount, parentCategoryId })\r\n+      \r\n+      if (!isCurrentlySelected) {\r\n         // Trying to select subcategory\r\n-        if (!canSelectMoreSubcategories(parentId)) {\r\n-          const parentName = availableCategories.find(cat => cat.id === parentId)?.name || 'this category'\r\n-          setError(`Cannot select more subcategories for ${parentName}. Maximum ${MAX_SUBCATEGORIES_PER_CATEGORY} per category allowed.`)\r\n+        if (selectedCategorySubCount >= MAX_SUBCATEGORIES_PER_MAIN) {\r\n+          const parentName = availableCategories.find(cat => cat.id === parentCategoryId)?.name || 'this category'\r\n+          setError(`Cannot select more subcategories for ${parentName}. Maximum ${MAX_SUBCATEGORIES_PER_MAIN} per category allowed.`)\r\n           return\r\n         }\r\n       }\r\n       \r\n       // Clear any existing errors\r\n       setError('')\r\n-      updateCategorySelection(categoryId, !isCurrentlySelected, false)\r\n+      \r\n+      // Update subcategory selection\r\n+      setCategoryConfig(prev => {\r\n+        const newConfig = { ...prev, categories: { ...prev.categories } }\r\n+        \r\n+        // Ensure parent category structure exists\r\n+        if (!newConfig.categories[parentCategoryId]) {\r\n+          newConfig.categories[parentCategoryId] = {\r\n+            selected: true, // Auto-select parent when selecting subcategory\r\n+            order: Object.keys(newConfig.categories).filter(id => newConfig.categories[id]?.selected).length,\r\n+            subcategories: {}\r\n+          }\r\n+        }\r\n+        \r\n+        if (!newConfig.categories[parentCategoryId].subcategories) {\r\n+          newConfig.categories[parentCategoryId].subcategories = {}\r\n+        }\r\n+        \r\n+        if (!isCurrentlySelected) {\r\n+          // Select subcategory\r\n+          newConfig.categories[parentCategoryId].subcategories[categoryId] = {\r\n+            selected: true,\r\n+            order: Object.keys(newConfig.categories[parentCategoryId].subcategories).filter(id => \r\n+              newConfig.categories[parentCategoryId].subcategories[id]?.selected\r\n+            ).length\r\n+          }\r\n+          \r\n+          // Ensure parent is also selected\r\n+          newConfig.categories[parentCategoryId].selected = true\r\n+        } else {\r\n+          // Deselect subcategory\r\n+          if (newConfig.categories[parentCategoryId].subcategories[categoryId]) {\r\n+            newConfig.categories[parentCategoryId].subcategories[categoryId].selected = false\r\n+          }\r\n+        }\r\n+        \r\n+        return newConfig\r\n+      })\r\n     }\r\n   }\r\n \r\n   // Handle max categories change\r\n@@ -932,10 +937,10 @@\n                     <div className=\"col-12\">\r\n                       <div className=\"alert alert-info d-flex align-items-center\">\r\n                         <i className=\"bi bi-info-circle me-2\"></i>\r\n                         <div>\r\n-                          <strong>Selection Summary:</strong> {categoryConfig.categoryIds.length} categories selected \r\n-                          ({categoryConfig.categoryIds.filter(id => mainCategories.some(cat => cat.id === id)).length} main categories, {categoryConfig.categoryIds.filter(id => subCategories.some(cat => cat.id === id)).length} subcategories)\r\n+                          <strong>Selection Summary:</strong> {getCurrentCounts().mainCategoriesCount + getCurrentCounts().totalSubcategoriesCount} categories selected \r\n+                          ({getCurrentCounts().mainCategoriesCount} main categories, {getCurrentCounts().totalSubcategoriesCount} subcategories)\r\n                         </div>\r\n                       </div>\r\n                     </div>\r\n                   </div>\r\n@@ -1075,9 +1080,11 @@\n                                       <div className=\"p-3 bg-light border-bottom\">\r\n                                         <div className=\"row text-center\">\r\n                                           <div className=\"col-6\">\r\n                                             <div className=\"small\">\r\n-                                              <strong>{selectedCategorySubcategories.filter(sub => categoryConfig.categoryIds.includes(sub.id)).length}</strong>\r\n+                                              <strong>{selectedCategorySubcategories.filter(sub => \r\n+                                                categoryConfig.categories[selectedMainCategory]?.subcategories?.[sub.id]?.selected\r\n+                                              ).length}</strong>\r\n                                               <br />\r\n                                               <span className=\"text-muted\">Selected</span>\r\n                                             </div>\r\n                                           </div>\r\n@@ -1461,11 +1468,11 @@\n                           <td className=\"ps-4\">\r\n                             <div className=\"d-flex align-items-center\">\r\n                               <div>\r\n                                 <div className=\"fw-semibold\">{section.label}</div>\r\n-                                {isCategorySection && categoryConfig.categoryIds.length > 0 && (\r\n+                                {isCategorySection && (getCurrentCounts().mainCategoriesCount + getCurrentCounts().totalSubcategoriesCount) > 0 && (\r\n                                   <small className=\"text-muted\">\r\n-                                    {categoryConfig.categoryIds.length} categories selected\r\n+                                    {getCurrentCounts().mainCategoriesCount + getCurrentCounts().totalSubcategoriesCount} categories selected\r\n                                   </small>\r\n                                 )}\r\n                               </div>\r\n                             </div>\r\n"
                },
                {
                    "date": 1753196510194,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -2,13 +2,8 @@\n import React, { useState, useEffect } from 'react'\r\n import { get, post, put } from '@/util/apiService'\r\n import { CATEGORY, SUBCATEGORY } from '@/util/apiEndpoints'\r\n \r\n-// Validation constants for category selection\r\n-const MIN_MAIN_CATEGORIES = 1\r\n-const MAX_MAIN_CATEGORIES = 10\r\n-const MAX_SUBCATEGORIES_PER_MAIN = 10\r\n-\r\n const PAGES = [\r\n   { \r\n     key: \"home\", \r\n     label: \"Home Page\",\r\n@@ -145,49 +140,79 @@\n   // ========== HIERARCHICAL DATA MANAGEMENT HELPERS ==========\r\n   \r\n   // Get current counts for validation\r\n   const getCurrentCounts = () => {\r\n-    if (!categoryConfig.categories || typeof categoryConfig.categories !== 'object') {\r\n-      return {\r\n-        mainCategoriesCount: 0,\r\n-        totalSubcategoriesCount: 0,\r\n-        selectedCategorySubCount: 0,\r\n-        subcategoryCounts: {}\r\n-      }\r\n-    }\r\n-\r\n-    const mainCategoriesCount = Object.keys(categoryConfig.categories).filter(\r\n-      categoryId => categoryConfig.categories[categoryId]?.selected\r\n-    ).length\r\n-\r\n+    // Handle both old array structure and new object structure\r\n+    let mainCategoriesCount = 0\r\n     let totalSubcategoriesCount = 0\r\n+    let selectedCategorySubCount = 0\r\n     const subcategoryCounts = {}\r\n     \r\n-    Object.keys(categoryConfig.categories).forEach(categoryId => {\r\n-      const categoryData = categoryConfig.categories[categoryId]\r\n-      if (categoryData && categoryData.subcategories) {\r\n-        const subCount = Object.keys(categoryData.subcategories).filter(\r\n-          subId => categoryData.subcategories[subId]?.selected\r\n-        ).length\r\n+    if (Array.isArray(categoryConfig.categories)) {\r\n+      // Old structure: array of category objects\r\n+      mainCategoriesCount = categoryConfig.categories.filter(cat => cat.enabled).length\r\n+      \r\n+      categoryConfig.categories.forEach(category => {\r\n+        const subCount = category.subcategories ? category.subcategories.filter(sub => sub.enabled).length : 0\r\n+        subcategoryCounts[category.categoryId] = subCount\r\n+        totalSubcategoriesCount += subCount\r\n+        \r\n+        // Get subcategory count for currently selected main category\r\n+        if (selectedMainCategory && category.categoryId === selectedMainCategory) {\r\n+          selectedCategorySubCount = subCount\r\n+        }\r\n+      })\r\n+    } else if (typeof categoryConfig.categories === 'object' && categoryConfig.categories !== null) {\r\n+      // New structure: object with category IDs as keys\r\n+      mainCategoriesCount = Object.keys(categoryConfig.categories).filter(\r\n+        categoryId => categoryConfig.categories[categoryId]?.selected\r\n+      ).length\r\n+      \r\n+      Object.keys(categoryConfig.categories).forEach(categoryId => {\r\n+        const categoryData = categoryConfig.categories[categoryId]\r\n+        let subCount = 0\r\n+        \r\n+        if (categoryData && categoryData.subcategories) {\r\n+          subCount = Object.keys(categoryData.subcategories).filter(\r\n+            subId => categoryData.subcategories[subId]?.selected\r\n+          ).length\r\n+        }\r\n+        \r\n         subcategoryCounts[categoryId] = subCount\r\n         totalSubcategoriesCount += subCount\r\n-      } else {\r\n-        subcategoryCounts[categoryId] = 0\r\n+        \r\n+        // Get subcategory count for currently selected main category\r\n+        if (selectedMainCategory && categoryId === selectedMainCategory) {\r\n+          selectedCategorySubCount = subCount\r\n+        }\r\n+      })\r\n+    } else {\r\n+      // Fallback: use categoryIds for backward compatibility\r\n+      if (availableCategories.length > 0) {\r\n+        mainCategoriesCount = categoryConfig.categoryIds ? \r\n+          categoryConfig.categoryIds.filter(id => \r\n+            availableCategories.some(cat => cat.id === id && !cat.parent)\r\n+          ).length : 0\r\n+        \r\n+        totalSubcategoriesCount = categoryConfig.categoryIds ? \r\n+          categoryConfig.categoryIds.filter(id => \r\n+            subcategories.some(sub => sub.id === id)\r\n+          ).length : 0\r\n+          \r\n+        selectedCategorySubCount = selectedMainCategory && categoryConfig.categoryIds ? \r\n+          categoryConfig.categoryIds.filter(id => \r\n+            subcategories.some(sub => sub.id === id && \r\n+              (sub.parent?._id === selectedMainCategory || sub.parent === selectedMainCategory)\r\n+            )\r\n+          ).length : 0\r\n       }\r\n-    })\r\n-\r\n-    // Count for currently selected main category\r\n-    const selectedCategorySubCount = selectedMainCategory && categoryConfig.categories[selectedMainCategory] \r\n-      ? Object.keys(categoryConfig.categories[selectedMainCategory].subcategories || {}).filter(\r\n-          subId => categoryConfig.categories[selectedMainCategory].subcategories[subId]?.selected\r\n-        ).length \r\n-      : 0\r\n-\r\n+    }\r\n+    \r\n     return { \r\n       mainCategoriesCount, \r\n+      subcategoryCounts, \r\n       totalSubcategoriesCount,\r\n-      selectedCategorySubCount,\r\n-      subcategoryCounts \r\n+      selectedCategorySubCount \r\n     }\r\n   }\r\n \r\n   // Check if we can select more main categories\r\n@@ -199,27 +224,151 @@\n   // Check if we can select more subcategories for a specific category\r\n   const canSelectMoreSubcategories = (categoryId) => {\r\n     const { subcategoryCounts } = getCurrentCounts()\r\n     const currentCount = subcategoryCounts[categoryId] || 0\r\n-    return currentCount < MAX_SUBCATEGORIES_PER_MAIN\r\n+    return currentCount < MAX_SUBCATEGORIES_PER_CATEGORY\r\n   }\r\n \r\n   // Check if a main category is selected\r\n   const isMainCategorySelected = (categoryId) => {\r\n-    return categoryConfig.categories[categoryId]?.selected || false\r\n+    if (Array.isArray(categoryConfig.categories)) {\r\n+      // Old structure\r\n+      const category = categoryConfig.categories.find(cat => cat.categoryId === categoryId)\r\n+      return category ? category.enabled : false\r\n+    } else if (typeof categoryConfig.categories === 'object') {\r\n+      // New structure\r\n+      return categoryConfig.categories[categoryId]?.selected || false\r\n+    } else {\r\n+      // Fallback\r\n+      return categoryConfig.categoryIds ? categoryConfig.categoryIds.includes(categoryId) : false\r\n+    }\r\n   }\r\n \r\n   // Check if a subcategory is selected\r\n-  const isSubcategorySelected = (subcategoryId, parentCategoryId) => {\r\n-    return categoryConfig.categories[parentCategoryId]?.subcategories?.[subcategoryId]?.selected || false\r\n+  const isSubcategorySelected = (subcategoryId, parentCategoryId = null) => {\r\n+    if (Array.isArray(categoryConfig.categories)) {\r\n+      // Old structure\r\n+      return categoryConfig.categories.some(category => \r\n+        category.subcategories && category.subcategories.some(sub => sub.categoryId === subcategoryId && sub.enabled)\r\n+      )\r\n+    } else if (typeof categoryConfig.categories === 'object' && parentCategoryId) {\r\n+      // New structure\r\n+      return categoryConfig.categories[parentCategoryId]?.subcategories?.[subcategoryId]?.selected || false\r\n+    } else {\r\n+      // Fallback\r\n+      return categoryConfig.categoryIds ? categoryConfig.categoryIds.includes(subcategoryId) : false\r\n+    }\r\n   }\r\n \r\n   // Find which main category a subcategory belongs to\r\n   const findParentCategory = (subcategoryId) => {\r\n     const subcategory = subcategories.find(sub => sub.id === subcategoryId)\r\n     return subcategory?.parent?._id || subcategory?.parent\r\n   }\r\n \r\n+  // Update hierarchical category selection\r\n+  const updateCategorySelection = (categoryId, isSelected, isMainCategory) => {\r\n+    console.log('🔄 Updating category selection:', { categoryId, isSelected, isMainCategory })\r\n+    \r\n+    setCategoryConfig(prev => {\r\n+      const newCategories = [...prev.categories]\r\n+      let newCategoryIds = [...prev.categoryIds]\r\n+      \r\n+      if (isMainCategory) {\r\n+        // Handle main category selection\r\n+        const existingIndex = newCategories.findIndex(cat => cat.categoryId === categoryId)\r\n+        \r\n+        if (existingIndex >= 0) {\r\n+          // Category exists, update it\r\n+          newCategories[existingIndex] = {\r\n+            ...newCategories[existingIndex],\r\n+            enabled: isSelected\r\n+          }\r\n+          \r\n+          if (isSelected) {\r\n+            if (!newCategoryIds.includes(categoryId)) {\r\n+              newCategoryIds.push(categoryId)\r\n+            }\r\n+          } else {\r\n+            newCategoryIds = newCategoryIds.filter(id => id !== categoryId)\r\n+            // Also remove all subcategories when deselecting main category\r\n+            newCategories[existingIndex].subcategories.forEach(sub => {\r\n+              if (sub.enabled) {\r\n+                newCategoryIds = newCategoryIds.filter(id => id !== sub.categoryId)\r\n+              }\r\n+              sub.enabled = false\r\n+            })\r\n+          }\r\n+        } else if (isSelected) {\r\n+          // Add new main category\r\n+          newCategories.push({\r\n+            categoryId: categoryId,\r\n+            enabled: true,\r\n+            order: newCategories.length,\r\n+            type: 'main',\r\n+            subcategories: []\r\n+          })\r\n+          newCategoryIds.push(categoryId)\r\n+        }\r\n+      } else {\r\n+        // Handle subcategory selection\r\n+        const parentId = findParentCategory(categoryId)\r\n+        \r\n+        if (parentId) {\r\n+          let parentCategoryIndex = newCategories.findIndex(cat => cat.categoryId === parentId)\r\n+          \r\n+          // Create parent category if it doesn't exist\r\n+          if (parentCategoryIndex < 0 && isSelected) {\r\n+            newCategories.push({\r\n+              categoryId: parentId,\r\n+              enabled: false, // Parent not directly selected\r\n+              order: newCategories.length,\r\n+              type: 'main',\r\n+              subcategories: []\r\n+            })\r\n+            parentCategoryIndex = newCategories.length - 1\r\n+          }\r\n+          \r\n+          if (parentCategoryIndex >= 0) {\r\n+            const parentCategory = newCategories[parentCategoryIndex]\r\n+            const existingSubIndex = parentCategory.subcategories.findIndex(sub => sub.categoryId === categoryId)\r\n+            \r\n+            if (existingSubIndex >= 0) {\r\n+              // Update existing subcategory\r\n+              parentCategory.subcategories[existingSubIndex].enabled = isSelected\r\n+            } else if (isSelected) {\r\n+              // Add new subcategory\r\n+              parentCategory.subcategories.push({\r\n+                categoryId: categoryId,\r\n+                enabled: true,\r\n+                order: parentCategory.subcategories.length,\r\n+                parentId: parentId\r\n+              })\r\n+            }\r\n+            \r\n+            // Update flat categoryIds array\r\n+            if (isSelected) {\r\n+              if (!newCategoryIds.includes(categoryId)) {\r\n+                newCategoryIds.push(categoryId)\r\n+              }\r\n+            } else {\r\n+              newCategoryIds = newCategoryIds.filter(id => id !== categoryId)\r\n+            }\r\n+          }\r\n+        }\r\n+      }\r\n+      \r\n+      console.log('📊 Updated categories:', newCategories)\r\n+      console.log('📋 Updated categoryIds:', newCategoryIds)\r\n+      \r\n+      return {\r\n+        ...prev,\r\n+        categories: newCategories,\r\n+        categoryIds: newCategoryIds\r\n+      }\r\n+    })\r\n+  }\r\n+\r\n   // Transform hierarchical data for backend save\r\n   const transformForSave = () => {\r\n     const saveData = {\r\n       enabled: categoryConfig.enabled,\r\n@@ -228,40 +377,33 @@\n       showSubcategories: categoryConfig.showSubcategories,\r\n       categories: []\r\n     }\r\n     \r\n-    // Convert hierarchical structure to flat array for backend\r\n-    Object.keys(categoryConfig.categories).forEach(categoryId => {\r\n-      const categoryData = categoryConfig.categories[categoryId]\r\n-      if (categoryData?.selected) {\r\n+    // Flatten hierarchical structure for backend\r\n+    categoryConfig.categories.forEach(category => {\r\n+      if (category.enabled) {\r\n         saveData.categories.push({\r\n-          categoryId: categoryId,\r\n+          categoryId: category.categoryId,\r\n           enabled: true,\r\n-          order: categoryData.order || 0,\r\n-          subcategories: []\r\n+          order: category.order,\r\n+          type: 'main'\r\n         })\r\n-        \r\n-        // Add subcategories for this main category\r\n-        if (categoryData.subcategories) {\r\n-          const categoryIndex = saveData.categories.length - 1\r\n-          Object.keys(categoryData.subcategories).forEach(subId => {\r\n-            const subData = categoryData.subcategories[subId]\r\n-            if (subData?.selected) {\r\n-              saveData.categories[categoryIndex].subcategories.push({\r\n-                subcategoryId: subId,\r\n-                enabled: true,\r\n-                order: subData.order || 0\r\n-              })\r\n-            }\r\n+      }\r\n+      \r\n+      category.subcategories.forEach(subcategory => {\r\n+        if (subcategory.enabled) {\r\n+          saveData.categories.push({\r\n+            categoryId: subcategory.categoryId,\r\n+            enabled: true,\r\n+            order: subcategory.order,\r\n+            type: 'subcategory',\r\n+            parentId: category.categoryId\r\n           })\r\n-          \r\n-          // Sort subcategories by order\r\n-          saveData.categories[categoryIndex].subcategories.sort((a, b) => a.order - b.order)\r\n         }\r\n-      }\r\n+      })\r\n     })\r\n     \r\n-    // Sort categories by order\r\n+    // Sort by order\r\n     saveData.categories.sort((a, b) => a.order - b.order)\r\n     \r\n     console.log('💾 Data prepared for save:', saveData)\r\n     return saveData\r\n@@ -272,9 +414,9 @@\n     try {\r\n       setLoading(true)\r\n       localStorage.setItem('authToken', ADMIN_TOKEN)\r\n       \r\n-      const response = await get(`/pages/${pageKey}`)\r\n+      const response = await get(`/api/pages/${pageKey}`)\r\n       console.log('Page config response:', response)\r\n       \r\n       // Handle the double-wrapped response from apiService\r\n       const actualData = response.data // This contains the backend response\r\n@@ -559,9 +701,9 @@\n       const configData = transformForSave()\r\n       \r\n       console.log('💾 Saving category configuration:', configData)\r\n       \r\n-      const response = await put('/pages/home/sections/category', configData)\r\n+      const response = await put('/api/pages/home/sections/category', configData)\r\n       console.log('📡 Save response:', response)\r\n       \r\n       // Handle the double-wrapped response from apiService\r\n       const actualData = response.data // This contains the backend response\r\n@@ -572,9 +714,9 @@\n         setShowCategoryConfig(false)\r\n         \r\n         // Trigger refresh notification (optional)\r\n         try {\r\n-          await get('/pages/home/refresh/categorySection')\r\n+          await get('/api/pages/home/refresh/categorySection')\r\n         } catch (refreshError) {\r\n           console.log('Refresh notification failed, but save was successful')\r\n         }\r\n         \r\n@@ -619,26 +761,24 @@\n       setSelectedMainCategory(mainCategories[0].id)\r\n     }\r\n   }\r\n \r\n-  // Handle category selection with validation - Updated for hierarchical structure\r\n-  const handleCategoryToggle = (categoryId, parentCategoryId = null) => {\r\n-    const isMainCategory = !parentCategoryId && availableCategories.some(cat => cat.id === categoryId && !cat.parent)\r\n-    const isSubcategory = parentCategoryId && availableCategories.some(cat => cat.id === categoryId && cat.parent)\r\n+  // Handle category selection with validation\r\n+  const handleCategoryToggle = (categoryId) => {\r\n+    const isMainCategory = availableCategories.some(cat => cat.id === categoryId && !cat.parent)\r\n     \r\n-    console.log('🎯 Category toggle triggered:', { categoryId, parentCategoryId, isMainCategory, isSubcategory })\r\n+    console.log('🎯 Category toggle triggered:', { categoryId, isMainCategory })\r\n     \r\n     if (isMainCategory) {\r\n-      // Handle main category selection\r\n-      const isCurrentlySelected = categoryConfig.categories[categoryId]?.selected || false\r\n+      const isCurrentlySelected = isMainCategorySelected(categoryId)\r\n       const { mainCategoriesCount } = getCurrentCounts()\r\n       \r\n       console.log('📊 Main category status:', { isCurrentlySelected, currentCount: mainCategoriesCount })\r\n       \r\n       // Validation for main categories\r\n       if (!isCurrentlySelected) {\r\n         // Trying to select\r\n-        if (mainCategoriesCount >= MAX_MAIN_CATEGORIES) {\r\n+        if (!canSelectMoreMainCategories()) {\r\n           setError(`Cannot select more main categories. Maximum ${MAX_MAIN_CATEGORIES} allowed.`)\r\n           return\r\n         }\r\n       } else {\r\n@@ -650,92 +790,29 @@\n       }\r\n       \r\n       // Clear any existing errors\r\n       setError('')\r\n+      updateCategorySelection(categoryId, !isCurrentlySelected, true)\r\n       \r\n-      // Update main category selection\r\n-      setCategoryConfig(prev => {\r\n-        const newConfig = { ...prev, categories: { ...prev.categories } }\r\n-        \r\n-        if (!isCurrentlySelected) {\r\n-          // Select main category\r\n-          newConfig.categories[categoryId] = {\r\n-            selected: true,\r\n-            order: Object.keys(newConfig.categories).filter(id => newConfig.categories[id]?.selected).length,\r\n-            subcategories: newConfig.categories[categoryId]?.subcategories || {}\r\n-          }\r\n-        } else {\r\n-          // Deselect main category and all its subcategories\r\n-          if (newConfig.categories[categoryId]) {\r\n-            newConfig.categories[categoryId].selected = false\r\n-            // Also deselect all subcategories\r\n-            Object.keys(newConfig.categories[categoryId].subcategories || {}).forEach(subId => {\r\n-              if (newConfig.categories[categoryId].subcategories[subId]) {\r\n-                newConfig.categories[categoryId].subcategories[subId].selected = false\r\n-              }\r\n-            })\r\n-          }\r\n-        }\r\n-        \r\n-        return newConfig\r\n-      })\r\n+    } else {\r\n+      // Subcategory logic\r\n+      const isCurrentlySelected = isSubcategorySelected(categoryId)\r\n+      const parentId = findParentCategory(categoryId)\r\n       \r\n-    } else if (isSubcategory && parentCategoryId) {\r\n-      // Handle subcategory selection\r\n-      const isCurrentlySelected = categoryConfig.categories[parentCategoryId]?.subcategories?.[categoryId]?.selected || false\r\n-      const { selectedCategorySubCount } = getCurrentCounts()\r\n+      console.log('📊 Subcategory status:', { isCurrentlySelected, parentId })\r\n       \r\n-      console.log('📊 Subcategory status:', { isCurrentlySelected, selectedCategorySubCount, parentCategoryId })\r\n-      \r\n-      if (!isCurrentlySelected) {\r\n+      if (!isCurrentlySelected && parentId) {\r\n         // Trying to select subcategory\r\n-        if (selectedCategorySubCount >= MAX_SUBCATEGORIES_PER_MAIN) {\r\n-          const parentName = availableCategories.find(cat => cat.id === parentCategoryId)?.name || 'this category'\r\n-          setError(`Cannot select more subcategories for ${parentName}. Maximum ${MAX_SUBCATEGORIES_PER_MAIN} per category allowed.`)\r\n+        if (!canSelectMoreSubcategories(parentId)) {\r\n+          const parentName = availableCategories.find(cat => cat.id === parentId)?.name || 'this category'\r\n+          setError(`Cannot select more subcategories for ${parentName}. Maximum ${MAX_SUBCATEGORIES_PER_CATEGORY} per category allowed.`)\r\n           return\r\n         }\r\n       }\r\n       \r\n       // Clear any existing errors\r\n       setError('')\r\n-      \r\n-      // Update subcategory selection\r\n-      setCategoryConfig(prev => {\r\n-        const newConfig = { ...prev, categories: { ...prev.categories } }\r\n-        \r\n-        // Ensure parent category structure exists\r\n-        if (!newConfig.categories[parentCategoryId]) {\r\n-          newConfig.categories[parentCategoryId] = {\r\n-            selected: true, // Auto-select parent when selecting subcategory\r\n-            order: Object.keys(newConfig.categories).filter(id => newConfig.categories[id]?.selected).length,\r\n-            subcategories: {}\r\n-          }\r\n-        }\r\n-        \r\n-        if (!newConfig.categories[parentCategoryId].subcategories) {\r\n-          newConfig.categories[parentCategoryId].subcategories = {}\r\n-        }\r\n-        \r\n-        if (!isCurrentlySelected) {\r\n-          // Select subcategory\r\n-          newConfig.categories[parentCategoryId].subcategories[categoryId] = {\r\n-            selected: true,\r\n-            order: Object.keys(newConfig.categories[parentCategoryId].subcategories).filter(id => \r\n-              newConfig.categories[parentCategoryId].subcategories[id]?.selected\r\n-            ).length\r\n-          }\r\n-          \r\n-          // Ensure parent is also selected\r\n-          newConfig.categories[parentCategoryId].selected = true\r\n-        } else {\r\n-          // Deselect subcategory\r\n-          if (newConfig.categories[parentCategoryId].subcategories[categoryId]) {\r\n-            newConfig.categories[parentCategoryId].subcategories[categoryId].selected = false\r\n-          }\r\n-        }\r\n-        \r\n-        return newConfig\r\n-      })\r\n+      updateCategorySelection(categoryId, !isCurrentlySelected, false)\r\n     }\r\n   }\r\n \r\n   // Handle max categories change\r\n@@ -875,9 +952,9 @@\n                               </div>\r\n                               {selectedMainCategory && (\r\n                                 <small className=\"text-muted\">\r\n                                   <i className=\"bi bi-arrow-right me-1\"></i>\r\n-                                  Selected category: {getCurrentCounts().selectedCategorySubCount} / {MAX_SUBCATEGORIES_PER_MAIN}\r\n+                                  Selected category: {getCurrentCounts().selectedCategorySubCount} / {MAX_SUBCATEGORIES_PER_CATEGORY}\r\n                                 </small>\r\n                               )}\r\n                             </div>\r\n                           </div>\r\n@@ -937,10 +1014,10 @@\n                     <div className=\"col-12\">\r\n                       <div className=\"alert alert-info d-flex align-items-center\">\r\n                         <i className=\"bi bi-info-circle me-2\"></i>\r\n                         <div>\r\n-                          <strong>Selection Summary:</strong> {getCurrentCounts().mainCategoriesCount + getCurrentCounts().totalSubcategoriesCount} categories selected \r\n-                          ({getCurrentCounts().mainCategoriesCount} main categories, {getCurrentCounts().totalSubcategoriesCount} subcategories)\r\n+                          <strong>Selection Summary:</strong> {categoryConfig.categoryIds.length} categories selected \r\n+                          ({categoryConfig.categoryIds.filter(id => mainCategories.some(cat => cat.id === id)).length} main categories, {categoryConfig.categoryIds.filter(id => subCategories.some(cat => cat.id === id)).length} subcategories)\r\n                         </div>\r\n                       </div>\r\n                     </div>\r\n                   </div>\r\n@@ -1080,11 +1157,9 @@\n                                       <div className=\"p-3 bg-light border-bottom\">\r\n                                         <div className=\"row text-center\">\r\n                                           <div className=\"col-6\">\r\n                                             <div className=\"small\">\r\n-                                              <strong>{selectedCategorySubcategories.filter(sub => \r\n-                                                categoryConfig.categories[selectedMainCategory]?.subcategories?.[sub.id]?.selected\r\n-                                              ).length}</strong>\r\n+                                              <strong>{selectedCategorySubcategories.filter(sub => categoryConfig.categoryIds.includes(sub.id)).length}</strong>\r\n                                               <br />\r\n                                               <span className=\"text-muted\">Selected</span>\r\n                                             </div>\r\n                                           </div>\r\n@@ -1306,12 +1381,12 @@\n                               const subcategoriesForMain = getSubcategoriesForCategory(selectedMainCategory)\r\n                               const currentSubCount = subcategoriesForMain.filter(sub => \r\n                                 categoryConfig.categories[selectedMainCategory]?.subcategories?.[sub.id]?.selected\r\n                               ).length\r\n-                              const availableSlots = MAX_SUBCATEGORIES_PER_MAIN - currentSubCount\r\n+                              const availableSlots = MAX_SUBCATEGORIES_PER_CATEGORY - currentSubCount\r\n                               \r\n                               if (availableSlots <= 0) {\r\n-                                setError(`Cannot select more subcategories. Maximum ${MAX_SUBCATEGORIES_PER_MAIN} subcategories per main category allowed.`)\r\n+                                setError(`Cannot select more subcategories. Maximum ${MAX_SUBCATEGORIES_PER_CATEGORY} subcategories per main category allowed.`)\r\n                                 return\r\n                               }\r\n                               \r\n                               setCategoryConfig(prev => {\r\n@@ -1468,11 +1543,11 @@\n                           <td className=\"ps-4\">\r\n                             <div className=\"d-flex align-items-center\">\r\n                               <div>\r\n                                 <div className=\"fw-semibold\">{section.label}</div>\r\n-                                {isCategorySection && (getCurrentCounts().mainCategoriesCount + getCurrentCounts().totalSubcategoriesCount) > 0 && (\r\n+                                {isCategorySection && categoryConfig.categoryIds.length > 0 && (\r\n                                   <small className=\"text-muted\">\r\n-                                    {getCurrentCounts().mainCategoriesCount + getCurrentCounts().totalSubcategoriesCount} categories selected\r\n+                                    {categoryConfig.categoryIds.length} categories selected\r\n                                   </small>\r\n                                 )}\r\n                               </div>\r\n                             </div>\r\n"
                },
                {
                    "date": 1753196790652,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -265,109 +265,9 @@\n     return subcategory?.parent?._id || subcategory?.parent\r\n   }\r\n \r\n   // Update hierarchical category selection\r\n-  const updateCategorySelection = (categoryId, isSelected, isMainCategory) => {\r\n-    console.log('🔄 Updating category selection:', { categoryId, isSelected, isMainCategory })\r\n-    \r\n-    setCategoryConfig(prev => {\r\n-      const newCategories = [...prev.categories]\r\n-      let newCategoryIds = [...prev.categoryIds]\r\n-      \r\n-      if (isMainCategory) {\r\n-        // Handle main category selection\r\n-        const existingIndex = newCategories.findIndex(cat => cat.categoryId === categoryId)\r\n-        \r\n-        if (existingIndex >= 0) {\r\n-          // Category exists, update it\r\n-          newCategories[existingIndex] = {\r\n-            ...newCategories[existingIndex],\r\n-            enabled: isSelected\r\n-          }\r\n-          \r\n-          if (isSelected) {\r\n-            if (!newCategoryIds.includes(categoryId)) {\r\n-              newCategoryIds.push(categoryId)\r\n-            }\r\n-          } else {\r\n-            newCategoryIds = newCategoryIds.filter(id => id !== categoryId)\r\n-            // Also remove all subcategories when deselecting main category\r\n-            newCategories[existingIndex].subcategories.forEach(sub => {\r\n-              if (sub.enabled) {\r\n-                newCategoryIds = newCategoryIds.filter(id => id !== sub.categoryId)\r\n-              }\r\n-              sub.enabled = false\r\n-            })\r\n-          }\r\n-        } else if (isSelected) {\r\n-          // Add new main category\r\n-          newCategories.push({\r\n-            categoryId: categoryId,\r\n-            enabled: true,\r\n-            order: newCategories.length,\r\n-            type: 'main',\r\n-            subcategories: []\r\n-          })\r\n-          newCategoryIds.push(categoryId)\r\n-        }\r\n-      } else {\r\n-        // Handle subcategory selection\r\n-        const parentId = findParentCategory(categoryId)\r\n-        \r\n-        if (parentId) {\r\n-          let parentCategoryIndex = newCategories.findIndex(cat => cat.categoryId === parentId)\r\n-          \r\n-          // Create parent category if it doesn't exist\r\n-          if (parentCategoryIndex < 0 && isSelected) {\r\n-            newCategories.push({\r\n-              categoryId: parentId,\r\n-              enabled: false, // Parent not directly selected\r\n-              order: newCategories.length,\r\n-              type: 'main',\r\n-              subcategories: []\r\n-            })\r\n-            parentCategoryIndex = newCategories.length - 1\r\n-          }\r\n-          \r\n-          if (parentCategoryIndex >= 0) {\r\n-            const parentCategory = newCategories[parentCategoryIndex]\r\n-            const existingSubIndex = parentCategory.subcategories.findIndex(sub => sub.categoryId === categoryId)\r\n-            \r\n-            if (existingSubIndex >= 0) {\r\n-              // Update existing subcategory\r\n-              parentCategory.subcategories[existingSubIndex].enabled = isSelected\r\n-            } else if (isSelected) {\r\n-              // Add new subcategory\r\n-              parentCategory.subcategories.push({\r\n-                categoryId: categoryId,\r\n-                enabled: true,\r\n-                order: parentCategory.subcategories.length,\r\n-                parentId: parentId\r\n-              })\r\n-            }\r\n-            \r\n-            // Update flat categoryIds array\r\n-            if (isSelected) {\r\n-              if (!newCategoryIds.includes(categoryId)) {\r\n-                newCategoryIds.push(categoryId)\r\n-              }\r\n-            } else {\r\n-              newCategoryIds = newCategoryIds.filter(id => id !== categoryId)\r\n-            }\r\n-          }\r\n-        }\r\n-      }\r\n-      \r\n-      console.log('📊 Updated categories:', newCategories)\r\n-      console.log('📋 Updated categoryIds:', newCategoryIds)\r\n-      \r\n-      return {\r\n-        ...prev,\r\n-        categories: newCategories,\r\n-        categoryIds: newCategoryIds\r\n-      }\r\n-    })\r\n-  }\r\n+  // Function removed - using simpler handleCategoryToggle approach\r\n \r\n   // Transform hierarchical data for backend save\r\n   const transformForSave = () => {\r\n     const saveData = {\r\n@@ -761,58 +661,109 @@\n       setSelectedMainCategory(mainCategories[0].id)\r\n     }\r\n   }\r\n \r\n-  // Handle category selection with validation\r\n-  const handleCategoryToggle = (categoryId) => {\r\n-    const isMainCategory = availableCategories.some(cat => cat.id === categoryId && !cat.parent)\r\n+  // Handle category selection with validation - SIMPLIFIED for current structure\r\n+  const handleCategoryToggle = (categoryId, parentCategoryId = null) => {\r\n+    const isMainCategory = !parentCategoryId && availableCategories.some(cat => cat.id === categoryId && !cat.parent)\r\n     \r\n-    console.log('🎯 Category toggle triggered:', { categoryId, isMainCategory })\r\n+    console.log('🎯 Category toggle triggered:', { categoryId, parentCategoryId, isMainCategory })\r\n     \r\n     if (isMainCategory) {\r\n-      const isCurrentlySelected = isMainCategorySelected(categoryId)\r\n-      const { mainCategoriesCount } = getCurrentCounts()\r\n+      const isCurrentlySelected = categoryConfig.categoryIds.includes(categoryId)\r\n+      const currentMainCount = categoryConfig.categoryIds.filter(id => \r\n+        availableCategories.some(cat => cat.id === id && !cat.parent)\r\n+      ).length\r\n       \r\n-      console.log('📊 Main category status:', { isCurrentlySelected, currentCount: mainCategoriesCount })\r\n+      console.log('📊 Main category status:', { isCurrentlySelected, currentCount: currentMainCount })\r\n       \r\n       // Validation for main categories\r\n       if (!isCurrentlySelected) {\r\n         // Trying to select\r\n-        if (!canSelectMoreMainCategories()) {\r\n+        if (currentMainCount >= MAX_MAIN_CATEGORIES) {\r\n           setError(`Cannot select more main categories. Maximum ${MAX_MAIN_CATEGORIES} allowed.`)\r\n           return\r\n         }\r\n       } else {\r\n         // Trying to deselect\r\n-        if (mainCategoriesCount <= MIN_MAIN_CATEGORIES) {\r\n+        if (currentMainCount <= MIN_MAIN_CATEGORIES) {\r\n           setError(`Cannot deselect this category. At least ${MIN_MAIN_CATEGORIES} main category must be selected.`)\r\n           return\r\n         }\r\n       }\r\n       \r\n       // Clear any existing errors\r\n       setError('')\r\n-      updateCategorySelection(categoryId, !isCurrentlySelected, true)\r\n       \r\n+      // Update categoryIds array\r\n+      setCategoryConfig(prev => {\r\n+        if (!isCurrentlySelected) {\r\n+          // Add to selection\r\n+          return {\r\n+            ...prev,\r\n+            categoryIds: [...prev.categoryIds, categoryId]\r\n+          }\r\n+        } else {\r\n+          // Remove from selection (and remove all its subcategories too)\r\n+          const subcategoriesOfThisCategory = subcategories\r\n+            .filter(sub => (sub.parent?._id || sub.parent) === categoryId)\r\n+            .map(sub => sub.id)\r\n+          \r\n+          return {\r\n+            ...prev,\r\n+            categoryIds: prev.categoryIds.filter(id => \r\n+              id !== categoryId && !subcategoriesOfThisCategory.includes(id)\r\n+            )\r\n+          }\r\n+        }\r\n+      })\r\n+      \r\n     } else {\r\n       // Subcategory logic\r\n-      const isCurrentlySelected = isSubcategorySelected(categoryId)\r\n-      const parentId = findParentCategory(categoryId)\r\n+      const isCurrentlySelected = categoryConfig.categoryIds.includes(categoryId)\r\n+      const parentId = parentCategoryId || findParentCategory(categoryId)\r\n       \r\n       console.log('📊 Subcategory status:', { isCurrentlySelected, parentId })\r\n       \r\n       if (!isCurrentlySelected && parentId) {\r\n-        // Trying to select subcategory\r\n-        if (!canSelectMoreSubcategories(parentId)) {\r\n+        // Check subcategory limit for this parent\r\n+        const currentSubCount = categoryConfig.categoryIds.filter(id => \r\n+          subcategories.some(sub => sub.id === id && (sub.parent?._id || sub.parent) === parentId)\r\n+        ).length\r\n+        \r\n+        if (currentSubCount >= MAX_SUBCATEGORIES_PER_CATEGORY) {\r\n           const parentName = availableCategories.find(cat => cat.id === parentId)?.name || 'this category'\r\n           setError(`Cannot select more subcategories for ${parentName}. Maximum ${MAX_SUBCATEGORIES_PER_CATEGORY} per category allowed.`)\r\n           return\r\n         }\r\n       }\r\n       \r\n       // Clear any existing errors\r\n       setError('')\r\n-      updateCategorySelection(categoryId, !isCurrentlySelected, false)\r\n+      \r\n+      // Update categoryIds array\r\n+      setCategoryConfig(prev => {\r\n+        if (!isCurrentlySelected) {\r\n+          // Add to selection\r\n+          let newIds = [...prev.categoryIds, categoryId]\r\n+          \r\n+          // Also ensure parent is selected\r\n+          if (parentId && !prev.categoryIds.includes(parentId)) {\r\n+            newIds.push(parentId)\r\n+          }\r\n+          \r\n+          return {\r\n+            ...prev,\r\n+            categoryIds: newIds\r\n+          }\r\n+        } else {\r\n+          // Remove from selection\r\n+          return {\r\n+            ...prev,\r\n+            categoryIds: prev.categoryIds.filter(id => id !== categoryId)\r\n+          }\r\n+        }\r\n+      })\r\n     }\r\n   }\r\n \r\n   // Handle max categories change\r\n@@ -1043,14 +994,14 @@\n                               </div>\r\n                               <div className=\"card-body p-0\">\r\n                                 <div className=\"list-group list-group-flush\" style={{ maxHeight: '400px', overflowY: 'auto' }}>\r\n                                   {mainCategories.map((category, index) => {\r\n-                                    const categoryData = categoryConfig.categories[category.id]\r\n-                                    const isSelected = categoryData?.selected || false\r\n+                                    // Use the flat categoryIds array for now since categories is still an array\r\n+                                    const isSelected = categoryConfig.categoryIds.includes(category.id)\r\n                                     const isActiveTab = selectedMainCategory === category.id\r\n                                     const subcategoryCount = getSubcategoriesForCategory(category.id).length\r\n                                     const selectedSubcategoryCount = getSubcategoriesForCategory(category.id)\r\n-                                      .filter(sub => categoryData?.subcategories?.[sub.id]?.selected).length\r\n+                                      .filter(sub => categoryConfig.categoryIds.includes(sub.id)).length\r\n                                     \r\n                                     return (\r\n                                       <div \r\n                                         key={category.id} \r\n@@ -1210,10 +1161,10 @@\n \r\n                                       {/* Subcategories List */}\r\n                                       <div className=\"list-group list-group-flush\" style={{ maxHeight: '350px', overflowY: 'auto' }}>\r\n                                         {selectedCategorySubcategories.map((subcategory, index) => {\r\n-                                          const parentCategoryData = categoryConfig.categories[selectedMainCategory]\r\n-                                          const isSelected = parentCategoryData?.subcategories?.[subcategory.id]?.selected || false\r\n+                                          // Use the flat categoryIds array for now since categories is still an array\r\n+                                          const isSelected = categoryConfig.categoryIds.includes(subcategory.id)\r\n                                           \r\n                                           return (\r\n                                             <div \r\n                                               key={subcategory.id} \r\n"
                },
                {
                    "date": 1753197282089,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -269,44 +269,83 @@\n   // Function removed - using simpler handleCategoryToggle approach\r\n \r\n   // Transform hierarchical data for backend save\r\n   const transformForSave = () => {\r\n+    console.log('🔄 === TRANSFORM FOR SAVE START ===')\r\n+    console.log('1. Input categoryConfig:', categoryConfig)\r\n+    console.log('   - categoryConfig.enabled:', categoryConfig.enabled)\r\n+    console.log('   - categoryConfig.maxCategories:', categoryConfig.maxCategories)\r\n+    console.log('   - categoryConfig.layout:', categoryConfig.layout)\r\n+    console.log('   - categoryConfig.showSubcategories:', categoryConfig.showSubcategories)\r\n+    console.log('   - categoryConfig.categories:', categoryConfig.categories)\r\n+    console.log('   - categoryConfig.categoryIds:', categoryConfig.categoryIds)\r\n+    \r\n     const saveData = {\r\n       enabled: categoryConfig.enabled,\r\n       maxCategories: categoryConfig.maxCategories,\r\n       layout: categoryConfig.layout,\r\n       showSubcategories: categoryConfig.showSubcategories,\r\n       categories: []\r\n     }\r\n     \r\n-    // Flatten hierarchical structure for backend\r\n-    categoryConfig.categories.forEach(category => {\r\n-      if (category.enabled) {\r\n-        saveData.categories.push({\r\n-          categoryId: category.categoryId,\r\n-          enabled: true,\r\n-          order: category.order,\r\n-          type: 'main'\r\n-        })\r\n-      }\r\n-      \r\n-      category.subcategories.forEach(subcategory => {\r\n-        if (subcategory.enabled) {\r\n+    console.log('2. Base saveData structure:', saveData)\r\n+    \r\n+    // Since we're using the flat categoryIds array, we need to build categories from that\r\n+    console.log('3. Processing categoryIds array...')\r\n+    console.log('   - Available categories:', availableCategories.length)\r\n+    console.log('   - Available subcategories:', subcategories.length)\r\n+    \r\n+    if (categoryConfig.categoryIds && categoryConfig.categoryIds.length > 0) {\r\n+      categoryConfig.categoryIds.forEach((categoryId, index) => {\r\n+        console.log(`   - Processing categoryId ${index + 1}:`, categoryId)\r\n+        \r\n+        // Check if it's a main category\r\n+        const mainCategory = availableCategories.find(cat => cat.id === categoryId && !cat.parent)\r\n+        if (mainCategory) {\r\n+          console.log(`     ✅ Found main category:`, mainCategory.name)\r\n           saveData.categories.push({\r\n-            categoryId: subcategory.categoryId,\r\n+            categoryId: categoryId,\r\n             enabled: true,\r\n-            order: subcategory.order,\r\n+            order: index,\r\n+            type: 'main'\r\n+          })\r\n+        }\r\n+        \r\n+        // Check if it's a subcategory\r\n+        const subcategory = subcategories.find(sub => sub.id === categoryId)\r\n+        if (subcategory) {\r\n+          const parentId = subcategory.parent?._id || subcategory.parent\r\n+          console.log(`     ✅ Found subcategory:`, subcategory.name, 'parent:', parentId)\r\n+          saveData.categories.push({\r\n+            categoryId: categoryId,\r\n+            enabled: true,\r\n+            order: index,\r\n             type: 'subcategory',\r\n-            parentId: category.categoryId\r\n+            parentId: parentId\r\n           })\r\n         }\r\n+        \r\n+        if (!mainCategory && !subcategory) {\r\n+          console.log(`     ❌ Category ID not found:`, categoryId)\r\n+        }\r\n       })\r\n-    })\r\n+    } else {\r\n+      console.log('   - No categoryIds to process')\r\n+    }\r\n     \r\n     // Sort by order\r\n+    console.log('4. Sorting categories by order...')\r\n     saveData.categories.sort((a, b) => a.order - b.order)\r\n     \r\n-    console.log('💾 Data prepared for save:', saveData)\r\n+    console.log('5. Final saveData:')\r\n+    console.log('   - enabled:', saveData.enabled)\r\n+    console.log('   - maxCategories:', saveData.maxCategories)\r\n+    console.log('   - layout:', saveData.layout)\r\n+    console.log('   - showSubcategories:', saveData.showSubcategories)\r\n+    console.log('   - categories count:', saveData.categories.length)\r\n+    console.log('   - categories details:', saveData.categories)\r\n+    console.log('🔚 === TRANSFORM FOR SAVE END ===')\r\n+    \r\n     return saveData\r\n   }\r\n \r\n   // Load page configuration\r\n@@ -580,57 +619,132 @@\n   }\r\n \r\n   // Save category section configuration\r\n   const saveCategoryConfig = async () => {\r\n+    console.log('🚀 === SAVE CATEGORY CONFIG START ===')\r\n+    console.log('1. Save function triggered')\r\n+    \r\n     try {\r\n+      console.log('2. Setting loading state to true')\r\n       setLoading(true)\r\n+      \r\n+      console.log('3. Setting auth token in localStorage')\r\n       localStorage.setItem('authToken', ADMIN_TOKEN)\r\n+      console.log('   - Auth token set:', ADMIN_TOKEN.substring(0, 20) + '...')\r\n       \r\n-      // Validate before save\r\n+      console.log('4. Getting current counts for validation')\r\n       const { mainCategoriesCount } = getCurrentCounts()\r\n+      console.log('   - Main categories count:', mainCategoriesCount)\r\n+      console.log('   - MIN_MAIN_CATEGORIES:', MIN_MAIN_CATEGORIES)\r\n+      console.log('   - MAX_MAIN_CATEGORIES:', MAX_MAIN_CATEGORIES)\r\n+      \r\n       if (mainCategoriesCount < MIN_MAIN_CATEGORIES) {\r\n+        console.log('❌ Validation failed: Too few main categories')\r\n         setError(`Please select at least ${MIN_MAIN_CATEGORIES} main category before saving.`)\r\n         return\r\n       }\r\n       \r\n       if (mainCategoriesCount > MAX_MAIN_CATEGORIES) {\r\n+        console.log('❌ Validation failed: Too many main categories')\r\n         setError(`Too many main categories selected. Maximum ${MAX_MAIN_CATEGORIES} allowed.`)\r\n         return\r\n       }\r\n       \r\n+      console.log('✅ Validation passed')\r\n+      \r\n+      console.log('5. Current categoryConfig state before transform:')\r\n+      console.log('   - categoryConfig.enabled:', categoryConfig.enabled)\r\n+      console.log('   - categoryConfig.maxCategories:', categoryConfig.maxCategories)\r\n+      console.log('   - categoryConfig.layout:', categoryConfig.layout)\r\n+      console.log('   - categoryConfig.showSubcategories:', categoryConfig.showSubcategories)\r\n+      console.log('   - categoryConfig.categories:', categoryConfig.categories)\r\n+      console.log('   - categoryConfig.categoryIds:', categoryConfig.categoryIds)\r\n+      \r\n       // Transform hierarchical data for save\r\n+      console.log('6. Transforming data for save...')\r\n       const configData = transformForSave()\r\n+      console.log('7. Transformed config data:')\r\n+      console.log('   - Full configData object:', JSON.stringify(configData, null, 2))\r\n+      console.log('   - configData.enabled:', configData.enabled)\r\n+      console.log('   - configData.categories length:', configData.categories?.length || 0)\r\n       \r\n-      console.log('💾 Saving category configuration:', configData)\r\n+      console.log('8. Preparing API request')\r\n+      const apiEndpoint = '/api/pages/home/sections/category'\r\n+      console.log('   - API endpoint:', apiEndpoint)\r\n+      console.log('   - Request method: PUT')\r\n+      console.log('   - Request data:', configData)\r\n+      console.log('   - Request headers will include auth token')\r\n       \r\n-      const response = await put('/api/pages/home/sections/category', configData)\r\n-      console.log('📡 Save response:', response)\r\n+      console.log('9. Making API request...')\r\n+      const response = await put(apiEndpoint, configData)\r\n+      console.log('10. API response received:')\r\n+      console.log('    - Raw response:', response)\r\n+      console.log('    - Response type:', typeof response)\r\n+      console.log('    - Response keys:', Object.keys(response || {}))\r\n+      console.log('    - Response.data:', response?.data)\r\n+      console.log('    - Response.status:', response?.status)\r\n+      console.log('    - Response.success:', response?.success)\r\n       \r\n       // Handle the double-wrapped response from apiService\r\n+      console.log('11. Processing response data...')\r\n       const actualData = response.data // This contains the backend response\r\n+      console.log('    - actualData:', actualData)\r\n+      console.log('    - actualData type:', typeof actualData)\r\n+      console.log('    - actualData.success:', actualData?.success)\r\n+      console.log('    - actualData.message:', actualData?.message)\r\n       \r\n       if (actualData && actualData.success) {\r\n+        console.log('✅ Save successful!')\r\n         setSuccess('Category section configuration saved successfully!')\r\n         setTimeout(() => setSuccess(''), 3000)\r\n         setShowCategoryConfig(false)\r\n         \r\n         // Trigger refresh notification (optional)\r\n         try {\r\n+          console.log('12. Triggering homepage refresh...')\r\n           await get('/api/pages/home/refresh/categorySection')\r\n+          console.log('    - Homepage refresh successful')\r\n         } catch (refreshError) {\r\n-          console.log('Refresh notification failed, but save was successful')\r\n+          console.log('⚠️ Refresh notification failed, but save was successful:', refreshError)\r\n         }\r\n         \r\n+        console.log('13. Reloading page config...')\r\n         await loadPageConfig(selectedPage) // Reload to get updated config\r\n+        console.log('14. Page config reloaded')\r\n       } else {\r\n-        setError('Failed to save configuration: ' + (actualData?.message || 'Unknown error'))\r\n+        console.log('❌ Save failed - API returned unsuccessful response')\r\n+        console.log('    - actualData:', actualData)\r\n+        const errorMessage = actualData?.message || 'Unknown error'\r\n+        console.log('    - Error message:', errorMessage)\r\n+        setError('Failed to save configuration: ' + errorMessage)\r\n       }\r\n       \r\n     } catch (err) {\r\n-      console.error('Save category config error:', err)\r\n+      console.error('❌ === SAVE CATEGORY CONFIG ERROR ===')\r\n+      console.error('Error caught in try-catch:')\r\n+      console.error('   - Error object:', err)\r\n+      console.error('   - Error message:', err.message)\r\n+      console.error('   - Error name:', err.name)\r\n+      console.error('   - Error stack:', err.stack)\r\n+      \r\n+      if (err.response) {\r\n+        console.error('   - HTTP Response Error Details:')\r\n+        console.error('     - Status:', err.response.status)\r\n+        console.error('     - Status text:', err.response.statusText)\r\n+        console.error('     - Response data:', err.response.data)\r\n+        console.error('     - Response headers:', err.response.headers)\r\n+      }\r\n+      \r\n+      if (err.request) {\r\n+        console.error('   - Request Error Details:')\r\n+        console.error('     - Request object:', err.request)\r\n+      }\r\n+      \r\n       setError('Failed to save category configuration: ' + err.message)\r\n     } finally {\r\n+      console.log('15. Setting loading state to false')\r\n       setLoading(false)\r\n+      console.log('🔚 === SAVE CATEGORY CONFIG END ===')\r\n     }\r\n   }\r\n \r\n   // Toggle section visibility\r\n"
                },
                {
                    "date": 1753198319614,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -667,9 +667,9 @@\n       console.log('   - configData.enabled:', configData.enabled)\r\n       console.log('   - configData.categories length:', configData.categories?.length || 0)\r\n       \r\n       console.log('8. Preparing API request')\r\n-      const apiEndpoint = '/api/pages/home/sections/category'\r\n+      const apiEndpoint = '/pages/home/sections/category'\r\n       console.log('   - API endpoint:', apiEndpoint)\r\n       console.log('   - Request method: PUT')\r\n       console.log('   - Request data:', configData)\r\n       console.log('   - Request headers will include auth token')\r\n"
                },
                {
                    "date": 1753199789703,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -353,9 +353,9 @@\n     try {\r\n       setLoading(true)\r\n       localStorage.setItem('authToken', ADMIN_TOKEN)\r\n       \r\n-      const response = await get(`/api/pages/${pageKey}`)\r\n+      const response = await get(`/pages/${pageKey}`)\r\n       console.log('Page config response:', response)\r\n       \r\n       // Handle the double-wrapped response from apiService\r\n       const actualData = response.data // This contains the backend response\r\n"
                },
                {
                    "date": 1753200011114,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -27,20 +27,27 @@\n   const [pageConfig, setPageConfig] = useState(null)\r\n \r\n   // Category section configuration state - NEW HIERARCHICAL STRUCTURE\r\n   const [categoryConfig, setCategoryConfig] = useState({\r\n-    enabled: true,\r\n-    maxCategories: 10, // Keep for UI display\r\n-    layout: 'grid',\r\n-    showSubcategories: true,\r\n-    // New hierarchical structure\r\n-    categories: [\r\n-      // Structure: { categoryId, enabled, order, type: 'main', subcategories: [...] }\r\n-    ],\r\n-    // Keep for backward compatibility and quick lookups\r\n-    categoryIds: []\r\n-  })\r\n+  enabled: true,\r\n+  maxCategories: 10,\r\n+  layout: 'grid',\r\n+  showSubcategories: true,\r\n+  // New hierarchical structure\r\n+  categories: [],\r\n+  // FIXED: Always initialize as empty array, not undefined\r\n+  categoryIds: []\r\n+})\r\n \r\n+// ...existing code around line 1612...\r\n+\r\n+// FIX: Add null safety check for categoryIds\r\n+{isCategorySection && categoryConfig.categoryIds && categoryConfig.categoryIds.length > 0 && (\r\n+  <small className=\"text-muted\">\r\n+    {categoryConfig.categoryIds.length} categories selected\r\n+  </small>\r\n+)}\r\n+\r\n   // Business rule constants\r\n   const MAX_MAIN_CATEGORIES = 10\r\n   const MIN_MAIN_CATEGORIES = 1\r\n   const MAX_SUBCATEGORIES_PER_CATEGORY = 10\r\n"
                },
                {
                    "date": 1753200202001,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -355,90 +355,82 @@\n     return saveData\r\n   }\r\n \r\n   // Load page configuration\r\n-  const loadPageConfig = async (pageKey) => {\r\n-    try {\r\n-      setLoading(true)\r\n-      localStorage.setItem('authToken', ADMIN_TOKEN)\r\n+  // ...existing code around line 380...\r\n+\r\n+// Load page configuration\r\n+const loadPageConfig = async (pageKey) => {\r\n+  try {\r\n+    setLoading(true)\r\n+    localStorage.setItem('authToken', ADMIN_TOKEN)\r\n+    \r\n+    const response = await get(`/pages/${pageKey}`)\r\n+    console.log('Page config response:', response)\r\n+    \r\n+    // Handle the double-wrapped response from apiService\r\n+    const actualData = response.data // This contains the backend response\r\n+    \r\n+    if (actualData && actualData.success) {\r\n+      setPageConfig(actualData.data)\r\n       \r\n-      const response = await get(`/pages/${pageKey}`)\r\n-      console.log('Page config response:', response)\r\n-      \r\n-      // Handle the double-wrapped response from apiService\r\n-      const actualData = response.data // This contains the backend response\r\n-      \r\n-      if (actualData && actualData.success) {\r\n-        setPageConfig(actualData.data)\r\n+      // Extract category section config\r\n+      const categorySection = actualData.data.sections.find(s => s.sectionType === 'categorySection')\r\n+      if (categorySection && categorySection.config) {\r\n+        // FIXED: Properly extract categoryIds and convert to flat structure\r\n+        const savedCategories = categorySection.config.categories || []\r\n+        const categoryIds = savedCategories.map(cat => cat.categoryId).filter(Boolean)\r\n         \r\n-        // Extract category section config\r\n-        const categorySection = actualData.data.sections.find(s => s.sectionType === 'categorySection')\r\n-        if (categorySection && categorySection.config) {\r\n-          // Convert the saved flat structure back to hierarchical state\r\n-          const hierarchicalConfig = {\r\n-            enabled: categorySection.enabled || false,\r\n-            maxCategories: categorySection.config.maxCategories || 10,\r\n-            layout: categorySection.config.layout || 'grid',\r\n-            showSubcategories: categorySection.config.showSubcategories || true,\r\n-            categories: {}\r\n+        setCategoryConfig({\r\n+          enabled: categorySection.enabled || false,\r\n+          maxCategories: categorySection.config.maxCategories || 10,\r\n+          layout: categorySection.config.layout || 'grid',\r\n+          showSubcategories: categorySection.config.showSubcategories || true,\r\n+          categories: savedCategories, // Keep the hierarchical structure\r\n+          categoryIds: categoryIds || [] // FIXED: Ensure this is always an array\r\n+        })\r\n+        \r\n+        console.log('📂 Loaded category config with categoryIds:', categoryIds)\r\n+        \r\n+        // Update visibility state\r\n+        setVisibleSections(prev => ({\r\n+          ...prev,\r\n+          [pageKey]: {\r\n+            ...prev[pageKey],\r\n+            giftCategories: categorySection.enabled\r\n           }\r\n-          \r\n-          // Rebuild hierarchical structure from saved config\r\n-          if (categorySection.config.categories && Array.isArray(categorySection.config.categories)) {\r\n-            categorySection.config.categories.forEach(cat => {\r\n-              if (cat.categoryId) {\r\n-                hierarchicalConfig.categories[cat.categoryId] = {\r\n-                  selected: cat.enabled || false,\r\n-                  order: cat.order || 0,\r\n-                  subcategories: {}\r\n-                }\r\n-                \r\n-                // Add subcategories if they exist\r\n-                if (cat.subcategories && Array.isArray(cat.subcategories)) {\r\n-                  cat.subcategories.forEach(sub => {\r\n-                    if (sub.subcategoryId) {\r\n-                      hierarchicalConfig.categories[cat.categoryId].subcategories[sub.subcategoryId] = {\r\n-                        selected: sub.enabled || false,\r\n-                        order: sub.order || 0\r\n-                      }\r\n-                    }\r\n-                  })\r\n-                }\r\n-              }\r\n-            })\r\n-          }\r\n-          \r\n-          setCategoryConfig(hierarchicalConfig)\r\n-          console.log('📂 Loaded hierarchical config:', hierarchicalConfig)\r\n-          \r\n-          // Update visibility state\r\n-          setVisibleSections(prev => ({\r\n-            ...prev,\r\n-            [pageKey]: {\r\n-              ...prev[pageKey],\r\n-              giftCategories: categorySection.enabled\r\n-            }\r\n-          }))\r\n-        } else {\r\n-          // Initialize with default hierarchical structure if no config exists\r\n-          setCategoryConfig({\r\n-            enabled: false,\r\n-            maxCategories: 10,\r\n-            layout: 'grid',\r\n-            showSubcategories: true,\r\n-            categories: {}\r\n-          })\r\n-        }\r\n+        }))\r\n+      } else {\r\n+        // FIXED: Initialize with empty arrays when no config exists\r\n+        setCategoryConfig({\r\n+          enabled: false,\r\n+          maxCategories: 10,\r\n+          layout: 'grid',\r\n+          showSubcategories: true,\r\n+          categories: [],\r\n+          categoryIds: [] // FIXED: Ensure this is always an array\r\n+        })\r\n       }\r\n-      \r\n-      setError('')\r\n-    } catch (err) {\r\n-      console.error('Load page config error:', err)\r\n-      setError('Failed to load page configuration: ' + err.message)\r\n-    } finally {\r\n-      setLoading(false)\r\n     }\r\n+    \r\n+    setError('')\r\n+  } catch (err) {\r\n+    console.error('Load page config error:', err)\r\n+    setError('Failed to load page configuration: ' + err.message)\r\n+    \r\n+    // FIXED: Set default config on error to prevent undefined\r\n+    setCategoryConfig({\r\n+      enabled: false,\r\n+      maxCategories: 10,\r\n+      layout: 'grid',\r\n+      showSubcategories: true,\r\n+      categories: [],\r\n+      categoryIds: [] // FIXED: Ensure this is always an array\r\n+    })\r\n+  } finally {\r\n+    setLoading(false)\r\n   }\r\n+}\r\n \r\n   // Load available categories (same approach as CategoriesPage.js)\r\n   const loadCategories = async () => {\r\n     try {\r\n"
                },
                {
                    "date": 1753200305836,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -146,82 +146,63 @@\n \r\n   // ========== HIERARCHICAL DATA MANAGEMENT HELPERS ==========\r\n   \r\n   // Get current counts for validation\r\n-  const getCurrentCounts = () => {\r\n-    // Handle both old array structure and new object structure\r\n-    let mainCategoriesCount = 0\r\n-    let totalSubcategoriesCount = 0\r\n-    let selectedCategorySubCount = 0\r\n-    const subcategoryCounts = {}\r\n+  // ...existing code around line 130...\r\n+\r\n+// Get current counts for validation\r\n+const getCurrentCounts = () => {\r\n+  // FIXED: Add safety checks for undefined categoryIds\r\n+  const safeCategories = categoryConfig.categories || []\r\n+  const safeCategoryIds = categoryConfig.categoryIds || []\r\n+  \r\n+  // Handle both old array structure and new object structure\r\n+  let mainCategoriesCount = 0\r\n+  let totalSubcategoriesCount = 0\r\n+  let selectedCategorySubCount = 0\r\n+  const subcategoryCounts = {}\r\n+  \r\n+  if (Array.isArray(safeCategories) && safeCategories.length > 0) {\r\n+    // Old structure: array of category objects\r\n+    mainCategoriesCount = safeCategories.filter(cat => cat.enabled).length\r\n     \r\n-    if (Array.isArray(categoryConfig.categories)) {\r\n-      // Old structure: array of category objects\r\n-      mainCategoriesCount = categoryConfig.categories.filter(cat => cat.enabled).length\r\n+    safeCategories.forEach(category => {\r\n+      const subCount = category.subcategories ? category.subcategories.filter(sub => sub.enabled).length : 0\r\n+      subcategoryCounts[category.categoryId] = subCount\r\n+      totalSubcategoriesCount += subCount\r\n       \r\n-      categoryConfig.categories.forEach(category => {\r\n-        const subCount = category.subcategories ? category.subcategories.filter(sub => sub.enabled).length : 0\r\n-        subcategoryCounts[category.categoryId] = subCount\r\n-        totalSubcategoriesCount += subCount\r\n-        \r\n-        // Get subcategory count for currently selected main category\r\n-        if (selectedMainCategory && category.categoryId === selectedMainCategory) {\r\n-          selectedCategorySubCount = subCount\r\n-        }\r\n-      })\r\n-    } else if (typeof categoryConfig.categories === 'object' && categoryConfig.categories !== null) {\r\n-      // New structure: object with category IDs as keys\r\n-      mainCategoriesCount = Object.keys(categoryConfig.categories).filter(\r\n-        categoryId => categoryConfig.categories[categoryId]?.selected\r\n+      // Get subcategory count for currently selected main category\r\n+      if (selectedMainCategory && category.categoryId === selectedMainCategory) {\r\n+        selectedCategorySubCount = subCount\r\n+      }\r\n+    })\r\n+  } else {\r\n+    // Fallback: use categoryIds for backward compatibility\r\n+    if (availableCategories.length > 0 && safeCategoryIds.length > 0) {\r\n+      mainCategoriesCount = safeCategoryIds.filter(id => \r\n+        availableCategories.some(cat => cat.id === id && !cat.parent)\r\n       ).length\r\n       \r\n-      Object.keys(categoryConfig.categories).forEach(categoryId => {\r\n-        const categoryData = categoryConfig.categories[categoryId]\r\n-        let subCount = 0\r\n+      totalSubcategoriesCount = safeCategoryIds.filter(id => \r\n+        subcategories.some(sub => sub.id === id)\r\n+      ).length\r\n         \r\n-        if (categoryData && categoryData.subcategories) {\r\n-          subCount = Object.keys(categoryData.subcategories).filter(\r\n-            subId => categoryData.subcategories[subId]?.selected\r\n-          ).length\r\n-        }\r\n-        \r\n-        subcategoryCounts[categoryId] = subCount\r\n-        totalSubcategoriesCount += subCount\r\n-        \r\n-        // Get subcategory count for currently selected main category\r\n-        if (selectedMainCategory && categoryId === selectedMainCategory) {\r\n-          selectedCategorySubCount = subCount\r\n-        }\r\n-      })\r\n-    } else {\r\n-      // Fallback: use categoryIds for backward compatibility\r\n-      if (availableCategories.length > 0) {\r\n-        mainCategoriesCount = categoryConfig.categoryIds ? \r\n-          categoryConfig.categoryIds.filter(id => \r\n-            availableCategories.some(cat => cat.id === id && !cat.parent)\r\n-          ).length : 0\r\n-        \r\n-        totalSubcategoriesCount = categoryConfig.categoryIds ? \r\n-          categoryConfig.categoryIds.filter(id => \r\n-            subcategories.some(sub => sub.id === id)\r\n-          ).length : 0\r\n-          \r\n-        selectedCategorySubCount = selectedMainCategory && categoryConfig.categoryIds ? \r\n-          categoryConfig.categoryIds.filter(id => \r\n-            subcategories.some(sub => sub.id === id && \r\n-              (sub.parent?._id === selectedMainCategory || sub.parent === selectedMainCategory)\r\n-            )\r\n-          ).length : 0\r\n-      }\r\n+      selectedCategorySubCount = selectedMainCategory && safeCategoryIds ? \r\n+        safeCategoryIds.filter(id => \r\n+          subcategories.some(sub => sub.id === id && \r\n+            (sub.parent?._id === selectedMainCategory || sub.parent === selectedMainCategory)\r\n+          )\r\n+        ).length : 0\r\n     }\r\n-    \r\n-    return { \r\n-      mainCategoriesCount, \r\n-      subcategoryCounts, \r\n-      totalSubcategoriesCount,\r\n-      selectedCategorySubCount \r\n-    }\r\n   }\r\n+  \r\n+  return { \r\n+    mainCategoriesCount, \r\n+    subcategoryCounts, \r\n+    totalSubcategoriesCount,\r\n+    selectedCategorySubCount \r\n+  }\r\n+}\r\n \r\n   // Check if we can select more main categories\r\n   const canSelectMoreMainCategories = () => {\r\n     const { mainCategoriesCount } = getCurrentCounts()\r\n@@ -235,37 +216,46 @@\n     return currentCount < MAX_SUBCATEGORIES_PER_CATEGORY\r\n   }\r\n \r\n   // Check if a main category is selected\r\n-  const isMainCategorySelected = (categoryId) => {\r\n-    if (Array.isArray(categoryConfig.categories)) {\r\n-      // Old structure\r\n-      const category = categoryConfig.categories.find(cat => cat.categoryId === categoryId)\r\n-      return category ? category.enabled : false\r\n-    } else if (typeof categoryConfig.categories === 'object') {\r\n-      // New structure\r\n-      return categoryConfig.categories[categoryId]?.selected || false\r\n-    } else {\r\n-      // Fallback\r\n-      return categoryConfig.categoryIds ? categoryConfig.categoryIds.includes(categoryId) : false\r\n-    }\r\n+  // ...existing code around line 190...\r\n+\r\n+// Check if a main category is selected\r\n+const isMainCategorySelected = (categoryId) => {\r\n+  // FIXED: Add safety check for undefined categoryIds\r\n+  const safeCategoryIds = categoryConfig.categoryIds || []\r\n+  \r\n+  if (Array.isArray(categoryConfig.categories)) {\r\n+    // Old structure\r\n+    const category = categoryConfig.categories.find(cat => cat.categoryId === categoryId)\r\n+    return category ? category.enabled : false\r\n+  } else if (typeof categoryConfig.categories === 'object') {\r\n+    // New structure\r\n+    return categoryConfig.categories[categoryId]?.selected || false\r\n+  } else {\r\n+    // Fallback\r\n+    return safeCategoryIds.includes(categoryId)\r\n   }\r\n+}\r\n \r\n-  // Check if a subcategory is selected\r\n-  const isSubcategorySelected = (subcategoryId, parentCategoryId = null) => {\r\n-    if (Array.isArray(categoryConfig.categories)) {\r\n-      // Old structure\r\n-      return categoryConfig.categories.some(category => \r\n-        category.subcategories && category.subcategories.some(sub => sub.categoryId === subcategoryId && sub.enabled)\r\n-      )\r\n-    } else if (typeof categoryConfig.categories === 'object' && parentCategoryId) {\r\n-      // New structure\r\n-      return categoryConfig.categories[parentCategoryId]?.subcategories?.[subcategoryId]?.selected || false\r\n-    } else {\r\n-      // Fallback\r\n-      return categoryConfig.categoryIds ? categoryConfig.categoryIds.includes(subcategoryId) : false\r\n-    }\r\n+// Check if a subcategory is selected\r\n+const isSubcategorySelected = (subcategoryId, parentCategoryId = null) => {\r\n+  // FIXED: Add safety check for undefined categoryIds\r\n+  const safeCategoryIds = categoryConfig.categoryIds || []\r\n+  \r\n+  if (Array.isArray(categoryConfig.categories)) {\r\n+    // Old structure\r\n+    return categoryConfig.categories.some(category => \r\n+      category.subcategories && category.subcategories.some(sub => sub.categoryId === subcategoryId && sub.enabled)\r\n+    )\r\n+  } else if (typeof categoryConfig.categories === 'object' && parentCategoryId) {\r\n+    // New structure\r\n+    return categoryConfig.categories[parentCategoryId]?.subcategories?.[subcategoryId]?.selected || false\r\n+  } else {\r\n+    // Fallback\r\n+    return safeCategoryIds.includes(subcategoryId)\r\n   }\r\n+}\r\n \r\n   // Find which main category a subcategory belongs to\r\n   const findParentCategory = (subcategoryId) => {\r\n     const subcategory = subcategories.find(sub => sub.id === subcategoryId)\r\n"
                },
                {
                    "date": 1753200447655,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -40,13 +40,8 @@\n \r\n // ...existing code around line 1612...\r\n \r\n // FIX: Add null safety check for categoryIds\r\n-{isCategorySection && categoryConfig.categoryIds && categoryConfig.categoryIds.length > 0 && (\r\n-  <small className=\"text-muted\">\r\n-    {categoryConfig.categoryIds.length} categories selected\r\n-  </small>\r\n-)}\r\n \r\n   // Business rule constants\r\n   const MAX_MAIN_CATEGORIES = 10\r\n   const MIN_MAIN_CATEGORIES = 1\r\n"
                },
                {
                    "date": 1753281671327,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -136,9 +136,9 @@\n     },\r\n   })\r\n \r\n   // Hardcoded admin token for testing\r\n-  const ADMIN_TOKEN = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY4NzZhYTJmYzc3YWY4ODU3Njk1ZDA5MiIsInJvbGUiOiJhZG1pbiIsImlhdCI6MTc1MjYwNzMyMCwiZXhwIjoxNzUzMjEyMTIwfQ.ugFuaDCq_ewqIE-dZaql3BB91kaXBIxE0TQmqdYnagI'\r\n+  const ADMIN_TOKEN = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY4NzZhYTJmYzc3YWY4ODU3Njk1ZDA5MiIsInJvbGUiOiJhZG1pbiIsImlhdCI6MTc1MzI4MTMyMCwiZXhwIjoxNzUzODg2MTIwfQ.3wEx7ZCDvYtUQppFM9CcXjhG1zTQX9_RYY_dy3Y6MZs'\r\n \r\n   // ========== HIERARCHICAL DATA MANAGEMENT HELPERS ==========\r\n   \r\n   // Get current counts for validation\r\n"
                },
                {
                    "date": 1753283597777,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -259,18 +259,13 @@\n \r\n   // Update hierarchical category selection\r\n   // Function removed - using simpler handleCategoryToggle approach\r\n \r\n-  // Transform hierarchical data for backend save\r\n+  // Transform hierarchical data for backend save - FIXED to only use selected categories\r\n   const transformForSave = () => {\r\n     console.log('🔄 === TRANSFORM FOR SAVE START ===')\r\n     console.log('1. Input categoryConfig:', categoryConfig)\r\n-    console.log('   - categoryConfig.enabled:', categoryConfig.enabled)\r\n-    console.log('   - categoryConfig.maxCategories:', categoryConfig.maxCategories)\r\n-    console.log('   - categoryConfig.layout:', categoryConfig.layout)\r\n-    console.log('   - categoryConfig.showSubcategories:', categoryConfig.showSubcategories)\r\n-    console.log('   - categoryConfig.categories:', categoryConfig.categories)\r\n-    console.log('   - categoryConfig.categoryIds:', categoryConfig.categoryIds)\r\n+    console.log('   - categoryConfig.categoryIds (SELECTED):', categoryConfig.categoryIds)\r\n     \r\n     const saveData = {\r\n       enabled: categoryConfig.enabled,\r\n       maxCategories: categoryConfig.maxCategories,\r\n@@ -280,26 +275,25 @@\n     }\r\n     \r\n     console.log('2. Base saveData structure:', saveData)\r\n     \r\n-    // Since we're using the flat categoryIds array, we need to build categories from that\r\n-    console.log('3. Processing categoryIds array...')\r\n-    console.log('   - Available categories:', availableCategories.length)\r\n-    console.log('   - Available subcategories:', subcategories.length)\r\n+    // 🎯 ONLY process the categoryIds that are actually selected by the user\r\n+    console.log('3. Processing ONLY selected categoryIds...')\r\n+    console.log('   - Selected categoryIds:', categoryConfig.categoryIds)\r\n+    console.log('   - Total selected:', categoryConfig.categoryIds.length)\r\n     \r\n     if (categoryConfig.categoryIds && categoryConfig.categoryIds.length > 0) {\r\n       categoryConfig.categoryIds.forEach((categoryId, index) => {\r\n-        console.log(`   - Processing categoryId ${index + 1}:`, categoryId)\r\n+        console.log(`   - Processing selected categoryId ${index + 1}:`, categoryId)\r\n         \r\n         // Check if it's a main category\r\n         const mainCategory = availableCategories.find(cat => cat.id === categoryId && !cat.parent)\r\n         if (mainCategory) {\r\n           console.log(`     ✅ Found main category:`, mainCategory.name)\r\n           saveData.categories.push({\r\n             categoryId: categoryId,\r\n             enabled: true,\r\n-            order: index,\r\n-            type: 'main'\r\n+            order: index\r\n           })\r\n         }\r\n         \r\n         // Check if it's a subcategory\r\n@@ -309,33 +303,21 @@\n           console.log(`     ✅ Found subcategory:`, subcategory.name, 'parent:', parentId)\r\n           saveData.categories.push({\r\n             categoryId: categoryId,\r\n             enabled: true,\r\n-            order: index,\r\n-            type: 'subcategory',\r\n-            parentId: parentId\r\n+            order: index\r\n           })\r\n         }\r\n         \r\n         if (!mainCategory && !subcategory) {\r\n           console.log(`     ❌ Category ID not found:`, categoryId)\r\n         }\r\n       })\r\n     } else {\r\n-      console.log('   - No categoryIds to process')\r\n+      console.log('   - No categories selected')\r\n     }\r\n     \r\n-    // Sort by order\r\n-    console.log('4. Sorting categories by order...')\r\n-    saveData.categories.sort((a, b) => a.order - b.order)\r\n-    \r\n-    console.log('5. Final saveData:')\r\n-    console.log('   - enabled:', saveData.enabled)\r\n-    console.log('   - maxCategories:', saveData.maxCategories)\r\n-    console.log('   - layout:', saveData.layout)\r\n-    console.log('   - showSubcategories:', saveData.showSubcategories)\r\n-    console.log('   - categories count:', saveData.categories.length)\r\n-    console.log('   - categories details:', saveData.categories)\r\n+    console.log('4. Final saveData categories:', saveData.categories)\r\n     console.log('🔚 === TRANSFORM FOR SAVE END ===')\r\n     \r\n     return saveData\r\n   }\r\n@@ -791,29 +773,38 @@\n       \r\n       // Clear any existing errors\r\n       setError('')\r\n       \r\n-      // Update categoryIds array\r\n+      // 🎯 Update categoryIds array with actual selections\r\n       setCategoryConfig(prev => {\r\n+        let newCategoryIds = [...prev.categoryIds]\r\n+        \r\n         if (!isCurrentlySelected) {\r\n           // Add to selection\r\n-          return {\r\n-            ...prev,\r\n-            categoryIds: [...prev.categoryIds, categoryId]\r\n-          }\r\n+          console.log('✅ Adding main category to selection:', categoryId)\r\n+          newCategoryIds.push(categoryId)\r\n         } else {\r\n           // Remove from selection (and remove all its subcategories too)\r\n           const subcategoriesOfThisCategory = subcategories\r\n             .filter(sub => (sub.parent?._id || sub.parent) === categoryId)\r\n             .map(sub => sub.id)\r\n           \r\n-          return {\r\n-            ...prev,\r\n-            categoryIds: prev.categoryIds.filter(id => \r\n-              id !== categoryId && !subcategoriesOfThisCategory.includes(id)\r\n-            )\r\n-          }\r\n+          console.log('❌ Removing main category and its subcategories:', {\r\n+            mainCategory: categoryId,\r\n+            subcategories: subcategoriesOfThisCategory\r\n+          })\r\n+          \r\n+          newCategoryIds = newCategoryIds.filter(id => \r\n+            id !== categoryId && !subcategoriesOfThisCategory.includes(id)\r\n+          )\r\n         }\r\n+        \r\n+        console.log('📝 Updated categoryIds:', newCategoryIds)\r\n+        \r\n+        return {\r\n+          ...prev,\r\n+          categoryIds: newCategoryIds\r\n+        }\r\n       })\r\n       \r\n     } else {\r\n       // Subcategory logic\r\n@@ -837,30 +828,34 @@\n       \r\n       // Clear any existing errors\r\n       setError('')\r\n       \r\n-      // Update categoryIds array\r\n+      // 🎯 Update categoryIds array for subcategory\r\n       setCategoryConfig(prev => {\r\n+        let newCategoryIds = [...prev.categoryIds]\r\n+        \r\n         if (!isCurrentlySelected) {\r\n-          // Add to selection\r\n-          let newIds = [...prev.categoryIds, categoryId]\r\n+          // Add subcategory to selection\r\n+          console.log('✅ Adding subcategory to selection:', categoryId)\r\n+          newCategoryIds.push(categoryId)\r\n           \r\n           // Also ensure parent is selected\r\n-          if (parentId && !prev.categoryIds.includes(parentId)) {\r\n-            newIds.push(parentId)\r\n+          if (parentId && !newCategoryIds.includes(parentId)) {\r\n+            console.log('✅ Auto-adding parent category:', parentId)\r\n+            newCategoryIds.push(parentId)\r\n           }\r\n-          \r\n-          return {\r\n-            ...prev,\r\n-            categoryIds: newIds\r\n-          }\r\n         } else {\r\n-          // Remove from selection\r\n-          return {\r\n-            ...prev,\r\n-            categoryIds: prev.categoryIds.filter(id => id !== categoryId)\r\n-          }\r\n+          // Remove subcategory from selection\r\n+          console.log('❌ Removing subcategory from selection:', categoryId)\r\n+          newCategoryIds = newCategoryIds.filter(id => id !== categoryId)\r\n         }\r\n+        \r\n+        console.log('📝 Updated categoryIds:', newCategoryIds)\r\n+        \r\n+        return {\r\n+          ...prev,\r\n+          categoryIds: newCategoryIds\r\n+        }\r\n       })\r\n     }\r\n   }\r\n \r\n@@ -1100,78 +1095,60 @@\n                                     const selectedSubcategoryCount = getSubcategoriesForCategory(category.id)\r\n                                       .filter(sub => categoryConfig.categoryIds.includes(sub.id)).length\r\n                                     \r\n                                     return (\r\n-                                      <div \r\n-                                        key={category.id} \r\n-                                        className={`list-group-item list-group-item-action border-0 ${isActiveTab ? 'active' : ''} ${isSelected ? 'bg-primary bg-opacity-10 border-start border-primary border-3' : ''}`}\r\n-                                        style={{ cursor: 'pointer' }}\r\n+                                      <div\r\n+                                        key={category.id}\r\n+                                        className={`list-group-item d-flex justify-content-between align-items-center ${isActiveTab ? 'active' : ''}`}\r\n+                                        style={{ \r\n+                                          cursor: 'pointer',\r\n+                                          borderLeft: isActiveTab ? '4px solid #0d6efd' : '4px solid transparent'\r\n+                                        }}\r\n                                         onClick={() => setSelectedMainCategory(category.id)}\r\n                                       >\r\n-                                        <div className=\"d-flex align-items-center\">\r\n-                                          <div className=\"form-check me-3\" onClick={(e) => e.stopPropagation()}>\r\n-                                            <input \r\n-                                              className=\"form-check-input\" \r\n-                                              type=\"checkbox\" \r\n-                                              id={`main-category-${category.id}`}\r\n+                                        <div className=\"d-flex align-items-center flex-grow-1\">\r\n+                                          <div className=\"form-check me-3\">\r\n+                                            <input\r\n+                                              className=\"form-check-input\"\r\n+                                              type=\"checkbox\"\r\n                                               checked={isSelected}\r\n-                                              onChange={() => handleCategoryToggle(category.id)}\r\n+                                              onChange={(e) => {\r\n+                                                e.stopPropagation()\r\n+                                                handleCategoryToggle(category.id)\r\n+                                              }}\r\n                                             />\r\n                                           </div>\r\n-                                          \r\n-                                          {category.image && (\r\n-                                            <img \r\n-                                              src={category.image} \r\n-                                              alt={category.name}\r\n-                                              className=\"me-3 flex-shrink-0 border\"\r\n-                                              style={{ width: '42px', height: '42px', objectFit: 'cover', borderRadius: '8px' }}\r\n-                                            />\r\n-                                          )}\r\n-                                          \r\n-                                          <div className=\"flex-grow-1\">\r\n-                                            <div className=\"d-flex justify-content-between align-items-center\">\r\n-                                              <div>\r\n-                                                <h6 className={`mb-1 fw-semibold ${isActiveTab ? 'text-white' : 'text-dark'}`}>\r\n-                                                  <i className=\"bi bi-grid text-primary me-1\" style={{ fontSize: '14px' }}></i>\r\n-                                                  {category.name}\r\n-                                                </h6>\r\n-                                                {category.description && (\r\n-                                                  <p className={`mb-1 small ${isActiveTab ? 'text-white-50' : 'text-muted'}`}>\r\n-                                                    {category.description}\r\n-                                                  </p>\r\n-                                                )}\r\n-                                                <div className=\"d-flex gap-1 align-items-center\">\r\n-                                                  <span className={`badge ${isActiveTab ? 'bg-white text-primary' : 'bg-primary'}`} style={{ fontSize: '9px' }}>\r\n-                                                    Main Category\r\n-                                                  </span>\r\n-                                                  {isSelected && (\r\n-                                                    <span className={`badge ${isActiveTab ? 'bg-success text-white' : 'bg-success'}`} style={{ fontSize: '9px' }}>\r\n-                                                      <i className=\"bi bi-check-circle me-1\"></i>\r\n-                                                      Selected\r\n-                                                    </span>\r\n-                                                  )}\r\n-                                                </div>\r\n-                                              </div>\r\n-                                              <div className=\"text-end\">\r\n-                                                {subcategoryCount > 0 && (\r\n-                                                  <div className=\"mb-1\">\r\n-                                                    <span className={`badge ${isActiveTab ? 'bg-white text-primary' : 'bg-secondary'}`} style={{ fontSize: '10px' }}>\r\n-                                                      {subcategoryCount} subs\r\n-                                                    </span>\r\n-                                                  </div>\r\n-                                                )}\r\n-                                                {selectedSubcategoryCount > 0 && (\r\n-                                                  <div className=\"mb-1\">\r\n-                                                    <span className={`badge ${isActiveTab ? 'bg-success text-white' : 'bg-success'}`} style={{ fontSize: '10px' }}>\r\n-                                                      {selectedSubcategoryCount} selected\r\n-                                                    </span>\r\n-                                                  </div>\r\n-                                                )}\r\n-                                                <i className={`bi bi-chevron-right ${isActiveTab ? 'text-white' : 'text-muted'}`}></i>\r\n-                                              </div>\r\n+                                          <img\r\n+                                            src={category.image}\r\n+                                            alt={category.name}\r\n+                                            className=\"me-3 rounded\"\r\n+                                            style={{ width: '32px', height: '32px', objectFit: 'cover' }}\r\n+                                            onError={(e) => {\r\n+                                              e.target.src = '/assets/img/product/category/default-category.svg'\r\n+                                            }}\r\n+                                          />\r\n+                                          <div>\r\n+                                            <div className={`fw-semibold ${isActiveTab ? 'text-white' : ''}`}>\r\n+                                              {category.name}\r\n                                             </div>\r\n+                                            <small className={`${isActiveTab ? 'text-white-50' : 'text-muted'}`}>\r\n+                                              {subcategoryCount} subcategories\r\n+                                            </small>\r\n                                           </div>\r\n                                         </div>\r\n+                                        <div className=\"d-flex flex-column align-items-end\">\r\n+                                          {isSelected && (\r\n+                                            <span className={`badge ${isActiveTab ? 'bg-light text-primary' : 'bg-success'} mb-1`}>\r\n+                                              <i className=\"bi bi-check2 me-1\"></i>\r\n+                                              Selected\r\n+                                            </span>\r\n+                                          )}\r\n+                                          {subcategoryCount > 0 && (\r\n+                                            <span className={`badge ${isActiveTab ? 'bg-light text-primary' : 'bg-secondary'}`}>\r\n+                                              {selectedSubcategoryCount}/{subcategoryCount} subs\r\n+                                            </span>\r\n+                                          )}\r\n+                                        </div>\r\n                                       </div>\r\n                                     )\r\n                                   })}\r\n                                 </div>\r\n@@ -1382,37 +1359,39 @@\n                           <button \r\n                             type=\"button\" \r\n                             className=\"btn btn-outline-primary btn-sm\"\r\n                             onClick={() => {\r\n+                              console.log('🎯 Select All Main Categories clicked')\r\n                               const { mainCategoriesCount } = getCurrentCounts()\r\n                               const availableSlots = MAX_MAIN_CATEGORIES - mainCategoriesCount\r\n                               \r\n                               if (availableSlots <= 0) {\r\n                                 setError(`Cannot select more categories. Maximum ${MAX_MAIN_CATEGORIES} main categories allowed.`)\r\n                                 return\r\n                               }\r\n                               \r\n+                              // Get main categories that are not already selected\r\n+                              const mainCategoryIds = mainCategories.map(cat => cat.id)\r\n+                              const unselectedMainCategories = mainCategoryIds.filter(id => \r\n+                                !categoryConfig.categoryIds.includes(id)\r\n+                              )\r\n+                              \r\n+                              // Take only the number that fits within the limit\r\n+                              const categoriesToAdd = unselectedMainCategories.slice(0, availableSlots)\r\n+                              console.log('   - Categories to add:', categoriesToAdd)\r\n+                              \r\n                               setCategoryConfig(prev => {\r\n-                                const newConfig = { ...prev, categories: { ...prev.categories } }\r\n-                                let added = 0\r\n-                                \r\n-                                mainCategories.forEach(cat => {\r\n-                                  if (added < availableSlots && !newConfig.categories[cat.id]?.selected) {\r\n-                                    newConfig.categories[cat.id] = {\r\n-                                      selected: true,\r\n-                                      order: Object.keys(newConfig.categories).filter(id => newConfig.categories[id]?.selected).length,\r\n-                                      subcategories: newConfig.categories[cat.id]?.subcategories || {}\r\n-                                    }\r\n-                                    added++\r\n-                                  }\r\n-                                })\r\n-                                \r\n-                                if (added < mainCategories.length - mainCategoriesCount) {\r\n-                                  setError(`Only selected ${added} more categories due to limit.`)\r\n+                                const newCategoryIds = [...new Set([...prev.categoryIds, ...categoriesToAdd])]\r\n+                                console.log('   - Updated categoryIds:', newCategoryIds)\r\n+                                return {\r\n+                                  ...prev,\r\n+                                  categoryIds: newCategoryIds\r\n                                 }\r\n-                                \r\n-                                return newConfig\r\n                               })\r\n+                              \r\n+                              if (categoriesToAdd.length < unselectedMainCategories.length) {\r\n+                                setError(`Only selected ${categoriesToAdd.length} more categories due to limit.`)\r\n+                              }\r\n                             }}\r\n                           >\r\n                             <i className=\"bi bi-check-all me-1\"></i>\r\n                             Select All Main Categories\r\n@@ -1421,55 +1400,54 @@\n                           <button \r\n                             type=\"button\" \r\n                             className=\"btn btn-outline-success btn-sm\"\r\n                             onClick={() => {\r\n+                              console.log('🎯 Select All Subcategories clicked')\r\n                               if (!selectedMainCategory) {\r\n                                 setError('Please select a main category first to add subcategories.')\r\n                                 return\r\n                               }\r\n                               \r\n                               const subcategoriesForMain = getSubcategoriesForCategory(selectedMainCategory)\r\n                               const currentSubCount = subcategoriesForMain.filter(sub => \r\n-                                categoryConfig.categories[selectedMainCategory]?.subcategories?.[sub.id]?.selected\r\n+                                categoryConfig.categoryIds.includes(sub.id)\r\n                               ).length\r\n                               const availableSlots = MAX_SUBCATEGORIES_PER_CATEGORY - currentSubCount\r\n                               \r\n                               if (availableSlots <= 0) {\r\n                                 setError(`Cannot select more subcategories. Maximum ${MAX_SUBCATEGORIES_PER_CATEGORY} subcategories per main category allowed.`)\r\n                                 return\r\n                               }\r\n                               \r\n+                              // Get unselected subcategories for this main category\r\n+                              const unselectedSubcategories = subcategoriesForMain\r\n+                                .filter(sub => !categoryConfig.categoryIds.includes(sub.id))\r\n+                                .slice(0, availableSlots)\r\n+                                .map(sub => sub.id)\r\n+                              \r\n+                              console.log('   - Subcategories to add:', unselectedSubcategories)\r\n+                              \r\n                               setCategoryConfig(prev => {\r\n-                                const newConfig = { ...prev, categories: { ...prev.categories } }\r\n+                                let newCategoryIds = [...prev.categoryIds]\r\n                                 \r\n-                                // Ensure main category is selected and has structure\r\n-                                if (!newConfig.categories[selectedMainCategory]) {\r\n-                                  newConfig.categories[selectedMainCategory] = {\r\n-                                    selected: true,\r\n-                                    order: Object.keys(newConfig.categories).filter(id => newConfig.categories[id]?.selected).length,\r\n-                                    subcategories: {}\r\n-                                  }\r\n+                                // Ensure main category is selected\r\n+                                if (!newCategoryIds.includes(selectedMainCategory)) {\r\n+                                  newCategoryIds.push(selectedMainCategory)\r\n                                 }\r\n                                 \r\n-                                let added = 0\r\n-                                subcategoriesForMain.forEach(sub => {\r\n-                                  if (added < availableSlots && !newConfig.categories[selectedMainCategory].subcategories[sub.id]?.selected) {\r\n-                                    newConfig.categories[selectedMainCategory].subcategories[sub.id] = {\r\n-                                      selected: true,\r\n-                                      order: Object.keys(newConfig.categories[selectedMainCategory].subcategories).filter(id => \r\n-                                        newConfig.categories[selectedMainCategory].subcategories[id]?.selected\r\n-                                      ).length\r\n-                                    }\r\n-                                    added++\r\n-                                  }\r\n-                                })\r\n+                                // Add unselected subcategories\r\n+                                newCategoryIds = [...new Set([...newCategoryIds, ...unselectedSubcategories])]\r\n                                 \r\n-                                if (added < subcategoriesForMain.length - currentSubCount) {\r\n-                                  setError(`Only selected ${added} more subcategories due to limit.`)\r\n+                                console.log('   - Updated categoryIds:', newCategoryIds)\r\n+                                return {\r\n+                                  ...prev,\r\n+                                  categoryIds: newCategoryIds\r\n                                 }\r\n-                                \r\n-                                return newConfig\r\n                               })\r\n+                              \r\n+                              if (unselectedSubcategories.length < subcategoriesForMain.length - currentSubCount) {\r\n+                                setError(`Only selected ${unselectedSubcategories.length} more subcategories due to limit.`)\r\n+                              }\r\n                             }}\r\n                           >\r\n                             <i className=\"bi bi-tags me-1\"></i>\r\n                             Select All Subcategories\r\n@@ -1478,11 +1456,12 @@\n                           <button \r\n                             type=\"button\" \r\n                             className=\"btn btn-outline-secondary btn-sm\"\r\n                             onClick={() => {\r\n+                              console.log('🎯 Clear All Selections clicked')\r\n                               setCategoryConfig(prev => ({\r\n                                 ...prev,\r\n-                                categories: {}\r\n+                                categoryIds: []\r\n                               }))\r\n                               setSelectedMainCategory(null)\r\n                             }}\r\n                           >\r\n"
                },
                {
                    "date": 1753283808423,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1052,8 +1052,133 @@\n                       </div>\r\n                     </div>\r\n                   </div>\r\n \r\n+                  {/* Current Selections Display */}\r\n+                  <div className=\"row mb-4\">\r\n+                    <div className=\"col-12\">\r\n+                      <div className=\"card border-success\">\r\n+                        <div className=\"card-header bg-success bg-opacity-10\">\r\n+                          <h6 className=\"mb-0 text-success\">\r\n+                            <i className=\"bi bi-check-circle me-2\"></i>\r\n+                            Current Selections\r\n+                          </h6>\r\n+                        </div>\r\n+                        <div className=\"card-body\">\r\n+                          {categoryConfig.categoryIds.length > 0 ? (\r\n+                            <div className=\"row\">\r\n+                              {/* Selected Main Categories */}\r\n+                              <div className=\"col-md-6\">\r\n+                                <h6 className=\"text-primary mb-3\">\r\n+                                  <i className=\"bi bi-grid me-1\"></i>\r\n+                                  Selected Main Categories ({categoryConfig.categoryIds.filter(id => mainCategories.some(cat => cat.id === id)).length})\r\n+                                </h6>\r\n+                                <div className=\"d-flex flex-wrap gap-2 mb-3\">\r\n+                                  {categoryConfig.categoryIds\r\n+                                    .filter(id => mainCategories.some(cat => cat.id === id))\r\n+                                    .map(categoryId => {\r\n+                                      const category = mainCategories.find(cat => cat.id === categoryId)\r\n+                                      return category ? (\r\n+                                        <span \r\n+                                          key={categoryId} \r\n+                                          className=\"badge bg-primary d-flex align-items-center\"\r\n+                                          style={{ fontSize: '12px', padding: '6px 10px' }}\r\n+                                        >\r\n+                                          <img \r\n+                                            src={category.image} \r\n+                                            alt={category.name}\r\n+                                            className=\"me-2 rounded\"\r\n+                                            style={{ width: '16px', height: '16px', objectFit: 'cover' }}\r\n+                                            onError={(e) => {\r\n+                                              e.target.src = '/assets/img/product/category/default-category.svg'\r\n+                                            }}\r\n+                                          />\r\n+                                          {category.name}\r\n+                                          <button\r\n+                                            type=\"button\"\r\n+                                            className=\"btn-close btn-close-white ms-2\"\r\n+                                            style={{ fontSize: '8px' }}\r\n+                                            onClick={() => handleCategoryToggle(categoryId)}\r\n+                                            title=\"Remove category\"\r\n+                                          ></button>\r\n+                                        </span>\r\n+                                      ) : null\r\n+                                    })}\r\n+                                </div>\r\n+                                {categoryConfig.categoryIds.filter(id => mainCategories.some(cat => cat.id === id)).length === 0 && (\r\n+                                  <p className=\"text-muted mb-0\">\r\n+                                    <i className=\"bi bi-info-circle me-1\"></i>\r\n+                                    No main categories selected\r\n+                                  </p>\r\n+                                )}\r\n+                              </div>\r\n+\r\n+                              {/* Selected Subcategories */}\r\n+                              <div className=\"col-md-6\">\r\n+                                <h6 className=\"text-secondary mb-3\">\r\n+                                  <i className=\"bi bi-tags me-1\"></i>\r\n+                                  Selected Subcategories ({categoryConfig.categoryIds.filter(id => subCategories.some(cat => cat.id === id)).length})\r\n+                                </h6>\r\n+                                <div className=\"d-flex flex-wrap gap-2 mb-3\">\r\n+                                  {categoryConfig.categoryIds\r\n+                                    .filter(id => subCategories.some(cat => cat.id === id))\r\n+                                    .map(subcategoryId => {\r\n+                                      const subcategory = subCategories.find(cat => cat.id === subcategoryId)\r\n+                                      const parentCategory = subcategory ? mainCategories.find(cat => cat.id === (subcategory.parent?._id || subcategory.parent)) : null\r\n+                                      return subcategory ? (\r\n+                                        <span \r\n+                                          key={subcategoryId} \r\n+                                          className=\"badge bg-secondary d-flex align-items-center\"\r\n+                                          style={{ fontSize: '11px', padding: '5px 8px' }}\r\n+                                        >\r\n+                                          <img \r\n+                                            src={subcategory.image} \r\n+                                            alt={subcategory.name}\r\n+                                            className=\"me-2 rounded\"\r\n+                                            style={{ width: '14px', height: '14px', objectFit: 'cover' }}\r\n+                                            onError={(e) => {\r\n+                                              e.target.src = '/assets/img/product/category/default-subcategory.svg'\r\n+                                            }}\r\n+                                          />\r\n+                                          <div className=\"d-flex flex-column align-items-start\">\r\n+                                            <span>{subcategory.name}</span>\r\n+                                            {parentCategory && (\r\n+                                              <small className=\"text-light opacity-75\" style={{ fontSize: '9px' }}>\r\n+                                                under {parentCategory.name}\r\n+                                              </small>\r\n+                                            )}\r\n+                                          </div>\r\n+                                          <button\r\n+                                            type=\"button\"\r\n+                                            className=\"btn-close btn-close-white ms-2\"\r\n+                                            style={{ fontSize: '7px' }}\r\n+                                            onClick={() => handleCategoryToggle(subcategoryId, subcategory.parent?._id || subcategory.parent)}\r\n+                                            title=\"Remove subcategory\"\r\n+                                          ></button>\r\n+                                        </span>\r\n+                                      ) : null\r\n+                                    })}\r\n+                                </div>\r\n+                                {categoryConfig.categoryIds.filter(id => subCategories.some(cat => cat.id === id)).length === 0 && (\r\n+                                  <p className=\"text-muted mb-0\">\r\n+                                    <i className=\"bi bi-info-circle me-1\"></i>\r\n+                                    No subcategories selected\r\n+                                  </p>\r\n+                                )}\r\n+                              </div>\r\n+                            </div>\r\n+                          ) : (\r\n+                            <div className=\"text-center py-4\">\r\n+                              <i className=\"bi bi-inbox text-muted\" style={{ fontSize: '2rem' }}></i>\r\n+                              <p className=\"text-muted mt-2 mb-0\">No categories selected yet</p>\r\n+                              <small className=\"text-muted\">Select categories from the interface below to see them here</small>\r\n+                            </div>\r\n+                          )}\r\n+                        </div>\r\n+                      </div>\r\n+                    </div>\r\n+                  </div>\r\n+\r\n                   {/* Selection Summary */}\r\n                   <div className=\"row mb-4\">\r\n                     <div className=\"col-12\">\r\n                       <div className=\"alert alert-info d-flex align-items-center\">\r\n"
                },
                {
                    "date": 1753284832356,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,1895 @@\n+'use client'\r\n+import React, { useState, useEffect } from 'react'\r\n+import { get, post, put } from '@/util/apiService'\r\n+import { CATEGORY, SUBCATEGORY } from '@/util/apiEndpoints'\r\n+\r\n+const PAGES = [\r\n+  { \r\n+    key: \"home\", \r\n+    label: \"Home Page\",\r\n+    description: \"Manage sections displayed on the homepage\"\r\n+  },\r\n+  { \r\n+    key: \"corporate\", \r\n+    label: \"Corporate Page\",\r\n+    description: \"Manage sections for corporate customers\"\r\n+  }\r\n+]\r\n+\r\n+export default function PagesManagement({ onNavigate }) {\r\n+  const [selectedPage, setSelectedPage] = useState(\"home\")\r\n+  const [loading, setLoading] = useState(false)\r\n+  const [error, setError] = useState('')\r\n+  const [success, setSuccess] = useState('')\r\n+  const [showCategoryConfig, setShowCategoryConfig] = useState(false)\r\n+  const [availableCategories, setAvailableCategories] = useState([])\r\n+  const [subcategories, setSubcategories] = useState([])\r\n+  const [pageConfig, setPageConfig] = useState(null)\r\n+\r\n+  // Category section configuration state - NEW HIERARCHICAL STRUCTURE\r\n+  const [categoryConfig, setCategoryConfig] = useState({\r\n+  enabled: true,\r\n+  maxCategories: 10,\r\n+  layout: 'grid',\r\n+  showSubcategories: true,\r\n+  // New hierarchical structure\r\n+  categories: [],\r\n+  // FIXED: Always initialize as empty array, not undefined\r\n+  categoryIds: []\r\n+})\r\n+\r\n+// ...existing code around line 1612...\r\n+\r\n+// FIX: Add null safety check for categoryIds\r\n+\r\n+  // Business rule constants\r\n+  const MAX_MAIN_CATEGORIES = 10\r\n+  const MIN_MAIN_CATEGORIES = 1\r\n+  const MAX_SUBCATEGORIES_PER_CATEGORY = 10\r\n+\r\n+  // UI state for category selection\r\n+  const [selectedMainCategory, setSelectedMainCategory] = useState(null)\r\n+\r\n+  // Define sections for each page\r\n+  const homeSections = [\r\n+    { \r\n+      key: \"giftCategories\", \r\n+      label: \"Gift Categories\", \r\n+      description: \"Display category grid with gifts\",\r\n+      order: 1,\r\n+      hasConfig: true\r\n+    },\r\n+    { \r\n+      key: \"slider\", \r\n+      label: \"Main Slider\", \r\n+      description: \"Hero banner with promotional slides\",\r\n+      order: 2\r\n+    },\r\n+    { \r\n+      key: \"services\", \r\n+      label: \"Services Section\", \r\n+      description: \"Highlight key services and benefits\",\r\n+      order: 3\r\n+    },\r\n+    { \r\n+      key: \"products\", \r\n+      label: \"Featured Products\", \r\n+      description: \"Showcase featured/trending products\",\r\n+      order: 4\r\n+    },\r\n+    { \r\n+      key: \"banner\", \r\n+      label: \"Promotional Banner\", \r\n+      description: \"Secondary promotional content\",\r\n+      order: 5\r\n+    },\r\n+    { \r\n+      key: \"dealProduct\", \r\n+      label: \"Deal Products\", \r\n+      description: \"Special offers and discounted items\",\r\n+      order: 6\r\n+    }\r\n+  ]\r\n+\r\n+  const corporateSections = [\r\n+    { \r\n+      key: \"corporateBanner\", \r\n+      label: \"Corporate Banner\", \r\n+      description: \"Hero section for corporate clients\",\r\n+      order: 1\r\n+    },\r\n+    { \r\n+      key: \"corporateServices\", \r\n+      label: \"Corporate Services\", \r\n+      description: \"B2B services and solutions\",\r\n+      order: 2\r\n+    },\r\n+    { \r\n+      key: \"corporateTestimonials\", \r\n+      label: \"Client Testimonials\", \r\n+      description: \"Corporate client reviews and case studies\",\r\n+      order: 3\r\n+    },\r\n+    { \r\n+      key: \"corporatePartners\", \r\n+      label: \"Partner Logos\", \r\n+      description: \"Display trusted corporate partners\",\r\n+      order: 4\r\n+    }\r\n+  ]\r\n+\r\n+  // Section visibility state\r\n+  const [visibleSections, setVisibleSections] = useState({\r\n+    home: {\r\n+      giftCategories: true,\r\n+      slider: true,\r\n+      services: true,\r\n+      products: true,\r\n+      banner: true,\r\n+      dealProduct: true,\r\n+    },\r\n+    corporate: {\r\n+      corporateBanner: true,\r\n+      corporateServices: true,\r\n+      corporateTestimonials: false,\r\n+      corporatePartners: false,\r\n+    },\r\n+  })\r\n+\r\n+  // Hardcoded admin token for testing\r\n+  const ADMIN_TOKEN = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY4NzZhYTJmYzc3YWY4ODU3Njk1ZDA5MiIsInJvbGUiOiJhZG1pbiIsImlhdCI6MTc1MzI4MTMyMCwiZXhwIjoxNzUzODg2MTIwfQ.3wEx7ZCDvYtUQppFM9CcXjhG1zTQX9_RYY_dy3Y6MZs'\r\n+\r\n+  // ========== HIERARCHICAL DATA MANAGEMENT HELPERS ==========\r\n+  \r\n+  // Get current counts for validation\r\n+  // ...existing code around line 130...\r\n+\r\n+// Get current counts for validation\r\n+const getCurrentCounts = () => {\r\n+  // FIXED: Add safety checks for undefined categoryIds\r\n+  const safeCategories = categoryConfig.categories || []\r\n+  const safeCategoryIds = categoryConfig.categoryIds || []\r\n+  \r\n+  // Handle both old array structure and new object structure\r\n+  let mainCategoriesCount = 0\r\n+  let totalSubcategoriesCount = 0\r\n+  let selectedCategorySubCount = 0\r\n+  const subcategoryCounts = {}\r\n+  \r\n+  if (Array.isArray(safeCategories) && safeCategories.length > 0) {\r\n+    // Old structure: array of category objects\r\n+    mainCategoriesCount = safeCategories.filter(cat => cat.enabled).length\r\n+    \r\n+    safeCategories.forEach(category => {\r\n+      const subCount = category.subcategories ? category.subcategories.filter(sub => sub.enabled).length : 0\r\n+      subcategoryCounts[category.categoryId] = subCount\r\n+      totalSubcategoriesCount += subCount\r\n+      \r\n+      // Get subcategory count for currently selected main category\r\n+      if (selectedMainCategory && category.categoryId === selectedMainCategory) {\r\n+        selectedCategorySubCount = subCount\r\n+      }\r\n+    })\r\n+  } else {\r\n+    // Fallback: use categoryIds for backward compatibility\r\n+    if (availableCategories.length > 0 && safeCategoryIds.length > 0) {\r\n+      mainCategoriesCount = safeCategoryIds.filter(id => \r\n+        availableCategories.some(cat => cat.id === id && !cat.parent)\r\n+      ).length\r\n+      \r\n+      totalSubcategoriesCount = safeCategoryIds.filter(id => \r\n+        subcategories.some(sub => sub.id === id)\r\n+      ).length\r\n+        \r\n+      selectedCategorySubCount = selectedMainCategory && safeCategoryIds ? \r\n+        safeCategoryIds.filter(id => \r\n+          subcategories.some(sub => sub.id === id && \r\n+            (sub.parent?._id === selectedMainCategory || sub.parent === selectedMainCategory)\r\n+          )\r\n+        ).length : 0\r\n+    }\r\n+  }\r\n+  \r\n+  return { \r\n+    mainCategoriesCount, \r\n+    subcategoryCounts, \r\n+    totalSubcategoriesCount,\r\n+    selectedCategorySubCount \r\n+  }\r\n+}\r\n+\r\n+  // Check if we can select more main categories\r\n+  const canSelectMoreMainCategories = () => {\r\n+    const { mainCategoriesCount } = getCurrentCounts()\r\n+    return mainCategoriesCount < MAX_MAIN_CATEGORIES\r\n+  }\r\n+\r\n+  // Check if we can select more subcategories for a specific category\r\n+  const canSelectMoreSubcategories = (categoryId) => {\r\n+    const { subcategoryCounts } = getCurrentCounts()\r\n+    const currentCount = subcategoryCounts[categoryId] || 0\r\n+    return currentCount < MAX_SUBCATEGORIES_PER_CATEGORY\r\n+  }\r\n+\r\n+  // Check if a main category is selected\r\n+  // ...existing code around line 190...\r\n+\r\n+// Check if a main category is selected\r\n+const isMainCategorySelected = (categoryId) => {\r\n+  // FIXED: Add safety check for undefined categoryIds\r\n+  const safeCategoryIds = categoryConfig.categoryIds || []\r\n+  \r\n+  if (Array.isArray(categoryConfig.categories)) {\r\n+    // Old structure\r\n+    const category = categoryConfig.categories.find(cat => cat.categoryId === categoryId)\r\n+    return category ? category.enabled : false\r\n+  } else if (typeof categoryConfig.categories === 'object') {\r\n+    // New structure\r\n+    return categoryConfig.categories[categoryId]?.selected || false\r\n+  } else {\r\n+    // Fallback\r\n+    return safeCategoryIds.includes(categoryId)\r\n+  }\r\n+}\r\n+\r\n+// Check if a subcategory is selected\r\n+const isSubcategorySelected = (subcategoryId, parentCategoryId = null) => {\r\n+  // FIXED: Add safety check for undefined categoryIds\r\n+  const safeCategoryIds = categoryConfig.categoryIds || []\r\n+  \r\n+  if (Array.isArray(categoryConfig.categories)) {\r\n+    // Old structure\r\n+    return categoryConfig.categories.some(category => \r\n+      category.subcategories && category.subcategories.some(sub => sub.categoryId === subcategoryId && sub.enabled)\r\n+    )\r\n+  } else if (typeof categoryConfig.categories === 'object' && parentCategoryId) {\r\n+    // New structure\r\n+    return categoryConfig.categories[parentCategoryId]?.subcategories?.[subcategoryId]?.selected || false\r\n+  } else {\r\n+    // Fallback\r\n+    return safeCategoryIds.includes(subcategoryId)\r\n+  }\r\n+}\r\n+\r\n+  // Find which main category a subcategory belongs to\r\n+  const findParentCategory = (subcategoryId) => {\r\n+    const subcategory = subcategories.find(sub => sub.id === subcategoryId)\r\n+    return subcategory?.parent?._id || subcategory?.parent\r\n+  }\r\n+\r\n+  // Update hierarchical category selection\r\n+  // Function removed - using simpler handleCategoryToggle approach\r\n+\r\n+  // Transform hierarchical data for backend save - FIXED to only use selected categories\r\n+  const transformForSave = () => {\r\n+    console.log('🔄 === TRANSFORM FOR SAVE START ===')\r\n+    console.log('1. Input categoryConfig:', categoryConfig)\r\n+    console.log('   - categoryConfig.categoryIds (SELECTED):', categoryConfig.categoryIds)\r\n+    \r\n+    const saveData = {\r\n+      enabled: categoryConfig.enabled,\r\n+      maxCategories: categoryConfig.maxCategories,\r\n+      layout: categoryConfig.layout,\r\n+      showSubcategories: categoryConfig.showSubcategories,\r\n+      categories: []\r\n+    }\r\n+    \r\n+    console.log('2. Base saveData structure:', saveData)\r\n+    \r\n+    // 🎯 ONLY process the categoryIds that are actually selected by the user\r\n+    console.log('3. Processing ONLY selected categoryIds...')\r\n+    console.log('   - Selected categoryIds:', categoryConfig.categoryIds)\r\n+    console.log('   - Total selected:', categoryConfig.categoryIds.length)\r\n+    \r\n+    if (categoryConfig.categoryIds && categoryConfig.categoryIds.length > 0) {\r\n+      categoryConfig.categoryIds.forEach((categoryId, index) => {\r\n+        console.log(`   - Processing selected categoryId ${index + 1}:`, categoryId)\r\n+        \r\n+        // Check if it's a main category\r\n+        const mainCategory = availableCategories.find(cat => cat.id === categoryId && !cat.parent)\r\n+        if (mainCategory) {\r\n+          console.log(`     ✅ Found main category:`, mainCategory.name)\r\n+          saveData.categories.push({\r\n+            categoryId: categoryId,\r\n+            enabled: true,\r\n+            order: index\r\n+          })\r\n+        }\r\n+        \r\n+        // Check if it's a subcategory\r\n+        const subcategory = subcategories.find(sub => sub.id === categoryId)\r\n+        if (subcategory) {\r\n+          const parentId = subcategory.parent?._id || subcategory.parent\r\n+          console.log(`     ✅ Found subcategory:`, subcategory.name, 'parent:', parentId)\r\n+          saveData.categories.push({\r\n+            categoryId: categoryId,\r\n+            enabled: true,\r\n+            order: index\r\n+          })\r\n+        }\r\n+        \r\n+        if (!mainCategory && !subcategory) {\r\n+          console.log(`     ❌ Category ID not found:`, categoryId)\r\n+        }\r\n+      })\r\n+    } else {\r\n+      console.log('   - No categories selected')\r\n+    }\r\n+    \r\n+    console.log('4. Final saveData categories:', saveData.categories)\r\n+    console.log('🔚 === TRANSFORM FOR SAVE END ===')\r\n+    \r\n+    return saveData\r\n+  }\r\n+\r\n+  // Load page configuration\r\n+  // ...existing code around line 380...\r\n+\r\n+// Load page configuration\r\n+const loadPageConfig = async (pageKey) => {\r\n+  try {\r\n+    setLoading(true)\r\n+    localStorage.setItem('authToken', ADMIN_TOKEN)\r\n+    \r\n+    const response = await get(`/pages/${pageKey}`)\r\n+    console.log('Page config response:', response)\r\n+    \r\n+    // Handle the double-wrapped response from apiService\r\n+    const actualData = response.data // This contains the backend response\r\n+    \r\n+    if (actualData && actualData.success) {\r\n+      setPageConfig(actualData.data)\r\n+      \r\n+      // Extract category section config\r\n+      const categorySection = actualData.data.sections.find(s => s.sectionType === 'categorySection')\r\n+      if (categorySection && categorySection.config) {\r\n+        // FIXED: Properly extract categoryIds and convert to flat structure\r\n+        const savedCategories = categorySection.config.categories || []\r\n+        const categoryIds = savedCategories.map(cat => cat.categoryId).filter(Boolean)\r\n+        \r\n+        setCategoryConfig({\r\n+          enabled: categorySection.enabled || false,\r\n+          maxCategories: categorySection.config.maxCategories || 10,\r\n+          layout: categorySection.config.layout || 'grid',\r\n+          showSubcategories: categorySection.config.showSubcategories || true,\r\n+          categories: savedCategories, // Keep the hierarchical structure\r\n+          categoryIds: categoryIds || [] // FIXED: Ensure this is always an array\r\n+        })\r\n+        \r\n+        console.log('📂 Loaded category config with categoryIds:', categoryIds)\r\n+        \r\n+        // Update visibility state\r\n+        setVisibleSections(prev => ({\r\n+          ...prev,\r\n+          [pageKey]: {\r\n+            ...prev[pageKey],\r\n+            giftCategories: categorySection.enabled\r\n+          }\r\n+        }))\r\n+      } else {\r\n+        // FIXED: Initialize with empty arrays when no config exists\r\n+        setCategoryConfig({\r\n+          enabled: false,\r\n+          maxCategories: 10,\r\n+          layout: 'grid',\r\n+          showSubcategories: true,\r\n+          categories: [],\r\n+          categoryIds: [] // FIXED: Ensure this is always an array\r\n+        })\r\n+      }\r\n+    }\r\n+    \r\n+    setError('')\r\n+  } catch (err) {\r\n+    console.error('Load page config error:', err)\r\n+    setError('Failed to load page configuration: ' + err.message)\r\n+    \r\n+    // FIXED: Set default config on error to prevent undefined\r\n+    setCategoryConfig({\r\n+      enabled: false,\r\n+      maxCategories: 10,\r\n+      layout: 'grid',\r\n+      showSubcategories: true,\r\n+      categories: [],\r\n+      categoryIds: [] // FIXED: Ensure this is always an array\r\n+    })\r\n+  } finally {\r\n+    setLoading(false)\r\n+  }\r\n+}\r\n+\r\n+  // Load available categories (same approach as CategoriesPage.js)\r\n+  const loadCategories = async () => {\r\n+    try {\r\n+      console.log('🔄 === LOADING CATEGORIES DEBUG ===')\r\n+      console.log('1. Setting auth token...')\r\n+      localStorage.setItem('authToken', ADMIN_TOKEN)\r\n+      \r\n+      console.log('2. Making API call to:', CATEGORY.GET_ALL)\r\n+      const response = await get(CATEGORY.GET_ALL)\r\n+      \r\n+      console.log('3. Raw API response received:')\r\n+      console.log('   - Response object:', response)\r\n+      console.log('   - Response type:', typeof response)\r\n+      console.log('   - Response keys:', Object.keys(response || {}))\r\n+      console.log('   - Response.success:', response?.success)\r\n+      console.log('   - Response.data:', response?.data)\r\n+      console.log('   - Response.data type:', typeof response?.data)\r\n+      console.log('   - Response.data is array:', Array.isArray(response?.data))\r\n+      \r\n+      if (!response.success) {\r\n+        console.error('4. ❌ API response failed:', response.error)\r\n+        throw new Error(response.error || 'Failed to fetch categories')\r\n+      }\r\n+      \r\n+      console.log('4. ✅ API response successful')\r\n+      console.log('5. Processing response.data...')\r\n+      console.log('   - Raw response.data:', JSON.stringify(response.data, null, 2))\r\n+      \r\n+      // Ensure response.data is an array\r\n+      let categoriesData = []\r\n+      if (Array.isArray(response.data)) {\r\n+        console.log('   - Response.data is direct array with', response.data.length, 'items')\r\n+        categoriesData = response.data\r\n+      } else if (response.data && typeof response.data === 'object') {\r\n+        console.log('   - Response.data is object, checking for nested arrays...')\r\n+        if (Array.isArray(response.data.categories)) {\r\n+          console.log('   - Found response.data.categories array with', response.data.categories.length, 'items')\r\n+          categoriesData = response.data.categories\r\n+        } else if (Array.isArray(response.data.data)) {\r\n+          console.log('   - Found response.data.data array with', response.data.data.length, 'items')\r\n+          categoriesData = response.data.data\r\n+        } else {\r\n+          console.log('   - No recognizable array found in response.data')\r\n+          categoriesData = []\r\n+        }\r\n+      }\r\n+      \r\n+      console.log('6. Categories data to process:')\r\n+      console.log('   - Array length:', categoriesData.length)\r\n+      console.log('   - Sample items (first 3):')\r\n+      categoriesData.slice(0, 3).forEach((cat, index) => {\r\n+        console.log(`     ${index + 1}.`, cat)\r\n+      })\r\n+      \r\n+      // Transform categories for display in the admin panel\r\n+      console.log('7. Transforming categories...')\r\n+      const transformedCategories = categoriesData.map((cat, index) => {\r\n+        console.log(`   - Transforming category ${index + 1}:`, {\r\n+          originalId: cat._id,\r\n+          originalName: cat.name,\r\n+          hasParent: !!cat.parent,\r\n+          parentInfo: cat.parent\r\n+        })\r\n+        \r\n+        return {\r\n+          id: cat.id || cat._id,\r\n+          value: cat.id || cat._id,\r\n+          label: cat.name,\r\n+          name: cat.name,\r\n+          image: cat.image?.url || '/assets/img/product/category/default-category.svg',\r\n+          description: cat.description || '',\r\n+          parent: cat.parent\r\n+        }\r\n+      })\r\n+      \r\n+      console.log('8. Final transformed categories:')\r\n+      console.log('   - Total transformed:', transformedCategories.length)\r\n+      console.log('   - Main categories:', transformedCategories.filter(cat => !cat.parent).length)\r\n+      console.log('   - Sub categories:', transformedCategories.filter(cat => cat.parent).length)\r\n+      console.log('   - Full transformed data:', transformedCategories)\r\n+      \r\n+      console.log('9. Setting availableCategories state...')\r\n+      setAvailableCategories(transformedCategories)\r\n+      setError('')\r\n+      \r\n+      console.log('10. ✅ Categories loaded successfully!')\r\n+      console.log('🔚 === END LOADING CATEGORIES DEBUG ===')\r\n+      \r\n+    } catch (err) {\r\n+      console.error('❌ === LOAD CATEGORIES ERROR ===')\r\n+      console.error('Error details:', {\r\n+        message: err.message,\r\n+        stack: err.stack,\r\n+        name: err.name\r\n+      })\r\n+      console.error('Raw error object:', err)\r\n+      setError('Failed to load categories: ' + err.message)\r\n+      setAvailableCategories([])\r\n+    }\r\n+  }\r\n+\r\n+  // Load subcategories from separate subcategories collection\r\n+  const loadSubcategories = async () => {\r\n+    try {\r\n+      console.log('🔄 === LOADING SUBCATEGORIES DEBUG ===')\r\n+      console.log('1. Setting auth token...')\r\n+      localStorage.setItem('authToken', ADMIN_TOKEN)\r\n+      \r\n+      console.log('2. Making API call to:', SUBCATEGORY.GET_ALL)\r\n+      const response = await get(SUBCATEGORY.GET_ALL)\r\n+      \r\n+      console.log('3. Raw subcategories response:')\r\n+      console.log('   - Response object:', response)\r\n+      console.log('   - Response.success:', response?.success)\r\n+      console.log('   - Response.data:', response?.data)\r\n+      console.log('   - Response.data is array:', Array.isArray(response?.data))\r\n+      \r\n+      if (!response.success) {\r\n+        console.error('4. ❌ Subcategories API response failed:', response.error)\r\n+        throw new Error(response.error || 'Failed to fetch subcategories')\r\n+      }\r\n+      \r\n+      console.log('4. ✅ Subcategories API response successful')\r\n+      console.log('5. Processing subcategories data...')\r\n+      \r\n+      let subcategoriesData = []\r\n+      if (Array.isArray(response.data)) {\r\n+        subcategoriesData = response.data\r\n+      } else if (response.data && Array.isArray(response.data.data)) {\r\n+        subcategoriesData = response.data.data\r\n+      }\r\n+      \r\n+      console.log('6. Subcategories data to process:')\r\n+      console.log('   - Array length:', subcategoriesData.length)\r\n+      console.log('   - Sample items (first 3):')\r\n+      subcategoriesData.slice(0, 3).forEach((subcat, index) => {\r\n+        console.log(`     ${index + 1}.`, {\r\n+          id: subcat._id,\r\n+          name: subcat.name,\r\n+          parent: subcat.parent,\r\n+          status: subcat.status\r\n+        })\r\n+      })\r\n+      \r\n+      // Transform subcategories for display\r\n+      const transformedSubcategories = subcategoriesData.map((subcat, index) => {\r\n+        console.log(`   - Transforming subcategory ${index + 1}:`, {\r\n+          originalId: subcat._id,\r\n+          originalName: subcat.name,\r\n+          parentId: subcat.parent?._id || subcat.parent,\r\n+          parentName: subcat.parent?.name\r\n+        })\r\n+        \r\n+        return {\r\n+          id: subcat.id || subcat._id,\r\n+          value: subcat.id || subcat._id,\r\n+          label: subcat.name,\r\n+          name: subcat.name,\r\n+          image: subcat.image?.url || '/assets/img/product/category/default-subcategory.svg',\r\n+          description: subcat.description || '',\r\n+          parent: subcat.parent,\r\n+          status: subcat.status\r\n+        }\r\n+      })\r\n+      \r\n+      console.log('7. Final transformed subcategories:')\r\n+      console.log('   - Total transformed:', transformedSubcategories.length)\r\n+      console.log('   - Full transformed data:', transformedSubcategories)\r\n+      \r\n+      console.log('8. Setting subcategories state...')\r\n+      setSubcategories(transformedSubcategories)\r\n+      \r\n+      console.log('9. ✅ Subcategories loaded successfully!')\r\n+      console.log('🔚 === END LOADING SUBCATEGORIES DEBUG ===')\r\n+      \r\n+    } catch (err) {\r\n+      console.error('❌ === LOAD SUBCATEGORIES ERROR ===')\r\n+      console.error('Error details:', {\r\n+        message: err.message,\r\n+        stack: err.stack,\r\n+        name: err.name\r\n+      })\r\n+      setSubcategories([])\r\n+    }\r\n+  }\r\n+\r\n+  // Save category section configuration\r\n+  const saveCategoryConfig = async () => {\r\n+    console.log('🚀 === SAVE CATEGORY CONFIG START ===')\r\n+    console.log('1. Save function triggered')\r\n+    \r\n+    try {\r\n+      console.log('2. Setting loading state to true')\r\n+      setLoading(true)\r\n+      \r\n+      console.log('3. Setting auth token in localStorage')\r\n+      localStorage.setItem('authToken', ADMIN_TOKEN)\r\n+      console.log('   - Auth token set:', ADMIN_TOKEN.substring(0, 20) + '...')\r\n+      \r\n+      console.log('4. Getting current counts for validation')\r\n+      const { mainCategoriesCount } = getCurrentCounts()\r\n+      console.log('   - Main categories count:', mainCategoriesCount)\r\n+      console.log('   - MIN_MAIN_CATEGORIES:', MIN_MAIN_CATEGORIES)\r\n+      console.log('   - MAX_MAIN_CATEGORIES:', MAX_MAIN_CATEGORIES)\r\n+      \r\n+      if (mainCategoriesCount < MIN_MAIN_CATEGORIES) {\r\n+        console.log('❌ Validation failed: Too few main categories')\r\n+        setError(`Please select at least ${MIN_MAIN_CATEGORIES} main category before saving.`)\r\n+        return\r\n+      }\r\n+      \r\n+      if (mainCategoriesCount > MAX_MAIN_CATEGORIES) {\r\n+        console.log('❌ Validation failed: Too many main categories')\r\n+        setError(`Too many main categories selected. Maximum ${MAX_MAIN_CATEGORIES} allowed.`)\r\n+        return\r\n+      }\r\n+      \r\n+      console.log('✅ Validation passed')\r\n+      \r\n+      console.log('5. Current categoryConfig state before transform:')\r\n+      console.log('   - categoryConfig.enabled:', categoryConfig.enabled)\r\n+      console.log('   - categoryConfig.maxCategories:', categoryConfig.maxCategories)\r\n+      console.log('   - categoryConfig.layout:', categoryConfig.layout)\r\n+      console.log('   - categoryConfig.showSubcategories:', categoryConfig.showSubcategories)\r\n+      console.log('   - categoryConfig.categories:', categoryConfig.categories)\r\n+      console.log('   - categoryConfig.categoryIds:', categoryConfig.categoryIds)\r\n+      \r\n+      // Transform hierarchical data for save\r\n+      console.log('6. Transforming data for save...')\r\n+      const configData = transformForSave()\r\n+      console.log('7. Transformed config data:')\r\n+      console.log('   - Full configData object:', JSON.stringify(configData, null, 2))\r\n+      console.log('   - configData.enabled:', configData.enabled)\r\n+      console.log('   - configData.categories length:', configData.categories?.length || 0)\r\n+      \r\n+      console.log('8. Preparing API request')\r\n+      const apiEndpoint = '/pages/home/sections/category'\r\n+      console.log('   - API endpoint:', apiEndpoint)\r\n+      console.log('   - Request method: PUT')\r\n+      console.log('   - Request data:', configData)\r\n+      console.log('   - Request headers will include auth token')\r\n+      \r\n+      console.log('9. Making API request...')\r\n+      const response = await put(apiEndpoint, configData)\r\n+      console.log('10. API response received:')\r\n+      console.log('    - Raw response:', response)\r\n+      console.log('    - Response type:', typeof response)\r\n+      console.log('    - Response keys:', Object.keys(response || {}))\r\n+      console.log('    - Response.data:', response?.data)\r\n+      console.log('    - Response.status:', response?.status)\r\n+      console.log('    - Response.success:', response?.success)\r\n+      \r\n+      // Handle the double-wrapped response from apiService\r\n+      console.log('11. Processing response data...')\r\n+      const actualData = response.data // This contains the backend response\r\n+      console.log('    - actualData:', actualData)\r\n+      console.log('    - actualData type:', typeof actualData)\r\n+      console.log('    - actualData.success:', actualData?.success)\r\n+      console.log('    - actualData.message:', actualData?.message)\r\n+      \r\n+      if (actualData && actualData.success) {\r\n+        console.log('✅ Save successful!')\r\n+        setSuccess('Category section configuration saved successfully!')\r\n+        setTimeout(() => setSuccess(''), 3000)\r\n+        setShowCategoryConfig(false)\r\n+        \r\n+        // Trigger refresh notification (optional)\r\n+        try {\r\n+          console.log('12. Triggering homepage refresh...')\r\n+          await get('/api/pages/home/refresh/categorySection')\r\n+          console.log('    - Homepage refresh successful')\r\n+        } catch (refreshError) {\r\n+          console.log('⚠️ Refresh notification failed, but save was successful:', refreshError)\r\n+        }\r\n+        \r\n+        // 🎯 REMOVED: Don't reload page config as it overwrites user selections\r\n+        // The loadPageConfig call was causing the categoryIds to be overwritten with old database values\r\n+        // console.log('13. Reloading page config...')\r\n+        // await loadPageConfig(selectedPage) // 🚨 THIS WAS CAUSING THE PROBLEM!\r\n+        // console.log('14. Page config reloaded')\r\n+        \r\n+        console.log('13. Save completed successfully - user selections preserved')\r\n+      } else {\r\n+        console.log('❌ Save failed - API returned unsuccessful response')\r\n+        console.log('    - actualData:', actualData)\r\n+        const errorMessage = actualData?.message || 'Unknown error'\r\n+        console.log('    - Error message:', errorMessage)\r\n+        setError('Failed to save configuration: ' + errorMessage)\r\n+      }\r\n+      \r\n+    } catch (err) {\r\n+      console.error('❌ === SAVE CATEGORY CONFIG ERROR ===')\r\n+      console.error('Error caught in try-catch:')\r\n+      console.error('   - Error object:', err)\r\n+      console.error('   - Error message:', err.message)\r\n+      console.error('   - Error name:', err.name)\r\n+      console.error('   - Error stack:', err.stack)\r\n+      \r\n+      if (err.response) {\r\n+        console.error('   - HTTP Response Error Details:')\r\n+        console.error('     - Status:', err.response.status)\r\n+        console.error('     - Status text:', err.response.statusText)\r\n+        console.error('     - Response data:', err.response.data)\r\n+        console.error('     - Response headers:', err.response.headers)\r\n+      }\r\n+      \r\n+      if (err.request) {\r\n+        console.error('   - Request Error Details:')\r\n+        console.error('     - Request object:', err.request)\r\n+      }\r\n+      \r\n+      setError('Failed to save category configuration: ' + err.message)\r\n+    } finally {\r\n+      console.log('15. Setting loading state to false')\r\n+      setLoading(false)\r\n+      console.log('🔚 === SAVE CATEGORY CONFIG END ===')\r\n+    }\r\n+  }\r\n+\r\n+  // Toggle section visibility\r\n+  const handleToggleSection = async (page, section) => {\r\n+    if (section === 'giftCategories') {\r\n+      // For category section, update the actual config\r\n+      setCategoryConfig(prev => ({ ...prev, enabled: !prev.enabled }))\r\n+      return\r\n+    }\r\n+    \r\n+    const newVisibility = {\r\n+      ...visibleSections,\r\n+      [page]: {\r\n+        ...visibleSections[page],\r\n+        [section]: !visibleSections[page][section],\r\n+      }\r\n+    }\r\n+    \r\n+    setVisibleSections(newVisibility)\r\n+  }\r\n+\r\n+  // Open category configuration modal\r\n+  const openCategoryConfig = () => {\r\n+    setShowCategoryConfig(true)\r\n+    // Reset to first main category when opening modal\r\n+    const mainCategories = availableCategories.filter(cat => !cat.parent)\r\n+    if (mainCategories.length > 0) {\r\n+      setSelectedMainCategory(mainCategories[0].id)\r\n+    }\r\n+  }\r\n+\r\n+  // Handle category selection with validation - SIMPLIFIED for current structure\r\n+  const handleCategoryToggle = (categoryId, parentCategoryId = null) => {\r\n+    const isMainCategory = !parentCategoryId && availableCategories.some(cat => cat.id === categoryId && !cat.parent)\r\n+    \r\n+    console.log('🎯 Category toggle triggered:', { categoryId, parentCategoryId, isMainCategory })\r\n+    \r\n+    if (isMainCategory) {\r\n+      const isCurrentlySelected = categoryConfig.categoryIds.includes(categoryId)\r\n+      const currentMainCount = categoryConfig.categoryIds.filter(id => \r\n+        availableCategories.some(cat => cat.id === id && !cat.parent)\r\n+      ).length\r\n+      \r\n+      console.log('📊 Main category status:', { isCurrentlySelected, currentCount: currentMainCount })\r\n+      \r\n+      // Validation for main categories\r\n+      if (!isCurrentlySelected) {\r\n+        // Trying to select\r\n+        if (currentMainCount >= MAX_MAIN_CATEGORIES) {\r\n+          setError(`Cannot select more main categories. Maximum ${MAX_MAIN_CATEGORIES} allowed.`)\r\n+          return\r\n+        }\r\n+      } else {\r\n+        // Trying to deselect\r\n+        if (currentMainCount <= MIN_MAIN_CATEGORIES) {\r\n+          setError(`Cannot deselect this category. At least ${MIN_MAIN_CATEGORIES} main category must be selected.`)\r\n+          return\r\n+        }\r\n+      }\r\n+      \r\n+      // Clear any existing errors\r\n+      setError('')\r\n+      \r\n+      // 🎯 Update categoryIds array with actual selections\r\n+      setCategoryConfig(prev => {\r\n+        let newCategoryIds = [...prev.categoryIds]\r\n+        \r\n+        if (!isCurrentlySelected) {\r\n+          // Add to selection\r\n+          console.log('✅ Adding main category to selection:', categoryId)\r\n+          newCategoryIds.push(categoryId)\r\n+        } else {\r\n+          // Remove from selection (and remove all its subcategories too)\r\n+          const subcategoriesOfThisCategory = subcategories\r\n+            .filter(sub => (sub.parent?._id || sub.parent) === categoryId)\r\n+            .map(sub => sub.id)\r\n+          \r\n+          console.log('❌ Removing main category and its subcategories:', {\r\n+            mainCategory: categoryId,\r\n+            subcategories: subcategoriesOfThisCategory\r\n+          })\r\n+          \r\n+          newCategoryIds = newCategoryIds.filter(id => \r\n+            id !== categoryId && !subcategoriesOfThisCategory.includes(id)\r\n+          )\r\n+        }\r\n+        \r\n+        console.log('📝 Updated categoryIds:', newCategoryIds)\r\n+        \r\n+        return {\r\n+          ...prev,\r\n+          categoryIds: newCategoryIds\r\n+        }\r\n+      })\r\n+      \r\n+    } else {\r\n+      // Subcategory logic\r\n+      const isCurrentlySelected = categoryConfig.categoryIds.includes(categoryId)\r\n+      const parentId = parentCategoryId || findParentCategory(categoryId)\r\n+      \r\n+      console.log('📊 Subcategory status:', { isCurrentlySelected, parentId })\r\n+      \r\n+      if (!isCurrentlySelected && parentId) {\r\n+        // Check subcategory limit for this parent\r\n+        const currentSubCount = categoryConfig.categoryIds.filter(id => \r\n+          subcategories.some(sub => sub.id === id && (sub.parent?._id || sub.parent) === parentId)\r\n+        ).length\r\n+        \r\n+        if (currentSubCount >= MAX_SUBCATEGORIES_PER_CATEGORY) {\r\n+          const parentName = availableCategories.find(cat => cat.id === parentId)?.name || 'this category'\r\n+          setError(`Cannot select more subcategories for ${parentName}. Maximum ${MAX_SUBCATEGORIES_PER_CATEGORY} per category allowed.`)\r\n+          return\r\n+        }\r\n+      }\r\n+      \r\n+      // Clear any existing errors\r\n+      setError('')\r\n+      \r\n+      // 🎯 Update categoryIds array for subcategory\r\n+      setCategoryConfig(prev => {\r\n+        let newCategoryIds = [...prev.categoryIds]\r\n+        \r\n+        if (!isCurrentlySelected) {\r\n+          // Add subcategory to selection\r\n+          console.log('✅ Adding subcategory to selection:', categoryId)\r\n+          newCategoryIds.push(categoryId)\r\n+          \r\n+          // Also ensure parent is selected\r\n+          if (parentId && !newCategoryIds.includes(parentId)) {\r\n+            console.log('✅ Auto-adding parent category:', parentId)\r\n+            newCategoryIds.push(parentId)\r\n+          }\r\n+        } else {\r\n+          // Remove subcategory from selection\r\n+          console.log('❌ Removing subcategory from selection:', categoryId)\r\n+          newCategoryIds = newCategoryIds.filter(id => id !== categoryId)\r\n+        }\r\n+        \r\n+        console.log('📝 Updated categoryIds:', newCategoryIds)\r\n+        \r\n+        return {\r\n+          ...prev,\r\n+          categoryIds: newCategoryIds\r\n+        }\r\n+      })\r\n+    }\r\n+  }\r\n+\r\n+  // Handle max categories change\r\n+  const handleMaxCategoriesChange = (value) => {\r\n+    const numValue = parseInt(value) || 0\r\n+    setCategoryConfig(prev => ({ ...prev, maxCategories: numValue }))\r\n+  }\r\n+\r\n+  // Load data when page changes\r\n+  useEffect(() => {\r\n+    const loadData = async () => {\r\n+      await loadPageConfig(selectedPage)\r\n+      await loadCategories()\r\n+      await loadSubcategories()\r\n+    }\r\n+    loadData()\r\n+  }, [selectedPage])\r\n+\r\n+  // Get sections for current page\r\n+  const getCurrentSections = () => {\r\n+    return selectedPage === \"home\" ? homeSections : corporateSections\r\n+  }\r\n+\r\n+  // Render category configuration modal\r\n+  const renderCategoryConfigModal = () => {\r\n+    if (!showCategoryConfig) return null\r\n+\r\n+    console.log('🎨 === RENDERING CATEGORY MODAL DEBUG ===')\r\n+    console.log('1. Modal render triggered')\r\n+    console.log('2. availableCategories state:')\r\n+    console.log('   - Length:', availableCategories.length)\r\n+    console.log('   - Is array:', Array.isArray(availableCategories))\r\n+    console.log('   - Full data:', availableCategories)\r\n+    \r\n+    const mainCategories = availableCategories.filter(cat => !cat.parent)\r\n+    const subCategories = subcategories // Use the separate subcategories state\r\n+    \r\n+    console.log('3. Category breakdown:')\r\n+    console.log('   - Main categories:', mainCategories.length, mainCategories)\r\n+    console.log('   - Sub categories:', subCategories.length, subCategories)\r\n+    \r\n+    // Get subcategories for selected main category\r\n+    const getSubcategoriesForCategory = (categoryId) => {\r\n+      console.log('🔍 Getting subcategories for category ID:', categoryId)\r\n+      const filtered = subCategories.filter(subCat => {\r\n+        const parentId = subCat.parent?._id || subCat.parent\r\n+        console.log(`   - Checking subcategory \"${subCat.name}\": parent=${parentId}, matches=${parentId === categoryId}`)\r\n+        return parentId === categoryId\r\n+      })\r\n+      console.log(`   - Found ${filtered.length} subcategories for category ${categoryId}:`, filtered)\r\n+      return filtered\r\n+    }\r\n+\r\n+    // Auto-select first main category if none selected\r\n+    if (!selectedMainCategory && mainCategories.length > 0) {\r\n+      setSelectedMainCategory(mainCategories[0].id)\r\n+    }\r\n+\r\n+    const selectedCategorySubcategories = selectedMainCategory ? \r\n+      getSubcategoriesForCategory(selectedMainCategory) : []\r\n+\r\n+    return (\r\n+      <div className=\"modal show d-block\" style={{ backgroundColor: 'rgba(0,0,0,0.5)' }}>\r\n+        <div className=\"modal-dialog modal-xl\">\r\n+          <div className=\"modal-content\">\r\n+            <div className=\"modal-header\">\r\n+              <h5 className=\"modal-title\">\r\n+                <i className=\"bi bi-grid-3x3-gap me-2\"></i>\r\n+                Category Section Configuration\r\n+              </h5>\r\n+              <button \r\n+                type=\"button\" \r\n+                className=\"btn-close\" \r\n+                onClick={() => setShowCategoryConfig(false)}\r\n+              ></button>\r\n+            </div>\r\n+            <div className=\"modal-body\">\r\n+              {/* Enable/Disable Section */}\r\n+              <div className=\"row mb-4\">\r\n+                <div className=\"col-12\">\r\n+                  <div className=\"form-check form-switch\">\r\n+                    <input \r\n+                      className=\"form-check-input\" \r\n+                      type=\"checkbox\" \r\n+                      id=\"enableCategorySection\"\r\n+                      checked={categoryConfig.enabled}\r\n+                      onChange={(e) => setCategoryConfig(prev => ({ ...prev, enabled: e.target.checked }))}\r\n+                    />\r\n+                    <label className=\"form-check-label fw-semibold\" htmlFor=\"enableCategorySection\">\r\n+                      Enable Category Section\r\n+                    </label>\r\n+                  </div>\r\n+                  <small className=\"text-muted\">Turn on/off the category section on the homepage</small>\r\n+                </div>\r\n+              </div>\r\n+\r\n+              {categoryConfig.enabled && (\r\n+                <>\r\n+                  {/* Selection Summary and Validation */}\r\n+                  <div className=\"row mb-4\">\r\n+                    <div className=\"col-12\">\r\n+                      <div className=\"card border-info\">\r\n+                        <div className=\"card-header bg-info bg-opacity-10\">\r\n+                          <h6 className=\"mb-0 text-info\">\r\n+                            <i className=\"bi bi-info-circle me-2\"></i>\r\n+                            Selection Summary\r\n+                          </h6>\r\n+                        </div>\r\n+                        <div className=\"card-body\">\r\n+                          <div className=\"row\">\r\n+                            <div className=\"col-md-6\">\r\n+                              <div className={`d-flex justify-content-between align-items-center p-2 rounded ${getCurrentCounts().mainCategoriesCount >= MIN_MAIN_CATEGORIES && getCurrentCounts().mainCategoriesCount <= MAX_MAIN_CATEGORIES ? 'bg-success bg-opacity-10 text-success' : 'bg-warning bg-opacity-10 text-warning'}`}>\r\n+                                <span className=\"fw-semibold\">\r\n+                                  <i className=\"bi bi-grid me-1\"></i>\r\n+                                  Main Categories:\r\n+                                </span>\r\n+                                <span className=\"badge bg-primary\">\r\n+                                  {getCurrentCounts().mainCategoriesCount} / {MAX_MAIN_CATEGORIES}\r\n+                                </span>\r\n+                              </div>\r\n+                              {getCurrentCounts().mainCategoriesCount < MIN_MAIN_CATEGORIES && (\r\n+                                <small className=\"text-warning\">\r\n+                                  <i className=\"bi bi-exclamation-triangle me-1\"></i>\r\n+                                  Minimum {MIN_MAIN_CATEGORIES} main category required\r\n+                                </small>\r\n+                              )}\r\n+                            </div>\r\n+                            <div className=\"col-md-6\">\r\n+                              <div className=\"d-flex justify-content-between align-items-center p-2 rounded bg-info bg-opacity-10 text-info\">\r\n+                                <span className=\"fw-semibold\">\r\n+                                  <i className=\"bi bi-tags me-1\"></i>\r\n+                                  Total Subcategories:\r\n+                                </span>\r\n+                                <span className=\"badge bg-info\">\r\n+                                  {getCurrentCounts().totalSubcategoriesCount}\r\n+                                </span>\r\n+                              </div>\r\n+                              {selectedMainCategory && (\r\n+                                <small className=\"text-muted\">\r\n+                                  <i className=\"bi bi-arrow-right me-1\"></i>\r\n+                                  Selected category: {getCurrentCounts().selectedCategorySubCount} / {MAX_SUBCATEGORIES_PER_CATEGORY}\r\n+                                </small>\r\n+                              )}\r\n+                            </div>\r\n+                          </div>\r\n+                        </div>\r\n+                      </div>\r\n+                    </div>\r\n+                  </div>\r\n+                </>\r\n+              )}\r\n+\r\n+              {categoryConfig.enabled && (\r\n+                <>\r\n+                  {/* Configuration Options */}\r\n+                  <div className=\"row mb-4\">\r\n+                    <div className=\"col-md-4\">\r\n+                      <label className=\"form-label fw-semibold\">Maximum Categories to Show</label>\r\n+                      <input \r\n+                        type=\"number\" \r\n+                        className=\"form-control\"\r\n+                        min=\"1\"\r\n+                        max=\"20\"\r\n+                        value={categoryConfig.maxCategories}\r\n+                        onChange={(e) => handleMaxCategoriesChange(e.target.value)}\r\n+                      />\r\n+                      <small className=\"text-muted\">Limit how many categories appear (0 = no limit)</small>\r\n+                    </div>\r\n+                    <div className=\"col-md-4\">\r\n+                      <label className=\"form-label fw-semibold\">Layout Style</label>\r\n+                      <select \r\n+                        className=\"form-select\"\r\n+                        value={categoryConfig.layout}\r\n+                        onChange={(e) => setCategoryConfig(prev => ({ ...prev, layout: e.target.value }))}\r\n+                      >\r\n+                        <option value=\"grid\">Grid Layout</option>\r\n+                        <option value=\"carousel\">Carousel</option>\r\n+                        <option value=\"list\">List View</option>\r\n+                      </select>\r\n+                    </div>\r\n+                    <div className=\"col-md-4\">\r\n+                      <div className=\"form-check mt-4\">\r\n+                        <input \r\n+                          className=\"form-check-input\" \r\n+                          type=\"checkbox\" \r\n+                          id=\"showSubcategories\"\r\n+                          checked={categoryConfig.showSubcategories}\r\n+                          onChange={(e) => setCategoryConfig(prev => ({ ...prev, showSubcategories: e.target.checked }))}\r\n+                        />\r\n+                        <label className=\"form-check-label\" htmlFor=\"showSubcategories\">\r\n+                          Show subcategories on hover\r\n+                        </label>\r\n+                      </div>\r\n+                    </div>\r\n+                  </div>\r\n+\r\n+                  {/* Current Selections Display */}\r\n+                  <div className=\"row mb-4\">\r\n+                    <div className=\"col-12\">\r\n+                      <div className=\"card border-success\">\r\n+                        <div className=\"card-header bg-success bg-opacity-10\">\r\n+                          <h6 className=\"mb-0 text-success\">\r\n+                            <i className=\"bi bi-check-circle me-2\"></i>\r\n+                            Current Selections\r\n+                          </h6>\r\n+                        </div>\r\n+                        <div className=\"card-body\">\r\n+                          {categoryConfig.categoryIds.length > 0 ? (\r\n+                            <div className=\"row\">\r\n+                              {/* Selected Main Categories */}\r\n+                              <div className=\"col-md-6\">\r\n+                                <h6 className=\"text-primary mb-3\">\r\n+                                  <i className=\"bi bi-grid me-1\"></i>\r\n+                                  Selected Main Categories ({categoryConfig.categoryIds.filter(id => mainCategories.some(cat => cat.id === id)).length})\r\n+                                </h6>\r\n+                                <div className=\"d-flex flex-wrap gap-2 mb-3\">\r\n+                                  {categoryConfig.categoryIds\r\n+                                    .filter(id => mainCategories.some(cat => cat.id === id))\r\n+                                    .map(categoryId => {\r\n+                                      const category = mainCategories.find(cat => cat.id === categoryId)\r\n+                                      return category ? (\r\n+                                        <span \r\n+                                          key={categoryId} \r\n+                                          className=\"badge bg-primary d-flex align-items-center\"\r\n+                                          style={{ fontSize: '12px', padding: '6px 10px' }}\r\n+                                        >\r\n+                                          <img \r\n+                                            src={category.image} \r\n+                                            alt={category.name}\r\n+                                            className=\"me-2 rounded\"\r\n+                                            style={{ width: '16px', height: '16px', objectFit: 'cover' }}\r\n+                                            onError={(e) => {\r\n+                                              e.target.src = '/assets/img/product/category/default-category.svg'\r\n+                                            }}\r\n+                                          />\r\n+                                          {category.name}\r\n+                                          <button\r\n+                                            type=\"button\"\r\n+                                            className=\"btn-close btn-close-white ms-2\"\r\n+                                            style={{ fontSize: '8px' }}\r\n+                                            onClick={() => handleCategoryToggle(categoryId)}\r\n+                                            title=\"Remove category\"\r\n+                                          ></button>\r\n+                                        </span>\r\n+                                      ) : null\r\n+                                    })}\r\n+                                </div>\r\n+                                {categoryConfig.categoryIds.filter(id => mainCategories.some(cat => cat.id === id)).length === 0 && (\r\n+                                  <p className=\"text-muted mb-0\">\r\n+                                    <i className=\"bi bi-info-circle me-1\"></i>\r\n+                                    No main categories selected\r\n+                                  </p>\r\n+                                )}\r\n+                              </div>\r\n+\r\n+                              {/* Selected Subcategories */}\r\n+                              <div className=\"col-md-6\">\r\n+                                <h6 className=\"text-secondary mb-3\">\r\n+                                  <i className=\"bi bi-tags me-1\"></i>\r\n+                                  Selected Subcategories ({categoryConfig.categoryIds.filter(id => subCategories.some(cat => cat.id === id)).length})\r\n+                                </h6>\r\n+                                <div className=\"d-flex flex-wrap gap-2 mb-3\">\r\n+                                  {categoryConfig.categoryIds\r\n+                                    .filter(id => subCategories.some(cat => cat.id === id))\r\n+                                    .map(subcategoryId => {\r\n+                                      const subcategory = subCategories.find(cat => cat.id === subcategoryId)\r\n+                                      const parentCategory = subcategory ? mainCategories.find(cat => cat.id === (subcategory.parent?._id || subcategory.parent)) : null\r\n+                                      return subcategory ? (\r\n+                                        <span \r\n+                                          key={subcategoryId} \r\n+                                          className=\"badge bg-secondary d-flex align-items-center\"\r\n+                                          style={{ fontSize: '11px', padding: '5px 8px' }}\r\n+                                        >\r\n+                                          <img \r\n+                                            src={subcategory.image} \r\n+                                            alt={subcategory.name}\r\n+                                            className=\"me-2 rounded\"\r\n+                                            style={{ width: '14px', height: '14px', objectFit: 'cover' }}\r\n+                                            onError={(e) => {\r\n+                                              e.target.src = '/assets/img/product/category/default-subcategory.svg'\r\n+                                            }}\r\n+                                          />\r\n+                                          <div className=\"d-flex flex-column align-items-start\">\r\n+                                            <span>{subcategory.name}</span>\r\n+                                            {parentCategory && (\r\n+                                              <small className=\"text-light opacity-75\" style={{ fontSize: '9px' }}>\r\n+                                                under {parentCategory.name}\r\n+                                              </small>\r\n+                                            )}\r\n+                                          </div>\r\n+                                          <button\r\n+                                            type=\"button\"\r\n+                                            className=\"btn-close btn-close-white ms-2\"\r\n+                                            style={{ fontSize: '7px' }}\r\n+                                            onClick={() => handleCategoryToggle(subcategoryId, subcategory.parent?._id || subcategory.parent)}\r\n+                                            title=\"Remove subcategory\"\r\n+                                          ></button>\r\n+                                        </span>\r\n+                                      ) : null\r\n+                                    })}\r\n+                                </div>\r\n+                                {categoryConfig.categoryIds.filter(id => subCategories.some(cat => cat.id === id)).length === 0 && (\r\n+                                  <p className=\"text-muted mb-0\">\r\n+                                    <i className=\"bi bi-info-circle me-1\"></i>\r\n+                                    No subcategories selected\r\n+                                  </p>\r\n+                                )}\r\n+                              </div>\r\n+                            </div>\r\n+                          ) : (\r\n+                            <div className=\"text-center py-4\">\r\n+                              <i className=\"bi bi-inbox text-muted\" style={{ fontSize: '2rem' }}></i>\r\n+                              <p className=\"text-muted mt-2 mb-0\">No categories selected yet</p>\r\n+                              <small className=\"text-muted\">Select categories from the interface below to see them here</small>\r\n+                            </div>\r\n+                          )}\r\n+                        </div>\r\n+                      </div>\r\n+                    </div>\r\n+                  </div>\r\n+\r\n+                  {/* Selection Summary */}\r\n+                  <div className=\"row mb-4\">\r\n+                    <div className=\"col-12\">\r\n+                      <div className=\"alert alert-info d-flex align-items-center\">\r\n+                        <i className=\"bi bi-info-circle me-2\"></i>\r\n+                        <div>\r\n+                          <strong>Selection Summary:</strong> {categoryConfig.categoryIds.length} categories selected \r\n+                          ({categoryConfig.categoryIds.filter(id => mainCategories.some(cat => cat.id === id)).length} main categories, {categoryConfig.categoryIds.filter(id => subCategories.some(cat => cat.id === id)).length} subcategories)\r\n+                        </div>\r\n+                      </div>\r\n+                    </div>\r\n+                  </div>\r\n+\r\n+                  {/* Category Selection Interface */}\r\n+                  <div className=\"row mb-4\">\r\n+                    <div className=\"col-12\">\r\n+                      <label className=\"form-label fw-semibold mb-3\">Select Categories and Subcategories</label>\r\n+                      \r\n+                      {mainCategories.length > 0 ? (\r\n+                        <div className=\"row\">\r\n+                          {/* Left Side - Main Categories */}\r\n+                          <div className=\"col-md-6\">\r\n+                            <div className=\"card\">\r\n+                              <div className=\"card-header bg-light d-flex justify-content-between align-items-center\">\r\n+                                <h6 className=\"mb-0\">\r\n+                                  <i className=\"bi bi-grid text-primary me-2\"></i>\r\n+                                  Main Categories ({mainCategories.length})\r\n+                                </h6>\r\n+                                <span className=\"badge bg-primary\">\r\n+                                  {getCurrentCounts().mainCategoriesCount} selected\r\n+                                </span>\r\n+                              </div>\r\n+                              <div className=\"card-body p-0\">\r\n+                                <div className=\"list-group list-group-flush\" style={{ maxHeight: '400px', overflowY: 'auto' }}>\r\n+                                  {mainCategories.map((category, index) => {\r\n+                                    // Use the flat categoryIds array for now since categories is still an array\r\n+                                    const isSelected = categoryConfig.categoryIds.includes(category.id)\r\n+                                    const isActiveTab = selectedMainCategory === category.id\r\n+                                    const subcategoryCount = getSubcategoriesForCategory(category.id).length\r\n+                                    const selectedSubcategoryCount = getSubcategoriesForCategory(category.id)\r\n+                                      .filter(sub => categoryConfig.categoryIds.includes(sub.id)).length\r\n+                                    \r\n+                                    return (\r\n+                                      <div\r\n+                                        key={category.id}\r\n+                                        className={`list-group-item d-flex justify-content-between align-items-center ${isActiveTab ? 'active' : ''}`}\r\n+                                        style={{ \r\n+                                          cursor: 'pointer',\r\n+                                          borderLeft: isActiveTab ? '4px solid #0d6efd' : '4px solid transparent'\r\n+                                        }}\r\n+                                        onClick={() => setSelectedMainCategory(category.id)}\r\n+                                      >\r\n+                                        <div className=\"d-flex align-items-center flex-grow-1\">\r\n+                                          <div className=\"form-check me-3\">\r\n+                                            <input\r\n+                                              className=\"form-check-input\"\r\n+                                              type=\"checkbox\"\r\n+                                              checked={isSelected}\r\n+                                              onChange={(e) => {\r\n+                                                e.stopPropagation()\r\n+                                                handleCategoryToggle(category.id)\r\n+                                              }}\r\n+                                            />\r\n+                                          </div>\r\n+                                          <img\r\n+                                            src={category.image}\r\n+                                            alt={category.name}\r\n+                                            className=\"me-3 rounded\"\r\n+                                            style={{ width: '32px', height: '32px', objectFit: 'cover' }}\r\n+                                            onError={(e) => {\r\n+                                              e.target.src = '/assets/img/product/category/default-category.svg'\r\n+                                            }}\r\n+                                          />\r\n+                                          <div>\r\n+                                            <div className={`fw-semibold ${isActiveTab ? 'text-white' : ''}`}>\r\n+                                              {category.name}\r\n+                                            </div>\r\n+                                            <small className={`${isActiveTab ? 'text-white-50' : 'text-muted'}`}>\r\n+                                              {subcategoryCount} subcategories\r\n+                                            </small>\r\n+                                          </div>\r\n+                                        </div>\r\n+                                        <div className=\"d-flex flex-column align-items-end\">\r\n+                                          {isSelected && (\r\n+                                            <span className={`badge ${isActiveTab ? 'bg-light text-primary' : 'bg-success'} mb-1`}>\r\n+                                              <i className=\"bi bi-check2 me-1\"></i>\r\n+                                              Selected\r\n+                                            </span>\r\n+                                          )}\r\n+                                          {subcategoryCount > 0 && (\r\n+                                            <span className={`badge ${isActiveTab ? 'bg-light text-primary' : 'bg-secondary'}`}>\r\n+                                              {selectedSubcategoryCount}/{subcategoryCount} subs\r\n+                                            </span>\r\n+                                          )}\r\n+                                        </div>\r\n+                                      </div>\r\n+                                    )\r\n+                                  })}\r\n+                                </div>\r\n+                              </div>\r\n+                            </div>\r\n+                          </div>\r\n+\r\n+                          {/* Right Side - Subcategories */}\r\n+                          <div className=\"col-md-6\">\r\n+                            <div className=\"card\">\r\n+                              <div className=\"card-header bg-light d-flex justify-content-between align-items-center\">\r\n+                                <h6 className=\"mb-0\">\r\n+                                  <i className=\"bi bi-tag text-secondary me-2\"></i>\r\n+                                  Subcategories\r\n+                                  {selectedMainCategory && (\r\n+                                    <span className=\"text-muted ms-2\">\r\n+                                      for \"{mainCategories.find(cat => cat.id === selectedMainCategory)?.name}\"\r\n+                                    </span>\r\n+                                  )}\r\n+                                </h6>\r\n+                                {selectedCategorySubcategories.length > 0 && (\r\n+                                  <span className=\"badge bg-secondary\">\r\n+                                    {selectedCategorySubcategories.length} subcategories\r\n+                                  </span>\r\n+                                )}\r\n+                              </div>\r\n+                              <div className=\"card-body p-0\">\r\n+                                {selectedMainCategory ? (\r\n+                                  selectedCategorySubcategories.length > 0 ? (\r\n+                                    <>\r\n+                                      {/* Subcategories Stats */}\r\n+                                      <div className=\"p-3 bg-light border-bottom\">\r\n+                                        <div className=\"row text-center\">\r\n+                                          <div className=\"col-6\">\r\n+                                            <div className=\"small\">\r\n+                                              <strong>{selectedCategorySubcategories.filter(sub => categoryConfig.categoryIds.includes(sub.id)).length}</strong>\r\n+                                              <br />\r\n+                                              <span className=\"text-muted\">Selected</span>\r\n+                                            </div>\r\n+                                          </div>\r\n+                                          <div className=\"col-6\">\r\n+                                            <div className=\"small\">\r\n+                                              <strong>{selectedCategorySubcategories.filter(sub => sub.status).length}</strong>\r\n+                                              <br />\r\n+                                              <span className=\"text-muted\">Active</span>\r\n+                                            </div>\r\n+                                          </div>\r\n+                                        </div>\r\n+                                      </div>\r\n+\r\n+                                      {/* Quick Actions for Subcategories */}\r\n+                                      <div className=\"p-2 border-bottom\">\r\n+                                        <div className=\"d-flex gap-1\">\r\n+                                          <button \r\n+                                            type=\"button\" \r\n+                                            className=\"btn btn-outline-success btn-sm\"\r\n+                                            onClick={() => {\r\n+                                              const currentSubIds = selectedCategorySubcategories.map(cat => cat.id)\r\n+                                              setCategoryConfig(prev => ({\r\n+                                                ...prev,\r\n+                                                categoryIds: [...new Set([...prev.categoryIds, ...currentSubIds])]\r\n+                                              }))\r\n+                                            }}\r\n+                                          >\r\n+                                            <i className=\"bi bi-check-all me-1\"></i>\r\n+                                            Select All\r\n+                                          </button>\r\n+                                          \r\n+                                          <button \r\n+                                            type=\"button\" \r\n+                                            className=\"btn btn-outline-secondary btn-sm\"\r\n+                                            onClick={() => {\r\n+                                              const currentSubIds = selectedCategorySubcategories.map(cat => cat.id)\r\n+                                              setCategoryConfig(prev => ({\r\n+                                                ...prev,\r\n+                                                categoryIds: prev.categoryIds.filter(id => !currentSubIds.includes(id))\r\n+                                              }))\r\n+                                            }}\r\n+                                          >\r\n+                                            <i className=\"bi bi-x-circle me-1\"></i>\r\n+                                            Clear All\r\n+                                          </button>\r\n+                                        </div>\r\n+                                      </div>\r\n+\r\n+                                      {/* Subcategories List */}\r\n+                                      <div className=\"list-group list-group-flush\" style={{ maxHeight: '350px', overflowY: 'auto' }}>\r\n+                                        {selectedCategorySubcategories.map((subcategory, index) => {\r\n+                                          // Use the flat categoryIds array for now since categories is still an array\r\n+                                          const isSelected = categoryConfig.categoryIds.includes(subcategory.id)\r\n+                                          \r\n+                                          return (\r\n+                                            <div \r\n+                                              key={subcategory.id} \r\n+                                              className={`list-group-item list-group-item-action border-0 ${isSelected ? 'bg-success bg-opacity-10 border-start border-success border-3' : ''}`}\r\n+                                            >\r\n+                                              <div className=\"d-flex align-items-center\">\r\n+                                                <div className=\"form-check me-3\">\r\n+                                                  <input \r\n+                                                    className=\"form-check-input form-check-input-success\" \r\n+                                                    type=\"checkbox\" \r\n+                                                    id={`sub-category-${subcategory.id}`}\r\n+                                                    checked={isSelected}\r\n+                                                    onChange={() => handleCategoryToggle(subcategory.id, selectedMainCategory)}\r\n+                                                  />\r\n+                                                </div>\r\n+                                                \r\n+                                                {subcategory.image && (\r\n+                                                  <img \r\n+                                                    src={subcategory.image} \r\n+                                                    alt={subcategory.name}\r\n+                                                    className=\"me-3 flex-shrink-0 border\"\r\n+                                                    style={{ width: '36px', height: '36px', objectFit: 'cover', borderRadius: '6px' }}\r\n+                                                  />\r\n+                                                )}\r\n+                                                \r\n+                                                <div className=\"flex-grow-1\">\r\n+                                                  <div className=\"d-flex justify-content-between align-items-start\">\r\n+                                                    <div>\r\n+                                                      <h6 className=\"mb-1 text-dark fw-semibold\">\r\n+                                                        <i className=\"bi bi-tag text-success me-1\" style={{ fontSize: '12px' }}></i>\r\n+                                                        {subcategory.name}\r\n+                                                      </h6>\r\n+                                                      {subcategory.description && (\r\n+                                                        <p className=\"mb-1 text-muted small\">{subcategory.description}</p>\r\n+                                                      )}\r\n+                                                      <div className=\"d-flex gap-1 align-items-center\">\r\n+                                                        <span className=\"badge bg-secondary\" style={{ fontSize: '9px' }}>\r\n+                                                          Subcategory\r\n+                                                        </span>\r\n+                                                        <span className={`badge ${subcategory.status ? 'bg-success' : 'bg-danger'}`} style={{ fontSize: '9px' }}>\r\n+                                                          {subcategory.status ? 'Active' : 'Inactive'}\r\n+                                                        </span>\r\n+                                                        {isSelected && (\r\n+                                                          <span className=\"badge bg-primary\" style={{ fontSize: '9px' }}>\r\n+                                                            <i className=\"bi bi-check-circle me-1\"></i>\r\n+                                                            Selected\r\n+                                                          </span>\r\n+                                                        )}\r\n+                                                      </div>\r\n+                                                    </div>\r\n+                                                    <div className=\"text-end\">\r\n+                                                      <small className=\"text-muted\">#{index + 1}</small>\r\n+                                                    </div>\r\n+                                                  </div>\r\n+                                                </div>\r\n+                                              </div>\r\n+                                            </div>\r\n+                                          )\r\n+                                        })}\r\n+                                      </div>\r\n+\r\n+                                      {/* Footer Info */}\r\n+                                      <div className=\"p-2 bg-light border-top text-center\">\r\n+                                        <small className=\"text-muted\">\r\n+                                          <i className=\"bi bi-info-circle me-1\"></i>\r\n+                                          Click checkboxes to select subcategories for homepage display\r\n+                                        </small>\r\n+                                      </div>\r\n+                                    </>\r\n+                                  ) : (\r\n+                                    <div className=\"text-center py-5\">\r\n+                                      <i className=\"bi bi-folder2-open text-muted\" style={{ fontSize: '2.5rem' }}></i>\r\n+                                      <h6 className=\"mt-3 text-muted\">No subcategories found</h6>\r\n+                                      <p className=\"text-muted mb-3\">\r\n+                                        The category \"{mainCategories.find(cat => cat.id === selectedMainCategory)?.name}\" doesn't have any subcategories yet.\r\n+                                      </p>\r\n+                                      <button \r\n+                                        className=\"btn btn-outline-primary btn-sm\"\r\n+                                        onClick={() => {\r\n+                                          // You can add navigation to create subcategory here\r\n+                                          alert('Navigate to Categories > Subcategories to create subcategories for this category')\r\n+                                        }}\r\n+                                      >\r\n+                                        <i className=\"bi bi-plus-circle me-1\"></i>\r\n+                                        Create Subcategories\r\n+                                      </button>\r\n+                                    </div>\r\n+                                  )\r\n+                                ) : (\r\n+                                  <div className=\"text-center py-5\">\r\n+                                    <i className=\"bi bi-arrow-left text-primary\" style={{ fontSize: '2.5rem' }}></i>\r\n+                                    <h6 className=\"mt-3 text-muted\">Select a main category</h6>\r\n+                                    <p className=\"text-muted mb-0\">\r\n+                                      Click on a main category from the left panel to view and select its subcategories.\r\n+                                    </p>\r\n+                                  </div>\r\n+                                )}\r\n+                              </div>\r\n+                            </div>\r\n+                          </div>\r\n+                        </div>\r\n+                      ) : (\r\n+                        <div className=\"text-center py-5\">\r\n+                          <i className=\"bi bi-folder2-open text-muted\" style={{ fontSize: '3rem' }}></i>\r\n+                          <p className=\"mt-2 text-muted\">No categories available</p>\r\n+                          <small className=\"text-muted\">Create categories first to configure this section.</small>\r\n+                        </div>\r\n+                      )}\r\n+                    </div>\r\n+                  </div>\r\n+\r\n+                  {/* Quick Actions */}\r\n+                  {mainCategories.length > 0 && (\r\n+                    <div className=\"row\">\r\n+                      <div className=\"col-12\">\r\n+                        <div className=\"d-flex gap-2 flex-wrap\">\r\n+                          <button \r\n+                            type=\"button\" \r\n+                            className=\"btn btn-outline-primary btn-sm\"\r\n+                            onClick={() => {\r\n+                              console.log('🎯 Select All Main Categories clicked')\r\n+                              const { mainCategoriesCount } = getCurrentCounts()\r\n+                              const availableSlots = MAX_MAIN_CATEGORIES - mainCategoriesCount\r\n+                              \r\n+                              if (availableSlots <= 0) {\r\n+                                setError(`Cannot select more categories. Maximum ${MAX_MAIN_CATEGORIES} main categories allowed.`)\r\n+                                return\r\n+                              }\r\n+                              \r\n+                              // Get main categories that are not already selected\r\n+                              const mainCategoryIds = mainCategories.map(cat => cat.id)\r\n+                              const unselectedMainCategories = mainCategoryIds.filter(id => \r\n+                                !categoryConfig.categoryIds.includes(id)\r\n+                              )\r\n+                              \r\n+                              // Take only the number that fits within the limit\r\n+                              const categoriesToAdd = unselectedMainCategories.slice(0, availableSlots)\r\n+                              console.log('   - Categories to add:', categoriesToAdd)\r\n+                              \r\n+                              setCategoryConfig(prev => {\r\n+                                const newCategoryIds = [...new Set([...prev.categoryIds, ...categoriesToAdd])]\r\n+                                console.log('   - Updated categoryIds:', newCategoryIds)\r\n+                                return {\r\n+                                  ...prev,\r\n+                                  categoryIds: newCategoryIds\r\n+                                }\r\n+                              })\r\n+                              \r\n+                              if (categoriesToAdd.length < unselectedMainCategories.length) {\r\n+                                setError(`Only selected ${categoriesToAdd.length} more categories due to limit.`)\r\n+                              }\r\n+                            }}\r\n+                          >\r\n+                            <i className=\"bi bi-check-all me-1\"></i>\r\n+                            Select All Main Categories\r\n+                          </button>\r\n+                          \r\n+                          <button \r\n+                            type=\"button\" \r\n+                            className=\"btn btn-outline-success btn-sm\"\r\n+                            onClick={() => {\r\n+                              console.log('🎯 Select All Subcategories clicked')\r\n+                              if (!selectedMainCategory) {\r\n+                                setError('Please select a main category first to add subcategories.')\r\n+                                return\r\n+                              }\r\n+                              \r\n+                              const subcategoriesForMain = getSubcategoriesForCategory(selectedMainCategory)\r\n+                              const currentSubCount = subcategoriesForMain.filter(sub => \r\n+                                categoryConfig.categoryIds.includes(sub.id)\r\n+                              ).length\r\n+                              const availableSlots = MAX_SUBCATEGORIES_PER_CATEGORY - currentSubCount\r\n+                              \r\n+                              if (availableSlots <= 0) {\r\n+                                setError(`Cannot select more subcategories. Maximum ${MAX_SUBCATEGORIES_PER_CATEGORY} subcategories per main category allowed.`)\r\n+                                return\r\n+                              }\r\n+                              \r\n+                              // Get unselected subcategories for this main category\r\n+                              const unselectedSubcategories = subcategoriesForMain\r\n+                                .filter(sub => !categoryConfig.categoryIds.includes(sub.id))\r\n+                                .slice(0, availableSlots)\r\n+                                .map(sub => sub.id)\r\n+                              \r\n+                              console.log('   - Subcategories to add:', unselectedSubcategories)\r\n+                              \r\n+                              setCategoryConfig(prev => {\r\n+                                let newCategoryIds = [...prev.categoryIds]\r\n+                                \r\n+                                // Ensure main category is selected\r\n+                                if (!newCategoryIds.includes(selectedMainCategory)) {\r\n+                                  newCategoryIds.push(selectedMainCategory)\r\n+                                }\r\n+                                \r\n+                                // Add unselected subcategories\r\n+                                newCategoryIds = [...new Set([...newCategoryIds, ...unselectedSubcategories])]\r\n+                                \r\n+                                console.log('   - Updated categoryIds:', newCategoryIds)\r\n+                                return {\r\n+                                  ...prev,\r\n+                                  categoryIds: newCategoryIds\r\n+                                }\r\n+                              })\r\n+                              \r\n+                              if (unselectedSubcategories.length < subcategoriesForMain.length - currentSubCount) {\r\n+                                setError(`Only selected ${unselectedSubcategories.length} more subcategories due to limit.`)\r\n+                              }\r\n+                            }}\r\n+                          >\r\n+                            <i className=\"bi bi-tags me-1\"></i>\r\n+                            Select All Subcategories\r\n+                          </button>\r\n+                          \r\n+                          <button \r\n+                            type=\"button\" \r\n+                            className=\"btn btn-outline-secondary btn-sm\"\r\n+                            onClick={() => {\r\n+                              console.log('🎯 Clear All Selections clicked')\r\n+                              setCategoryConfig(prev => ({\r\n+                                ...prev,\r\n+                                categoryIds: []\r\n+                              }))\r\n+                              setSelectedMainCategory(null)\r\n+                            }}\r\n+                          >\r\n+                            <i className=\"bi bi-x-circle me-1\"></i>\r\n+                            Clear All Selections\r\n+                          </button>\r\n+                        </div>\r\n+                      </div>\r\n+                    </div>\r\n+                  )}\r\n+                </>\r\n+              )}\r\n+            </div>\r\n+            <div className=\"modal-footer\">\r\n+              <button \r\n+                type=\"button\" \r\n+                className=\"btn btn-secondary\" \r\n+                onClick={() => setShowCategoryConfig(false)}\r\n+              >\r\n+                Cancel\r\n+              </button>\r\n+              <button \r\n+                type=\"button\" \r\n+                className=\"btn btn-primary\" \r\n+                onClick={saveCategoryConfig}\r\n+                disabled={loading}\r\n+              >\r\n+                {loading ? (\r\n+                  <>\r\n+                    <span className=\"spinner-border spinner-border-sm me-2\"></span>\r\n+                    Saving...\r\n+                  </>\r\n+                ) : (\r\n+                  'Save Configuration'\r\n+                )}\r\n+              </button>\r\n+            </div>\r\n+          </div>\r\n+        </div>\r\n+      </div>\r\n+    )\r\n+  }\r\n+\r\n+  // Move section up/down\r\n+  const handleMoveSection = async (page, sectionKey, direction) => {\r\n+    const sections = page === \"home\" ? homeSections : corporateSections\r\n+    const currentIndex = sections.findIndex(s => s.key === sectionKey)\r\n+    \r\n+    if (direction === 'up' && currentIndex > 0) {\r\n+      // Move up logic - would need to update order\r\n+      console.log(`Moving ${sectionKey} up`)\r\n+    } else if (direction === 'down' && currentIndex < sections.length - 1) {\r\n+      // Move down logic - would need to update order\r\n+      console.log(`Moving ${sectionKey} down`)\r\n+    }\r\n+    \r\n+    // TODO: Implement actual reordering\r\n+    setSuccess('Section order updated!')\r\n+    setTimeout(() => setSuccess(''), 2000)\r\n+  }\r\n+\r\n+  // Render section controls\r\n+  const renderSections = () => {\r\n+    const sections = getCurrentSections()\r\n+    const currentPage = PAGES.find(p => p.key === selectedPage)\r\n+    \r\n+    return (\r\n+      <div className=\"col-md-9\">\r\n+        <div className=\"card border-0 shadow-sm\">\r\n+          <div className=\"card-header bg-white border-bottom\">\r\n+            <div className=\"d-flex justify-content-between align-items-center\">\r\n+              <div>\r\n+                <h5 className=\"mb-1 fw-semibold\">{currentPage.label}</h5>\r\n+                <p className=\"text-muted mb-0 small\">{currentPage.description}</p>\r\n+              </div>\r\n+              <span className=\"badge bg-primary\">\r\n+                {sections.filter(s => visibleSections[selectedPage][s.key]).length} active\r\n+              </span>\r\n+            </div>\r\n+          </div>\r\n+          \r\n+          <div className=\"card-body p-0\">\r\n+            {sections.length === 0 ? (\r\n+              <div className=\"text-center py-5\">\r\n+                <i className=\"bi bi-grid\" style={{ fontSize: '3rem', color: '#6c757d' }}></i>\r\n+                <p className=\"mt-2 text-muted\">No sections configured for this page.</p>\r\n+              </div>\r\n+            ) : (\r\n+              <div className=\"table-responsive\">\r\n+                <table className=\"table table-hover mb-0\">\r\n+                  <thead className=\"table-light\">\r\n+                    <tr>\r\n+                      <th className=\"ps-4\">Section</th>\r\n+                      <th>Description</th>\r\n+                      <th>Order</th>\r\n+                      <th>Status</th>\r\n+                      <th className=\"text-center\">Actions</th>\r\n+                    </tr>\r\n+                  </thead>\r\n+                  <tbody>\r\n+                    {sections.map((section, index) => {\r\n+                      const isVisible = visibleSections[selectedPage][section.key]\r\n+                      const isCategorySection = section.key === 'giftCategories'\r\n+                      \r\n+                      return (\r\n+                        <tr key={section.key} className={isVisible ? '' : 'table-secondary'}>\r\n+                          <td className=\"ps-4\">\r\n+                            <div className=\"d-flex align-items-center\">\r\n+                              <div>\r\n+                                <div className=\"fw-semibold\">{section.label}</div>\r\n+                                {isCategorySection && categoryConfig.categoryIds.length > 0 && (\r\n+                                  <small className=\"text-muted\">\r\n+                                    {categoryConfig.categoryIds.length} categories selected\r\n+                                  </small>\r\n+                                )}\r\n+                              </div>\r\n+                            </div>\r\n+                          </td>\r\n+                          <td>\r\n+                            <span className=\"text-muted\">{section.description}</span>\r\n+                          </td>\r\n+                          <td>\r\n+                            <span className=\"badge bg-light text-dark\">{section.order}</span>\r\n+                          </td>\r\n+                          <td>\r\n+                            <div className=\"form-check form-switch\">\r\n+                              <input \r\n+                                className=\"form-check-input\" \r\n+                                type=\"checkbox\" \r\n+                                checked={isCategorySection ? categoryConfig.enabled : isVisible}\r\n+                                onChange={() => handleToggleSection(selectedPage, section.key)}\r\n+                                id={`toggle-${section.key}`}\r\n+                              />\r\n+                              <label className=\"form-check-label\" htmlFor={`toggle-${section.key}`}>\r\n+                                {isCategorySection ? (categoryConfig.enabled ? 'Enabled' : 'Disabled') : (isVisible ? 'Visible' : 'Hidden')}\r\n+                              </label>\r\n+                            </div>\r\n+                          </td>\r\n+                          <td className=\"text-center\">\r\n+                            <div className=\"btn-group btn-group-sm\">\r\n+                              {section.hasConfig && (\r\n+                                <button\r\n+                                  className=\"btn btn-outline-primary\"\r\n+                                  onClick={openCategoryConfig}\r\n+                                  title=\"Configure section\"\r\n+                                >\r\n+                                  <i className=\"bi bi-gear\"></i>\r\n+                                </button>\r\n+                              )}\r\n+                              <button\r\n+                                className=\"btn btn-outline-secondary\"\r\n+                                onClick={() => handleMoveSection(selectedPage, section.key, 'up')}\r\n+                                disabled={index === 0}\r\n+                                title=\"Move up\"\r\n+                              >\r\n+                                <i className=\"bi bi-arrow-up\"></i>\r\n+                              </button>\r\n+                              <button\r\n+                                className=\"btn btn-outline-secondary\"\r\n+                                onClick={() => handleMoveSection(selectedPage, section.key, 'down')}\r\n+                                disabled={index === sections.length - 1}\r\n+                                title=\"Move down\"\r\n+                              >\r\n+                                <i className=\"bi bi-arrow-down\"></i>\r\n+                              </button>\r\n+                            </div>\r\n+                          </td>\r\n+                        </tr>\r\n+                      )\r\n+                    })}\r\n+                  </tbody>\r\n+                </table>\r\n+              </div>\r\n+            )}\r\n+          </div>\r\n+        </div>\r\n+      </div>\r\n+    )\r\n+  }\r\n+\r\n+  // Render page sidebar\r\n+  const renderPageSidebar = () => (\r\n+    <div className=\"col-md-3\">\r\n+      <div className=\"card border-0 shadow-sm\">\r\n+        <div className=\"card-header bg-white border-bottom\">\r\n+          <h6 className=\"mb-0 fw-semibold\">\r\n+            <i className=\"bi bi-file-earmark-text me-2\"></i>\r\n+            Pages\r\n+          </h6>\r\n+        </div>\r\n+        <div className=\"card-body p-0\">\r\n+          <div className=\"list-group list-group-flush\">\r\n+            {PAGES.map((page) => {\r\n+              const isActive = selectedPage === page.key\r\n+              const activeCount = visibleSections[page.key] ? \r\n+                Object.values(visibleSections[page.key]).filter(Boolean).length : 0\r\n+              \r\n+              return (\r\n+                <button\r\n+                  key={page.key}\r\n+                  className={`list-group-item list-group-item-action border-0 ${isActive ? 'active' : ''}`}\r\n+                  onClick={() => setSelectedPage(page.key)}\r\n+                  disabled={loading}\r\n+                >\r\n+                  <div className=\"d-flex justify-content-between align-items-center\">\r\n+                    <div>\r\n+                      <div className=\"fw-semibold\">{page.label}</div>\r\n+                      <small className={isActive ? 'text-white-50' : 'text-muted'}>\r\n+                        {page.description}\r\n+                      </small>\r\n+                    </div>\r\n+                    <span className={`badge ${isActive ? 'bg-white text-primary' : 'bg-primary'}`}>\r\n+                      {activeCount}\r\n+                    </span>\r\n+                  </div>\r\n+                </button>\r\n+              )\r\n+            })}\r\n+          </div>\r\n+        </div>\r\n+      </div>\r\n+    </div>\r\n+  )\r\n+\r\n+  return (\r\n+    <div className=\"container-fluid\">\r\n+      {/* Page Header */}\r\n+      <div className=\"row mb-4\">\r\n+        <div className=\"col-12\">\r\n+          <div className=\"d-flex justify-content-between align-items-center\">\r\n+            <div>\r\n+              <h2 className=\"fw-bold text-dark mb-1\">Pages Management</h2>\r\n+              <p className=\"text-muted mb-0\">Control which sections appear on each page</p>\r\n+            </div>\r\n+            <div className=\"d-flex gap-2\">\r\n+              <button\r\n+                className=\"btn btn-outline-primary\"\r\n+                onClick={() => loadPageConfig(selectedPage)}\r\n+                disabled={loading}\r\n+              >\r\n+                <i className=\"bi bi-arrow-clockwise me-2\"></i>\r\n+                Refresh\r\n+              </button>\r\n+            </div>\r\n+          </div>\r\n+        </div>\r\n+      </div>\r\n+\r\n+      {/* Status Messages */}\r\n+      {error && (\r\n+        <div className=\"row mb-3\">\r\n+          <div className=\"col-12\">\r\n+            <div className=\"alert alert-danger d-flex align-items-center\" role=\"alert\">\r\n+              <i className=\"bi bi-exclamation-triangle-fill me-2\"></i>\r\n+              <div>{error}</div>\r\n+              <button\r\n+                type=\"button\"\r\n+                className=\"btn-close ms-auto\"\r\n+                onClick={() => setError('')}\r\n+              ></button>\r\n+            </div>\r\n+          </div>\r\n+        </div>\r\n+      )}\r\n+\r\n+      {success && (\r\n+        <div className=\"row mb-3\">\r\n+          <div className=\"col-12\">\r\n+            <div className=\"alert alert-success d-flex align-items-center\" role=\"alert\">\r\n+              <i className=\"bi bi-check-circle-fill me-2\"></i>\r\n+              <div>{success}</div>\r\n+              <button\r\n+                type=\"button\"\r\n+                className=\"btn-close ms-auto\"\r\n+                onClick={() => setSuccess('')}\r\n+              ></button>\r\n+            </div>\r\n+          </div>\r\n+        </div>\r\n+      )}\r\n+\r\n+      {/* Main Content */}\r\n+      <div className=\"row\">\r\n+        {renderPageSidebar()}\r\n+        {renderSections()}\r\n+      </div>\r\n+\r\n+      {/* Category Configuration Modal */}\r\n+      {renderCategoryConfigModal()}\r\n+\r\n+      {/* Loading Overlay */}\r\n+      {loading && (\r\n+        <div className=\"position-fixed top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center\" \r\n+             style={{ backgroundColor: 'rgba(0,0,0,0.5)', zIndex: 9999 }}>\r\n+          <div className=\"spinner-border text-primary\" role=\"status\">\r\n+            <span className=\"visually-hidden\">Loading...</span>\r\n+          </div>\r\n+        </div>\r\n+      )}\r\n+    </div>\r\n+  )\r\n+}\r\n"
                },
                {
                    "date": 1753288332494,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -451,8 +451,11 @@\n       categoriesData.slice(0, 3).forEach((cat, index) => {\r\n         console.log(`     ${index + 1}.`, cat)\r\n       })\r\n       \r\n+      // Create default category icon as data URL to avoid 404 errors\r\n+      const defaultCategoryIcon = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjQwIiBoZWlnaHQ9IjQwIiBmaWxsPSIjZjhmOWZhIiByeD0iOCIvPgo8cGF0aCBkPSJNMTAgMTVIMzBWMjVIMTBWMTVaIiBmaWxsPSIjZGVlMmU2Ii8+CjxjaXJjbGUgY3g9IjE1IiBjeT0iMjAiIHI9IjIiIGZpbGw9IiM5NjliYTYiLz4KPGNpcmNsZSBjeD0iMjUiIGN5PSIyMCIgcj0iMiIgZmlsbD0iIzk2OWJhNiIvPgo8L3N2Zz4='\r\n+      \r\n       // Transform categories for display in the admin panel\r\n       console.log('7. Transforming categories...')\r\n       const transformedCategories = categoriesData.map((cat, index) => {\r\n         console.log(`   - Transforming category ${index + 1}:`, {\r\n@@ -466,9 +469,9 @@\n           id: cat.id || cat._id,\r\n           value: cat.id || cat._id,\r\n           label: cat.name,\r\n           name: cat.name,\r\n-          image: cat.image?.url || '/assets/img/product/category/default-category.svg',\r\n+          image: cat.image?.url || defaultCategoryIcon, // 🎯 Use data URL instead of file path\r\n           description: cat.description || '',\r\n           parent: cat.parent\r\n         }\r\n       })\r\n@@ -541,8 +544,11 @@\n           status: subcat.status\r\n         })\r\n       })\r\n       \r\n+      // Create default subcategory icon as data URL to avoid 404 errors\r\n+      const defaultSubcategoryIcon = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzYiIGhlaWdodD0iMzYiIHZpZXdCb3g9IjAgMCAzNiAzNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjM2IiBoZWlnaHQ9IjM2IiBmaWxsPSIjZjhmOWZhIiByeD0iNiIvPgo8Y2lyY2xlIGN4PSIxOCIgY3k9IjE4IiByPSI4IiBmaWxsPSIjZGVlMmU2Ii8+CjxjaXJjbGUgY3g9IjE4IiBjeT0iMTgiIHI9IjMiIGZpbGw9IiM5NjliYTYiLz4KPC9zdmc+'\r\n+      \r\n       // Transform subcategories for display\r\n       const transformedSubcategories = subcategoriesData.map((subcat, index) => {\r\n         console.log(`   - Transforming subcategory ${index + 1}:`, {\r\n           originalId: subcat._id,\r\n@@ -555,9 +561,9 @@\n           id: subcat.id || subcat._id,\r\n           value: subcat.id || subcat._id,\r\n           label: subcat.name,\r\n           name: subcat.name,\r\n-          image: subcat.image?.url || '/assets/img/product/category/default-subcategory.svg',\r\n+          image: subcat.image?.url || defaultSubcategoryIcon, // 🎯 Use data URL instead of file path\r\n           description: subcat.description || '',\r\n           parent: subcat.parent,\r\n           status: subcat.status\r\n         }\r\n@@ -1892,1895 +1898,4 @@\n       )}\r\n     </div>\r\n   )\r\n }\r\n-'use client'\r\n-import React, { useState, useEffect } from 'react'\r\n-import { get, post, put } from '@/util/apiService'\r\n-import { CATEGORY, SUBCATEGORY } from '@/util/apiEndpoints'\r\n-\r\n-const PAGES = [\r\n-  { \r\n-    key: \"home\", \r\n-    label: \"Home Page\",\r\n-    description: \"Manage sections displayed on the homepage\"\r\n-  },\r\n-  { \r\n-    key: \"corporate\", \r\n-    label: \"Corporate Page\",\r\n-    description: \"Manage sections for corporate customers\"\r\n-  }\r\n-]\r\n-\r\n-export default function PagesManagement({ onNavigate }) {\r\n-  const [selectedPage, setSelectedPage] = useState(\"home\")\r\n-  const [loading, setLoading] = useState(false)\r\n-  const [error, setError] = useState('')\r\n-  const [success, setSuccess] = useState('')\r\n-  const [showCategoryConfig, setShowCategoryConfig] = useState(false)\r\n-  const [availableCategories, setAvailableCategories] = useState([])\r\n-  const [subcategories, setSubcategories] = useState([])\r\n-  const [pageConfig, setPageConfig] = useState(null)\r\n-\r\n-  // Category section configuration state - NEW HIERARCHICAL STRUCTURE\r\n-  const [categoryConfig, setCategoryConfig] = useState({\r\n-  enabled: true,\r\n-  maxCategories: 10,\r\n-  layout: 'grid',\r\n-  showSubcategories: true,\r\n-  // New hierarchical structure\r\n-  categories: [],\r\n-  // FIXED: Always initialize as empty array, not undefined\r\n-  categoryIds: []\r\n-})\r\n-\r\n-// ...existing code around line 1612...\r\n-\r\n-// FIX: Add null safety check for categoryIds\r\n-\r\n-  // Business rule constants\r\n-  const MAX_MAIN_CATEGORIES = 10\r\n-  const MIN_MAIN_CATEGORIES = 1\r\n-  const MAX_SUBCATEGORIES_PER_CATEGORY = 10\r\n-\r\n-  // UI state for category selection\r\n-  const [selectedMainCategory, setSelectedMainCategory] = useState(null)\r\n-\r\n-  // Define sections for each page\r\n-  const homeSections = [\r\n-    { \r\n-      key: \"giftCategories\", \r\n-      label: \"Gift Categories\", \r\n-      description: \"Display category grid with gifts\",\r\n-      order: 1,\r\n-      hasConfig: true\r\n-    },\r\n-    { \r\n-      key: \"slider\", \r\n-      label: \"Main Slider\", \r\n-      description: \"Hero banner with promotional slides\",\r\n-      order: 2\r\n-    },\r\n-    { \r\n-      key: \"services\", \r\n-      label: \"Services Section\", \r\n-      description: \"Highlight key services and benefits\",\r\n-      order: 3\r\n-    },\r\n-    { \r\n-      key: \"products\", \r\n-      label: \"Featured Products\", \r\n-      description: \"Showcase featured/trending products\",\r\n-      order: 4\r\n-    },\r\n-    { \r\n-      key: \"banner\", \r\n-      label: \"Promotional Banner\", \r\n-      description: \"Secondary promotional content\",\r\n-      order: 5\r\n-    },\r\n-    { \r\n-      key: \"dealProduct\", \r\n-      label: \"Deal Products\", \r\n-      description: \"Special offers and discounted items\",\r\n-      order: 6\r\n-    }\r\n-  ]\r\n-\r\n-  const corporateSections = [\r\n-    { \r\n-      key: \"corporateBanner\", \r\n-      label: \"Corporate Banner\", \r\n-      description: \"Hero section for corporate clients\",\r\n-      order: 1\r\n-    },\r\n-    { \r\n-      key: \"corporateServices\", \r\n-      label: \"Corporate Services\", \r\n-      description: \"B2B services and solutions\",\r\n-      order: 2\r\n-    },\r\n-    { \r\n-      key: \"corporateTestimonials\", \r\n-      label: \"Client Testimonials\", \r\n-      description: \"Corporate client reviews and case studies\",\r\n-      order: 3\r\n-    },\r\n-    { \r\n-      key: \"corporatePartners\", \r\n-      label: \"Partner Logos\", \r\n-      description: \"Display trusted corporate partners\",\r\n-      order: 4\r\n-    }\r\n-  ]\r\n-\r\n-  // Section visibility state\r\n-  const [visibleSections, setVisibleSections] = useState({\r\n-    home: {\r\n-      giftCategories: true,\r\n-      slider: true,\r\n-      services: true,\r\n-      products: true,\r\n-      banner: true,\r\n-      dealProduct: true,\r\n-    },\r\n-    corporate: {\r\n-      corporateBanner: true,\r\n-      corporateServices: true,\r\n-      corporateTestimonials: false,\r\n-      corporatePartners: false,\r\n-    },\r\n-  })\r\n-\r\n-  // Hardcoded admin token for testing\r\n-  const ADMIN_TOKEN = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY4NzZhYTJmYzc3YWY4ODU3Njk1ZDA5MiIsInJvbGUiOiJhZG1pbiIsImlhdCI6MTc1MzI4MTMyMCwiZXhwIjoxNzUzODg2MTIwfQ.3wEx7ZCDvYtUQppFM9CcXjhG1zTQX9_RYY_dy3Y6MZs'\r\n-\r\n-  // ========== HIERARCHICAL DATA MANAGEMENT HELPERS ==========\r\n-  \r\n-  // Get current counts for validation\r\n-  // ...existing code around line 130...\r\n-\r\n-// Get current counts for validation\r\n-const getCurrentCounts = () => {\r\n-  // FIXED: Add safety checks for undefined categoryIds\r\n-  const safeCategories = categoryConfig.categories || []\r\n-  const safeCategoryIds = categoryConfig.categoryIds || []\r\n-  \r\n-  // Handle both old array structure and new object structure\r\n-  let mainCategoriesCount = 0\r\n-  let totalSubcategoriesCount = 0\r\n-  let selectedCategorySubCount = 0\r\n-  const subcategoryCounts = {}\r\n-  \r\n-  if (Array.isArray(safeCategories) && safeCategories.length > 0) {\r\n-    // Old structure: array of category objects\r\n-    mainCategoriesCount = safeCategories.filter(cat => cat.enabled).length\r\n-    \r\n-    safeCategories.forEach(category => {\r\n-      const subCount = category.subcategories ? category.subcategories.filter(sub => sub.enabled).length : 0\r\n-      subcategoryCounts[category.categoryId] = subCount\r\n-      totalSubcategoriesCount += subCount\r\n-      \r\n-      // Get subcategory count for currently selected main category\r\n-      if (selectedMainCategory && category.categoryId === selectedMainCategory) {\r\n-        selectedCategorySubCount = subCount\r\n-      }\r\n-    })\r\n-  } else {\r\n-    // Fallback: use categoryIds for backward compatibility\r\n-    if (availableCategories.length > 0 && safeCategoryIds.length > 0) {\r\n-      mainCategoriesCount = safeCategoryIds.filter(id => \r\n-        availableCategories.some(cat => cat.id === id && !cat.parent)\r\n-      ).length\r\n-      \r\n-      totalSubcategoriesCount = safeCategoryIds.filter(id => \r\n-        subcategories.some(sub => sub.id === id)\r\n-      ).length\r\n-        \r\n-      selectedCategorySubCount = selectedMainCategory && safeCategoryIds ? \r\n-        safeCategoryIds.filter(id => \r\n-          subcategories.some(sub => sub.id === id && \r\n-            (sub.parent?._id === selectedMainCategory || sub.parent === selectedMainCategory)\r\n-          )\r\n-        ).length : 0\r\n-    }\r\n-  }\r\n-  \r\n-  return { \r\n-    mainCategoriesCount, \r\n-    subcategoryCounts, \r\n-    totalSubcategoriesCount,\r\n-    selectedCategorySubCount \r\n-  }\r\n-}\r\n-\r\n-  // Check if we can select more main categories\r\n-  const canSelectMoreMainCategories = () => {\r\n-    const { mainCategoriesCount } = getCurrentCounts()\r\n-    return mainCategoriesCount < MAX_MAIN_CATEGORIES\r\n-  }\r\n-\r\n-  // Check if we can select more subcategories for a specific category\r\n-  const canSelectMoreSubcategories = (categoryId) => {\r\n-    const { subcategoryCounts } = getCurrentCounts()\r\n-    const currentCount = subcategoryCounts[categoryId] || 0\r\n-    return currentCount < MAX_SUBCATEGORIES_PER_CATEGORY\r\n-  }\r\n-\r\n-  // Check if a main category is selected\r\n-  // ...existing code around line 190...\r\n-\r\n-// Check if a main category is selected\r\n-const isMainCategorySelected = (categoryId) => {\r\n-  // FIXED: Add safety check for undefined categoryIds\r\n-  const safeCategoryIds = categoryConfig.categoryIds || []\r\n-  \r\n-  if (Array.isArray(categoryConfig.categories)) {\r\n-    // Old structure\r\n-    const category = categoryConfig.categories.find(cat => cat.categoryId === categoryId)\r\n-    return category ? category.enabled : false\r\n-  } else if (typeof categoryConfig.categories === 'object') {\r\n-    // New structure\r\n-    return categoryConfig.categories[categoryId]?.selected || false\r\n-  } else {\r\n-    // Fallback\r\n-    return safeCategoryIds.includes(categoryId)\r\n-  }\r\n-}\r\n-\r\n-// Check if a subcategory is selected\r\n-const isSubcategorySelected = (subcategoryId, parentCategoryId = null) => {\r\n-  // FIXED: Add safety check for undefined categoryIds\r\n-  const safeCategoryIds = categoryConfig.categoryIds || []\r\n-  \r\n-  if (Array.isArray(categoryConfig.categories)) {\r\n-    // Old structure\r\n-    return categoryConfig.categories.some(category => \r\n-      category.subcategories && category.subcategories.some(sub => sub.categoryId === subcategoryId && sub.enabled)\r\n-    )\r\n-  } else if (typeof categoryConfig.categories === 'object' && parentCategoryId) {\r\n-    // New structure\r\n-    return categoryConfig.categories[parentCategoryId]?.subcategories?.[subcategoryId]?.selected || false\r\n-  } else {\r\n-    // Fallback\r\n-    return safeCategoryIds.includes(subcategoryId)\r\n-  }\r\n-}\r\n-\r\n-  // Find which main category a subcategory belongs to\r\n-  const findParentCategory = (subcategoryId) => {\r\n-    const subcategory = subcategories.find(sub => sub.id === subcategoryId)\r\n-    return subcategory?.parent?._id || subcategory?.parent\r\n-  }\r\n-\r\n-  // Update hierarchical category selection\r\n-  // Function removed - using simpler handleCategoryToggle approach\r\n-\r\n-  // Transform hierarchical data for backend save - FIXED to only use selected categories\r\n-  const transformForSave = () => {\r\n-    console.log('🔄 === TRANSFORM FOR SAVE START ===')\r\n-    console.log('1. Input categoryConfig:', categoryConfig)\r\n-    console.log('   - categoryConfig.categoryIds (SELECTED):', categoryConfig.categoryIds)\r\n-    \r\n-    const saveData = {\r\n-      enabled: categoryConfig.enabled,\r\n-      maxCategories: categoryConfig.maxCategories,\r\n-      layout: categoryConfig.layout,\r\n-      showSubcategories: categoryConfig.showSubcategories,\r\n-      categories: []\r\n-    }\r\n-    \r\n-    console.log('2. Base saveData structure:', saveData)\r\n-    \r\n-    // 🎯 ONLY process the categoryIds that are actually selected by the user\r\n-    console.log('3. Processing ONLY selected categoryIds...')\r\n-    console.log('   - Selected categoryIds:', categoryConfig.categoryIds)\r\n-    console.log('   - Total selected:', categoryConfig.categoryIds.length)\r\n-    \r\n-    if (categoryConfig.categoryIds && categoryConfig.categoryIds.length > 0) {\r\n-      categoryConfig.categoryIds.forEach((categoryId, index) => {\r\n-        console.log(`   - Processing selected categoryId ${index + 1}:`, categoryId)\r\n-        \r\n-        // Check if it's a main category\r\n-        const mainCategory = availableCategories.find(cat => cat.id === categoryId && !cat.parent)\r\n-        if (mainCategory) {\r\n-          console.log(`     ✅ Found main category:`, mainCategory.name)\r\n-          saveData.categories.push({\r\n-            categoryId: categoryId,\r\n-            enabled: true,\r\n-            order: index\r\n-          })\r\n-        }\r\n-        \r\n-        // Check if it's a subcategory\r\n-        const subcategory = subcategories.find(sub => sub.id === categoryId)\r\n-        if (subcategory) {\r\n-          const parentId = subcategory.parent?._id || subcategory.parent\r\n-          console.log(`     ✅ Found subcategory:`, subcategory.name, 'parent:', parentId)\r\n-          saveData.categories.push({\r\n-            categoryId: categoryId,\r\n-            enabled: true,\r\n-            order: index\r\n-          })\r\n-        }\r\n-        \r\n-        if (!mainCategory && !subcategory) {\r\n-          console.log(`     ❌ Category ID not found:`, categoryId)\r\n-        }\r\n-      })\r\n-    } else {\r\n-      console.log('   - No categories selected')\r\n-    }\r\n-    \r\n-    console.log('4. Final saveData categories:', saveData.categories)\r\n-    console.log('🔚 === TRANSFORM FOR SAVE END ===')\r\n-    \r\n-    return saveData\r\n-  }\r\n-\r\n-  // Load page configuration\r\n-  // ...existing code around line 380...\r\n-\r\n-// Load page configuration\r\n-const loadPageConfig = async (pageKey) => {\r\n-  try {\r\n-    setLoading(true)\r\n-    localStorage.setItem('authToken', ADMIN_TOKEN)\r\n-    \r\n-    const response = await get(`/pages/${pageKey}`)\r\n-    console.log('Page config response:', response)\r\n-    \r\n-    // Handle the double-wrapped response from apiService\r\n-    const actualData = response.data // This contains the backend response\r\n-    \r\n-    if (actualData && actualData.success) {\r\n-      setPageConfig(actualData.data)\r\n-      \r\n-      // Extract category section config\r\n-      const categorySection = actualData.data.sections.find(s => s.sectionType === 'categorySection')\r\n-      if (categorySection && categorySection.config) {\r\n-        // FIXED: Properly extract categoryIds and convert to flat structure\r\n-        const savedCategories = categorySection.config.categories || []\r\n-        const categoryIds = savedCategories.map(cat => cat.categoryId).filter(Boolean)\r\n-        \r\n-        setCategoryConfig({\r\n-          enabled: categorySection.enabled || false,\r\n-          maxCategories: categorySection.config.maxCategories || 10,\r\n-          layout: categorySection.config.layout || 'grid',\r\n-          showSubcategories: categorySection.config.showSubcategories || true,\r\n-          categories: savedCategories, // Keep the hierarchical structure\r\n-          categoryIds: categoryIds || [] // FIXED: Ensure this is always an array\r\n-        })\r\n-        \r\n-        console.log('📂 Loaded category config with categoryIds:', categoryIds)\r\n-        \r\n-        // Update visibility state\r\n-        setVisibleSections(prev => ({\r\n-          ...prev,\r\n-          [pageKey]: {\r\n-            ...prev[pageKey],\r\n-            giftCategories: categorySection.enabled\r\n-          }\r\n-        }))\r\n-      } else {\r\n-        // FIXED: Initialize with empty arrays when no config exists\r\n-        setCategoryConfig({\r\n-          enabled: false,\r\n-          maxCategories: 10,\r\n-          layout: 'grid',\r\n-          showSubcategories: true,\r\n-          categories: [],\r\n-          categoryIds: [] // FIXED: Ensure this is always an array\r\n-        })\r\n-      }\r\n-    }\r\n-    \r\n-    setError('')\r\n-  } catch (err) {\r\n-    console.error('Load page config error:', err)\r\n-    setError('Failed to load page configuration: ' + err.message)\r\n-    \r\n-    // FIXED: Set default config on error to prevent undefined\r\n-    setCategoryConfig({\r\n-      enabled: false,\r\n-      maxCategories: 10,\r\n-      layout: 'grid',\r\n-      showSubcategories: true,\r\n-      categories: [],\r\n-      categoryIds: [] // FIXED: Ensure this is always an array\r\n-    })\r\n-  } finally {\r\n-    setLoading(false)\r\n-  }\r\n-}\r\n-\r\n-  // Load available categories (same approach as CategoriesPage.js)\r\n-  const loadCategories = async () => {\r\n-    try {\r\n-      console.log('🔄 === LOADING CATEGORIES DEBUG ===')\r\n-      console.log('1. Setting auth token...')\r\n-      localStorage.setItem('authToken', ADMIN_TOKEN)\r\n-      \r\n-      console.log('2. Making API call to:', CATEGORY.GET_ALL)\r\n-      const response = await get(CATEGORY.GET_ALL)\r\n-      \r\n-      console.log('3. Raw API response received:')\r\n-      console.log('   - Response object:', response)\r\n-      console.log('   - Response type:', typeof response)\r\n-      console.log('   - Response keys:', Object.keys(response || {}))\r\n-      console.log('   - Response.success:', response?.success)\r\n-      console.log('   - Response.data:', response?.data)\r\n-      console.log('   - Response.data type:', typeof response?.data)\r\n-      console.log('   - Response.data is array:', Array.isArray(response?.data))\r\n-      \r\n-      if (!response.success) {\r\n-        console.error('4. ❌ API response failed:', response.error)\r\n-        throw new Error(response.error || 'Failed to fetch categories')\r\n-      }\r\n-      \r\n-      console.log('4. ✅ API response successful')\r\n-      console.log('5. Processing response.data...')\r\n-      console.log('   - Raw response.data:', JSON.stringify(response.data, null, 2))\r\n-      \r\n-      // Ensure response.data is an array\r\n-      let categoriesData = []\r\n-      if (Array.isArray(response.data)) {\r\n-        console.log('   - Response.data is direct array with', response.data.length, 'items')\r\n-        categoriesData = response.data\r\n-      } else if (response.data && typeof response.data === 'object') {\r\n-        console.log('   - Response.data is object, checking for nested arrays...')\r\n-        if (Array.isArray(response.data.categories)) {\r\n-          console.log('   - Found response.data.categories array with', response.data.categories.length, 'items')\r\n-          categoriesData = response.data.categories\r\n-        } else if (Array.isArray(response.data.data)) {\r\n-          console.log('   - Found response.data.data array with', response.data.data.length, 'items')\r\n-          categoriesData = response.data.data\r\n-        } else {\r\n-          console.log('   - No recognizable array found in response.data')\r\n-          categoriesData = []\r\n-        }\r\n-      }\r\n-      \r\n-      console.log('6. Categories data to process:')\r\n-      console.log('   - Array length:', categoriesData.length)\r\n-      console.log('   - Sample items (first 3):')\r\n-      categoriesData.slice(0, 3).forEach((cat, index) => {\r\n-        console.log(`     ${index + 1}.`, cat)\r\n-      })\r\n-      \r\n-      // Transform categories for display in the admin panel\r\n-      console.log('7. Transforming categories...')\r\n-      const transformedCategories = categoriesData.map((cat, index) => {\r\n-        console.log(`   - Transforming category ${index + 1}:`, {\r\n-          originalId: cat._id,\r\n-          originalName: cat.name,\r\n-          hasParent: !!cat.parent,\r\n-          parentInfo: cat.parent\r\n-        })\r\n-        \r\n-        return {\r\n-          id: cat.id || cat._id,\r\n-          value: cat.id || cat._id,\r\n-          label: cat.name,\r\n-          name: cat.name,\r\n-          image: cat.image?.url || '/assets/img/product/category/default-category.svg',\r\n-          description: cat.description || '',\r\n-          parent: cat.parent\r\n-        }\r\n-      })\r\n-      \r\n-      console.log('8. Final transformed categories:')\r\n-      console.log('   - Total transformed:', transformedCategories.length)\r\n-      console.log('   - Main categories:', transformedCategories.filter(cat => !cat.parent).length)\r\n-      console.log('   - Sub categories:', transformedCategories.filter(cat => cat.parent).length)\r\n-      console.log('   - Full transformed data:', transformedCategories)\r\n-      \r\n-      console.log('9. Setting availableCategories state...')\r\n-      setAvailableCategories(transformedCategories)\r\n-      setError('')\r\n-      \r\n-      console.log('10. ✅ Categories loaded successfully!')\r\n-      console.log('🔚 === END LOADING CATEGORIES DEBUG ===')\r\n-      \r\n-    } catch (err) {\r\n-      console.error('❌ === LOAD CATEGORIES ERROR ===')\r\n-      console.error('Error details:', {\r\n-        message: err.message,\r\n-        stack: err.stack,\r\n-        name: err.name\r\n-      })\r\n-      console.error('Raw error object:', err)\r\n-      setError('Failed to load categories: ' + err.message)\r\n-      setAvailableCategories([])\r\n-    }\r\n-  }\r\n-\r\n-  // Load subcategories from separate subcategories collection\r\n-  const loadSubcategories = async () => {\r\n-    try {\r\n-      console.log('🔄 === LOADING SUBCATEGORIES DEBUG ===')\r\n-      console.log('1. Setting auth token...')\r\n-      localStorage.setItem('authToken', ADMIN_TOKEN)\r\n-      \r\n-      console.log('2. Making API call to:', SUBCATEGORY.GET_ALL)\r\n-      const response = await get(SUBCATEGORY.GET_ALL)\r\n-      \r\n-      console.log('3. Raw subcategories response:')\r\n-      console.log('   - Response object:', response)\r\n-      console.log('   - Response.success:', response?.success)\r\n-      console.log('   - Response.data:', response?.data)\r\n-      console.log('   - Response.data is array:', Array.isArray(response?.data))\r\n-      \r\n-      if (!response.success) {\r\n-        console.error('4. ❌ Subcategories API response failed:', response.error)\r\n-        throw new Error(response.error || 'Failed to fetch subcategories')\r\n-      }\r\n-      \r\n-      console.log('4. ✅ Subcategories API response successful')\r\n-      console.log('5. Processing subcategories data...')\r\n-      \r\n-      let subcategoriesData = []\r\n-      if (Array.isArray(response.data)) {\r\n-        subcategoriesData = response.data\r\n-      } else if (response.data && Array.isArray(response.data.data)) {\r\n-        subcategoriesData = response.data.data\r\n-      }\r\n-      \r\n-      console.log('6. Subcategories data to process:')\r\n-      console.log('   - Array length:', subcategoriesData.length)\r\n-      console.log('   - Sample items (first 3):')\r\n-      subcategoriesData.slice(0, 3).forEach((subcat, index) => {\r\n-        console.log(`     ${index + 1}.`, {\r\n-          id: subcat._id,\r\n-          name: subcat.name,\r\n-          parent: subcat.parent,\r\n-          status: subcat.status\r\n-        })\r\n-      })\r\n-      \r\n-      // Transform subcategories for display\r\n-      const transformedSubcategories = subcategoriesData.map((subcat, index) => {\r\n-        console.log(`   - Transforming subcategory ${index + 1}:`, {\r\n-          originalId: subcat._id,\r\n-          originalName: subcat.name,\r\n-          parentId: subcat.parent?._id || subcat.parent,\r\n-          parentName: subcat.parent?.name\r\n-        })\r\n-        \r\n-        return {\r\n-          id: subcat.id || subcat._id,\r\n-          value: subcat.id || subcat._id,\r\n-          label: subcat.name,\r\n-          name: subcat.name,\r\n-          image: subcat.image?.url || '/assets/img/product/category/default-subcategory.svg',\r\n-          description: subcat.description || '',\r\n-          parent: subcat.parent,\r\n-          status: subcat.status\r\n-        }\r\n-      })\r\n-      \r\n-      console.log('7. Final transformed subcategories:')\r\n-      console.log('   - Total transformed:', transformedSubcategories.length)\r\n-      console.log('   - Full transformed data:', transformedSubcategories)\r\n-      \r\n-      console.log('8. Setting subcategories state...')\r\n-      setSubcategories(transformedSubcategories)\r\n-      \r\n-      console.log('9. ✅ Subcategories loaded successfully!')\r\n-      console.log('🔚 === END LOADING SUBCATEGORIES DEBUG ===')\r\n-      \r\n-    } catch (err) {\r\n-      console.error('❌ === LOAD SUBCATEGORIES ERROR ===')\r\n-      console.error('Error details:', {\r\n-        message: err.message,\r\n-        stack: err.stack,\r\n-        name: err.name\r\n-      })\r\n-      setSubcategories([])\r\n-    }\r\n-  }\r\n-\r\n-  // Save category section configuration\r\n-  const saveCategoryConfig = async () => {\r\n-    console.log('🚀 === SAVE CATEGORY CONFIG START ===')\r\n-    console.log('1. Save function triggered')\r\n-    \r\n-    try {\r\n-      console.log('2. Setting loading state to true')\r\n-      setLoading(true)\r\n-      \r\n-      console.log('3. Setting auth token in localStorage')\r\n-      localStorage.setItem('authToken', ADMIN_TOKEN)\r\n-      console.log('   - Auth token set:', ADMIN_TOKEN.substring(0, 20) + '...')\r\n-      \r\n-      console.log('4. Getting current counts for validation')\r\n-      const { mainCategoriesCount } = getCurrentCounts()\r\n-      console.log('   - Main categories count:', mainCategoriesCount)\r\n-      console.log('   - MIN_MAIN_CATEGORIES:', MIN_MAIN_CATEGORIES)\r\n-      console.log('   - MAX_MAIN_CATEGORIES:', MAX_MAIN_CATEGORIES)\r\n-      \r\n-      if (mainCategoriesCount < MIN_MAIN_CATEGORIES) {\r\n-        console.log('❌ Validation failed: Too few main categories')\r\n-        setError(`Please select at least ${MIN_MAIN_CATEGORIES} main category before saving.`)\r\n-        return\r\n-      }\r\n-      \r\n-      if (mainCategoriesCount > MAX_MAIN_CATEGORIES) {\r\n-        console.log('❌ Validation failed: Too many main categories')\r\n-        setError(`Too many main categories selected. Maximum ${MAX_MAIN_CATEGORIES} allowed.`)\r\n-        return\r\n-      }\r\n-      \r\n-      console.log('✅ Validation passed')\r\n-      \r\n-      console.log('5. Current categoryConfig state before transform:')\r\n-      console.log('   - categoryConfig.enabled:', categoryConfig.enabled)\r\n-      console.log('   - categoryConfig.maxCategories:', categoryConfig.maxCategories)\r\n-      console.log('   - categoryConfig.layout:', categoryConfig.layout)\r\n-      console.log('   - categoryConfig.showSubcategories:', categoryConfig.showSubcategories)\r\n-      console.log('   - categoryConfig.categories:', categoryConfig.categories)\r\n-      console.log('   - categoryConfig.categoryIds:', categoryConfig.categoryIds)\r\n-      \r\n-      // Transform hierarchical data for save\r\n-      console.log('6. Transforming data for save...')\r\n-      const configData = transformForSave()\r\n-      console.log('7. Transformed config data:')\r\n-      console.log('   - Full configData object:', JSON.stringify(configData, null, 2))\r\n-      console.log('   - configData.enabled:', configData.enabled)\r\n-      console.log('   - configData.categories length:', configData.categories?.length || 0)\r\n-      \r\n-      console.log('8. Preparing API request')\r\n-      const apiEndpoint = '/pages/home/sections/category'\r\n-      console.log('   - API endpoint:', apiEndpoint)\r\n-      console.log('   - Request method: PUT')\r\n-      console.log('   - Request data:', configData)\r\n-      console.log('   - Request headers will include auth token')\r\n-      \r\n-      console.log('9. Making API request...')\r\n-      const response = await put(apiEndpoint, configData)\r\n-      console.log('10. API response received:')\r\n-      console.log('    - Raw response:', response)\r\n-      console.log('    - Response type:', typeof response)\r\n-      console.log('    - Response keys:', Object.keys(response || {}))\r\n-      console.log('    - Response.data:', response?.data)\r\n-      console.log('    - Response.status:', response?.status)\r\n-      console.log('    - Response.success:', response?.success)\r\n-      \r\n-      // Handle the double-wrapped response from apiService\r\n-      console.log('11. Processing response data...')\r\n-      const actualData = response.data // This contains the backend response\r\n-      console.log('    - actualData:', actualData)\r\n-      console.log('    - actualData type:', typeof actualData)\r\n-      console.log('    - actualData.success:', actualData?.success)\r\n-      console.log('    - actualData.message:', actualData?.message)\r\n-      \r\n-      if (actualData && actualData.success) {\r\n-        console.log('✅ Save successful!')\r\n-        setSuccess('Category section configuration saved successfully!')\r\n-        setTimeout(() => setSuccess(''), 3000)\r\n-        setShowCategoryConfig(false)\r\n-        \r\n-        // Trigger refresh notification (optional)\r\n-        try {\r\n-          console.log('12. Triggering homepage refresh...')\r\n-          await get('/api/pages/home/refresh/categorySection')\r\n-          console.log('    - Homepage refresh successful')\r\n-        } catch (refreshError) {\r\n-          console.log('⚠️ Refresh notification failed, but save was successful:', refreshError)\r\n-        }\r\n-        \r\n-        console.log('13. Reloading page config...')\r\n-        await loadPageConfig(selectedPage) // Reload to get updated config\r\n-        console.log('14. Page config reloaded')\r\n-      } else {\r\n-        console.log('❌ Save failed - API returned unsuccessful response')\r\n-        console.log('    - actualData:', actualData)\r\n-        const errorMessage = actualData?.message || 'Unknown error'\r\n-        console.log('    - Error message:', errorMessage)\r\n-        setError('Failed to save configuration: ' + errorMessage)\r\n-      }\r\n-      \r\n-    } catch (err) {\r\n-      console.error('❌ === SAVE CATEGORY CONFIG ERROR ===')\r\n-      console.error('Error caught in try-catch:')\r\n-      console.error('   - Error object:', err)\r\n-      console.error('   - Error message:', err.message)\r\n-      console.error('   - Error name:', err.name)\r\n-      console.error('   - Error stack:', err.stack)\r\n-      \r\n-      if (err.response) {\r\n-        console.error('   - HTTP Response Error Details:')\r\n-        console.error('     - Status:', err.response.status)\r\n-        console.error('     - Status text:', err.response.statusText)\r\n-        console.error('     - Response data:', err.response.data)\r\n-        console.error('     - Response headers:', err.response.headers)\r\n-      }\r\n-      \r\n-      if (err.request) {\r\n-        console.error('   - Request Error Details:')\r\n-        console.error('     - Request object:', err.request)\r\n-      }\r\n-      \r\n-      setError('Failed to save category configuration: ' + err.message)\r\n-    } finally {\r\n-      console.log('15. Setting loading state to false')\r\n-      setLoading(false)\r\n-      console.log('🔚 === SAVE CATEGORY CONFIG END ===')\r\n-    }\r\n-  }\r\n-\r\n-  // Toggle section visibility\r\n-  const handleToggleSection = async (page, section) => {\r\n-    if (section === 'giftCategories') {\r\n-      // For category section, update the actual config\r\n-      setCategoryConfig(prev => ({ ...prev, enabled: !prev.enabled }))\r\n-      return\r\n-    }\r\n-    \r\n-    const newVisibility = {\r\n-      ...visibleSections,\r\n-      [page]: {\r\n-        ...visibleSections[page],\r\n-        [section]: !visibleSections[page][section],\r\n-      }\r\n-    }\r\n-    \r\n-    setVisibleSections(newVisibility)\r\n-  }\r\n-\r\n-  // Open category configuration modal\r\n-  const openCategoryConfig = () => {\r\n-    setShowCategoryConfig(true)\r\n-    // Reset to first main category when opening modal\r\n-    const mainCategories = availableCategories.filter(cat => !cat.parent)\r\n-    if (mainCategories.length > 0) {\r\n-      setSelectedMainCategory(mainCategories[0].id)\r\n-    }\r\n-  }\r\n-\r\n-  // Handle category selection with validation - SIMPLIFIED for current structure\r\n-  const handleCategoryToggle = (categoryId, parentCategoryId = null) => {\r\n-    const isMainCategory = !parentCategoryId && availableCategories.some(cat => cat.id === categoryId && !cat.parent)\r\n-    \r\n-    console.log('🎯 Category toggle triggered:', { categoryId, parentCategoryId, isMainCategory })\r\n-    \r\n-    if (isMainCategory) {\r\n-      const isCurrentlySelected = categoryConfig.categoryIds.includes(categoryId)\r\n-      const currentMainCount = categoryConfig.categoryIds.filter(id => \r\n-        availableCategories.some(cat => cat.id === id && !cat.parent)\r\n-      ).length\r\n-      \r\n-      console.log('📊 Main category status:', { isCurrentlySelected, currentCount: currentMainCount })\r\n-      \r\n-      // Validation for main categories\r\n-      if (!isCurrentlySelected) {\r\n-        // Trying to select\r\n-        if (currentMainCount >= MAX_MAIN_CATEGORIES) {\r\n-          setError(`Cannot select more main categories. Maximum ${MAX_MAIN_CATEGORIES} allowed.`)\r\n-          return\r\n-        }\r\n-      } else {\r\n-        // Trying to deselect\r\n-        if (currentMainCount <= MIN_MAIN_CATEGORIES) {\r\n-          setError(`Cannot deselect this category. At least ${MIN_MAIN_CATEGORIES} main category must be selected.`)\r\n-          return\r\n-        }\r\n-      }\r\n-      \r\n-      // Clear any existing errors\r\n-      setError('')\r\n-      \r\n-      // 🎯 Update categoryIds array with actual selections\r\n-      setCategoryConfig(prev => {\r\n-        let newCategoryIds = [...prev.categoryIds]\r\n-        \r\n-        if (!isCurrentlySelected) {\r\n-          // Add to selection\r\n-          console.log('✅ Adding main category to selection:', categoryId)\r\n-          newCategoryIds.push(categoryId)\r\n-        } else {\r\n-          // Remove from selection (and remove all its subcategories too)\r\n-          const subcategoriesOfThisCategory = subcategories\r\n-            .filter(sub => (sub.parent?._id || sub.parent) === categoryId)\r\n-            .map(sub => sub.id)\r\n-          \r\n-          console.log('❌ Removing main category and its subcategories:', {\r\n-            mainCategory: categoryId,\r\n-            subcategories: subcategoriesOfThisCategory\r\n-          })\r\n-          \r\n-          newCategoryIds = newCategoryIds.filter(id => \r\n-            id !== categoryId && !subcategoriesOfThisCategory.includes(id)\r\n-          )\r\n-        }\r\n-        \r\n-        console.log('📝 Updated categoryIds:', newCategoryIds)\r\n-        \r\n-        return {\r\n-          ...prev,\r\n-          categoryIds: newCategoryIds\r\n-        }\r\n-      })\r\n-      \r\n-    } else {\r\n-      // Subcategory logic\r\n-      const isCurrentlySelected = categoryConfig.categoryIds.includes(categoryId)\r\n-      const parentId = parentCategoryId || findParentCategory(categoryId)\r\n-      \r\n-      console.log('📊 Subcategory status:', { isCurrentlySelected, parentId })\r\n-      \r\n-      if (!isCurrentlySelected && parentId) {\r\n-        // Check subcategory limit for this parent\r\n-        const currentSubCount = categoryConfig.categoryIds.filter(id => \r\n-          subcategories.some(sub => sub.id === id && (sub.parent?._id || sub.parent) === parentId)\r\n-        ).length\r\n-        \r\n-        if (currentSubCount >= MAX_SUBCATEGORIES_PER_CATEGORY) {\r\n-          const parentName = availableCategories.find(cat => cat.id === parentId)?.name || 'this category'\r\n-          setError(`Cannot select more subcategories for ${parentName}. Maximum ${MAX_SUBCATEGORIES_PER_CATEGORY} per category allowed.`)\r\n-          return\r\n-        }\r\n-      }\r\n-      \r\n-      // Clear any existing errors\r\n-      setError('')\r\n-      \r\n-      // 🎯 Update categoryIds array for subcategory\r\n-      setCategoryConfig(prev => {\r\n-        let newCategoryIds = [...prev.categoryIds]\r\n-        \r\n-        if (!isCurrentlySelected) {\r\n-          // Add subcategory to selection\r\n-          console.log('✅ Adding subcategory to selection:', categoryId)\r\n-          newCategoryIds.push(categoryId)\r\n-          \r\n-          // Also ensure parent is selected\r\n-          if (parentId && !newCategoryIds.includes(parentId)) {\r\n-            console.log('✅ Auto-adding parent category:', parentId)\r\n-            newCategoryIds.push(parentId)\r\n-          }\r\n-        } else {\r\n-          // Remove subcategory from selection\r\n-          console.log('❌ Removing subcategory from selection:', categoryId)\r\n-          newCategoryIds = newCategoryIds.filter(id => id !== categoryId)\r\n-        }\r\n-        \r\n-        console.log('📝 Updated categoryIds:', newCategoryIds)\r\n-        \r\n-        return {\r\n-          ...prev,\r\n-          categoryIds: newCategoryIds\r\n-        }\r\n-      })\r\n-    }\r\n-  }\r\n-\r\n-  // Handle max categories change\r\n-  const handleMaxCategoriesChange = (value) => {\r\n-    const numValue = parseInt(value) || 0\r\n-    setCategoryConfig(prev => ({ ...prev, maxCategories: numValue }))\r\n-  }\r\n-\r\n-  // Load data when page changes\r\n-  useEffect(() => {\r\n-    const loadData = async () => {\r\n-      await loadPageConfig(selectedPage)\r\n-      await loadCategories()\r\n-      await loadSubcategories()\r\n-    }\r\n-    loadData()\r\n-  }, [selectedPage])\r\n-\r\n-  // Get sections for current page\r\n-  const getCurrentSections = () => {\r\n-    return selectedPage === \"home\" ? homeSections : corporateSections\r\n-  }\r\n-\r\n-  // Render category configuration modal\r\n-  const renderCategoryConfigModal = () => {\r\n-    if (!showCategoryConfig) return null\r\n-\r\n-    console.log('🎨 === RENDERING CATEGORY MODAL DEBUG ===')\r\n-    console.log('1. Modal render triggered')\r\n-    console.log('2. availableCategories state:')\r\n-    console.log('   - Length:', availableCategories.length)\r\n-    console.log('   - Is array:', Array.isArray(availableCategories))\r\n-    console.log('   - Full data:', availableCategories)\r\n-    \r\n-    const mainCategories = availableCategories.filter(cat => !cat.parent)\r\n-    const subCategories = subcategories // Use the separate subcategories state\r\n-    \r\n-    console.log('3. Category breakdown:')\r\n-    console.log('   - Main categories:', mainCategories.length, mainCategories)\r\n-    console.log('   - Sub categories:', subCategories.length, subCategories)\r\n-    \r\n-    // Get subcategories for selected main category\r\n-    const getSubcategoriesForCategory = (categoryId) => {\r\n-      console.log('🔍 Getting subcategories for category ID:', categoryId)\r\n-      const filtered = subCategories.filter(subCat => {\r\n-        const parentId = subCat.parent?._id || subCat.parent\r\n-        console.log(`   - Checking subcategory \"${subCat.name}\": parent=${parentId}, matches=${parentId === categoryId}`)\r\n-        return parentId === categoryId\r\n-      })\r\n-      console.log(`   - Found ${filtered.length} subcategories for category ${categoryId}:`, filtered)\r\n-      return filtered\r\n-    }\r\n-\r\n-    // Auto-select first main category if none selected\r\n-    if (!selectedMainCategory && mainCategories.length > 0) {\r\n-      setSelectedMainCategory(mainCategories[0].id)\r\n-    }\r\n-\r\n-    const selectedCategorySubcategories = selectedMainCategory ? \r\n-      getSubcategoriesForCategory(selectedMainCategory) : []\r\n-\r\n-    return (\r\n-      <div className=\"modal show d-block\" style={{ backgroundColor: 'rgba(0,0,0,0.5)' }}>\r\n-        <div className=\"modal-dialog modal-xl\">\r\n-          <div className=\"modal-content\">\r\n-            <div className=\"modal-header\">\r\n-              <h5 className=\"modal-title\">\r\n-                <i className=\"bi bi-grid-3x3-gap me-2\"></i>\r\n-                Category Section Configuration\r\n-              </h5>\r\n-              <button \r\n-                type=\"button\" \r\n-                className=\"btn-close\" \r\n-                onClick={() => setShowCategoryConfig(false)}\r\n-              ></button>\r\n-            </div>\r\n-            <div className=\"modal-body\">\r\n-              {/* Enable/Disable Section */}\r\n-              <div className=\"row mb-4\">\r\n-                <div className=\"col-12\">\r\n-                  <div className=\"form-check form-switch\">\r\n-                    <input \r\n-                      className=\"form-check-input\" \r\n-                      type=\"checkbox\" \r\n-                      id=\"enableCategorySection\"\r\n-                      checked={categoryConfig.enabled}\r\n-                      onChange={(e) => setCategoryConfig(prev => ({ ...prev, enabled: e.target.checked }))}\r\n-                    />\r\n-                    <label className=\"form-check-label fw-semibold\" htmlFor=\"enableCategorySection\">\r\n-                      Enable Category Section\r\n-                    </label>\r\n-                  </div>\r\n-                  <small className=\"text-muted\">Turn on/off the category section on the homepage</small>\r\n-                </div>\r\n-              </div>\r\n-\r\n-              {categoryConfig.enabled && (\r\n-                <>\r\n-                  {/* Selection Summary and Validation */}\r\n-                  <div className=\"row mb-4\">\r\n-                    <div className=\"col-12\">\r\n-                      <div className=\"card border-info\">\r\n-                        <div className=\"card-header bg-info bg-opacity-10\">\r\n-                          <h6 className=\"mb-0 text-info\">\r\n-                            <i className=\"bi bi-info-circle me-2\"></i>\r\n-                            Selection Summary\r\n-                          </h6>\r\n-                        </div>\r\n-                        <div className=\"card-body\">\r\n-                          <div className=\"row\">\r\n-                            <div className=\"col-md-6\">\r\n-                              <div className={`d-flex justify-content-between align-items-center p-2 rounded ${getCurrentCounts().mainCategoriesCount >= MIN_MAIN_CATEGORIES && getCurrentCounts().mainCategoriesCount <= MAX_MAIN_CATEGORIES ? 'bg-success bg-opacity-10 text-success' : 'bg-warning bg-opacity-10 text-warning'}`}>\r\n-                                <span className=\"fw-semibold\">\r\n-                                  <i className=\"bi bi-grid me-1\"></i>\r\n-                                  Main Categories:\r\n-                                </span>\r\n-                                <span className=\"badge bg-primary\">\r\n-                                  {getCurrentCounts().mainCategoriesCount} / {MAX_MAIN_CATEGORIES}\r\n-                                </span>\r\n-                              </div>\r\n-                              {getCurrentCounts().mainCategoriesCount < MIN_MAIN_CATEGORIES && (\r\n-                                <small className=\"text-warning\">\r\n-                                  <i className=\"bi bi-exclamation-triangle me-1\"></i>\r\n-                                  Minimum {MIN_MAIN_CATEGORIES} main category required\r\n-                                </small>\r\n-                              )}\r\n-                            </div>\r\n-                            <div className=\"col-md-6\">\r\n-                              <div className=\"d-flex justify-content-between align-items-center p-2 rounded bg-info bg-opacity-10 text-info\">\r\n-                                <span className=\"fw-semibold\">\r\n-                                  <i className=\"bi bi-tags me-1\"></i>\r\n-                                  Total Subcategories:\r\n-                                </span>\r\n-                                <span className=\"badge bg-info\">\r\n-                                  {getCurrentCounts().totalSubcategoriesCount}\r\n-                                </span>\r\n-                              </div>\r\n-                              {selectedMainCategory && (\r\n-                                <small className=\"text-muted\">\r\n-                                  <i className=\"bi bi-arrow-right me-1\"></i>\r\n-                                  Selected category: {getCurrentCounts().selectedCategorySubCount} / {MAX_SUBCATEGORIES_PER_CATEGORY}\r\n-                                </small>\r\n-                              )}\r\n-                            </div>\r\n-                          </div>\r\n-                        </div>\r\n-                      </div>\r\n-                    </div>\r\n-                  </div>\r\n-                </>\r\n-              )}\r\n-\r\n-              {categoryConfig.enabled && (\r\n-                <>\r\n-                  {/* Configuration Options */}\r\n-                  <div className=\"row mb-4\">\r\n-                    <div className=\"col-md-4\">\r\n-                      <label className=\"form-label fw-semibold\">Maximum Categories to Show</label>\r\n-                      <input \r\n-                        type=\"number\" \r\n-                        className=\"form-control\"\r\n-                        min=\"1\"\r\n-                        max=\"20\"\r\n-                        value={categoryConfig.maxCategories}\r\n-                        onChange={(e) => handleMaxCategoriesChange(e.target.value)}\r\n-                      />\r\n-                      <small className=\"text-muted\">Limit how many categories appear (0 = no limit)</small>\r\n-                    </div>\r\n-                    <div className=\"col-md-4\">\r\n-                      <label className=\"form-label fw-semibold\">Layout Style</label>\r\n-                      <select \r\n-                        className=\"form-select\"\r\n-                        value={categoryConfig.layout}\r\n-                        onChange={(e) => setCategoryConfig(prev => ({ ...prev, layout: e.target.value }))}\r\n-                      >\r\n-                        <option value=\"grid\">Grid Layout</option>\r\n-                        <option value=\"carousel\">Carousel</option>\r\n-                        <option value=\"list\">List View</option>\r\n-                      </select>\r\n-                    </div>\r\n-                    <div className=\"col-md-4\">\r\n-                      <div className=\"form-check mt-4\">\r\n-                        <input \r\n-                          className=\"form-check-input\" \r\n-                          type=\"checkbox\" \r\n-                          id=\"showSubcategories\"\r\n-                          checked={categoryConfig.showSubcategories}\r\n-                          onChange={(e) => setCategoryConfig(prev => ({ ...prev, showSubcategories: e.target.checked }))}\r\n-                        />\r\n-                        <label className=\"form-check-label\" htmlFor=\"showSubcategories\">\r\n-                          Show subcategories on hover\r\n-                        </label>\r\n-                      </div>\r\n-                    </div>\r\n-                  </div>\r\n-\r\n-                  {/* Current Selections Display */}\r\n-                  <div className=\"row mb-4\">\r\n-                    <div className=\"col-12\">\r\n-                      <div className=\"card border-success\">\r\n-                        <div className=\"card-header bg-success bg-opacity-10\">\r\n-                          <h6 className=\"mb-0 text-success\">\r\n-                            <i className=\"bi bi-check-circle me-2\"></i>\r\n-                            Current Selections\r\n-                          </h6>\r\n-                        </div>\r\n-                        <div className=\"card-body\">\r\n-                          {categoryConfig.categoryIds.length > 0 ? (\r\n-                            <div className=\"row\">\r\n-                              {/* Selected Main Categories */}\r\n-                              <div className=\"col-md-6\">\r\n-                                <h6 className=\"text-primary mb-3\">\r\n-                                  <i className=\"bi bi-grid me-1\"></i>\r\n-                                  Selected Main Categories ({categoryConfig.categoryIds.filter(id => mainCategories.some(cat => cat.id === id)).length})\r\n-                                </h6>\r\n-                                <div className=\"d-flex flex-wrap gap-2 mb-3\">\r\n-                                  {categoryConfig.categoryIds\r\n-                                    .filter(id => mainCategories.some(cat => cat.id === id))\r\n-                                    .map(categoryId => {\r\n-                                      const category = mainCategories.find(cat => cat.id === categoryId)\r\n-                                      return category ? (\r\n-                                        <span \r\n-                                          key={categoryId} \r\n-                                          className=\"badge bg-primary d-flex align-items-center\"\r\n-                                          style={{ fontSize: '12px', padding: '6px 10px' }}\r\n-                                        >\r\n-                                          <img \r\n-                                            src={category.image} \r\n-                                            alt={category.name}\r\n-                                            className=\"me-2 rounded\"\r\n-                                            style={{ width: '16px', height: '16px', objectFit: 'cover' }}\r\n-                                            onError={(e) => {\r\n-                                              e.target.src = '/assets/img/product/category/default-category.svg'\r\n-                                            }}\r\n-                                          />\r\n-                                          {category.name}\r\n-                                          <button\r\n-                                            type=\"button\"\r\n-                                            className=\"btn-close btn-close-white ms-2\"\r\n-                                            style={{ fontSize: '8px' }}\r\n-                                            onClick={() => handleCategoryToggle(categoryId)}\r\n-                                            title=\"Remove category\"\r\n-                                          ></button>\r\n-                                        </span>\r\n-                                      ) : null\r\n-                                    })}\r\n-                                </div>\r\n-                                {categoryConfig.categoryIds.filter(id => mainCategories.some(cat => cat.id === id)).length === 0 && (\r\n-                                  <p className=\"text-muted mb-0\">\r\n-                                    <i className=\"bi bi-info-circle me-1\"></i>\r\n-                                    No main categories selected\r\n-                                  </p>\r\n-                                )}\r\n-                              </div>\r\n-\r\n-                              {/* Selected Subcategories */}\r\n-                              <div className=\"col-md-6\">\r\n-                                <h6 className=\"text-secondary mb-3\">\r\n-                                  <i className=\"bi bi-tags me-1\"></i>\r\n-                                  Selected Subcategories ({categoryConfig.categoryIds.filter(id => subCategories.some(cat => cat.id === id)).length})\r\n-                                </h6>\r\n-                                <div className=\"d-flex flex-wrap gap-2 mb-3\">\r\n-                                  {categoryConfig.categoryIds\r\n-                                    .filter(id => subCategories.some(cat => cat.id === id))\r\n-                                    .map(subcategoryId => {\r\n-                                      const subcategory = subCategories.find(cat => cat.id === subcategoryId)\r\n-                                      const parentCategory = subcategory ? mainCategories.find(cat => cat.id === (subcategory.parent?._id || subcategory.parent)) : null\r\n-                                      return subcategory ? (\r\n-                                        <span \r\n-                                          key={subcategoryId} \r\n-                                          className=\"badge bg-secondary d-flex align-items-center\"\r\n-                                          style={{ fontSize: '11px', padding: '5px 8px' }}\r\n-                                        >\r\n-                                          <img \r\n-                                            src={subcategory.image} \r\n-                                            alt={subcategory.name}\r\n-                                            className=\"me-2 rounded\"\r\n-                                            style={{ width: '14px', height: '14px', objectFit: 'cover' }}\r\n-                                            onError={(e) => {\r\n-                                              e.target.src = '/assets/img/product/category/default-subcategory.svg'\r\n-                                            }}\r\n-                                          />\r\n-                                          <div className=\"d-flex flex-column align-items-start\">\r\n-                                            <span>{subcategory.name}</span>\r\n-                                            {parentCategory && (\r\n-                                              <small className=\"text-light opacity-75\" style={{ fontSize: '9px' }}>\r\n-                                                under {parentCategory.name}\r\n-                                              </small>\r\n-                                            )}\r\n-                                          </div>\r\n-                                          <button\r\n-                                            type=\"button\"\r\n-                                            className=\"btn-close btn-close-white ms-2\"\r\n-                                            style={{ fontSize: '7px' }}\r\n-                                            onClick={() => handleCategoryToggle(subcategoryId, subcategory.parent?._id || subcategory.parent)}\r\n-                                            title=\"Remove subcategory\"\r\n-                                          ></button>\r\n-                                        </span>\r\n-                                      ) : null\r\n-                                    })}\r\n-                                </div>\r\n-                                {categoryConfig.categoryIds.filter(id => subCategories.some(cat => cat.id === id)).length === 0 && (\r\n-                                  <p className=\"text-muted mb-0\">\r\n-                                    <i className=\"bi bi-info-circle me-1\"></i>\r\n-                                    No subcategories selected\r\n-                                  </p>\r\n-                                )}\r\n-                              </div>\r\n-                            </div>\r\n-                          ) : (\r\n-                            <div className=\"text-center py-4\">\r\n-                              <i className=\"bi bi-inbox text-muted\" style={{ fontSize: '2rem' }}></i>\r\n-                              <p className=\"text-muted mt-2 mb-0\">No categories selected yet</p>\r\n-                              <small className=\"text-muted\">Select categories from the interface below to see them here</small>\r\n-                            </div>\r\n-                          )}\r\n-                        </div>\r\n-                      </div>\r\n-                    </div>\r\n-                  </div>\r\n-\r\n-                  {/* Selection Summary */}\r\n-                  <div className=\"row mb-4\">\r\n-                    <div className=\"col-12\">\r\n-                      <div className=\"alert alert-info d-flex align-items-center\">\r\n-                        <i className=\"bi bi-info-circle me-2\"></i>\r\n-                        <div>\r\n-                          <strong>Selection Summary:</strong> {categoryConfig.categoryIds.length} categories selected \r\n-                          ({categoryConfig.categoryIds.filter(id => mainCategories.some(cat => cat.id === id)).length} main categories, {categoryConfig.categoryIds.filter(id => subCategories.some(cat => cat.id === id)).length} subcategories)\r\n-                        </div>\r\n-                      </div>\r\n-                    </div>\r\n-                  </div>\r\n-\r\n-                  {/* Category Selection Interface */}\r\n-                  <div className=\"row mb-4\">\r\n-                    <div className=\"col-12\">\r\n-                      <label className=\"form-label fw-semibold mb-3\">Select Categories and Subcategories</label>\r\n-                      \r\n-                      {mainCategories.length > 0 ? (\r\n-                        <div className=\"row\">\r\n-                          {/* Left Side - Main Categories */}\r\n-                          <div className=\"col-md-6\">\r\n-                            <div className=\"card\">\r\n-                              <div className=\"card-header bg-light d-flex justify-content-between align-items-center\">\r\n-                                <h6 className=\"mb-0\">\r\n-                                  <i className=\"bi bi-grid text-primary me-2\"></i>\r\n-                                  Main Categories ({mainCategories.length})\r\n-                                </h6>\r\n-                                <span className=\"badge bg-primary\">\r\n-                                  {getCurrentCounts().mainCategoriesCount} selected\r\n-                                </span>\r\n-                              </div>\r\n-                              <div className=\"card-body p-0\">\r\n-                                <div className=\"list-group list-group-flush\" style={{ maxHeight: '400px', overflowY: 'auto' }}>\r\n-                                  {mainCategories.map((category, index) => {\r\n-                                    // Use the flat categoryIds array for now since categories is still an array\r\n-                                    const isSelected = categoryConfig.categoryIds.includes(category.id)\r\n-                                    const isActiveTab = selectedMainCategory === category.id\r\n-                                    const subcategoryCount = getSubcategoriesForCategory(category.id).length\r\n-                                    const selectedSubcategoryCount = getSubcategoriesForCategory(category.id)\r\n-                                      .filter(sub => categoryConfig.categoryIds.includes(sub.id)).length\r\n-                                    \r\n-                                    return (\r\n-                                      <div\r\n-                                        key={category.id}\r\n-                                        className={`list-group-item d-flex justify-content-between align-items-center ${isActiveTab ? 'active' : ''}`}\r\n-                                        style={{ \r\n-                                          cursor: 'pointer',\r\n-                                          borderLeft: isActiveTab ? '4px solid #0d6efd' : '4px solid transparent'\r\n-                                        }}\r\n-                                        onClick={() => setSelectedMainCategory(category.id)}\r\n-                                      >\r\n-                                        <div className=\"d-flex align-items-center flex-grow-1\">\r\n-                                          <div className=\"form-check me-3\">\r\n-                                            <input\r\n-                                              className=\"form-check-input\"\r\n-                                              type=\"checkbox\"\r\n-                                              checked={isSelected}\r\n-                                              onChange={(e) => {\r\n-                                                e.stopPropagation()\r\n-                                                handleCategoryToggle(category.id)\r\n-                                              }}\r\n-                                            />\r\n-                                          </div>\r\n-                                          <img\r\n-                                            src={category.image}\r\n-                                            alt={category.name}\r\n-                                            className=\"me-3 rounded\"\r\n-                                            style={{ width: '32px', height: '32px', objectFit: 'cover' }}\r\n-                                            onError={(e) => {\r\n-                                              e.target.src = '/assets/img/product/category/default-category.svg'\r\n-                                            }}\r\n-                                          />\r\n-                                          <div>\r\n-                                            <div className={`fw-semibold ${isActiveTab ? 'text-white' : ''}`}>\r\n-                                              {category.name}\r\n-                                            </div>\r\n-                                            <small className={`${isActiveTab ? 'text-white-50' : 'text-muted'}`}>\r\n-                                              {subcategoryCount} subcategories\r\n-                                            </small>\r\n-                                          </div>\r\n-                                        </div>\r\n-                                        <div className=\"d-flex flex-column align-items-end\">\r\n-                                          {isSelected && (\r\n-                                            <span className={`badge ${isActiveTab ? 'bg-light text-primary' : 'bg-success'} mb-1`}>\r\n-                                              <i className=\"bi bi-check2 me-1\"></i>\r\n-                                              Selected\r\n-                                            </span>\r\n-                                          )}\r\n-                                          {subcategoryCount > 0 && (\r\n-                                            <span className={`badge ${isActiveTab ? 'bg-light text-primary' : 'bg-secondary'}`}>\r\n-                                              {selectedSubcategoryCount}/{subcategoryCount} subs\r\n-                                            </span>\r\n-                                          )}\r\n-                                        </div>\r\n-                                      </div>\r\n-                                    )\r\n-                                  })}\r\n-                                </div>\r\n-                              </div>\r\n-                            </div>\r\n-                          </div>\r\n-\r\n-                          {/* Right Side - Subcategories */}\r\n-                          <div className=\"col-md-6\">\r\n-                            <div className=\"card\">\r\n-                              <div className=\"card-header bg-light d-flex justify-content-between align-items-center\">\r\n-                                <h6 className=\"mb-0\">\r\n-                                  <i className=\"bi bi-tag text-secondary me-2\"></i>\r\n-                                  Subcategories\r\n-                                  {selectedMainCategory && (\r\n-                                    <span className=\"text-muted ms-2\">\r\n-                                      for \"{mainCategories.find(cat => cat.id === selectedMainCategory)?.name}\"\r\n-                                    </span>\r\n-                                  )}\r\n-                                </h6>\r\n-                                {selectedCategorySubcategories.length > 0 && (\r\n-                                  <span className=\"badge bg-secondary\">\r\n-                                    {selectedCategorySubcategories.length} subcategories\r\n-                                  </span>\r\n-                                )}\r\n-                              </div>\r\n-                              <div className=\"card-body p-0\">\r\n-                                {selectedMainCategory ? (\r\n-                                  selectedCategorySubcategories.length > 0 ? (\r\n-                                    <>\r\n-                                      {/* Subcategories Stats */}\r\n-                                      <div className=\"p-3 bg-light border-bottom\">\r\n-                                        <div className=\"row text-center\">\r\n-                                          <div className=\"col-6\">\r\n-                                            <div className=\"small\">\r\n-                                              <strong>{selectedCategorySubcategories.filter(sub => categoryConfig.categoryIds.includes(sub.id)).length}</strong>\r\n-                                              <br />\r\n-                                              <span className=\"text-muted\">Selected</span>\r\n-                                            </div>\r\n-                                          </div>\r\n-                                          <div className=\"col-6\">\r\n-                                            <div className=\"small\">\r\n-                                              <strong>{selectedCategorySubcategories.filter(sub => sub.status).length}</strong>\r\n-                                              <br />\r\n-                                              <span className=\"text-muted\">Active</span>\r\n-                                            </div>\r\n-                                          </div>\r\n-                                        </div>\r\n-                                      </div>\r\n-\r\n-                                      {/* Quick Actions for Subcategories */}\r\n-                                      <div className=\"p-2 border-bottom\">\r\n-                                        <div className=\"d-flex gap-1\">\r\n-                                          <button \r\n-                                            type=\"button\" \r\n-                                            className=\"btn btn-outline-success btn-sm\"\r\n-                                            onClick={() => {\r\n-                                              const currentSubIds = selectedCategorySubcategories.map(cat => cat.id)\r\n-                                              setCategoryConfig(prev => ({\r\n-                                                ...prev,\r\n-                                                categoryIds: [...new Set([...prev.categoryIds, ...currentSubIds])]\r\n-                                              }))\r\n-                                            }}\r\n-                                          >\r\n-                                            <i className=\"bi bi-check-all me-1\"></i>\r\n-                                            Select All\r\n-                                          </button>\r\n-                                          \r\n-                                          <button \r\n-                                            type=\"button\" \r\n-                                            className=\"btn btn-outline-secondary btn-sm\"\r\n-                                            onClick={() => {\r\n-                                              const currentSubIds = selectedCategorySubcategories.map(cat => cat.id)\r\n-                                              setCategoryConfig(prev => ({\r\n-                                                ...prev,\r\n-                                                categoryIds: prev.categoryIds.filter(id => !currentSubIds.includes(id))\r\n-                                              }))\r\n-                                            }}\r\n-                                          >\r\n-                                            <i className=\"bi bi-x-circle me-1\"></i>\r\n-                                            Clear All\r\n-                                          </button>\r\n-                                        </div>\r\n-                                      </div>\r\n-\r\n-                                      {/* Subcategories List */}\r\n-                                      <div className=\"list-group list-group-flush\" style={{ maxHeight: '350px', overflowY: 'auto' }}>\r\n-                                        {selectedCategorySubcategories.map((subcategory, index) => {\r\n-                                          // Use the flat categoryIds array for now since categories is still an array\r\n-                                          const isSelected = categoryConfig.categoryIds.includes(subcategory.id)\r\n-                                          \r\n-                                          return (\r\n-                                            <div \r\n-                                              key={subcategory.id} \r\n-                                              className={`list-group-item list-group-item-action border-0 ${isSelected ? 'bg-success bg-opacity-10 border-start border-success border-3' : ''}`}\r\n-                                            >\r\n-                                              <div className=\"d-flex align-items-center\">\r\n-                                                <div className=\"form-check me-3\">\r\n-                                                  <input \r\n-                                                    className=\"form-check-input form-check-input-success\" \r\n-                                                    type=\"checkbox\" \r\n-                                                    id={`sub-category-${subcategory.id}`}\r\n-                                                    checked={isSelected}\r\n-                                                    onChange={() => handleCategoryToggle(subcategory.id, selectedMainCategory)}\r\n-                                                  />\r\n-                                                </div>\r\n-                                                \r\n-                                                {subcategory.image && (\r\n-                                                  <img \r\n-                                                    src={subcategory.image} \r\n-                                                    alt={subcategory.name}\r\n-                                                    className=\"me-3 flex-shrink-0 border\"\r\n-                                                    style={{ width: '36px', height: '36px', objectFit: 'cover', borderRadius: '6px' }}\r\n-                                                  />\r\n-                                                )}\r\n-                                                \r\n-                                                <div className=\"flex-grow-1\">\r\n-                                                  <div className=\"d-flex justify-content-between align-items-start\">\r\n-                                                    <div>\r\n-                                                      <h6 className=\"mb-1 text-dark fw-semibold\">\r\n-                                                        <i className=\"bi bi-tag text-success me-1\" style={{ fontSize: '12px' }}></i>\r\n-                                                        {subcategory.name}\r\n-                                                      </h6>\r\n-                                                      {subcategory.description && (\r\n-                                                        <p className=\"mb-1 text-muted small\">{subcategory.description}</p>\r\n-                                                      )}\r\n-                                                      <div className=\"d-flex gap-1 align-items-center\">\r\n-                                                        <span className=\"badge bg-secondary\" style={{ fontSize: '9px' }}>\r\n-                                                          Subcategory\r\n-                                                        </span>\r\n-                                                        <span className={`badge ${subcategory.status ? 'bg-success' : 'bg-danger'}`} style={{ fontSize: '9px' }}>\r\n-                                                          {subcategory.status ? 'Active' : 'Inactive'}\r\n-                                                        </span>\r\n-                                                        {isSelected && (\r\n-                                                          <span className=\"badge bg-primary\" style={{ fontSize: '9px' }}>\r\n-                                                            <i className=\"bi bi-check-circle me-1\"></i>\r\n-                                                            Selected\r\n-                                                          </span>\r\n-                                                        )}\r\n-                                                      </div>\r\n-                                                    </div>\r\n-                                                    <div className=\"text-end\">\r\n-                                                      <small className=\"text-muted\">#{index + 1}</small>\r\n-                                                    </div>\r\n-                                                  </div>\r\n-                                                </div>\r\n-                                              </div>\r\n-                                            </div>\r\n-                                          )\r\n-                                        })}\r\n-                                      </div>\r\n-\r\n-                                      {/* Footer Info */}\r\n-                                      <div className=\"p-2 bg-light border-top text-center\">\r\n-                                        <small className=\"text-muted\">\r\n-                                          <i className=\"bi bi-info-circle me-1\"></i>\r\n-                                          Click checkboxes to select subcategories for homepage display\r\n-                                        </small>\r\n-                                      </div>\r\n-                                    </>\r\n-                                  ) : (\r\n-                                    <div className=\"text-center py-5\">\r\n-                                      <i className=\"bi bi-folder2-open text-muted\" style={{ fontSize: '2.5rem' }}></i>\r\n-                                      <h6 className=\"mt-3 text-muted\">No subcategories found</h6>\r\n-                                      <p className=\"text-muted mb-3\">\r\n-                                        The category \"{mainCategories.find(cat => cat.id === selectedMainCategory)?.name}\" doesn't have any subcategories yet.\r\n-                                      </p>\r\n-                                      <button \r\n-                                        className=\"btn btn-outline-primary btn-sm\"\r\n-                                        onClick={() => {\r\n-                                          // You can add navigation to create subcategory here\r\n-                                          alert('Navigate to Categories > Subcategories to create subcategories for this category')\r\n-                                        }}\r\n-                                      >\r\n-                                        <i className=\"bi bi-plus-circle me-1\"></i>\r\n-                                        Create Subcategories\r\n-                                      </button>\r\n-                                    </div>\r\n-                                  )\r\n-                                ) : (\r\n-                                  <div className=\"text-center py-5\">\r\n-                                    <i className=\"bi bi-arrow-left text-primary\" style={{ fontSize: '2.5rem' }}></i>\r\n-                                    <h6 className=\"mt-3 text-muted\">Select a main category</h6>\r\n-                                    <p className=\"text-muted mb-0\">\r\n-                                      Click on a main category from the left panel to view and select its subcategories.\r\n-                                    </p>\r\n-                                  </div>\r\n-                                )}\r\n-                              </div>\r\n-                            </div>\r\n-                          </div>\r\n-                        </div>\r\n-                      ) : (\r\n-                        <div className=\"text-center py-5\">\r\n-                          <i className=\"bi bi-folder2-open text-muted\" style={{ fontSize: '3rem' }}></i>\r\n-                          <p className=\"mt-2 text-muted\">No categories available</p>\r\n-                          <small className=\"text-muted\">Create categories first to configure this section.</small>\r\n-                        </div>\r\n-                      )}\r\n-                    </div>\r\n-                  </div>\r\n-\r\n-                  {/* Quick Actions */}\r\n-                  {mainCategories.length > 0 && (\r\n-                    <div className=\"row\">\r\n-                      <div className=\"col-12\">\r\n-                        <div className=\"d-flex gap-2 flex-wrap\">\r\n-                          <button \r\n-                            type=\"button\" \r\n-                            className=\"btn btn-outline-primary btn-sm\"\r\n-                            onClick={() => {\r\n-                              console.log('🎯 Select All Main Categories clicked')\r\n-                              const { mainCategoriesCount } = getCurrentCounts()\r\n-                              const availableSlots = MAX_MAIN_CATEGORIES - mainCategoriesCount\r\n-                              \r\n-                              if (availableSlots <= 0) {\r\n-                                setError(`Cannot select more categories. Maximum ${MAX_MAIN_CATEGORIES} main categories allowed.`)\r\n-                                return\r\n-                              }\r\n-                              \r\n-                              // Get main categories that are not already selected\r\n-                              const mainCategoryIds = mainCategories.map(cat => cat.id)\r\n-                              const unselectedMainCategories = mainCategoryIds.filter(id => \r\n-                                !categoryConfig.categoryIds.includes(id)\r\n-                              )\r\n-                              \r\n-                              // Take only the number that fits within the limit\r\n-                              const categoriesToAdd = unselectedMainCategories.slice(0, availableSlots)\r\n-                              console.log('   - Categories to add:', categoriesToAdd)\r\n-                              \r\n-                              setCategoryConfig(prev => {\r\n-                                const newCategoryIds = [...new Set([...prev.categoryIds, ...categoriesToAdd])]\r\n-                                console.log('   - Updated categoryIds:', newCategoryIds)\r\n-                                return {\r\n-                                  ...prev,\r\n-                                  categoryIds: newCategoryIds\r\n-                                }\r\n-                              })\r\n-                              \r\n-                              if (categoriesToAdd.length < unselectedMainCategories.length) {\r\n-                                setError(`Only selected ${categoriesToAdd.length} more categories due to limit.`)\r\n-                              }\r\n-                            }}\r\n-                          >\r\n-                            <i className=\"bi bi-check-all me-1\"></i>\r\n-                            Select All Main Categories\r\n-                          </button>\r\n-                          \r\n-                          <button \r\n-                            type=\"button\" \r\n-                            className=\"btn btn-outline-success btn-sm\"\r\n-                            onClick={() => {\r\n-                              console.log('🎯 Select All Subcategories clicked')\r\n-                              if (!selectedMainCategory) {\r\n-                                setError('Please select a main category first to add subcategories.')\r\n-                                return\r\n-                              }\r\n-                              \r\n-                              const subcategoriesForMain = getSubcategoriesForCategory(selectedMainCategory)\r\n-                              const currentSubCount = subcategoriesForMain.filter(sub => \r\n-                                categoryConfig.categoryIds.includes(sub.id)\r\n-                              ).length\r\n-                              const availableSlots = MAX_SUBCATEGORIES_PER_CATEGORY - currentSubCount\r\n-                              \r\n-                              if (availableSlots <= 0) {\r\n-                                setError(`Cannot select more subcategories. Maximum ${MAX_SUBCATEGORIES_PER_CATEGORY} subcategories per main category allowed.`)\r\n-                                return\r\n-                              }\r\n-                              \r\n-                              // Get unselected subcategories for this main category\r\n-                              const unselectedSubcategories = subcategoriesForMain\r\n-                                .filter(sub => !categoryConfig.categoryIds.includes(sub.id))\r\n-                                .slice(0, availableSlots)\r\n-                                .map(sub => sub.id)\r\n-                              \r\n-                              console.log('   - Subcategories to add:', unselectedSubcategories)\r\n-                              \r\n-                              setCategoryConfig(prev => {\r\n-                                let newCategoryIds = [...prev.categoryIds]\r\n-                                \r\n-                                // Ensure main category is selected\r\n-                                if (!newCategoryIds.includes(selectedMainCategory)) {\r\n-                                  newCategoryIds.push(selectedMainCategory)\r\n-                                }\r\n-                                \r\n-                                // Add unselected subcategories\r\n-                                newCategoryIds = [...new Set([...newCategoryIds, ...unselectedSubcategories])]\r\n-                                \r\n-                                console.log('   - Updated categoryIds:', newCategoryIds)\r\n-                                return {\r\n-                                  ...prev,\r\n-                                  categoryIds: newCategoryIds\r\n-                                }\r\n-                              })\r\n-                              \r\n-                              if (unselectedSubcategories.length < subcategoriesForMain.length - currentSubCount) {\r\n-                                setError(`Only selected ${unselectedSubcategories.length} more subcategories due to limit.`)\r\n-                              }\r\n-                            }}\r\n-                          >\r\n-                            <i className=\"bi bi-tags me-1\"></i>\r\n-                            Select All Subcategories\r\n-                          </button>\r\n-                          \r\n-                          <button \r\n-                            type=\"button\" \r\n-                            className=\"btn btn-outline-secondary btn-sm\"\r\n-                            onClick={() => {\r\n-                              console.log('🎯 Clear All Selections clicked')\r\n-                              setCategoryConfig(prev => ({\r\n-                                ...prev,\r\n-                                categoryIds: []\r\n-                              }))\r\n-                              setSelectedMainCategory(null)\r\n-                            }}\r\n-                          >\r\n-                            <i className=\"bi bi-x-circle me-1\"></i>\r\n-                            Clear All Selections\r\n-                          </button>\r\n-                        </div>\r\n-                      </div>\r\n-                    </div>\r\n-                  )}\r\n-                </>\r\n-              )}\r\n-            </div>\r\n-            <div className=\"modal-footer\">\r\n-              <button \r\n-                type=\"button\" \r\n-                className=\"btn btn-secondary\" \r\n-                onClick={() => setShowCategoryConfig(false)}\r\n-              >\r\n-                Cancel\r\n-              </button>\r\n-              <button \r\n-                type=\"button\" \r\n-                className=\"btn btn-primary\" \r\n-                onClick={saveCategoryConfig}\r\n-                disabled={loading}\r\n-              >\r\n-                {loading ? (\r\n-                  <>\r\n-                    <span className=\"spinner-border spinner-border-sm me-2\"></span>\r\n-                    Saving...\r\n-                  </>\r\n-                ) : (\r\n-                  'Save Configuration'\r\n-                )}\r\n-              </button>\r\n-            </div>\r\n-          </div>\r\n-        </div>\r\n-      </div>\r\n-    )\r\n-  }\r\n-\r\n-  // Move section up/down\r\n-  const handleMoveSection = async (page, sectionKey, direction) => {\r\n-    const sections = page === \"home\" ? homeSections : corporateSections\r\n-    const currentIndex = sections.findIndex(s => s.key === sectionKey)\r\n-    \r\n-    if (direction === 'up' && currentIndex > 0) {\r\n-      // Move up logic - would need to update order\r\n-      console.log(`Moving ${sectionKey} up`)\r\n-    } else if (direction === 'down' && currentIndex < sections.length - 1) {\r\n-      // Move down logic - would need to update order\r\n-      console.log(`Moving ${sectionKey} down`)\r\n-    }\r\n-    \r\n-    // TODO: Implement actual reordering\r\n-    setSuccess('Section order updated!')\r\n-    setTimeout(() => setSuccess(''), 2000)\r\n-  }\r\n-\r\n-  // Render section controls\r\n-  const renderSections = () => {\r\n-    const sections = getCurrentSections()\r\n-    const currentPage = PAGES.find(p => p.key === selectedPage)\r\n-    \r\n-    return (\r\n-      <div className=\"col-md-9\">\r\n-        <div className=\"card border-0 shadow-sm\">\r\n-          <div className=\"card-header bg-white border-bottom\">\r\n-            <div className=\"d-flex justify-content-between align-items-center\">\r\n-              <div>\r\n-                <h5 className=\"mb-1 fw-semibold\">{currentPage.label}</h5>\r\n-                <p className=\"text-muted mb-0 small\">{currentPage.description}</p>\r\n-              </div>\r\n-              <span className=\"badge bg-primary\">\r\n-                {sections.filter(s => visibleSections[selectedPage][s.key]).length} active\r\n-              </span>\r\n-            </div>\r\n-          </div>\r\n-          \r\n-          <div className=\"card-body p-0\">\r\n-            {sections.length === 0 ? (\r\n-              <div className=\"text-center py-5\">\r\n-                <i className=\"bi bi-grid\" style={{ fontSize: '3rem', color: '#6c757d' }}></i>\r\n-                <p className=\"mt-2 text-muted\">No sections configured for this page.</p>\r\n-              </div>\r\n-            ) : (\r\n-              <div className=\"table-responsive\">\r\n-                <table className=\"table table-hover mb-0\">\r\n-                  <thead className=\"table-light\">\r\n-                    <tr>\r\n-                      <th className=\"ps-4\">Section</th>\r\n-                      <th>Description</th>\r\n-                      <th>Order</th>\r\n-                      <th>Status</th>\r\n-                      <th className=\"text-center\">Actions</th>\r\n-                    </tr>\r\n-                  </thead>\r\n-                  <tbody>\r\n-                    {sections.map((section, index) => {\r\n-                      const isVisible = visibleSections[selectedPage][section.key]\r\n-                      const isCategorySection = section.key === 'giftCategories'\r\n-                      \r\n-                      return (\r\n-                        <tr key={section.key} className={isVisible ? '' : 'table-secondary'}>\r\n-                          <td className=\"ps-4\">\r\n-                            <div className=\"d-flex align-items-center\">\r\n-                              <div>\r\n-                                <div className=\"fw-semibold\">{section.label}</div>\r\n-                                {isCategorySection && categoryConfig.categoryIds.length > 0 && (\r\n-                                  <small className=\"text-muted\">\r\n-                                    {categoryConfig.categoryIds.length} categories selected\r\n-                                  </small>\r\n-                                )}\r\n-                              </div>\r\n-                            </div>\r\n-                          </td>\r\n-                          <td>\r\n-                            <span className=\"text-muted\">{section.description}</span>\r\n-                          </td>\r\n-                          <td>\r\n-                            <span className=\"badge bg-light text-dark\">{section.order}</span>\r\n-                          </td>\r\n-                          <td>\r\n-                            <div className=\"form-check form-switch\">\r\n-                              <input \r\n-                                className=\"form-check-input\" \r\n-                                type=\"checkbox\" \r\n-                                checked={isCategorySection ? categoryConfig.enabled : isVisible}\r\n-                                onChange={() => handleToggleSection(selectedPage, section.key)}\r\n-                                id={`toggle-${section.key}`}\r\n-                              />\r\n-                              <label className=\"form-check-label\" htmlFor={`toggle-${section.key}`}>\r\n-                                {isCategorySection ? (categoryConfig.enabled ? 'Enabled' : 'Disabled') : (isVisible ? 'Visible' : 'Hidden')}\r\n-                              </label>\r\n-                            </div>\r\n-                          </td>\r\n-                          <td className=\"text-center\">\r\n-                            <div className=\"btn-group btn-group-sm\">\r\n-                              {section.hasConfig && (\r\n-                                <button\r\n-                                  className=\"btn btn-outline-primary\"\r\n-                                  onClick={openCategoryConfig}\r\n-                                  title=\"Configure section\"\r\n-                                >\r\n-                                  <i className=\"bi bi-gear\"></i>\r\n-                                </button>\r\n-                              )}\r\n-                              <button\r\n-                                className=\"btn btn-outline-secondary\"\r\n-                                onClick={() => handleMoveSection(selectedPage, section.key, 'up')}\r\n-                                disabled={index === 0}\r\n-                                title=\"Move up\"\r\n-                              >\r\n-                                <i className=\"bi bi-arrow-up\"></i>\r\n-                              </button>\r\n-                              <button\r\n-                                className=\"btn btn-outline-secondary\"\r\n-                                onClick={() => handleMoveSection(selectedPage, section.key, 'down')}\r\n-                                disabled={index === sections.length - 1}\r\n-                                title=\"Move down\"\r\n-                              >\r\n-                                <i className=\"bi bi-arrow-down\"></i>\r\n-                              </button>\r\n-                            </div>\r\n-                          </td>\r\n-                        </tr>\r\n-                      )\r\n-                    })}\r\n-                  </tbody>\r\n-                </table>\r\n-              </div>\r\n-            )}\r\n-          </div>\r\n-        </div>\r\n-      </div>\r\n-    )\r\n-  }\r\n-\r\n-  // Render page sidebar\r\n-  const renderPageSidebar = () => (\r\n-    <div className=\"col-md-3\">\r\n-      <div className=\"card border-0 shadow-sm\">\r\n-        <div className=\"card-header bg-white border-bottom\">\r\n-          <h6 className=\"mb-0 fw-semibold\">\r\n-            <i className=\"bi bi-file-earmark-text me-2\"></i>\r\n-            Pages\r\n-          </h6>\r\n-        </div>\r\n-        <div className=\"card-body p-0\">\r\n-          <div className=\"list-group list-group-flush\">\r\n-            {PAGES.map((page) => {\r\n-              const isActive = selectedPage === page.key\r\n-              const activeCount = visibleSections[page.key] ? \r\n-                Object.values(visibleSections[page.key]).filter(Boolean).length : 0\r\n-              \r\n-              return (\r\n-                <button\r\n-                  key={page.key}\r\n-                  className={`list-group-item list-group-item-action border-0 ${isActive ? 'active' : ''}`}\r\n-                  onClick={() => setSelectedPage(page.key)}\r\n-                  disabled={loading}\r\n-                >\r\n-                  <div className=\"d-flex justify-content-between align-items-center\">\r\n-                    <div>\r\n-                      <div className=\"fw-semibold\">{page.label}</div>\r\n-                      <small className={isActive ? 'text-white-50' : 'text-muted'}>\r\n-                        {page.description}\r\n-                      </small>\r\n-                    </div>\r\n-                    <span className={`badge ${isActive ? 'bg-white text-primary' : 'bg-primary'}`}>\r\n-                      {activeCount}\r\n-                    </span>\r\n-                  </div>\r\n-                </button>\r\n-              )\r\n-            })}\r\n-          </div>\r\n-        </div>\r\n-      </div>\r\n-    </div>\r\n-  )\r\n-\r\n-  return (\r\n-    <div className=\"container-fluid\">\r\n-      {/* Page Header */}\r\n-      <div className=\"row mb-4\">\r\n-        <div className=\"col-12\">\r\n-          <div className=\"d-flex justify-content-between align-items-center\">\r\n-            <div>\r\n-              <h2 className=\"fw-bold text-dark mb-1\">Pages Management</h2>\r\n-              <p className=\"text-muted mb-0\">Control which sections appear on each page</p>\r\n-            </div>\r\n-            <div className=\"d-flex gap-2\">\r\n-              <button\r\n-                className=\"btn btn-outline-primary\"\r\n-                onClick={() => loadPageConfig(selectedPage)}\r\n-                disabled={loading}\r\n-              >\r\n-                <i className=\"bi bi-arrow-clockwise me-2\"></i>\r\n-                Refresh\r\n-              </button>\r\n-            </div>\r\n-          </div>\r\n-        </div>\r\n-      </div>\r\n-\r\n-      {/* Status Messages */}\r\n-      {error && (\r\n-        <div className=\"row mb-3\">\r\n-          <div className=\"col-12\">\r\n-            <div className=\"alert alert-danger d-flex align-items-center\" role=\"alert\">\r\n-              <i className=\"bi bi-exclamation-triangle-fill me-2\"></i>\r\n-              <div>{error}</div>\r\n-              <button\r\n-                type=\"button\"\r\n-                className=\"btn-close ms-auto\"\r\n-                onClick={() => setError('')}\r\n-              ></button>\r\n-            </div>\r\n-          </div>\r\n-        </div>\r\n-      )}\r\n-\r\n-      {success && (\r\n-        <div className=\"row mb-3\">\r\n-          <div className=\"col-12\">\r\n-            <div className=\"alert alert-success d-flex align-items-center\" role=\"alert\">\r\n-              <i className=\"bi bi-check-circle-fill me-2\"></i>\r\n-              <div>{success}</div>\r\n-              <button\r\n-                type=\"button\"\r\n-                className=\"btn-close ms-auto\"\r\n-                onClick={() => setSuccess('')}\r\n-              ></button>\r\n-            </div>\r\n-          </div>\r\n-        </div>\r\n-      )}\r\n-\r\n-      {/* Main Content */}\r\n-      <div className=\"row\">\r\n-        {renderPageSidebar()}\r\n-        {renderSections()}\r\n-      </div>\r\n-\r\n-      {/* Category Configuration Modal */}\r\n-      {renderCategoryConfigModal()}\r\n-\r\n-      {/* Loading Overlay */}\r\n-      {loading && (\r\n-        <div className=\"position-fixed top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center\" \r\n-             style={{ backgroundColor: 'rgba(0,0,0,0.5)', zIndex: 9999 }}>\r\n-          <div className=\"spinner-border text-primary\" role=\"status\">\r\n-            <span className=\"visually-hidden\">Loading...</span>\r\n-          </div>\r\n-        </div>\r\n-      )}\r\n-    </div>\r\n-  )\r\n-}\r\n"
                },
                {
                    "date": 1753288391801,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -451,11 +451,8 @@\n       categoriesData.slice(0, 3).forEach((cat, index) => {\r\n         console.log(`     ${index + 1}.`, cat)\r\n       })\r\n       \r\n-      // Create default category icon as data URL to avoid 404 errors\r\n-      const defaultCategoryIcon = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjQwIiBoZWlnaHQ9IjQwIiBmaWxsPSIjZjhmOWZhIiByeD0iOCIvPgo8cGF0aCBkPSJNMTAgMTVIMzBWMjVIMTBWMTVaIiBmaWxsPSIjZGVlMmU2Ii8+CjxjaXJjbGUgY3g9IjE1IiBjeT0iMjAiIHI9IjIiIGZpbGw9IiM5NjliYTYiLz4KPGNpcmNsZSBjeD0iMjUiIGN5PSIyMCIgcj0iMiIgZmlsbD0iIzk2OWJhNiIvPgo8L3N2Zz4='\r\n-      \r\n       // Transform categories for display in the admin panel\r\n       console.log('7. Transforming categories...')\r\n       const transformedCategories = categoriesData.map((cat, index) => {\r\n         console.log(`   - Transforming category ${index + 1}:`, {\r\n@@ -469,9 +466,9 @@\n           id: cat.id || cat._id,\r\n           value: cat.id || cat._id,\r\n           label: cat.name,\r\n           name: cat.name,\r\n-          image: cat.image?.url || defaultCategoryIcon, // 🎯 Use data URL instead of file path\r\n+          image: cat.image?.url || '/assets/img/product/category/default-category.svg',\r\n           description: cat.description || '',\r\n           parent: cat.parent\r\n         }\r\n       })\r\n@@ -544,11 +541,8 @@\n           status: subcat.status\r\n         })\r\n       })\r\n       \r\n-      // Create default subcategory icon as data URL to avoid 404 errors\r\n-      const defaultSubcategoryIcon = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzYiIGhlaWdodD0iMzYiIHZpZXdCb3g9IjAgMCAzNiAzNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjM2IiBoZWlnaHQ9IjM2IiBmaWxsPSIjZjhmOWZhIiByeD0iNiIvPgo8Y2lyY2xlIGN4PSIxOCIgY3k9IjE4IiByPSI4IiBmaWxsPSIjZGVlMmU2Ii8+CjxjaXJjbGUgY3g9IjE4IiBjeT0iMTgiIHI9IjMiIGZpbGw9IiM5NjliYTYiLz4KPC9zdmc+'\r\n-      \r\n       // Transform subcategories for display\r\n       const transformedSubcategories = subcategoriesData.map((subcat, index) => {\r\n         console.log(`   - Transforming subcategory ${index + 1}:`, {\r\n           originalId: subcat._id,\r\n@@ -561,9 +555,9 @@\n           id: subcat.id || subcat._id,\r\n           value: subcat.id || subcat._id,\r\n           label: subcat.name,\r\n           name: subcat.name,\r\n-          image: subcat.image?.url || defaultSubcategoryIcon, // 🎯 Use data URL instead of file path\r\n+          image: subcat.image?.url || '/assets/img/product/category/default-subcategory.svg',\r\n           description: subcat.description || '',\r\n           parent: subcat.parent,\r\n           status: subcat.status\r\n         }\r\n"
                },
                {
                    "date": 1753289008832,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,1169 @@\n+'use client'\r\n+import React, { useState, useEffect } from 'react'\r\n+import { get, post, put } from '@/util/apiService'\r\n+import { CATEGORY, SUBCATEGORY } from '@/util/apiEndpoints'\r\n+import CategoryConfigModal from './sections/CategoryConfigModal'\r\n+\r\n+const PAGES = [\r\n+  { \r\n+    key: \"home\", \r\n+    label: \"Home Page\",\r\n+    description: \"Manage sections displayed on the homepage\"\r\n+  },\r\n+  { \r\n+    key: \"corporate\", \r\n+    label: \"Corporate Page\",\r\n+    description: \"Manage sections for corporate customers\"\r\n+  }\r\n+]\r\n+\r\n+export default function PagesManagement({ onNavigate }) {\r\n+  const [selectedPage, setSelectedPage] = useState(\"home\")\r\n+  const [loading, setLoading] = useState(false)\r\n+  const [error, setError] = useState('')\r\n+  const [success, setSuccess] = useState('')\r\n+  const [showCategoryConfig, setShowCategoryConfig] = useState(false)\r\n+  const [availableCategories, setAvailableCategories] = useState([])\r\n+  const [subcategories, setSubcategories] = useState([])\r\n+  const [pageConfig, setPageConfig] = useState(null)\r\n+\r\n+  // Category section configuration state - NEW HIERARCHICAL STRUCTURE\r\n+  const [categoryConfig, setCategoryConfig] = useState({\r\n+  enabled: true,\r\n+  maxCategories: 10,\r\n+  layout: 'grid',\r\n+  showSubcategories: true,\r\n+  // New hierarchical structure\r\n+  categories: [],\r\n+  // FIXED: Always initialize as empty array, not undefined\r\n+  categoryIds: []\r\n+})\r\n+\r\n+// ...existing code around line 1612...\r\n+\r\n+// FIX: Add null safety check for categoryIds\r\n+\r\n+  // Business rule constants\r\n+  const MAX_MAIN_CATEGORIES = 10\r\n+  const MIN_MAIN_CATEGORIES = 1\r\n+  const MAX_SUBCATEGORIES_PER_CATEGORY = 10\r\n+\r\n+  // UI state for category selection\r\n+  const [selectedMainCategory, setSelectedMainCategory] = useState(null)\r\n+\r\n+  // Define sections for each page\r\n+  const homeSections = [\r\n+    { \r\n+      key: \"giftCategories\", \r\n+      label: \"Gift Categories\", \r\n+      description: \"Display category grid with gifts\",\r\n+      order: 1,\r\n+      hasConfig: true\r\n+    },\r\n+    { \r\n+      key: \"slider\", \r\n+      label: \"Main Slider\", \r\n+      description: \"Hero banner with promotional slides\",\r\n+      order: 2\r\n+    },\r\n+    { \r\n+      key: \"services\", \r\n+      label: \"Services Section\", \r\n+      description: \"Highlight key services and benefits\",\r\n+      order: 3\r\n+    },\r\n+    { \r\n+      key: \"products\", \r\n+      label: \"Featured Products\", \r\n+      description: \"Showcase featured/trending products\",\r\n+      order: 4\r\n+    },\r\n+    { \r\n+      key: \"banner\", \r\n+      label: \"Promotional Banner\", \r\n+      description: \"Secondary promotional content\",\r\n+      order: 5\r\n+    },\r\n+    { \r\n+      key: \"dealProduct\", \r\n+      label: \"Deal Products\", \r\n+      description: \"Special offers and discounted items\",\r\n+      order: 6\r\n+    }\r\n+  ]\r\n+\r\n+  const corporateSections = [\r\n+    { \r\n+      key: \"corporateBanner\", \r\n+      label: \"Corporate Banner\", \r\n+      description: \"Hero section for corporate clients\",\r\n+      order: 1\r\n+    },\r\n+    { \r\n+      key: \"corporateServices\", \r\n+      label: \"Corporate Services\", \r\n+      description: \"B2B services and solutions\",\r\n+      order: 2\r\n+    },\r\n+    { \r\n+      key: \"corporateTestimonials\", \r\n+      label: \"Client Testimonials\", \r\n+      description: \"Corporate client reviews and case studies\",\r\n+      order: 3\r\n+    },\r\n+    { \r\n+      key: \"corporatePartners\", \r\n+      label: \"Partner Logos\", \r\n+      description: \"Display trusted corporate partners\",\r\n+      order: 4\r\n+    }\r\n+  ]\r\n+\r\n+  // Section visibility state\r\n+  const [visibleSections, setVisibleSections] = useState({\r\n+    home: {\r\n+      giftCategories: true,\r\n+      slider: true,\r\n+      services: true,\r\n+      products: true,\r\n+      banner: true,\r\n+      dealProduct: true,\r\n+    },\r\n+    corporate: {\r\n+      corporateBanner: true,\r\n+      corporateServices: true,\r\n+      corporateTestimonials: false,\r\n+      corporatePartners: false,\r\n+    },\r\n+  })\r\n+\r\n+  // Hardcoded admin token for testing\r\n+  const ADMIN_TOKEN = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY4NzZhYTJmYzc3YWY4ODU3Njk1ZDA5MiIsInJvbGUiOiJhZG1pbiIsImlhdCI6MTc1MzI4MTMyMCwiZXhwIjoxNzUzODg2MTIwfQ.3wEx7ZCDvYtUQppFM9CcXjhG1zTQX9_RYY_dy3Y6MZs'\r\n+\r\n+  // ========== HIERARCHICAL DATA MANAGEMENT HELPERS ==========\r\n+  \r\n+  // Get current counts for validation\r\n+  // ...existing code around line 130...\r\n+\r\n+// Get current counts for validation\r\n+const getCurrentCounts = () => {\r\n+  // FIXED: Add safety checks for undefined categoryIds\r\n+  const safeCategories = categoryConfig.categories || []\r\n+  const safeCategoryIds = categoryConfig.categoryIds || []\r\n+  \r\n+  // Handle both old array structure and new object structure\r\n+  let mainCategoriesCount = 0\r\n+  let totalSubcategoriesCount = 0\r\n+  let selectedCategorySubCount = 0\r\n+  const subcategoryCounts = {}\r\n+  \r\n+  if (Array.isArray(safeCategories) && safeCategories.length > 0) {\r\n+    // Old structure: array of category objects\r\n+    mainCategoriesCount = safeCategories.filter(cat => cat.enabled).length\r\n+    \r\n+    safeCategories.forEach(category => {\r\n+      const subCount = category.subcategories ? category.subcategories.filter(sub => sub.enabled).length : 0\r\n+      subcategoryCounts[category.categoryId] = subCount\r\n+      totalSubcategoriesCount += subCount\r\n+      \r\n+      // Get subcategory count for currently selected main category\r\n+      if (selectedMainCategory && category.categoryId === selectedMainCategory) {\r\n+        selectedCategorySubCount = subCount\r\n+      }\r\n+    })\r\n+  } else {\r\n+    // Fallback: use categoryIds for backward compatibility\r\n+    if (availableCategories.length > 0 && safeCategoryIds.length > 0) {\r\n+      mainCategoriesCount = safeCategoryIds.filter(id => \r\n+        availableCategories.some(cat => cat.id === id && !cat.parent)\r\n+      ).length\r\n+      \r\n+      totalSubcategoriesCount = safeCategoryIds.filter(id => \r\n+        subcategories.some(sub => sub.id === id)\r\n+      ).length\r\n+        \r\n+      selectedCategorySubCount = selectedMainCategory && safeCategoryIds ? \r\n+        safeCategoryIds.filter(id => \r\n+          subcategories.some(sub => sub.id === id && \r\n+            (sub.parent?._id === selectedMainCategory || sub.parent === selectedMainCategory)\r\n+          )\r\n+        ).length : 0\r\n+    }\r\n+  }\r\n+  \r\n+  return { \r\n+    mainCategoriesCount, \r\n+    subcategoryCounts, \r\n+    totalSubcategoriesCount,\r\n+    selectedCategorySubCount \r\n+  }\r\n+}\r\n+\r\n+  // Check if we can select more main categories\r\n+  const canSelectMoreMainCategories = () => {\r\n+    const { mainCategoriesCount } = getCurrentCounts()\r\n+    return mainCategoriesCount < MAX_MAIN_CATEGORIES\r\n+  }\r\n+\r\n+  // Check if we can select more subcategories for a specific category\r\n+  const canSelectMoreSubcategories = (categoryId) => {\r\n+    const { subcategoryCounts } = getCurrentCounts()\r\n+    const currentCount = subcategoryCounts[categoryId] || 0\r\n+    return currentCount < MAX_SUBCATEGORIES_PER_CATEGORY\r\n+  }\r\n+\r\n+  // Check if a main category is selected\r\n+  // ...existing code around line 190...\r\n+\r\n+// Check if a main category is selected\r\n+const isMainCategorySelected = (categoryId) => {\r\n+  // FIXED: Add safety check for undefined categoryIds\r\n+  const safeCategoryIds = categoryConfig.categoryIds || []\r\n+  \r\n+  if (Array.isArray(categoryConfig.categories)) {\r\n+    // Old structure\r\n+    const category = categoryConfig.categories.find(cat => cat.categoryId === categoryId)\r\n+    return category ? category.enabled : false\r\n+  } else if (typeof categoryConfig.categories === 'object') {\r\n+    // New structure\r\n+    return categoryConfig.categories[categoryId]?.selected || false\r\n+  } else {\r\n+    // Fallback\r\n+    return safeCategoryIds.includes(categoryId)\r\n+  }\r\n+}\r\n+\r\n+// Check if a subcategory is selected\r\n+const isSubcategorySelected = (subcategoryId, parentCategoryId = null) => {\r\n+  // FIXED: Add safety check for undefined categoryIds\r\n+  const safeCategoryIds = categoryConfig.categoryIds || []\r\n+  \r\n+  if (Array.isArray(categoryConfig.categories)) {\r\n+    // Old structure\r\n+    return categoryConfig.categories.some(category => \r\n+      category.subcategories && category.subcategories.some(sub => sub.categoryId === subcategoryId && sub.enabled)\r\n+    )\r\n+  } else if (typeof categoryConfig.categories === 'object' && parentCategoryId) {\r\n+    // New structure\r\n+    return categoryConfig.categories[parentCategoryId]?.subcategories?.[subcategoryId]?.selected || false\r\n+  } else {\r\n+    // Fallback\r\n+    return safeCategoryIds.includes(subcategoryId)\r\n+  }\r\n+}\r\n+\r\n+  // Find which main category a subcategory belongs to\r\n+  const findParentCategory = (subcategoryId) => {\r\n+    const subcategory = subcategories.find(sub => sub.id === subcategoryId)\r\n+    return subcategory?.parent?._id || subcategory?.parent\r\n+  }\r\n+\r\n+  // Update hierarchical category selection\r\n+  // Function removed - using simpler handleCategoryToggle approach\r\n+\r\n+  // Transform hierarchical data for backend save - FIXED to only use selected categories\r\n+  const transformForSave = () => {\r\n+    console.log('🔄 === TRANSFORM FOR SAVE START ===')\r\n+    console.log('1. Input categoryConfig:', categoryConfig)\r\n+    console.log('   - categoryConfig.categoryIds (SELECTED):', categoryConfig.categoryIds)\r\n+    \r\n+    const saveData = {\r\n+      enabled: categoryConfig.enabled,\r\n+      maxCategories: categoryConfig.maxCategories,\r\n+      layout: categoryConfig.layout,\r\n+      showSubcategories: categoryConfig.showSubcategories,\r\n+      categories: []\r\n+    }\r\n+    \r\n+    console.log('2. Base saveData structure:', saveData)\r\n+    \r\n+    // 🎯 ONLY process the categoryIds that are actually selected by the user\r\n+    console.log('3. Processing ONLY selected categoryIds...')\r\n+    console.log('   - Selected categoryIds:', categoryConfig.categoryIds)\r\n+    console.log('   - Total selected:', categoryConfig.categoryIds.length)\r\n+    \r\n+    if (categoryConfig.categoryIds && categoryConfig.categoryIds.length > 0) {\r\n+      categoryConfig.categoryIds.forEach((categoryId, index) => {\r\n+        console.log(`   - Processing selected categoryId ${index + 1}:`, categoryId)\r\n+        \r\n+        // Check if it's a main category\r\n+        const mainCategory = availableCategories.find(cat => cat.id === categoryId && !cat.parent)\r\n+        if (mainCategory) {\r\n+          console.log(`     ✅ Found main category:`, mainCategory.name)\r\n+          saveData.categories.push({\r\n+            categoryId: categoryId,\r\n+            enabled: true,\r\n+            order: index\r\n+          })\r\n+        }\r\n+        \r\n+        // Check if it's a subcategory\r\n+        const subcategory = subcategories.find(sub => sub.id === categoryId)\r\n+        if (subcategory) {\r\n+          const parentId = subcategory.parent?._id || subcategory.parent\r\n+          console.log(`     ✅ Found subcategory:`, subcategory.name, 'parent:', parentId)\r\n+          saveData.categories.push({\r\n+            categoryId: categoryId,\r\n+            enabled: true,\r\n+            order: index\r\n+          })\r\n+        }\r\n+        \r\n+        if (!mainCategory && !subcategory) {\r\n+          console.log(`     ❌ Category ID not found:`, categoryId)\r\n+        }\r\n+      })\r\n+    } else {\r\n+      console.log('   - No categories selected')\r\n+    }\r\n+    \r\n+    console.log('4. Final saveData categories:', saveData.categories)\r\n+    console.log('🔚 === TRANSFORM FOR SAVE END ===')\r\n+    \r\n+    return saveData\r\n+  }\r\n+\r\n+  // Load page configuration\r\n+  // ...existing code around line 380...\r\n+\r\n+// Load page configuration\r\n+const loadPageConfig = async (pageKey) => {\r\n+  try {\r\n+    setLoading(true)\r\n+    localStorage.setItem('authToken', ADMIN_TOKEN)\r\n+    \r\n+    const response = await get(`/pages/${pageKey}`)\r\n+    console.log('Page config response:', response)\r\n+    \r\n+    // Handle the double-wrapped response from apiService\r\n+    const actualData = response.data // This contains the backend response\r\n+    \r\n+    if (actualData && actualData.success) {\r\n+      setPageConfig(actualData.data)\r\n+      \r\n+      // Extract category section config\r\n+      const categorySection = actualData.data.sections.find(s => s.sectionType === 'categorySection')\r\n+      if (categorySection && categorySection.config) {\r\n+        // FIXED: Properly extract categoryIds and convert to flat structure\r\n+        const savedCategories = categorySection.config.categories || []\r\n+        const categoryIds = savedCategories.map(cat => cat.categoryId).filter(Boolean)\r\n+        \r\n+        setCategoryConfig({\r\n+          enabled: categorySection.enabled || false,\r\n+          maxCategories: categorySection.config.maxCategories || 10,\r\n+          layout: categorySection.config.layout || 'grid',\r\n+          showSubcategories: categorySection.config.showSubcategories || true,\r\n+          categories: savedCategories, // Keep the hierarchical structure\r\n+          categoryIds: categoryIds || [] // FIXED: Ensure this is always an array\r\n+        })\r\n+        \r\n+        console.log('📂 Loaded category config with categoryIds:', categoryIds)\r\n+        \r\n+        // Update visibility state\r\n+        setVisibleSections(prev => ({\r\n+          ...prev,\r\n+          [pageKey]: {\r\n+            ...prev[pageKey],\r\n+            giftCategories: categorySection.enabled\r\n+          }\r\n+        }))\r\n+      } else {\r\n+        // FIXED: Initialize with empty arrays when no config exists\r\n+        setCategoryConfig({\r\n+          enabled: false,\r\n+          maxCategories: 10,\r\n+          layout: 'grid',\r\n+          showSubcategories: true,\r\n+          categories: [],\r\n+          categoryIds: [] // FIXED: Ensure this is always an array\r\n+        })\r\n+      }\r\n+    }\r\n+    \r\n+    setError('')\r\n+  } catch (err) {\r\n+    console.error('Load page config error:', err)\r\n+    setError('Failed to load page configuration: ' + err.message)\r\n+    \r\n+    // FIXED: Set default config on error to prevent undefined\r\n+    setCategoryConfig({\r\n+      enabled: false,\r\n+      maxCategories: 10,\r\n+      layout: 'grid',\r\n+      showSubcategories: true,\r\n+      categories: [],\r\n+      categoryIds: [] // FIXED: Ensure this is always an array\r\n+    })\r\n+  } finally {\r\n+    setLoading(false)\r\n+  }\r\n+}\r\n+\r\n+  // Load available categories (same approach as CategoriesPage.js)\r\n+  const loadCategories = async () => {\r\n+    try {\r\n+      console.log('🔄 === LOADING CATEGORIES DEBUG ===')\r\n+      console.log('1. Setting auth token...')\r\n+      localStorage.setItem('authToken', ADMIN_TOKEN)\r\n+      \r\n+      console.log('2. Making API call to:', CATEGORY.GET_ALL)\r\n+      const response = await get(CATEGORY.GET_ALL)\r\n+      \r\n+      console.log('3. Raw API response received:')\r\n+      console.log('   - Response object:', response)\r\n+      console.log('   - Response type:', typeof response)\r\n+      console.log('   - Response keys:', Object.keys(response || {}))\r\n+      console.log('   - Response.success:', response?.success)\r\n+      console.log('   - Response.data:', response?.data)\r\n+      console.log('   - Response.data type:', typeof response?.data)\r\n+      console.log('   - Response.data is array:', Array.isArray(response?.data))\r\n+      \r\n+      if (!response.success) {\r\n+        console.error('4. ❌ API response failed:', response.error)\r\n+        throw new Error(response.error || 'Failed to fetch categories')\r\n+      }\r\n+      \r\n+      console.log('4. ✅ API response successful')\r\n+      console.log('5. Processing response.data...')\r\n+      console.log('   - Raw response.data:', JSON.stringify(response.data, null, 2))\r\n+      \r\n+      // Ensure response.data is an array\r\n+      let categoriesData = []\r\n+      if (Array.isArray(response.data)) {\r\n+        console.log('   - Response.data is direct array with', response.data.length, 'items')\r\n+        categoriesData = response.data\r\n+      } else if (response.data && typeof response.data === 'object') {\r\n+        console.log('   - Response.data is object, checking for nested arrays...')\r\n+        if (Array.isArray(response.data.categories)) {\r\n+          console.log('   - Found response.data.categories array with', response.data.categories.length, 'items')\r\n+          categoriesData = response.data.categories\r\n+        } else if (Array.isArray(response.data.data)) {\r\n+          console.log('   - Found response.data.data array with', response.data.data.length, 'items')\r\n+          categoriesData = response.data.data\r\n+        } else {\r\n+          console.log('   - No recognizable array found in response.data')\r\n+          categoriesData = []\r\n+        }\r\n+      }\r\n+      \r\n+      console.log('6. Categories data to process:')\r\n+      console.log('   - Array length:', categoriesData.length)\r\n+      console.log('   - Sample items (first 3):')\r\n+      categoriesData.slice(0, 3).forEach((cat, index) => {\r\n+        console.log(`     ${index + 1}.`, cat)\r\n+      })\r\n+      \r\n+      // Transform categories for display in the admin panel\r\n+      console.log('7. Transforming categories...')\r\n+      const transformedCategories = categoriesData.map((cat, index) => {\r\n+        console.log(`   - Transforming category ${index + 1}:`, {\r\n+          originalId: cat._id,\r\n+          originalName: cat.name,\r\n+          hasParent: !!cat.parent,\r\n+          parentInfo: cat.parent\r\n+        })\r\n+        \r\n+        return {\r\n+          id: cat.id || cat._id,\r\n+          value: cat.id || cat._id,\r\n+          label: cat.name,\r\n+          name: cat.name,\r\n+          image: cat.image?.url || '/assets/img/product/category/default-category.svg',\r\n+          description: cat.description || '',\r\n+          parent: cat.parent\r\n+        }\r\n+      })\r\n+      \r\n+      console.log('8. Final transformed categories:')\r\n+      console.log('   - Total transformed:', transformedCategories.length)\r\n+      console.log('   - Main categories:', transformedCategories.filter(cat => !cat.parent).length)\r\n+      console.log('   - Sub categories:', transformedCategories.filter(cat => cat.parent).length)\r\n+      console.log('   - Full transformed data:', transformedCategories)\r\n+      \r\n+      console.log('9. Setting availableCategories state...')\r\n+      setAvailableCategories(transformedCategories)\r\n+      setError('')\r\n+      \r\n+      console.log('10. ✅ Categories loaded successfully!')\r\n+      console.log('🔚 === END LOADING CATEGORIES DEBUG ===')\r\n+      \r\n+    } catch (err) {\r\n+      console.error('❌ === LOAD CATEGORIES ERROR ===')\r\n+      console.error('Error details:', {\r\n+        message: err.message,\r\n+        stack: err.stack,\r\n+        name: err.name\r\n+      })\r\n+      console.error('Raw error object:', err)\r\n+      setError('Failed to load categories: ' + err.message)\r\n+      setAvailableCategories([])\r\n+    }\r\n+  }\r\n+\r\n+  // Load subcategories from separate subcategories collection\r\n+  const loadSubcategories = async () => {\r\n+    try {\r\n+      console.log('🔄 === LOADING SUBCATEGORIES DEBUG ===')\r\n+      console.log('1. Setting auth token...')\r\n+      localStorage.setItem('authToken', ADMIN_TOKEN)\r\n+      \r\n+      console.log('2. Making API call to:', SUBCATEGORY.GET_ALL)\r\n+      const response = await get(SUBCATEGORY.GET_ALL)\r\n+      \r\n+      console.log('3. Raw subcategories response:')\r\n+      console.log('   - Response object:', response)\r\n+      console.log('   - Response.success:', response?.success)\r\n+      console.log('   - Response.data:', response?.data)\r\n+      console.log('   - Response.data is array:', Array.isArray(response?.data))\r\n+      \r\n+      if (!response.success) {\r\n+        console.error('4. ❌ Subcategories API response failed:', response.error)\r\n+        throw new Error(response.error || 'Failed to fetch subcategories')\r\n+      }\r\n+      \r\n+      console.log('4. ✅ Subcategories API response successful')\r\n+      console.log('5. Processing subcategories data...')\r\n+      \r\n+      let subcategoriesData = []\r\n+      if (Array.isArray(response.data)) {\r\n+        subcategoriesData = response.data\r\n+      } else if (response.data && Array.isArray(response.data.data)) {\r\n+        subcategoriesData = response.data.data\r\n+      }\r\n+      \r\n+      console.log('6. Subcategories data to process:')\r\n+      console.log('   - Array length:', subcategoriesData.length)\r\n+      console.log('   - Sample items (first 3):')\r\n+      subcategoriesData.slice(0, 3).forEach((subcat, index) => {\r\n+        console.log(`     ${index + 1}.`, {\r\n+          id: subcat._id,\r\n+          name: subcat.name,\r\n+          parent: subcat.parent,\r\n+          status: subcat.status\r\n+        })\r\n+      })\r\n+      \r\n+      // Transform subcategories for display\r\n+      const transformedSubcategories = subcategoriesData.map((subcat, index) => {\r\n+        console.log(`   - Transforming subcategory ${index + 1}:`, {\r\n+          originalId: subcat._id,\r\n+          originalName: subcat.name,\r\n+          parentId: subcat.parent?._id || subcat.parent,\r\n+          parentName: subcat.parent?.name\r\n+        })\r\n+        \r\n+        return {\r\n+          id: subcat.id || subcat._id,\r\n+          value: subcat.id || subcat._id,\r\n+          label: subcat.name,\r\n+          name: subcat.name,\r\n+          image: subcat.image?.url || '/assets/img/product/category/default-subcategory.svg',\r\n+          description: subcat.description || '',\r\n+          parent: subcat.parent,\r\n+          status: subcat.status\r\n+        }\r\n+      })\r\n+      \r\n+      console.log('7. Final transformed subcategories:')\r\n+      console.log('   - Total transformed:', transformedSubcategories.length)\r\n+      console.log('   - Full transformed data:', transformedSubcategories)\r\n+      \r\n+      console.log('8. Setting subcategories state...')\r\n+      setSubcategories(transformedSubcategories)\r\n+      \r\n+      console.log('9. ✅ Subcategories loaded successfully!')\r\n+      console.log('🔚 === END LOADING SUBCATEGORIES DEBUG ===')\r\n+      \r\n+    } catch (err) {\r\n+      console.error('❌ === LOAD SUBCATEGORIES ERROR ===')\r\n+      console.error('Error details:', {\r\n+        message: err.message,\r\n+        stack: err.stack,\r\n+        name: err.name\r\n+      })\r\n+      setSubcategories([])\r\n+    }\r\n+  }\r\n+\r\n+  // Save category section configuration\r\n+  const saveCategoryConfig = async () => {\r\n+    console.log('🚀 === SAVE CATEGORY CONFIG START ===')\r\n+    console.log('1. Save function triggered')\r\n+    \r\n+    try {\r\n+      console.log('2. Setting loading state to true')\r\n+      setLoading(true)\r\n+      \r\n+      console.log('3. Setting auth token in localStorage')\r\n+      localStorage.setItem('authToken', ADMIN_TOKEN)\r\n+      console.log('   - Auth token set:', ADMIN_TOKEN.substring(0, 20) + '...')\r\n+      \r\n+      console.log('4. Getting current counts for validation')\r\n+      const { mainCategoriesCount } = getCurrentCounts()\r\n+      console.log('   - Main categories count:', mainCategoriesCount)\r\n+      console.log('   - MIN_MAIN_CATEGORIES:', MIN_MAIN_CATEGORIES)\r\n+      console.log('   - MAX_MAIN_CATEGORIES:', MAX_MAIN_CATEGORIES)\r\n+      \r\n+      if (mainCategoriesCount < MIN_MAIN_CATEGORIES) {\r\n+        console.log('❌ Validation failed: Too few main categories')\r\n+        setError(`Please select at least ${MIN_MAIN_CATEGORIES} main category before saving.`)\r\n+        return\r\n+      }\r\n+      \r\n+      if (mainCategoriesCount > MAX_MAIN_CATEGORIES) {\r\n+        console.log('❌ Validation failed: Too many main categories')\r\n+        setError(`Too many main categories selected. Maximum ${MAX_MAIN_CATEGORIES} allowed.`)\r\n+        return\r\n+      }\r\n+      \r\n+      console.log('✅ Validation passed')\r\n+      \r\n+      console.log('5. Current categoryConfig state before transform:')\r\n+      console.log('   - categoryConfig.enabled:', categoryConfig.enabled)\r\n+      console.log('   - categoryConfig.maxCategories:', categoryConfig.maxCategories)\r\n+      console.log('   - categoryConfig.layout:', categoryConfig.layout)\r\n+      console.log('   - categoryConfig.showSubcategories:', categoryConfig.showSubcategories)\r\n+      console.log('   - categoryConfig.categories:', categoryConfig.categories)\r\n+      console.log('   - categoryConfig.categoryIds:', categoryConfig.categoryIds)\r\n+      \r\n+      // Transform hierarchical data for save\r\n+      console.log('6. Transforming data for save...')\r\n+      const configData = transformForSave()\r\n+      console.log('7. Transformed config data:')\r\n+      console.log('   - Full configData object:', JSON.stringify(configData, null, 2))\r\n+      console.log('   - configData.enabled:', configData.enabled)\r\n+      console.log('   - configData.categories length:', configData.categories?.length || 0)\r\n+      \r\n+      console.log('8. Preparing API request')\r\n+      const apiEndpoint = '/pages/home/sections/category'\r\n+      console.log('   - API endpoint:', apiEndpoint)\r\n+      console.log('   - Request method: PUT')\r\n+      console.log('   - Request data:', configData)\r\n+      console.log('   - Request headers will include auth token')\r\n+      \r\n+      console.log('9. Making API request...')\r\n+      const response = await put(apiEndpoint, configData)\r\n+      console.log('10. API response received:')\r\n+      console.log('    - Raw response:', response)\r\n+      console.log('    - Response type:', typeof response)\r\n+      console.log('    - Response keys:', Object.keys(response || {}))\r\n+      console.log('    - Response.data:', response?.data)\r\n+      console.log('    - Response.status:', response?.status)\r\n+      console.log('    - Response.success:', response?.success)\r\n+      \r\n+      // Handle the double-wrapped response from apiService\r\n+      console.log('11. Processing response data...')\r\n+      const actualData = response.data // This contains the backend response\r\n+      console.log('    - actualData:', actualData)\r\n+      console.log('    - actualData type:', typeof actualData)\r\n+      console.log('    - actualData.success:', actualData?.success)\r\n+      console.log('    - actualData.message:', actualData?.message)\r\n+      \r\n+      if (actualData && actualData.success) {\r\n+        console.log('✅ Save successful!')\r\n+        setSuccess('Category section configuration saved successfully!')\r\n+        setTimeout(() => setSuccess(''), 3000)\r\n+        setShowCategoryConfig(false)\r\n+        \r\n+        // Trigger refresh notification (optional)\r\n+        try {\r\n+          console.log('12. Triggering homepage refresh...')\r\n+          await get('/api/pages/home/refresh/categorySection')\r\n+          console.log('    - Homepage refresh successful')\r\n+        } catch (refreshError) {\r\n+          console.log('⚠️ Refresh notification failed, but save was successful:', refreshError)\r\n+        }\r\n+        \r\n+        // 🎯 REMOVED: Don't reload page config as it overwrites user selections\r\n+        // The loadPageConfig call was causing the categoryIds to be overwritten with old database values\r\n+        // console.log('13. Reloading page config...')\r\n+        // await loadPageConfig(selectedPage) // 🚨 THIS WAS CAUSING THE PROBLEM!\r\n+        // console.log('14. Page config reloaded')\r\n+        \r\n+        console.log('13. Save completed successfully - user selections preserved')\r\n+      } else {\r\n+        console.log('❌ Save failed - API returned unsuccessful response')\r\n+        console.log('    - actualData:', actualData)\r\n+        const errorMessage = actualData?.message || 'Unknown error'\r\n+        console.log('    - Error message:', errorMessage)\r\n+        setError('Failed to save configuration: ' + errorMessage)\r\n+      }\r\n+      \r\n+    } catch (err) {\r\n+      console.error('❌ === SAVE CATEGORY CONFIG ERROR ===')\r\n+      console.error('Error caught in try-catch:')\r\n+      console.error('   - Error object:', err)\r\n+      console.error('   - Error message:', err.message)\r\n+      console.error('   - Error name:', err.name)\r\n+      console.error('   - Error stack:', err.stack)\r\n+      \r\n+      if (err.response) {\r\n+        console.error('   - HTTP Response Error Details:')\r\n+        console.error('     - Status:', err.response.status)\r\n+        console.error('     - Status text:', err.response.statusText)\r\n+        console.error('     - Response data:', err.response.data)\r\n+        console.error('     - Response headers:', err.response.headers)\r\n+      }\r\n+      \r\n+      if (err.request) {\r\n+        console.error('   - Request Error Details:')\r\n+        console.error('     - Request object:', err.request)\r\n+      }\r\n+      \r\n+      setError('Failed to save category configuration: ' + err.message)\r\n+    } finally {\r\n+      console.log('15. Setting loading state to false')\r\n+      setLoading(false)\r\n+      console.log('🔚 === SAVE CATEGORY CONFIG END ===')\r\n+    }\r\n+  }\r\n+\r\n+  // Toggle section visibility\r\n+  const handleToggleSection = async (page, section) => {\r\n+    if (section === 'giftCategories') {\r\n+      // For category section, update the actual config\r\n+      setCategoryConfig(prev => ({ ...prev, enabled: !prev.enabled }))\r\n+      return\r\n+    }\r\n+    \r\n+    const newVisibility = {\r\n+      ...visibleSections,\r\n+      [page]: {\r\n+        ...visibleSections[page],\r\n+        [section]: !visibleSections[page][section],\r\n+      }\r\n+    }\r\n+    \r\n+    setVisibleSections(newVisibility)\r\n+  }\r\n+\r\n+  // Open category configuration modal\r\n+  const openCategoryConfig = () => {\r\n+    setShowCategoryConfig(true)\r\n+    // Reset to first main category when opening modal\r\n+    const mainCategories = availableCategories.filter(cat => !cat.parent)\r\n+    if (mainCategories.length > 0) {\r\n+      setSelectedMainCategory(mainCategories[0].id)\r\n+    }\r\n+  }\r\n+\r\n+  // Handle category selection with validation - SIMPLIFIED for current structure\r\n+  const handleCategoryToggle = (categoryId, parentCategoryId = null) => {\r\n+    const isMainCategory = !parentCategoryId && availableCategories.some(cat => cat.id === categoryId && !cat.parent)\r\n+    \r\n+    console.log('🎯 Category toggle triggered:', { categoryId, parentCategoryId, isMainCategory })\r\n+    \r\n+    if (isMainCategory) {\r\n+      const isCurrentlySelected = categoryConfig.categoryIds.includes(categoryId)\r\n+      const currentMainCount = categoryConfig.categoryIds.filter(id => \r\n+        availableCategories.some(cat => cat.id === id && !cat.parent)\r\n+      ).length\r\n+      \r\n+      console.log('📊 Main category status:', { isCurrentlySelected, currentCount: currentMainCount })\r\n+      \r\n+      // Validation for main categories\r\n+      if (!isCurrentlySelected) {\r\n+        // Trying to select\r\n+        if (currentMainCount >= MAX_MAIN_CATEGORIES) {\r\n+          setError(`Cannot select more main categories. Maximum ${MAX_MAIN_CATEGORIES} allowed.`)\r\n+          return\r\n+        }\r\n+      } else {\r\n+        // Trying to deselect\r\n+        if (currentMainCount <= MIN_MAIN_CATEGORIES) {\r\n+          setError(`Cannot deselect this category. At least ${MIN_MAIN_CATEGORIES} main category must be selected.`)\r\n+          return\r\n+        }\r\n+      }\r\n+      \r\n+      // Clear any existing errors\r\n+      setError('')\r\n+      \r\n+      // 🎯 Update categoryIds array with actual selections\r\n+      setCategoryConfig(prev => {\r\n+        let newCategoryIds = [...prev.categoryIds]\r\n+        \r\n+        if (!isCurrentlySelected) {\r\n+          // Add to selection\r\n+          console.log('✅ Adding main category to selection:', categoryId)\r\n+          newCategoryIds.push(categoryId)\r\n+        } else {\r\n+          // Remove from selection (and remove all its subcategories too)\r\n+          const subcategoriesOfThisCategory = subcategories\r\n+            .filter(sub => (sub.parent?._id || sub.parent) === categoryId)\r\n+            .map(sub => sub.id)\r\n+          \r\n+          console.log('❌ Removing main category and its subcategories:', {\r\n+            mainCategory: categoryId,\r\n+            subcategories: subcategoriesOfThisCategory\r\n+          })\r\n+          \r\n+          newCategoryIds = newCategoryIds.filter(id => \r\n+            id !== categoryId && !subcategoriesOfThisCategory.includes(id)\r\n+          )\r\n+        }\r\n+        \r\n+        console.log('📝 Updated categoryIds:', newCategoryIds)\r\n+        \r\n+        return {\r\n+          ...prev,\r\n+          categoryIds: newCategoryIds\r\n+        }\r\n+      })\r\n+      \r\n+    } else {\r\n+      // Subcategory logic\r\n+      const isCurrentlySelected = categoryConfig.categoryIds.includes(categoryId)\r\n+      const parentId = parentCategoryId || findParentCategory(categoryId)\r\n+      \r\n+      console.log('📊 Subcategory status:', { isCurrentlySelected, parentId })\r\n+      \r\n+      if (!isCurrentlySelected && parentId) {\r\n+        // Check subcategory limit for this parent\r\n+        const currentSubCount = categoryConfig.categoryIds.filter(id => \r\n+          subcategories.some(sub => sub.id === id && (sub.parent?._id || sub.parent) === parentId)\r\n+        ).length\r\n+        \r\n+        if (currentSubCount >= MAX_SUBCATEGORIES_PER_CATEGORY) {\r\n+          const parentName = availableCategories.find(cat => cat.id === parentId)?.name || 'this category'\r\n+          setError(`Cannot select more subcategories for ${parentName}. Maximum ${MAX_SUBCATEGORIES_PER_CATEGORY} per category allowed.`)\r\n+          return\r\n+        }\r\n+      }\r\n+      \r\n+      // Clear any existing errors\r\n+      setError('')\r\n+      \r\n+      // 🎯 Update categoryIds array for subcategory\r\n+      setCategoryConfig(prev => {\r\n+        let newCategoryIds = [...prev.categoryIds]\r\n+        \r\n+        if (!isCurrentlySelected) {\r\n+          // Add subcategory to selection\r\n+          console.log('✅ Adding subcategory to selection:', categoryId)\r\n+          newCategoryIds.push(categoryId)\r\n+          \r\n+          // Also ensure parent is selected\r\n+          if (parentId && !newCategoryIds.includes(parentId)) {\r\n+            console.log('✅ Auto-adding parent category:', parentId)\r\n+            newCategoryIds.push(parentId)\r\n+          }\r\n+        } else {\r\n+          // Remove subcategory from selection\r\n+          console.log('❌ Removing subcategory from selection:', categoryId)\r\n+          newCategoryIds = newCategoryIds.filter(id => id !== categoryId)\r\n+        }\r\n+        \r\n+        console.log('📝 Updated categoryIds:', newCategoryIds)\r\n+        \r\n+        return {\r\n+          ...prev,\r\n+          categoryIds: newCategoryIds\r\n+        }\r\n+      })\r\n+    }\r\n+  }\r\n+\r\n+  // Handle max categories change\r\n+  const handleMaxCategoriesChange = (value) => {\r\n+    const numValue = parseInt(value) || 0\r\n+    setCategoryConfig(prev => ({ ...prev, maxCategories: numValue }))\r\n+  }\r\n+\r\n+  // Load data when page changes\r\n+  useEffect(() => {\r\n+    const loadData = async () => {\r\n+      await loadPageConfig(selectedPage)\r\n+      await loadCategories()\r\n+      await loadSubcategories()\r\n+    }\r\n+    loadData()\r\n+  }, [selectedPage])\r\n+\r\n+  // Get sections for current page\r\n+  const getCurrentSections = () => {\r\n+    return selectedPage === \"home\" ? homeSections : corporateSections\r\n+  }\r\n+\r\n+  // Render category configuration modal using modular component\r\n+  const renderCategoryConfigModal = () => {\r\n+    return (\r\n+      <CategoryConfigModal\r\n+        showModal={showCategoryConfig}\r\n+        onClose={() => setShowCategoryConfig(false)}\r\n+        categoryConfig={categoryConfig}\r\n+        setCategoryConfig={setCategoryConfig}\r\n+        availableCategories={availableCategories}\r\n+        subcategories={subcategories}\r\n+        selectedMainCategory={selectedMainCategory}\r\n+        setSelectedMainCategory={setSelectedMainCategory}\r\n+        getCurrentCounts={getCurrentCounts}\r\n+        handleCategoryToggle={handleCategoryToggle}\r\n+        handleMaxCategoriesChange={handleMaxCategoriesChange}\r\n+        saveCategoryConfig={saveCategoryConfig}\r\n+        loading={loading}\r\n+        error={error}\r\n+        setError={setError}\r\n+      />\r\n+    )\r\n+  }\r\n+\r\n+  // Move section up/down\r\n+  const handleMoveSection = async (page, sectionKey, direction) => {\r\n+    const sections = page === \"home\" ? homeSections : corporateSections\r\n+    const currentIndex = sections.findIndex(s => s.key === sectionKey)\r\n+    \r\n+    if (direction === 'up' && currentIndex > 0) {\r\n+      // Move up logic - would need to update order\r\n+      console.log(`Moving ${sectionKey} up`)\r\n+    } else if (direction === 'down' && currentIndex < sections.length - 1) {\r\n+      // Move down logic - would need to update order\r\n+      console.log(`Moving ${sectionKey} down`)\r\n+    }\r\n+    \r\n+    // TODO: Implement actual reordering\r\n+    setSuccess('Section order updated!')\r\n+    setTimeout(() => setSuccess(''), 2000)\r\n+  }\r\n+\r\n+  // Render section controls\r\n+  const renderSections = () => {\r\n+    const sections = getCurrentSections()\r\n+    const currentPage = PAGES.find(p => p.key === selectedPage)\r\n+    \r\n+    return (\r\n+      <div className=\"col-md-9\">\r\n+        <div className=\"card border-0 shadow-sm\">\r\n+          <div className=\"card-header bg-white border-bottom\">\r\n+            <div className=\"d-flex justify-content-between align-items-center\">\r\n+              <div>\r\n+                <h5 className=\"mb-1 fw-semibold\">{currentPage.label}</h5>\r\n+                <p className=\"text-muted mb-0 small\">{currentPage.description}</p>\r\n+              </div>\r\n+              <span className=\"badge bg-primary\">\r\n+                {sections.filter(s => visibleSections[selectedPage][s.key]).length} active\r\n+              </span>\r\n+            </div>\r\n+          </div>\r\n+          \r\n+          <div className=\"card-body p-0\">\r\n+            {sections.length === 0 ? (\r\n+              <div className=\"text-center py-5\">\r\n+                <i className=\"bi bi-grid\" style={{ fontSize: '3rem', color: '#6c757d' }}></i>\r\n+                <p className=\"mt-2 text-muted\">No sections configured for this page.</p>\r\n+              </div>\r\n+            ) : (\r\n+              <div className=\"table-responsive\">\r\n+                <table className=\"table table-hover mb-0\">\r\n+                  <thead className=\"table-light\">\r\n+                    <tr>\r\n+                      <th className=\"ps-4\">Section</th>\r\n+                      <th>Description</th>\r\n+                      <th>Order</th>\r\n+                      <th>Status</th>\r\n+                      <th className=\"text-center\">Actions</th>\r\n+                    </tr>\r\n+                  </thead>\r\n+                  <tbody>\r\n+                    {sections.map((section, index) => {\r\n+                      const isVisible = visibleSections[selectedPage][section.key]\r\n+                      const isCategorySection = section.key === 'giftCategories'\r\n+                      \r\n+                      return (\r\n+                        <tr key={section.key} className={isVisible ? '' : 'table-secondary'}>\r\n+                          <td className=\"ps-4\">\r\n+                            <div className=\"d-flex align-items-center\">\r\n+                              <div>\r\n+                                <div className=\"fw-semibold\">{section.label}</div>\r\n+                                {isCategorySection && categoryConfig.categoryIds.length > 0 && (\r\n+                                  <small className=\"text-muted\">\r\n+                                    {categoryConfig.categoryIds.length} categories selected\r\n+                                  </small>\r\n+                                )}\r\n+                              </div>\r\n+                            </div>\r\n+                          </td>\r\n+                          <td>\r\n+                            <span className=\"text-muted\">{section.description}</span>\r\n+                          </td>\r\n+                          <td>\r\n+                            <span className=\"badge bg-light text-dark\">{section.order}</span>\r\n+                          </td>\r\n+                          <td>\r\n+                            <div className=\"form-check form-switch\">\r\n+                              <input \r\n+                                className=\"form-check-input\" \r\n+                                type=\"checkbox\" \r\n+                                checked={isCategorySection ? categoryConfig.enabled : isVisible}\r\n+                                onChange={() => handleToggleSection(selectedPage, section.key)}\r\n+                                id={`toggle-${section.key}`}\r\n+                              />\r\n+                              <label className=\"form-check-label\" htmlFor={`toggle-${section.key}`}>\r\n+                                {isCategorySection ? (categoryConfig.enabled ? 'Enabled' : 'Disabled') : (isVisible ? 'Visible' : 'Hidden')}\r\n+                              </label>\r\n+                            </div>\r\n+                          </td>\r\n+                          <td className=\"text-center\">\r\n+                            <div className=\"btn-group btn-group-sm\">\r\n+                              {section.hasConfig && (\r\n+                                <button\r\n+                                  className=\"btn btn-outline-primary\"\r\n+                                  onClick={openCategoryConfig}\r\n+                                  title=\"Configure section\"\r\n+                                >\r\n+                                  <i className=\"bi bi-gear\"></i>\r\n+                                </button>\r\n+                              )}\r\n+                              <button\r\n+                                className=\"btn btn-outline-secondary\"\r\n+                                onClick={() => handleMoveSection(selectedPage, section.key, 'up')}\r\n+                                disabled={index === 0}\r\n+                                title=\"Move up\"\r\n+                              >\r\n+                                <i className=\"bi bi-arrow-up\"></i>\r\n+                              </button>\r\n+                              <button\r\n+                                className=\"btn btn-outline-secondary\"\r\n+                                onClick={() => handleMoveSection(selectedPage, section.key, 'down')}\r\n+                                disabled={index === sections.length - 1}\r\n+                                title=\"Move down\"\r\n+                              >\r\n+                                <i className=\"bi bi-arrow-down\"></i>\r\n+                              </button>\r\n+                            </div>\r\n+                          </td>\r\n+                        </tr>\r\n+                      )\r\n+                    })}\r\n+                  </tbody>\r\n+                </table>\r\n+              </div>\r\n+            )}\r\n+          </div>\r\n+        </div>\r\n+      </div>\r\n+    )\r\n+  }\r\n+\r\n+  // Render page sidebar\r\n+  const renderPageSidebar = () => (\r\n+    <div className=\"col-md-3\">\r\n+      <div className=\"card border-0 shadow-sm\">\r\n+        <div className=\"card-header bg-white border-bottom\">\r\n+          <h6 className=\"mb-0 fw-semibold\">\r\n+            <i className=\"bi bi-file-earmark-text me-2\"></i>\r\n+            Pages\r\n+          </h6>\r\n+        </div>\r\n+        <div className=\"card-body p-0\">\r\n+          <div className=\"list-group list-group-flush\">\r\n+            {PAGES.map((page) => {\r\n+              const isActive = selectedPage === page.key\r\n+              const activeCount = visibleSections[page.key] ? \r\n+                Object.values(visibleSections[page.key]).filter(Boolean).length : 0\r\n+              \r\n+              return (\r\n+                <button\r\n+                  key={page.key}\r\n+                  className={`list-group-item list-group-item-action border-0 ${isActive ? 'active' : ''}`}\r\n+                  onClick={() => setSelectedPage(page.key)}\r\n+                  disabled={loading}\r\n+                >\r\n+                  <div className=\"d-flex justify-content-between align-items-center\">\r\n+                    <div>\r\n+                      <div className=\"fw-semibold\">{page.label}</div>\r\n+                      <small className={isActive ? 'text-white-50' : 'text-muted'}>\r\n+                        {page.description}\r\n+                      </small>\r\n+                    </div>\r\n+                    <span className={`badge ${isActive ? 'bg-white text-primary' : 'bg-primary'}`}>\r\n+                      {activeCount}\r\n+                    </span>\r\n+                  </div>\r\n+                </button>\r\n+              )\r\n+            })}\r\n+          </div>\r\n+        </div>\r\n+      </div>\r\n+    </div>\r\n+  )\r\n+\r\n+  return (\r\n+    <div className=\"container-fluid\">\r\n+      {/* Page Header */}\r\n+      <div className=\"row mb-4\">\r\n+        <div className=\"col-12\">\r\n+          <div className=\"d-flex justify-content-between align-items-center\">\r\n+            <div>\r\n+              <h2 className=\"fw-bold text-dark mb-1\">Pages Management</h2>\r\n+              <p className=\"text-muted mb-0\">Control which sections appear on each page</p>\r\n+            </div>\r\n+            <div className=\"d-flex gap-2\">\r\n+              <button\r\n+                className=\"btn btn-outline-primary\"\r\n+                onClick={() => loadPageConfig(selectedPage)}\r\n+                disabled={loading}\r\n+              >\r\n+                <i className=\"bi bi-arrow-clockwise me-2\"></i>\r\n+                Refresh\r\n+              </button>\r\n+            </div>\r\n+          </div>\r\n+        </div>\r\n+      </div>\r\n+\r\n+      {/* Status Messages */}\r\n+      {error && (\r\n+        <div className=\"row mb-3\">\r\n+          <div className=\"col-12\">\r\n+            <div className=\"alert alert-danger d-flex align-items-center\" role=\"alert\">\r\n+              <i className=\"bi bi-exclamation-triangle-fill me-2\"></i>\r\n+              <div>{error}</div>\r\n+              <button\r\n+                type=\"button\"\r\n+                className=\"btn-close ms-auto\"\r\n+                onClick={() => setError('')}\r\n+              ></button>\r\n+            </div>\r\n+          </div>\r\n+        </div>\r\n+      )}\r\n+\r\n+      {success && (\r\n+        <div className=\"row mb-3\">\r\n+          <div className=\"col-12\">\r\n+            <div className=\"alert alert-success d-flex align-items-center\" role=\"alert\">\r\n+              <i className=\"bi bi-check-circle-fill me-2\"></i>\r\n+              <div>{success}</div>\r\n+              <button\r\n+                type=\"button\"\r\n+                className=\"btn-close ms-auto\"\r\n+                onClick={() => setSuccess('')}\r\n+              ></button>\r\n+            </div>\r\n+          </div>\r\n+        </div>\r\n+      )}\r\n+\r\n+      {/* Main Content */}\r\n+      <div className=\"row\">\r\n+        {renderPageSidebar()}\r\n+        {renderSections()}\r\n+      </div>\r\n+\r\n+      {/* Category Configuration Modal */}\r\n+      {renderCategoryConfigModal()}\r\n+\r\n+      {/* Loading Overlay */}\r\n+      {loading && (\r\n+        <div className=\"position-fixed top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center\" \r\n+             style={{ backgroundColor: 'rgba(0,0,0,0.5)', zIndex: 9999 }}>\r\n+          <div className=\"spinner-border text-primary\" role=\"status\">\r\n+            <span className=\"visually-hidden\">Loading...</span>\r\n+          </div>\r\n+        </div>\r\n+      )}\r\n+    </div>\r\n+  )\r\n+}\r\n"
                },
                {
                    "date": 1753289801162,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -667,9 +667,9 @@\n         \r\n         // Trigger refresh notification (optional)\r\n         try {\r\n           console.log('12. Triggering homepage refresh...')\r\n-          await get('/api/pages/home/refresh/categorySection')\r\n+          await get('/pages/home/refresh/categorySection')\r\n           console.log('    - Homepage refresh successful')\r\n         } catch (refreshError) {\r\n           console.log('⚠️ Refresh notification failed, but save was successful:', refreshError)\r\n         }\r\n"
                },
                {
                    "date": 1753456327502,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -903,8 +903,10 @@\n         saveCategoryConfig={saveCategoryConfig}\r\n         loading={loading}\r\n         error={error}\r\n         setError={setError}\r\n+        selectedPage={selectedPage}\r\n+        ADMIN_TOKEN={ADMIN_TOKEN}\r\n       />\r\n     )\r\n   }\r\n \r\n@@ -1166,1899 +1168,4 @@\n       )}\r\n     </div>\r\n   )\r\n }\r\n-'use client'\r\n-import React, { useState, useEffect } from 'react'\r\n-import { get, post, put } from '@/util/apiService'\r\n-import { CATEGORY, SUBCATEGORY } from '@/util/apiEndpoints'\r\n-\r\n-const PAGES = [\r\n-  { \r\n-    key: \"home\", \r\n-    label: \"Home Page\",\r\n-    description: \"Manage sections displayed on the homepage\"\r\n-  },\r\n-  { \r\n-    key: \"corporate\", \r\n-    label: \"Corporate Page\",\r\n-    description: \"Manage sections for corporate customers\"\r\n-  }\r\n-]\r\n-\r\n-export default function PagesManagement({ onNavigate }) {\r\n-  const [selectedPage, setSelectedPage] = useState(\"home\")\r\n-  const [loading, setLoading] = useState(false)\r\n-  const [error, setError] = useState('')\r\n-  const [success, setSuccess] = useState('')\r\n-  const [showCategoryConfig, setShowCategoryConfig] = useState(false)\r\n-  const [availableCategories, setAvailableCategories] = useState([])\r\n-  const [subcategories, setSubcategories] = useState([])\r\n-  const [pageConfig, setPageConfig] = useState(null)\r\n-\r\n-  // Category section configuration state - NEW HIERARCHICAL STRUCTURE\r\n-  const [categoryConfig, setCategoryConfig] = useState({\r\n-  enabled: true,\r\n-  maxCategories: 10,\r\n-  layout: 'grid',\r\n-  showSubcategories: true,\r\n-  // New hierarchical structure\r\n-  categories: [],\r\n-  // FIXED: Always initialize as empty array, not undefined\r\n-  categoryIds: []\r\n-})\r\n-\r\n-// ...existing code around line 1612...\r\n-\r\n-// FIX: Add null safety check for categoryIds\r\n-\r\n-  // Business rule constants\r\n-  const MAX_MAIN_CATEGORIES = 10\r\n-  const MIN_MAIN_CATEGORIES = 1\r\n-  const MAX_SUBCATEGORIES_PER_CATEGORY = 10\r\n-\r\n-  // UI state for category selection\r\n-  const [selectedMainCategory, setSelectedMainCategory] = useState(null)\r\n-\r\n-  // Define sections for each page\r\n-  const homeSections = [\r\n-    { \r\n-      key: \"giftCategories\", \r\n-      label: \"Gift Categories\", \r\n-      description: \"Display category grid with gifts\",\r\n-      order: 1,\r\n-      hasConfig: true\r\n-    },\r\n-    { \r\n-      key: \"slider\", \r\n-      label: \"Main Slider\", \r\n-      description: \"Hero banner with promotional slides\",\r\n-      order: 2\r\n-    },\r\n-    { \r\n-      key: \"services\", \r\n-      label: \"Services Section\", \r\n-      description: \"Highlight key services and benefits\",\r\n-      order: 3\r\n-    },\r\n-    { \r\n-      key: \"products\", \r\n-      label: \"Featured Products\", \r\n-      description: \"Showcase featured/trending products\",\r\n-      order: 4\r\n-    },\r\n-    { \r\n-      key: \"banner\", \r\n-      label: \"Promotional Banner\", \r\n-      description: \"Secondary promotional content\",\r\n-      order: 5\r\n-    },\r\n-    { \r\n-      key: \"dealProduct\", \r\n-      label: \"Deal Products\", \r\n-      description: \"Special offers and discounted items\",\r\n-      order: 6\r\n-    }\r\n-  ]\r\n-\r\n-  const corporateSections = [\r\n-    { \r\n-      key: \"corporateBanner\", \r\n-      label: \"Corporate Banner\", \r\n-      description: \"Hero section for corporate clients\",\r\n-      order: 1\r\n-    },\r\n-    { \r\n-      key: \"corporateServices\", \r\n-      label: \"Corporate Services\", \r\n-      description: \"B2B services and solutions\",\r\n-      order: 2\r\n-    },\r\n-    { \r\n-      key: \"corporateTestimonials\", \r\n-      label: \"Client Testimonials\", \r\n-      description: \"Corporate client reviews and case studies\",\r\n-      order: 3\r\n-    },\r\n-    { \r\n-      key: \"corporatePartners\", \r\n-      label: \"Partner Logos\", \r\n-      description: \"Display trusted corporate partners\",\r\n-      order: 4\r\n-    }\r\n-  ]\r\n-\r\n-  // Section visibility state\r\n-  const [visibleSections, setVisibleSections] = useState({\r\n-    home: {\r\n-      giftCategories: true,\r\n-      slider: true,\r\n-      services: true,\r\n-      products: true,\r\n-      banner: true,\r\n-      dealProduct: true,\r\n-    },\r\n-    corporate: {\r\n-      corporateBanner: true,\r\n-      corporateServices: true,\r\n-      corporateTestimonials: false,\r\n-      corporatePartners: false,\r\n-    },\r\n-  })\r\n-\r\n-  // Hardcoded admin token for testing\r\n-  const ADMIN_TOKEN = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY4NzZhYTJmYzc3YWY4ODU3Njk1ZDA5MiIsInJvbGUiOiJhZG1pbiIsImlhdCI6MTc1MzI4MTMyMCwiZXhwIjoxNzUzODg2MTIwfQ.3wEx7ZCDvYtUQppFM9CcXjhG1zTQX9_RYY_dy3Y6MZs'\r\n-\r\n-  // ========== HIERARCHICAL DATA MANAGEMENT HELPERS ==========\r\n-  \r\n-  // Get current counts for validation\r\n-  // ...existing code around line 130...\r\n-\r\n-// Get current counts for validation\r\n-const getCurrentCounts = () => {\r\n-  // FIXED: Add safety checks for undefined categoryIds\r\n-  const safeCategories = categoryConfig.categories || []\r\n-  const safeCategoryIds = categoryConfig.categoryIds || []\r\n-  \r\n-  // Handle both old array structure and new object structure\r\n-  let mainCategoriesCount = 0\r\n-  let totalSubcategoriesCount = 0\r\n-  let selectedCategorySubCount = 0\r\n-  const subcategoryCounts = {}\r\n-  \r\n-  if (Array.isArray(safeCategories) && safeCategories.length > 0) {\r\n-    // Old structure: array of category objects\r\n-    mainCategoriesCount = safeCategories.filter(cat => cat.enabled).length\r\n-    \r\n-    safeCategories.forEach(category => {\r\n-      const subCount = category.subcategories ? category.subcategories.filter(sub => sub.enabled).length : 0\r\n-      subcategoryCounts[category.categoryId] = subCount\r\n-      totalSubcategoriesCount += subCount\r\n-      \r\n-      // Get subcategory count for currently selected main category\r\n-      if (selectedMainCategory && category.categoryId === selectedMainCategory) {\r\n-        selectedCategorySubCount = subCount\r\n-      }\r\n-    })\r\n-  } else {\r\n-    // Fallback: use categoryIds for backward compatibility\r\n-    if (availableCategories.length > 0 && safeCategoryIds.length > 0) {\r\n-      mainCategoriesCount = safeCategoryIds.filter(id => \r\n-        availableCategories.some(cat => cat.id === id && !cat.parent)\r\n-      ).length\r\n-      \r\n-      totalSubcategoriesCount = safeCategoryIds.filter(id => \r\n-        subcategories.some(sub => sub.id === id)\r\n-      ).length\r\n-        \r\n-      selectedCategorySubCount = selectedMainCategory && safeCategoryIds ? \r\n-        safeCategoryIds.filter(id => \r\n-          subcategories.some(sub => sub.id === id && \r\n-            (sub.parent?._id === selectedMainCategory || sub.parent === selectedMainCategory)\r\n-          )\r\n-        ).length : 0\r\n-    }\r\n-  }\r\n-  \r\n-  return { \r\n-    mainCategoriesCount, \r\n-    subcategoryCounts, \r\n-    totalSubcategoriesCount,\r\n-    selectedCategorySubCount \r\n-  }\r\n-}\r\n-\r\n-  // Check if we can select more main categories\r\n-  const canSelectMoreMainCategories = () => {\r\n-    const { mainCategoriesCount } = getCurrentCounts()\r\n-    return mainCategoriesCount < MAX_MAIN_CATEGORIES\r\n-  }\r\n-\r\n-  // Check if we can select more subcategories for a specific category\r\n-  const canSelectMoreSubcategories = (categoryId) => {\r\n-    const { subcategoryCounts } = getCurrentCounts()\r\n-    const currentCount = subcategoryCounts[categoryId] || 0\r\n-    return currentCount < MAX_SUBCATEGORIES_PER_CATEGORY\r\n-  }\r\n-\r\n-  // Check if a main category is selected\r\n-  // ...existing code around line 190...\r\n-\r\n-// Check if a main category is selected\r\n-const isMainCategorySelected = (categoryId) => {\r\n-  // FIXED: Add safety check for undefined categoryIds\r\n-  const safeCategoryIds = categoryConfig.categoryIds || []\r\n-  \r\n-  if (Array.isArray(categoryConfig.categories)) {\r\n-    // Old structure\r\n-    const category = categoryConfig.categories.find(cat => cat.categoryId === categoryId)\r\n-    return category ? category.enabled : false\r\n-  } else if (typeof categoryConfig.categories === 'object') {\r\n-    // New structure\r\n-    return categoryConfig.categories[categoryId]?.selected || false\r\n-  } else {\r\n-    // Fallback\r\n-    return safeCategoryIds.includes(categoryId)\r\n-  }\r\n-}\r\n-\r\n-// Check if a subcategory is selected\r\n-const isSubcategorySelected = (subcategoryId, parentCategoryId = null) => {\r\n-  // FIXED: Add safety check for undefined categoryIds\r\n-  const safeCategoryIds = categoryConfig.categoryIds || []\r\n-  \r\n-  if (Array.isArray(categoryConfig.categories)) {\r\n-    // Old structure\r\n-    return categoryConfig.categories.some(category => \r\n-      category.subcategories && category.subcategories.some(sub => sub.categoryId === subcategoryId && sub.enabled)\r\n-    )\r\n-  } else if (typeof categoryConfig.categories === 'object' && parentCategoryId) {\r\n-    // New structure\r\n-    return categoryConfig.categories[parentCategoryId]?.subcategories?.[subcategoryId]?.selected || false\r\n-  } else {\r\n-    // Fallback\r\n-    return safeCategoryIds.includes(subcategoryId)\r\n-  }\r\n-}\r\n-\r\n-  // Find which main category a subcategory belongs to\r\n-  const findParentCategory = (subcategoryId) => {\r\n-    const subcategory = subcategories.find(sub => sub.id === subcategoryId)\r\n-    return subcategory?.parent?._id || subcategory?.parent\r\n-  }\r\n-\r\n-  // Update hierarchical category selection\r\n-  // Function removed - using simpler handleCategoryToggle approach\r\n-\r\n-  // Transform hierarchical data for backend save - FIXED to only use selected categories\r\n-  const transformForSave = () => {\r\n-    console.log('🔄 === TRANSFORM FOR SAVE START ===')\r\n-    console.log('1. Input categoryConfig:', categoryConfig)\r\n-    console.log('   - categoryConfig.categoryIds (SELECTED):', categoryConfig.categoryIds)\r\n-    \r\n-    const saveData = {\r\n-      enabled: categoryConfig.enabled,\r\n-      maxCategories: categoryConfig.maxCategories,\r\n-      layout: categoryConfig.layout,\r\n-      showSubcategories: categoryConfig.showSubcategories,\r\n-      categories: []\r\n-    }\r\n-    \r\n-    console.log('2. Base saveData structure:', saveData)\r\n-    \r\n-    // 🎯 ONLY process the categoryIds that are actually selected by the user\r\n-    console.log('3. Processing ONLY selected categoryIds...')\r\n-    console.log('   - Selected categoryIds:', categoryConfig.categoryIds)\r\n-    console.log('   - Total selected:', categoryConfig.categoryIds.length)\r\n-    \r\n-    if (categoryConfig.categoryIds && categoryConfig.categoryIds.length > 0) {\r\n-      categoryConfig.categoryIds.forEach((categoryId, index) => {\r\n-        console.log(`   - Processing selected categoryId ${index + 1}:`, categoryId)\r\n-        \r\n-        // Check if it's a main category\r\n-        const mainCategory = availableCategories.find(cat => cat.id === categoryId && !cat.parent)\r\n-        if (mainCategory) {\r\n-          console.log(`     ✅ Found main category:`, mainCategory.name)\r\n-          saveData.categories.push({\r\n-            categoryId: categoryId,\r\n-            enabled: true,\r\n-            order: index\r\n-          })\r\n-        }\r\n-        \r\n-        // Check if it's a subcategory\r\n-        const subcategory = subcategories.find(sub => sub.id === categoryId)\r\n-        if (subcategory) {\r\n-          const parentId = subcategory.parent?._id || subcategory.parent\r\n-          console.log(`     ✅ Found subcategory:`, subcategory.name, 'parent:', parentId)\r\n-          saveData.categories.push({\r\n-            categoryId: categoryId,\r\n-            enabled: true,\r\n-            order: index\r\n-          })\r\n-        }\r\n-        \r\n-        if (!mainCategory && !subcategory) {\r\n-          console.log(`     ❌ Category ID not found:`, categoryId)\r\n-        }\r\n-      })\r\n-    } else {\r\n-      console.log('   - No categories selected')\r\n-    }\r\n-    \r\n-    console.log('4. Final saveData categories:', saveData.categories)\r\n-    console.log('🔚 === TRANSFORM FOR SAVE END ===')\r\n-    \r\n-    return saveData\r\n-  }\r\n-\r\n-  // Load page configuration\r\n-  // ...existing code around line 380...\r\n-\r\n-// Load page configuration\r\n-const loadPageConfig = async (pageKey) => {\r\n-  try {\r\n-    setLoading(true)\r\n-    localStorage.setItem('authToken', ADMIN_TOKEN)\r\n-    \r\n-    const response = await get(`/pages/${pageKey}`)\r\n-    console.log('Page config response:', response)\r\n-    \r\n-    // Handle the double-wrapped response from apiService\r\n-    const actualData = response.data // This contains the backend response\r\n-    \r\n-    if (actualData && actualData.success) {\r\n-      setPageConfig(actualData.data)\r\n-      \r\n-      // Extract category section config\r\n-      const categorySection = actualData.data.sections.find(s => s.sectionType === 'categorySection')\r\n-      if (categorySection && categorySection.config) {\r\n-        // FIXED: Properly extract categoryIds and convert to flat structure\r\n-        const savedCategories = categorySection.config.categories || []\r\n-        const categoryIds = savedCategories.map(cat => cat.categoryId).filter(Boolean)\r\n-        \r\n-        setCategoryConfig({\r\n-          enabled: categorySection.enabled || false,\r\n-          maxCategories: categorySection.config.maxCategories || 10,\r\n-          layout: categorySection.config.layout || 'grid',\r\n-          showSubcategories: categorySection.config.showSubcategories || true,\r\n-          categories: savedCategories, // Keep the hierarchical structure\r\n-          categoryIds: categoryIds || [] // FIXED: Ensure this is always an array\r\n-        })\r\n-        \r\n-        console.log('📂 Loaded category config with categoryIds:', categoryIds)\r\n-        \r\n-        // Update visibility state\r\n-        setVisibleSections(prev => ({\r\n-          ...prev,\r\n-          [pageKey]: {\r\n-            ...prev[pageKey],\r\n-            giftCategories: categorySection.enabled\r\n-          }\r\n-        }))\r\n-      } else {\r\n-        // FIXED: Initialize with empty arrays when no config exists\r\n-        setCategoryConfig({\r\n-          enabled: false,\r\n-          maxCategories: 10,\r\n-          layout: 'grid',\r\n-          showSubcategories: true,\r\n-          categories: [],\r\n-          categoryIds: [] // FIXED: Ensure this is always an array\r\n-        })\r\n-      }\r\n-    }\r\n-    \r\n-    setError('')\r\n-  } catch (err) {\r\n-    console.error('Load page config error:', err)\r\n-    setError('Failed to load page configuration: ' + err.message)\r\n-    \r\n-    // FIXED: Set default config on error to prevent undefined\r\n-    setCategoryConfig({\r\n-      enabled: false,\r\n-      maxCategories: 10,\r\n-      layout: 'grid',\r\n-      showSubcategories: true,\r\n-      categories: [],\r\n-      categoryIds: [] // FIXED: Ensure this is always an array\r\n-    })\r\n-  } finally {\r\n-    setLoading(false)\r\n-  }\r\n-}\r\n-\r\n-  // Load available categories (same approach as CategoriesPage.js)\r\n-  const loadCategories = async () => {\r\n-    try {\r\n-      console.log('🔄 === LOADING CATEGORIES DEBUG ===')\r\n-      console.log('1. Setting auth token...')\r\n-      localStorage.setItem('authToken', ADMIN_TOKEN)\r\n-      \r\n-      console.log('2. Making API call to:', CATEGORY.GET_ALL)\r\n-      const response = await get(CATEGORY.GET_ALL)\r\n-      \r\n-      console.log('3. Raw API response received:')\r\n-      console.log('   - Response object:', response)\r\n-      console.log('   - Response type:', typeof response)\r\n-      console.log('   - Response keys:', Object.keys(response || {}))\r\n-      console.log('   - Response.success:', response?.success)\r\n-      console.log('   - Response.data:', response?.data)\r\n-      console.log('   - Response.data type:', typeof response?.data)\r\n-      console.log('   - Response.data is array:', Array.isArray(response?.data))\r\n-      \r\n-      if (!response.success) {\r\n-        console.error('4. ❌ API response failed:', response.error)\r\n-        throw new Error(response.error || 'Failed to fetch categories')\r\n-      }\r\n-      \r\n-      console.log('4. ✅ API response successful')\r\n-      console.log('5. Processing response.data...')\r\n-      console.log('   - Raw response.data:', JSON.stringify(response.data, null, 2))\r\n-      \r\n-      // Ensure response.data is an array\r\n-      let categoriesData = []\r\n-      if (Array.isArray(response.data)) {\r\n-        console.log('   - Response.data is direct array with', response.data.length, 'items')\r\n-        categoriesData = response.data\r\n-      } else if (response.data && typeof response.data === 'object') {\r\n-        console.log('   - Response.data is object, checking for nested arrays...')\r\n-        if (Array.isArray(response.data.categories)) {\r\n-          console.log('   - Found response.data.categories array with', response.data.categories.length, 'items')\r\n-          categoriesData = response.data.categories\r\n-        } else if (Array.isArray(response.data.data)) {\r\n-          console.log('   - Found response.data.data array with', response.data.data.length, 'items')\r\n-          categoriesData = response.data.data\r\n-        } else {\r\n-          console.log('   - No recognizable array found in response.data')\r\n-          categoriesData = []\r\n-        }\r\n-      }\r\n-      \r\n-      console.log('6. Categories data to process:')\r\n-      console.log('   - Array length:', categoriesData.length)\r\n-      console.log('   - Sample items (first 3):')\r\n-      categoriesData.slice(0, 3).forEach((cat, index) => {\r\n-        console.log(`     ${index + 1}.`, cat)\r\n-      })\r\n-      \r\n-      // Transform categories for display in the admin panel\r\n-      console.log('7. Transforming categories...')\r\n-      const transformedCategories = categoriesData.map((cat, index) => {\r\n-        console.log(`   - Transforming category ${index + 1}:`, {\r\n-          originalId: cat._id,\r\n-          originalName: cat.name,\r\n-          hasParent: !!cat.parent,\r\n-          parentInfo: cat.parent\r\n-        })\r\n-        \r\n-        return {\r\n-          id: cat.id || cat._id,\r\n-          value: cat.id || cat._id,\r\n-          label: cat.name,\r\n-          name: cat.name,\r\n-          image: cat.image?.url || '/assets/img/product/category/default-category.svg',\r\n-          description: cat.description || '',\r\n-          parent: cat.parent\r\n-        }\r\n-      })\r\n-      \r\n-      console.log('8. Final transformed categories:')\r\n-      console.log('   - Total transformed:', transformedCategories.length)\r\n-      console.log('   - Main categories:', transformedCategories.filter(cat => !cat.parent).length)\r\n-      console.log('   - Sub categories:', transformedCategories.filter(cat => cat.parent).length)\r\n-      console.log('   - Full transformed data:', transformedCategories)\r\n-      \r\n-      console.log('9. Setting availableCategories state...')\r\n-      setAvailableCategories(transformedCategories)\r\n-      setError('')\r\n-      \r\n-      console.log('10. ✅ Categories loaded successfully!')\r\n-      console.log('🔚 === END LOADING CATEGORIES DEBUG ===')\r\n-      \r\n-    } catch (err) {\r\n-      console.error('❌ === LOAD CATEGORIES ERROR ===')\r\n-      console.error('Error details:', {\r\n-        message: err.message,\r\n-        stack: err.stack,\r\n-        name: err.name\r\n-      })\r\n-      console.error('Raw error object:', err)\r\n-      setError('Failed to load categories: ' + err.message)\r\n-      setAvailableCategories([])\r\n-    }\r\n-  }\r\n-\r\n-  // Load subcategories from separate subcategories collection\r\n-  const loadSubcategories = async () => {\r\n-    try {\r\n-      console.log('🔄 === LOADING SUBCATEGORIES DEBUG ===')\r\n-      console.log('1. Setting auth token...')\r\n-      localStorage.setItem('authToken', ADMIN_TOKEN)\r\n-      \r\n-      console.log('2. Making API call to:', SUBCATEGORY.GET_ALL)\r\n-      const response = await get(SUBCATEGORY.GET_ALL)\r\n-      \r\n-      console.log('3. Raw subcategories response:')\r\n-      console.log('   - Response object:', response)\r\n-      console.log('   - Response.success:', response?.success)\r\n-      console.log('   - Response.data:', response?.data)\r\n-      console.log('   - Response.data is array:', Array.isArray(response?.data))\r\n-      \r\n-      if (!response.success) {\r\n-        console.error('4. ❌ Subcategories API response failed:', response.error)\r\n-        throw new Error(response.error || 'Failed to fetch subcategories')\r\n-      }\r\n-      \r\n-      console.log('4. ✅ Subcategories API response successful')\r\n-      console.log('5. Processing subcategories data...')\r\n-      \r\n-      let subcategoriesData = []\r\n-      if (Array.isArray(response.data)) {\r\n-        subcategoriesData = response.data\r\n-      } else if (response.data && Array.isArray(response.data.data)) {\r\n-        subcategoriesData = response.data.data\r\n-      }\r\n-      \r\n-      console.log('6. Subcategories data to process:')\r\n-      console.log('   - Array length:', subcategoriesData.length)\r\n-      console.log('   - Sample items (first 3):')\r\n-      subcategoriesData.slice(0, 3).forEach((subcat, index) => {\r\n-        console.log(`     ${index + 1}.`, {\r\n-          id: subcat._id,\r\n-          name: subcat.name,\r\n-          parent: subcat.parent,\r\n-          status: subcat.status\r\n-        })\r\n-      })\r\n-      \r\n-      // Transform subcategories for display\r\n-      const transformedSubcategories = subcategoriesData.map((subcat, index) => {\r\n-        console.log(`   - Transforming subcategory ${index + 1}:`, {\r\n-          originalId: subcat._id,\r\n-          originalName: subcat.name,\r\n-          parentId: subcat.parent?._id || subcat.parent,\r\n-          parentName: subcat.parent?.name\r\n-        })\r\n-        \r\n-        return {\r\n-          id: subcat.id || subcat._id,\r\n-          value: subcat.id || subcat._id,\r\n-          label: subcat.name,\r\n-          name: subcat.name,\r\n-          image: subcat.image?.url || '/assets/img/product/category/default-subcategory.svg',\r\n-          description: subcat.description || '',\r\n-          parent: subcat.parent,\r\n-          status: subcat.status\r\n-        }\r\n-      })\r\n-      \r\n-      console.log('7. Final transformed subcategories:')\r\n-      console.log('   - Total transformed:', transformedSubcategories.length)\r\n-      console.log('   - Full transformed data:', transformedSubcategories)\r\n-      \r\n-      console.log('8. Setting subcategories state...')\r\n-      setSubcategories(transformedSubcategories)\r\n-      \r\n-      console.log('9. ✅ Subcategories loaded successfully!')\r\n-      console.log('🔚 === END LOADING SUBCATEGORIES DEBUG ===')\r\n-      \r\n-    } catch (err) {\r\n-      console.error('❌ === LOAD SUBCATEGORIES ERROR ===')\r\n-      console.error('Error details:', {\r\n-        message: err.message,\r\n-        stack: err.stack,\r\n-        name: err.name\r\n-      })\r\n-      setSubcategories([])\r\n-    }\r\n-  }\r\n-\r\n-  // Save category section configuration\r\n-  const saveCategoryConfig = async () => {\r\n-    console.log('🚀 === SAVE CATEGORY CONFIG START ===')\r\n-    console.log('1. Save function triggered')\r\n-    \r\n-    try {\r\n-      console.log('2. Setting loading state to true')\r\n-      setLoading(true)\r\n-      \r\n-      console.log('3. Setting auth token in localStorage')\r\n-      localStorage.setItem('authToken', ADMIN_TOKEN)\r\n-      console.log('   - Auth token set:', ADMIN_TOKEN.substring(0, 20) + '...')\r\n-      \r\n-      console.log('4. Getting current counts for validation')\r\n-      const { mainCategoriesCount } = getCurrentCounts()\r\n-      console.log('   - Main categories count:', mainCategoriesCount)\r\n-      console.log('   - MIN_MAIN_CATEGORIES:', MIN_MAIN_CATEGORIES)\r\n-      console.log('   - MAX_MAIN_CATEGORIES:', MAX_MAIN_CATEGORIES)\r\n-      \r\n-      if (mainCategoriesCount < MIN_MAIN_CATEGORIES) {\r\n-        console.log('❌ Validation failed: Too few main categories')\r\n-        setError(`Please select at least ${MIN_MAIN_CATEGORIES} main category before saving.`)\r\n-        return\r\n-      }\r\n-      \r\n-      if (mainCategoriesCount > MAX_MAIN_CATEGORIES) {\r\n-        console.log('❌ Validation failed: Too many main categories')\r\n-        setError(`Too many main categories selected. Maximum ${MAX_MAIN_CATEGORIES} allowed.`)\r\n-        return\r\n-      }\r\n-      \r\n-      console.log('✅ Validation passed')\r\n-      \r\n-      console.log('5. Current categoryConfig state before transform:')\r\n-      console.log('   - categoryConfig.enabled:', categoryConfig.enabled)\r\n-      console.log('   - categoryConfig.maxCategories:', categoryConfig.maxCategories)\r\n-      console.log('   - categoryConfig.layout:', categoryConfig.layout)\r\n-      console.log('   - categoryConfig.showSubcategories:', categoryConfig.showSubcategories)\r\n-      console.log('   - categoryConfig.categories:', categoryConfig.categories)\r\n-      console.log('   - categoryConfig.categoryIds:', categoryConfig.categoryIds)\r\n-      \r\n-      // Transform hierarchical data for save\r\n-      console.log('6. Transforming data for save...')\r\n-      const configData = transformForSave()\r\n-      console.log('7. Transformed config data:')\r\n-      console.log('   - Full configData object:', JSON.stringify(configData, null, 2))\r\n-      console.log('   - configData.enabled:', configData.enabled)\r\n-      console.log('   - configData.categories length:', configData.categories?.length || 0)\r\n-      \r\n-      console.log('8. Preparing API request')\r\n-      const apiEndpoint = '/pages/home/sections/category'\r\n-      console.log('   - API endpoint:', apiEndpoint)\r\n-      console.log('   - Request method: PUT')\r\n-      console.log('   - Request data:', configData)\r\n-      console.log('   - Request headers will include auth token')\r\n-      \r\n-      console.log('9. Making API request...')\r\n-      const response = await put(apiEndpoint, configData)\r\n-      console.log('10. API response received:')\r\n-      console.log('    - Raw response:', response)\r\n-      console.log('    - Response type:', typeof response)\r\n-      console.log('    - Response keys:', Object.keys(response || {}))\r\n-      console.log('    - Response.data:', response?.data)\r\n-      console.log('    - Response.status:', response?.status)\r\n-      console.log('    - Response.success:', response?.success)\r\n-      \r\n-      // Handle the double-wrapped response from apiService\r\n-      console.log('11. Processing response data...')\r\n-      const actualData = response.data // This contains the backend response\r\n-      console.log('    - actualData:', actualData)\r\n-      console.log('    - actualData type:', typeof actualData)\r\n-      console.log('    - actualData.success:', actualData?.success)\r\n-      console.log('    - actualData.message:', actualData?.message)\r\n-      \r\n-      if (actualData && actualData.success) {\r\n-        console.log('✅ Save successful!')\r\n-        setSuccess('Category section configuration saved successfully!')\r\n-        setTimeout(() => setSuccess(''), 3000)\r\n-        setShowCategoryConfig(false)\r\n-        \r\n-        // Trigger refresh notification (optional)\r\n-        try {\r\n-          console.log('12. Triggering homepage refresh...')\r\n-          await get('/api/pages/home/refresh/categorySection')\r\n-          console.log('    - Homepage refresh successful')\r\n-        } catch (refreshError) {\r\n-          console.log('⚠️ Refresh notification failed, but save was successful:', refreshError)\r\n-        }\r\n-        \r\n-        // 🎯 REMOVED: Don't reload page config as it overwrites user selections\r\n-        // The loadPageConfig call was causing the categoryIds to be overwritten with old database values\r\n-        // console.log('13. Reloading page config...')\r\n-        // await loadPageConfig(selectedPage) // 🚨 THIS WAS CAUSING THE PROBLEM!\r\n-        // console.log('14. Page config reloaded')\r\n-        \r\n-        console.log('13. Save completed successfully - user selections preserved')\r\n-      } else {\r\n-        console.log('❌ Save failed - API returned unsuccessful response')\r\n-        console.log('    - actualData:', actualData)\r\n-        const errorMessage = actualData?.message || 'Unknown error'\r\n-        console.log('    - Error message:', errorMessage)\r\n-        setError('Failed to save configuration: ' + errorMessage)\r\n-      }\r\n-      \r\n-    } catch (err) {\r\n-      console.error('❌ === SAVE CATEGORY CONFIG ERROR ===')\r\n-      console.error('Error caught in try-catch:')\r\n-      console.error('   - Error object:', err)\r\n-      console.error('   - Error message:', err.message)\r\n-      console.error('   - Error name:', err.name)\r\n-      console.error('   - Error stack:', err.stack)\r\n-      \r\n-      if (err.response) {\r\n-        console.error('   - HTTP Response Error Details:')\r\n-        console.error('     - Status:', err.response.status)\r\n-        console.error('     - Status text:', err.response.statusText)\r\n-        console.error('     - Response data:', err.response.data)\r\n-        console.error('     - Response headers:', err.response.headers)\r\n-      }\r\n-      \r\n-      if (err.request) {\r\n-        console.error('   - Request Error Details:')\r\n-        console.error('     - Request object:', err.request)\r\n-      }\r\n-      \r\n-      setError('Failed to save category configuration: ' + err.message)\r\n-    } finally {\r\n-      console.log('15. Setting loading state to false')\r\n-      setLoading(false)\r\n-      console.log('🔚 === SAVE CATEGORY CONFIG END ===')\r\n-    }\r\n-  }\r\n-\r\n-  // Toggle section visibility\r\n-  const handleToggleSection = async (page, section) => {\r\n-    if (section === 'giftCategories') {\r\n-      // For category section, update the actual config\r\n-      setCategoryConfig(prev => ({ ...prev, enabled: !prev.enabled }))\r\n-      return\r\n-    }\r\n-    \r\n-    const newVisibility = {\r\n-      ...visibleSections,\r\n-      [page]: {\r\n-        ...visibleSections[page],\r\n-        [section]: !visibleSections[page][section],\r\n-      }\r\n-    }\r\n-    \r\n-    setVisibleSections(newVisibility)\r\n-  }\r\n-\r\n-  // Open category configuration modal\r\n-  const openCategoryConfig = () => {\r\n-    setShowCategoryConfig(true)\r\n-    // Reset to first main category when opening modal\r\n-    const mainCategories = availableCategories.filter(cat => !cat.parent)\r\n-    if (mainCategories.length > 0) {\r\n-      setSelectedMainCategory(mainCategories[0].id)\r\n-    }\r\n-  }\r\n-\r\n-  // Handle category selection with validation - SIMPLIFIED for current structure\r\n-  const handleCategoryToggle = (categoryId, parentCategoryId = null) => {\r\n-    const isMainCategory = !parentCategoryId && availableCategories.some(cat => cat.id === categoryId && !cat.parent)\r\n-    \r\n-    console.log('🎯 Category toggle triggered:', { categoryId, parentCategoryId, isMainCategory })\r\n-    \r\n-    if (isMainCategory) {\r\n-      const isCurrentlySelected = categoryConfig.categoryIds.includes(categoryId)\r\n-      const currentMainCount = categoryConfig.categoryIds.filter(id => \r\n-        availableCategories.some(cat => cat.id === id && !cat.parent)\r\n-      ).length\r\n-      \r\n-      console.log('📊 Main category status:', { isCurrentlySelected, currentCount: currentMainCount })\r\n-      \r\n-      // Validation for main categories\r\n-      if (!isCurrentlySelected) {\r\n-        // Trying to select\r\n-        if (currentMainCount >= MAX_MAIN_CATEGORIES) {\r\n-          setError(`Cannot select more main categories. Maximum ${MAX_MAIN_CATEGORIES} allowed.`)\r\n-          return\r\n-        }\r\n-      } else {\r\n-        // Trying to deselect\r\n-        if (currentMainCount <= MIN_MAIN_CATEGORIES) {\r\n-          setError(`Cannot deselect this category. At least ${MIN_MAIN_CATEGORIES} main category must be selected.`)\r\n-          return\r\n-        }\r\n-      }\r\n-      \r\n-      // Clear any existing errors\r\n-      setError('')\r\n-      \r\n-      // 🎯 Update categoryIds array with actual selections\r\n-      setCategoryConfig(prev => {\r\n-        let newCategoryIds = [...prev.categoryIds]\r\n-        \r\n-        if (!isCurrentlySelected) {\r\n-          // Add to selection\r\n-          console.log('✅ Adding main category to selection:', categoryId)\r\n-          newCategoryIds.push(categoryId)\r\n-        } else {\r\n-          // Remove from selection (and remove all its subcategories too)\r\n-          const subcategoriesOfThisCategory = subcategories\r\n-            .filter(sub => (sub.parent?._id || sub.parent) === categoryId)\r\n-            .map(sub => sub.id)\r\n-          \r\n-          console.log('❌ Removing main category and its subcategories:', {\r\n-            mainCategory: categoryId,\r\n-            subcategories: subcategoriesOfThisCategory\r\n-          })\r\n-          \r\n-          newCategoryIds = newCategoryIds.filter(id => \r\n-            id !== categoryId && !subcategoriesOfThisCategory.includes(id)\r\n-          )\r\n-        }\r\n-        \r\n-        console.log('📝 Updated categoryIds:', newCategoryIds)\r\n-        \r\n-        return {\r\n-          ...prev,\r\n-          categoryIds: newCategoryIds\r\n-        }\r\n-      })\r\n-      \r\n-    } else {\r\n-      // Subcategory logic\r\n-      const isCurrentlySelected = categoryConfig.categoryIds.includes(categoryId)\r\n-      const parentId = parentCategoryId || findParentCategory(categoryId)\r\n-      \r\n-      console.log('📊 Subcategory status:', { isCurrentlySelected, parentId })\r\n-      \r\n-      if (!isCurrentlySelected && parentId) {\r\n-        // Check subcategory limit for this parent\r\n-        const currentSubCount = categoryConfig.categoryIds.filter(id => \r\n-          subcategories.some(sub => sub.id === id && (sub.parent?._id || sub.parent) === parentId)\r\n-        ).length\r\n-        \r\n-        if (currentSubCount >= MAX_SUBCATEGORIES_PER_CATEGORY) {\r\n-          const parentName = availableCategories.find(cat => cat.id === parentId)?.name || 'this category'\r\n-          setError(`Cannot select more subcategories for ${parentName}. Maximum ${MAX_SUBCATEGORIES_PER_CATEGORY} per category allowed.`)\r\n-          return\r\n-        }\r\n-      }\r\n-      \r\n-      // Clear any existing errors\r\n-      setError('')\r\n-      \r\n-      // 🎯 Update categoryIds array for subcategory\r\n-      setCategoryConfig(prev => {\r\n-        let newCategoryIds = [...prev.categoryIds]\r\n-        \r\n-        if (!isCurrentlySelected) {\r\n-          // Add subcategory to selection\r\n-          console.log('✅ Adding subcategory to selection:', categoryId)\r\n-          newCategoryIds.push(categoryId)\r\n-          \r\n-          // Also ensure parent is selected\r\n-          if (parentId && !newCategoryIds.includes(parentId)) {\r\n-            console.log('✅ Auto-adding parent category:', parentId)\r\n-            newCategoryIds.push(parentId)\r\n-          }\r\n-        } else {\r\n-          // Remove subcategory from selection\r\n-          console.log('❌ Removing subcategory from selection:', categoryId)\r\n-          newCategoryIds = newCategoryIds.filter(id => id !== categoryId)\r\n-        }\r\n-        \r\n-        console.log('📝 Updated categoryIds:', newCategoryIds)\r\n-        \r\n-        return {\r\n-          ...prev,\r\n-          categoryIds: newCategoryIds\r\n-        }\r\n-      })\r\n-    }\r\n-  }\r\n-\r\n-  // Handle max categories change\r\n-  const handleMaxCategoriesChange = (value) => {\r\n-    const numValue = parseInt(value) || 0\r\n-    setCategoryConfig(prev => ({ ...prev, maxCategories: numValue }))\r\n-  }\r\n-\r\n-  // Load data when page changes\r\n-  useEffect(() => {\r\n-    const loadData = async () => {\r\n-      await loadPageConfig(selectedPage)\r\n-      await loadCategories()\r\n-      await loadSubcategories()\r\n-    }\r\n-    loadData()\r\n-  }, [selectedPage])\r\n-\r\n-  // Get sections for current page\r\n-  const getCurrentSections = () => {\r\n-    return selectedPage === \"home\" ? homeSections : corporateSections\r\n-  }\r\n-\r\n-  // Render category configuration modal\r\n-  const renderCategoryConfigModal = () => {\r\n-    if (!showCategoryConfig) return null\r\n-\r\n-    console.log('🎨 === RENDERING CATEGORY MODAL DEBUG ===')\r\n-    console.log('1. Modal render triggered')\r\n-    console.log('2. availableCategories state:')\r\n-    console.log('   - Length:', availableCategories.length)\r\n-    console.log('   - Is array:', Array.isArray(availableCategories))\r\n-    console.log('   - Full data:', availableCategories)\r\n-    \r\n-    const mainCategories = availableCategories.filter(cat => !cat.parent)\r\n-    const subCategories = subcategories // Use the separate subcategories state\r\n-    \r\n-    console.log('3. Category breakdown:')\r\n-    console.log('   - Main categories:', mainCategories.length, mainCategories)\r\n-    console.log('   - Sub categories:', subCategories.length, subCategories)\r\n-    \r\n-    // Get subcategories for selected main category\r\n-    const getSubcategoriesForCategory = (categoryId) => {\r\n-      console.log('🔍 Getting subcategories for category ID:', categoryId)\r\n-      const filtered = subCategories.filter(subCat => {\r\n-        const parentId = subCat.parent?._id || subCat.parent\r\n-        console.log(`   - Checking subcategory \"${subCat.name}\": parent=${parentId}, matches=${parentId === categoryId}`)\r\n-        return parentId === categoryId\r\n-      })\r\n-      console.log(`   - Found ${filtered.length} subcategories for category ${categoryId}:`, filtered)\r\n-      return filtered\r\n-    }\r\n-\r\n-    // Auto-select first main category if none selected\r\n-    if (!selectedMainCategory && mainCategories.length > 0) {\r\n-      setSelectedMainCategory(mainCategories[0].id)\r\n-    }\r\n-\r\n-    const selectedCategorySubcategories = selectedMainCategory ? \r\n-      getSubcategoriesForCategory(selectedMainCategory) : []\r\n-\r\n-    return (\r\n-      <div className=\"modal show d-block\" style={{ backgroundColor: 'rgba(0,0,0,0.5)' }}>\r\n-        <div className=\"modal-dialog modal-xl\">\r\n-          <div className=\"modal-content\">\r\n-            <div className=\"modal-header\">\r\n-              <h5 className=\"modal-title\">\r\n-                <i className=\"bi bi-grid-3x3-gap me-2\"></i>\r\n-                Category Section Configuration\r\n-              </h5>\r\n-              <button \r\n-                type=\"button\" \r\n-                className=\"btn-close\" \r\n-                onClick={() => setShowCategoryConfig(false)}\r\n-              ></button>\r\n-            </div>\r\n-            <div className=\"modal-body\">\r\n-              {/* Enable/Disable Section */}\r\n-              <div className=\"row mb-4\">\r\n-                <div className=\"col-12\">\r\n-                  <div className=\"form-check form-switch\">\r\n-                    <input \r\n-                      className=\"form-check-input\" \r\n-                      type=\"checkbox\" \r\n-                      id=\"enableCategorySection\"\r\n-                      checked={categoryConfig.enabled}\r\n-                      onChange={(e) => setCategoryConfig(prev => ({ ...prev, enabled: e.target.checked }))}\r\n-                    />\r\n-                    <label className=\"form-check-label fw-semibold\" htmlFor=\"enableCategorySection\">\r\n-                      Enable Category Section\r\n-                    </label>\r\n-                  </div>\r\n-                  <small className=\"text-muted\">Turn on/off the category section on the homepage</small>\r\n-                </div>\r\n-              </div>\r\n-\r\n-              {categoryConfig.enabled && (\r\n-                <>\r\n-                  {/* Selection Summary and Validation */}\r\n-                  <div className=\"row mb-4\">\r\n-                    <div className=\"col-12\">\r\n-                      <div className=\"card border-info\">\r\n-                        <div className=\"card-header bg-info bg-opacity-10\">\r\n-                          <h6 className=\"mb-0 text-info\">\r\n-                            <i className=\"bi bi-info-circle me-2\"></i>\r\n-                            Selection Summary\r\n-                          </h6>\r\n-                        </div>\r\n-                        <div className=\"card-body\">\r\n-                          <div className=\"row\">\r\n-                            <div className=\"col-md-6\">\r\n-                              <div className={`d-flex justify-content-between align-items-center p-2 rounded ${getCurrentCounts().mainCategoriesCount >= MIN_MAIN_CATEGORIES && getCurrentCounts().mainCategoriesCount <= MAX_MAIN_CATEGORIES ? 'bg-success bg-opacity-10 text-success' : 'bg-warning bg-opacity-10 text-warning'}`}>\r\n-                                <span className=\"fw-semibold\">\r\n-                                  <i className=\"bi bi-grid me-1\"></i>\r\n-                                  Main Categories:\r\n-                                </span>\r\n-                                <span className=\"badge bg-primary\">\r\n-                                  {getCurrentCounts().mainCategoriesCount} / {MAX_MAIN_CATEGORIES}\r\n-                                </span>\r\n-                              </div>\r\n-                              {getCurrentCounts().mainCategoriesCount < MIN_MAIN_CATEGORIES && (\r\n-                                <small className=\"text-warning\">\r\n-                                  <i className=\"bi bi-exclamation-triangle me-1\"></i>\r\n-                                  Minimum {MIN_MAIN_CATEGORIES} main category required\r\n-                                </small>\r\n-                              )}\r\n-                            </div>\r\n-                            <div className=\"col-md-6\">\r\n-                              <div className=\"d-flex justify-content-between align-items-center p-2 rounded bg-info bg-opacity-10 text-info\">\r\n-                                <span className=\"fw-semibold\">\r\n-                                  <i className=\"bi bi-tags me-1\"></i>\r\n-                                  Total Subcategories:\r\n-                                </span>\r\n-                                <span className=\"badge bg-info\">\r\n-                                  {getCurrentCounts().totalSubcategoriesCount}\r\n-                                </span>\r\n-                              </div>\r\n-                              {selectedMainCategory && (\r\n-                                <small className=\"text-muted\">\r\n-                                  <i className=\"bi bi-arrow-right me-1\"></i>\r\n-                                  Selected category: {getCurrentCounts().selectedCategorySubCount} / {MAX_SUBCATEGORIES_PER_CATEGORY}\r\n-                                </small>\r\n-                              )}\r\n-                            </div>\r\n-                          </div>\r\n-                        </div>\r\n-                      </div>\r\n-                    </div>\r\n-                  </div>\r\n-                </>\r\n-              )}\r\n-\r\n-              {categoryConfig.enabled && (\r\n-                <>\r\n-                  {/* Configuration Options */}\r\n-                  <div className=\"row mb-4\">\r\n-                    <div className=\"col-md-4\">\r\n-                      <label className=\"form-label fw-semibold\">Maximum Categories to Show</label>\r\n-                      <input \r\n-                        type=\"number\" \r\n-                        className=\"form-control\"\r\n-                        min=\"1\"\r\n-                        max=\"20\"\r\n-                        value={categoryConfig.maxCategories}\r\n-                        onChange={(e) => handleMaxCategoriesChange(e.target.value)}\r\n-                      />\r\n-                      <small className=\"text-muted\">Limit how many categories appear (0 = no limit)</small>\r\n-                    </div>\r\n-                    <div className=\"col-md-4\">\r\n-                      <label className=\"form-label fw-semibold\">Layout Style</label>\r\n-                      <select \r\n-                        className=\"form-select\"\r\n-                        value={categoryConfig.layout}\r\n-                        onChange={(e) => setCategoryConfig(prev => ({ ...prev, layout: e.target.value }))}\r\n-                      >\r\n-                        <option value=\"grid\">Grid Layout</option>\r\n-                        <option value=\"carousel\">Carousel</option>\r\n-                        <option value=\"list\">List View</option>\r\n-                      </select>\r\n-                    </div>\r\n-                    <div className=\"col-md-4\">\r\n-                      <div className=\"form-check mt-4\">\r\n-                        <input \r\n-                          className=\"form-check-input\" \r\n-                          type=\"checkbox\" \r\n-                          id=\"showSubcategories\"\r\n-                          checked={categoryConfig.showSubcategories}\r\n-                          onChange={(e) => setCategoryConfig(prev => ({ ...prev, showSubcategories: e.target.checked }))}\r\n-                        />\r\n-                        <label className=\"form-check-label\" htmlFor=\"showSubcategories\">\r\n-                          Show subcategories on hover\r\n-                        </label>\r\n-                      </div>\r\n-                    </div>\r\n-                  </div>\r\n-\r\n-                  {/* Current Selections Display */}\r\n-                  <div className=\"row mb-4\">\r\n-                    <div className=\"col-12\">\r\n-                      <div className=\"card border-success\">\r\n-                        <div className=\"card-header bg-success bg-opacity-10\">\r\n-                          <h6 className=\"mb-0 text-success\">\r\n-                            <i className=\"bi bi-check-circle me-2\"></i>\r\n-                            Current Selections\r\n-                          </h6>\r\n-                        </div>\r\n-                        <div className=\"card-body\">\r\n-                          {categoryConfig.categoryIds.length > 0 ? (\r\n-                            <div className=\"row\">\r\n-                              {/* Selected Main Categories */}\r\n-                              <div className=\"col-md-6\">\r\n-                                <h6 className=\"text-primary mb-3\">\r\n-                                  <i className=\"bi bi-grid me-1\"></i>\r\n-                                  Selected Main Categories ({categoryConfig.categoryIds.filter(id => mainCategories.some(cat => cat.id === id)).length})\r\n-                                </h6>\r\n-                                <div className=\"d-flex flex-wrap gap-2 mb-3\">\r\n-                                  {categoryConfig.categoryIds\r\n-                                    .filter(id => mainCategories.some(cat => cat.id === id))\r\n-                                    .map(categoryId => {\r\n-                                      const category = mainCategories.find(cat => cat.id === categoryId)\r\n-                                      return category ? (\r\n-                                        <span \r\n-                                          key={categoryId} \r\n-                                          className=\"badge bg-primary d-flex align-items-center\"\r\n-                                          style={{ fontSize: '12px', padding: '6px 10px' }}\r\n-                                        >\r\n-                                          <img \r\n-                                            src={category.image} \r\n-                                            alt={category.name}\r\n-                                            className=\"me-2 rounded\"\r\n-                                            style={{ width: '16px', height: '16px', objectFit: 'cover' }}\r\n-                                            onError={(e) => {\r\n-                                              e.target.src = '/assets/img/product/category/default-category.svg'\r\n-                                            }}\r\n-                                          />\r\n-                                          {category.name}\r\n-                                          <button\r\n-                                            type=\"button\"\r\n-                                            className=\"btn-close btn-close-white ms-2\"\r\n-                                            style={{ fontSize: '8px' }}\r\n-                                            onClick={() => handleCategoryToggle(categoryId)}\r\n-                                            title=\"Remove category\"\r\n-                                          ></button>\r\n-                                        </span>\r\n-                                      ) : null\r\n-                                    })}\r\n-                                </div>\r\n-                                {categoryConfig.categoryIds.filter(id => mainCategories.some(cat => cat.id === id)).length === 0 && (\r\n-                                  <p className=\"text-muted mb-0\">\r\n-                                    <i className=\"bi bi-info-circle me-1\"></i>\r\n-                                    No main categories selected\r\n-                                  </p>\r\n-                                )}\r\n-                              </div>\r\n-\r\n-                              {/* Selected Subcategories */}\r\n-                              <div className=\"col-md-6\">\r\n-                                <h6 className=\"text-secondary mb-3\">\r\n-                                  <i className=\"bi bi-tags me-1\"></i>\r\n-                                  Selected Subcategories ({categoryConfig.categoryIds.filter(id => subCategories.some(cat => cat.id === id)).length})\r\n-                                </h6>\r\n-                                <div className=\"d-flex flex-wrap gap-2 mb-3\">\r\n-                                  {categoryConfig.categoryIds\r\n-                                    .filter(id => subCategories.some(cat => cat.id === id))\r\n-                                    .map(subcategoryId => {\r\n-                                      const subcategory = subCategories.find(cat => cat.id === subcategoryId)\r\n-                                      const parentCategory = subcategory ? mainCategories.find(cat => cat.id === (subcategory.parent?._id || subcategory.parent)) : null\r\n-                                      return subcategory ? (\r\n-                                        <span \r\n-                                          key={subcategoryId} \r\n-                                          className=\"badge bg-secondary d-flex align-items-center\"\r\n-                                          style={{ fontSize: '11px', padding: '5px 8px' }}\r\n-                                        >\r\n-                                          <img \r\n-                                            src={subcategory.image} \r\n-                                            alt={subcategory.name}\r\n-                                            className=\"me-2 rounded\"\r\n-                                            style={{ width: '14px', height: '14px', objectFit: 'cover' }}\r\n-                                            onError={(e) => {\r\n-                                              e.target.src = '/assets/img/product/category/default-subcategory.svg'\r\n-                                            }}\r\n-                                          />\r\n-                                          <div className=\"d-flex flex-column align-items-start\">\r\n-                                            <span>{subcategory.name}</span>\r\n-                                            {parentCategory && (\r\n-                                              <small className=\"text-light opacity-75\" style={{ fontSize: '9px' }}>\r\n-                                                under {parentCategory.name}\r\n-                                              </small>\r\n-                                            )}\r\n-                                          </div>\r\n-                                          <button\r\n-                                            type=\"button\"\r\n-                                            className=\"btn-close btn-close-white ms-2\"\r\n-                                            style={{ fontSize: '7px' }}\r\n-                                            onClick={() => handleCategoryToggle(subcategoryId, subcategory.parent?._id || subcategory.parent)}\r\n-                                            title=\"Remove subcategory\"\r\n-                                          ></button>\r\n-                                        </span>\r\n-                                      ) : null\r\n-                                    })}\r\n-                                </div>\r\n-                                {categoryConfig.categoryIds.filter(id => subCategories.some(cat => cat.id === id)).length === 0 && (\r\n-                                  <p className=\"text-muted mb-0\">\r\n-                                    <i className=\"bi bi-info-circle me-1\"></i>\r\n-                                    No subcategories selected\r\n-                                  </p>\r\n-                                )}\r\n-                              </div>\r\n-                            </div>\r\n-                          ) : (\r\n-                            <div className=\"text-center py-4\">\r\n-                              <i className=\"bi bi-inbox text-muted\" style={{ fontSize: '2rem' }}></i>\r\n-                              <p className=\"text-muted mt-2 mb-0\">No categories selected yet</p>\r\n-                              <small className=\"text-muted\">Select categories from the interface below to see them here</small>\r\n-                            </div>\r\n-                          )}\r\n-                        </div>\r\n-                      </div>\r\n-                    </div>\r\n-                  </div>\r\n-\r\n-                  {/* Selection Summary */}\r\n-                  <div className=\"row mb-4\">\r\n-                    <div className=\"col-12\">\r\n-                      <div className=\"alert alert-info d-flex align-items-center\">\r\n-                        <i className=\"bi bi-info-circle me-2\"></i>\r\n-                        <div>\r\n-                          <strong>Selection Summary:</strong> {categoryConfig.categoryIds.length} categories selected \r\n-                          ({categoryConfig.categoryIds.filter(id => mainCategories.some(cat => cat.id === id)).length} main categories, {categoryConfig.categoryIds.filter(id => subCategories.some(cat => cat.id === id)).length} subcategories)\r\n-                        </div>\r\n-                      </div>\r\n-                    </div>\r\n-                  </div>\r\n-\r\n-                  {/* Category Selection Interface */}\r\n-                  <div className=\"row mb-4\">\r\n-                    <div className=\"col-12\">\r\n-                      <label className=\"form-label fw-semibold mb-3\">Select Categories and Subcategories</label>\r\n-                      \r\n-                      {mainCategories.length > 0 ? (\r\n-                        <div className=\"row\">\r\n-                          {/* Left Side - Main Categories */}\r\n-                          <div className=\"col-md-6\">\r\n-                            <div className=\"card\">\r\n-                              <div className=\"card-header bg-light d-flex justify-content-between align-items-center\">\r\n-                                <h6 className=\"mb-0\">\r\n-                                  <i className=\"bi bi-grid text-primary me-2\"></i>\r\n-                                  Main Categories ({mainCategories.length})\r\n-                                </h6>\r\n-                                <span className=\"badge bg-primary\">\r\n-                                  {getCurrentCounts().mainCategoriesCount} selected\r\n-                                </span>\r\n-                              </div>\r\n-                              <div className=\"card-body p-0\">\r\n-                                <div className=\"list-group list-group-flush\" style={{ maxHeight: '400px', overflowY: 'auto' }}>\r\n-                                  {mainCategories.map((category, index) => {\r\n-                                    // Use the flat categoryIds array for now since categories is still an array\r\n-                                    const isSelected = categoryConfig.categoryIds.includes(category.id)\r\n-                                    const isActiveTab = selectedMainCategory === category.id\r\n-                                    const subcategoryCount = getSubcategoriesForCategory(category.id).length\r\n-                                    const selectedSubcategoryCount = getSubcategoriesForCategory(category.id)\r\n-                                      .filter(sub => categoryConfig.categoryIds.includes(sub.id)).length\r\n-                                    \r\n-                                    return (\r\n-                                      <div\r\n-                                        key={category.id}\r\n-                                        className={`list-group-item d-flex justify-content-between align-items-center ${isActiveTab ? 'active' : ''}`}\r\n-                                        style={{ \r\n-                                          cursor: 'pointer',\r\n-                                          borderLeft: isActiveTab ? '4px solid #0d6efd' : '4px solid transparent'\r\n-                                        }}\r\n-                                        onClick={() => setSelectedMainCategory(category.id)}\r\n-                                      >\r\n-                                        <div className=\"d-flex align-items-center flex-grow-1\">\r\n-                                          <div className=\"form-check me-3\">\r\n-                                            <input\r\n-                                              className=\"form-check-input\"\r\n-                                              type=\"checkbox\"\r\n-                                              checked={isSelected}\r\n-                                              onChange={(e) => {\r\n-                                                e.stopPropagation()\r\n-                                                handleCategoryToggle(category.id)\r\n-                                              }}\r\n-                                            />\r\n-                                          </div>\r\n-                                          <img\r\n-                                            src={category.image}\r\n-                                            alt={category.name}\r\n-                                            className=\"me-3 rounded\"\r\n-                                            style={{ width: '32px', height: '32px', objectFit: 'cover' }}\r\n-                                            onError={(e) => {\r\n-                                              e.target.src = '/assets/img/product/category/default-category.svg'\r\n-                                            }}\r\n-                                          />\r\n-                                          <div>\r\n-                                            <div className={`fw-semibold ${isActiveTab ? 'text-white' : ''}`}>\r\n-                                              {category.name}\r\n-                                            </div>\r\n-                                            <small className={`${isActiveTab ? 'text-white-50' : 'text-muted'}`}>\r\n-                                              {subcategoryCount} subcategories\r\n-                                            </small>\r\n-                                          </div>\r\n-                                        </div>\r\n-                                        <div className=\"d-flex flex-column align-items-end\">\r\n-                                          {isSelected && (\r\n-                                            <span className={`badge ${isActiveTab ? 'bg-light text-primary' : 'bg-success'} mb-1`}>\r\n-                                              <i className=\"bi bi-check2 me-1\"></i>\r\n-                                              Selected\r\n-                                            </span>\r\n-                                          )}\r\n-                                          {subcategoryCount > 0 && (\r\n-                                            <span className={`badge ${isActiveTab ? 'bg-light text-primary' : 'bg-secondary'}`}>\r\n-                                              {selectedSubcategoryCount}/{subcategoryCount} subs\r\n-                                            </span>\r\n-                                          )}\r\n-                                        </div>\r\n-                                      </div>\r\n-                                    )\r\n-                                  })}\r\n-                                </div>\r\n-                              </div>\r\n-                            </div>\r\n-                          </div>\r\n-\r\n-                          {/* Right Side - Subcategories */}\r\n-                          <div className=\"col-md-6\">\r\n-                            <div className=\"card\">\r\n-                              <div className=\"card-header bg-light d-flex justify-content-between align-items-center\">\r\n-                                <h6 className=\"mb-0\">\r\n-                                  <i className=\"bi bi-tag text-secondary me-2\"></i>\r\n-                                  Subcategories\r\n-                                  {selectedMainCategory && (\r\n-                                    <span className=\"text-muted ms-2\">\r\n-                                      for \"{mainCategories.find(cat => cat.id === selectedMainCategory)?.name}\"\r\n-                                    </span>\r\n-                                  )}\r\n-                                </h6>\r\n-                                {selectedCategorySubcategories.length > 0 && (\r\n-                                  <span className=\"badge bg-secondary\">\r\n-                                    {selectedCategorySubcategories.length} subcategories\r\n-                                  </span>\r\n-                                )}\r\n-                              </div>\r\n-                              <div className=\"card-body p-0\">\r\n-                                {selectedMainCategory ? (\r\n-                                  selectedCategorySubcategories.length > 0 ? (\r\n-                                    <>\r\n-                                      {/* Subcategories Stats */}\r\n-                                      <div className=\"p-3 bg-light border-bottom\">\r\n-                                        <div className=\"row text-center\">\r\n-                                          <div className=\"col-6\">\r\n-                                            <div className=\"small\">\r\n-                                              <strong>{selectedCategorySubcategories.filter(sub => categoryConfig.categoryIds.includes(sub.id)).length}</strong>\r\n-                                              <br />\r\n-                                              <span className=\"text-muted\">Selected</span>\r\n-                                            </div>\r\n-                                          </div>\r\n-                                          <div className=\"col-6\">\r\n-                                            <div className=\"small\">\r\n-                                              <strong>{selectedCategorySubcategories.filter(sub => sub.status).length}</strong>\r\n-                                              <br />\r\n-                                              <span className=\"text-muted\">Active</span>\r\n-                                            </div>\r\n-                                          </div>\r\n-                                        </div>\r\n-                                      </div>\r\n-\r\n-                                      {/* Quick Actions for Subcategories */}\r\n-                                      <div className=\"p-2 border-bottom\">\r\n-                                        <div className=\"d-flex gap-1\">\r\n-                                          <button \r\n-                                            type=\"button\" \r\n-                                            className=\"btn btn-outline-success btn-sm\"\r\n-                                            onClick={() => {\r\n-                                              const currentSubIds = selectedCategorySubcategories.map(cat => cat.id)\r\n-                                              setCategoryConfig(prev => ({\r\n-                                                ...prev,\r\n-                                                categoryIds: [...new Set([...prev.categoryIds, ...currentSubIds])]\r\n-                                              }))\r\n-                                            }}\r\n-                                          >\r\n-                                            <i className=\"bi bi-check-all me-1\"></i>\r\n-                                            Select All\r\n-                                          </button>\r\n-                                          \r\n-                                          <button \r\n-                                            type=\"button\" \r\n-                                            className=\"btn btn-outline-secondary btn-sm\"\r\n-                                            onClick={() => {\r\n-                                              const currentSubIds = selectedCategorySubcategories.map(cat => cat.id)\r\n-                                              setCategoryConfig(prev => ({\r\n-                                                ...prev,\r\n-                                                categoryIds: prev.categoryIds.filter(id => !currentSubIds.includes(id))\r\n-                                              }))\r\n-                                            }}\r\n-                                          >\r\n-                                            <i className=\"bi bi-x-circle me-1\"></i>\r\n-                                            Clear All\r\n-                                          </button>\r\n-                                        </div>\r\n-                                      </div>\r\n-\r\n-                                      {/* Subcategories List */}\r\n-                                      <div className=\"list-group list-group-flush\" style={{ maxHeight: '350px', overflowY: 'auto' }}>\r\n-                                        {selectedCategorySubcategories.map((subcategory, index) => {\r\n-                                          // Use the flat categoryIds array for now since categories is still an array\r\n-                                          const isSelected = categoryConfig.categoryIds.includes(subcategory.id)\r\n-                                          \r\n-                                          return (\r\n-                                            <div \r\n-                                              key={subcategory.id} \r\n-                                              className={`list-group-item list-group-item-action border-0 ${isSelected ? 'bg-success bg-opacity-10 border-start border-success border-3' : ''}`}\r\n-                                            >\r\n-                                              <div className=\"d-flex align-items-center\">\r\n-                                                <div className=\"form-check me-3\">\r\n-                                                  <input \r\n-                                                    className=\"form-check-input form-check-input-success\" \r\n-                                                    type=\"checkbox\" \r\n-                                                    id={`sub-category-${subcategory.id}`}\r\n-                                                    checked={isSelected}\r\n-                                                    onChange={() => handleCategoryToggle(subcategory.id, selectedMainCategory)}\r\n-                                                  />\r\n-                                                </div>\r\n-                                                \r\n-                                                {subcategory.image && (\r\n-                                                  <img \r\n-                                                    src={subcategory.image} \r\n-                                                    alt={subcategory.name}\r\n-                                                    className=\"me-3 flex-shrink-0 border\"\r\n-                                                    style={{ width: '36px', height: '36px', objectFit: 'cover', borderRadius: '6px' }}\r\n-                                                  />\r\n-                                                )}\r\n-                                                \r\n-                                                <div className=\"flex-grow-1\">\r\n-                                                  <div className=\"d-flex justify-content-between align-items-start\">\r\n-                                                    <div>\r\n-                                                      <h6 className=\"mb-1 text-dark fw-semibold\">\r\n-                                                        <i className=\"bi bi-tag text-success me-1\" style={{ fontSize: '12px' }}></i>\r\n-                                                        {subcategory.name}\r\n-                                                      </h6>\r\n-                                                      {subcategory.description && (\r\n-                                                        <p className=\"mb-1 text-muted small\">{subcategory.description}</p>\r\n-                                                      )}\r\n-                                                      <div className=\"d-flex gap-1 align-items-center\">\r\n-                                                        <span className=\"badge bg-secondary\" style={{ fontSize: '9px' }}>\r\n-                                                          Subcategory\r\n-                                                        </span>\r\n-                                                        <span className={`badge ${subcategory.status ? 'bg-success' : 'bg-danger'}`} style={{ fontSize: '9px' }}>\r\n-                                                          {subcategory.status ? 'Active' : 'Inactive'}\r\n-                                                        </span>\r\n-                                                        {isSelected && (\r\n-                                                          <span className=\"badge bg-primary\" style={{ fontSize: '9px' }}>\r\n-                                                            <i className=\"bi bi-check-circle me-1\"></i>\r\n-                                                            Selected\r\n-                                                          </span>\r\n-                                                        )}\r\n-                                                      </div>\r\n-                                                    </div>\r\n-                                                    <div className=\"text-end\">\r\n-                                                      <small className=\"text-muted\">#{index + 1}</small>\r\n-                                                    </div>\r\n-                                                  </div>\r\n-                                                </div>\r\n-                                              </div>\r\n-                                            </div>\r\n-                                          )\r\n-                                        })}\r\n-                                      </div>\r\n-\r\n-                                      {/* Footer Info */}\r\n-                                      <div className=\"p-2 bg-light border-top text-center\">\r\n-                                        <small className=\"text-muted\">\r\n-                                          <i className=\"bi bi-info-circle me-1\"></i>\r\n-                                          Click checkboxes to select subcategories for homepage display\r\n-                                        </small>\r\n-                                      </div>\r\n-                                    </>\r\n-                                  ) : (\r\n-                                    <div className=\"text-center py-5\">\r\n-                                      <i className=\"bi bi-folder2-open text-muted\" style={{ fontSize: '2.5rem' }}></i>\r\n-                                      <h6 className=\"mt-3 text-muted\">No subcategories found</h6>\r\n-                                      <p className=\"text-muted mb-3\">\r\n-                                        The category \"{mainCategories.find(cat => cat.id === selectedMainCategory)?.name}\" doesn't have any subcategories yet.\r\n-                                      </p>\r\n-                                      <button \r\n-                                        className=\"btn btn-outline-primary btn-sm\"\r\n-                                        onClick={() => {\r\n-                                          // You can add navigation to create subcategory here\r\n-                                          alert('Navigate to Categories > Subcategories to create subcategories for this category')\r\n-                                        }}\r\n-                                      >\r\n-                                        <i className=\"bi bi-plus-circle me-1\"></i>\r\n-                                        Create Subcategories\r\n-                                      </button>\r\n-                                    </div>\r\n-                                  )\r\n-                                ) : (\r\n-                                  <div className=\"text-center py-5\">\r\n-                                    <i className=\"bi bi-arrow-left text-primary\" style={{ fontSize: '2.5rem' }}></i>\r\n-                                    <h6 className=\"mt-3 text-muted\">Select a main category</h6>\r\n-                                    <p className=\"text-muted mb-0\">\r\n-                                      Click on a main category from the left panel to view and select its subcategories.\r\n-                                    </p>\r\n-                                  </div>\r\n-                                )}\r\n-                              </div>\r\n-                            </div>\r\n-                          </div>\r\n-                        </div>\r\n-                      ) : (\r\n-                        <div className=\"text-center py-5\">\r\n-                          <i className=\"bi bi-folder2-open text-muted\" style={{ fontSize: '3rem' }}></i>\r\n-                          <p className=\"mt-2 text-muted\">No categories available</p>\r\n-                          <small className=\"text-muted\">Create categories first to configure this section.</small>\r\n-                        </div>\r\n-                      )}\r\n-                    </div>\r\n-                  </div>\r\n-\r\n-                  {/* Quick Actions */}\r\n-                  {mainCategories.length > 0 && (\r\n-                    <div className=\"row\">\r\n-                      <div className=\"col-12\">\r\n-                        <div className=\"d-flex gap-2 flex-wrap\">\r\n-                          <button \r\n-                            type=\"button\" \r\n-                            className=\"btn btn-outline-primary btn-sm\"\r\n-                            onClick={() => {\r\n-                              console.log('🎯 Select All Main Categories clicked')\r\n-                              const { mainCategoriesCount } = getCurrentCounts()\r\n-                              const availableSlots = MAX_MAIN_CATEGORIES - mainCategoriesCount\r\n-                              \r\n-                              if (availableSlots <= 0) {\r\n-                                setError(`Cannot select more categories. Maximum ${MAX_MAIN_CATEGORIES} main categories allowed.`)\r\n-                                return\r\n-                              }\r\n-                              \r\n-                              // Get main categories that are not already selected\r\n-                              const mainCategoryIds = mainCategories.map(cat => cat.id)\r\n-                              const unselectedMainCategories = mainCategoryIds.filter(id => \r\n-                                !categoryConfig.categoryIds.includes(id)\r\n-                              )\r\n-                              \r\n-                              // Take only the number that fits within the limit\r\n-                              const categoriesToAdd = unselectedMainCategories.slice(0, availableSlots)\r\n-                              console.log('   - Categories to add:', categoriesToAdd)\r\n-                              \r\n-                              setCategoryConfig(prev => {\r\n-                                const newCategoryIds = [...new Set([...prev.categoryIds, ...categoriesToAdd])]\r\n-                                console.log('   - Updated categoryIds:', newCategoryIds)\r\n-                                return {\r\n-                                  ...prev,\r\n-                                  categoryIds: newCategoryIds\r\n-                                }\r\n-                              })\r\n-                              \r\n-                              if (categoriesToAdd.length < unselectedMainCategories.length) {\r\n-                                setError(`Only selected ${categoriesToAdd.length} more categories due to limit.`)\r\n-                              }\r\n-                            }}\r\n-                          >\r\n-                            <i className=\"bi bi-check-all me-1\"></i>\r\n-                            Select All Main Categories\r\n-                          </button>\r\n-                          \r\n-                          <button \r\n-                            type=\"button\" \r\n-                            className=\"btn btn-outline-success btn-sm\"\r\n-                            onClick={() => {\r\n-                              console.log('🎯 Select All Subcategories clicked')\r\n-                              if (!selectedMainCategory) {\r\n-                                setError('Please select a main category first to add subcategories.')\r\n-                                return\r\n-                              }\r\n-                              \r\n-                              const subcategoriesForMain = getSubcategoriesForCategory(selectedMainCategory)\r\n-                              const currentSubCount = subcategoriesForMain.filter(sub => \r\n-                                categoryConfig.categoryIds.includes(sub.id)\r\n-                              ).length\r\n-                              const availableSlots = MAX_SUBCATEGORIES_PER_CATEGORY - currentSubCount\r\n-                              \r\n-                              if (availableSlots <= 0) {\r\n-                                setError(`Cannot select more subcategories. Maximum ${MAX_SUBCATEGORIES_PER_CATEGORY} subcategories per main category allowed.`)\r\n-                                return\r\n-                              }\r\n-                              \r\n-                              // Get unselected subcategories for this main category\r\n-                              const unselectedSubcategories = subcategoriesForMain\r\n-                                .filter(sub => !categoryConfig.categoryIds.includes(sub.id))\r\n-                                .slice(0, availableSlots)\r\n-                                .map(sub => sub.id)\r\n-                              \r\n-                              console.log('   - Subcategories to add:', unselectedSubcategories)\r\n-                              \r\n-                              setCategoryConfig(prev => {\r\n-                                let newCategoryIds = [...prev.categoryIds]\r\n-                                \r\n-                                // Ensure main category is selected\r\n-                                if (!newCategoryIds.includes(selectedMainCategory)) {\r\n-                                  newCategoryIds.push(selectedMainCategory)\r\n-                                }\r\n-                                \r\n-                                // Add unselected subcategories\r\n-                                newCategoryIds = [...new Set([...newCategoryIds, ...unselectedSubcategories])]\r\n-                                \r\n-                                console.log('   - Updated categoryIds:', newCategoryIds)\r\n-                                return {\r\n-                                  ...prev,\r\n-                                  categoryIds: newCategoryIds\r\n-                                }\r\n-                              })\r\n-                              \r\n-                              if (unselectedSubcategories.length < subcategoriesForMain.length - currentSubCount) {\r\n-                                setError(`Only selected ${unselectedSubcategories.length} more subcategories due to limit.`)\r\n-                              }\r\n-                            }}\r\n-                          >\r\n-                            <i className=\"bi bi-tags me-1\"></i>\r\n-                            Select All Subcategories\r\n-                          </button>\r\n-                          \r\n-                          <button \r\n-                            type=\"button\" \r\n-                            className=\"btn btn-outline-secondary btn-sm\"\r\n-                            onClick={() => {\r\n-                              console.log('🎯 Clear All Selections clicked')\r\n-                              setCategoryConfig(prev => ({\r\n-                                ...prev,\r\n-                                categoryIds: []\r\n-                              }))\r\n-                              setSelectedMainCategory(null)\r\n-                            }}\r\n-                          >\r\n-                            <i className=\"bi bi-x-circle me-1\"></i>\r\n-                            Clear All Selections\r\n-                          </button>\r\n-                        </div>\r\n-                      </div>\r\n-                    </div>\r\n-                  )}\r\n-                </>\r\n-              )}\r\n-            </div>\r\n-            <div className=\"modal-footer\">\r\n-              <button \r\n-                type=\"button\" \r\n-                className=\"btn btn-secondary\" \r\n-                onClick={() => setShowCategoryConfig(false)}\r\n-              >\r\n-                Cancel\r\n-              </button>\r\n-              <button \r\n-                type=\"button\" \r\n-                className=\"btn btn-primary\" \r\n-                onClick={saveCategoryConfig}\r\n-                disabled={loading}\r\n-              >\r\n-                {loading ? (\r\n-                  <>\r\n-                    <span className=\"spinner-border spinner-border-sm me-2\"></span>\r\n-                    Saving...\r\n-                  </>\r\n-                ) : (\r\n-                  'Save Configuration'\r\n-                )}\r\n-              </button>\r\n-            </div>\r\n-          </div>\r\n-        </div>\r\n-      </div>\r\n-    )\r\n-  }\r\n-\r\n-  // Move section up/down\r\n-  const handleMoveSection = async (page, sectionKey, direction) => {\r\n-    const sections = page === \"home\" ? homeSections : corporateSections\r\n-    const currentIndex = sections.findIndex(s => s.key === sectionKey)\r\n-    \r\n-    if (direction === 'up' && currentIndex > 0) {\r\n-      // Move up logic - would need to update order\r\n-      console.log(`Moving ${sectionKey} up`)\r\n-    } else if (direction === 'down' && currentIndex < sections.length - 1) {\r\n-      // Move down logic - would need to update order\r\n-      console.log(`Moving ${sectionKey} down`)\r\n-    }\r\n-    \r\n-    // TODO: Implement actual reordering\r\n-    setSuccess('Section order updated!')\r\n-    setTimeout(() => setSuccess(''), 2000)\r\n-  }\r\n-\r\n-  // Render section controls\r\n-  const renderSections = () => {\r\n-    const sections = getCurrentSections()\r\n-    const currentPage = PAGES.find(p => p.key === selectedPage)\r\n-    \r\n-    return (\r\n-      <div className=\"col-md-9\">\r\n-        <div className=\"card border-0 shadow-sm\">\r\n-          <div className=\"card-header bg-white border-bottom\">\r\n-            <div className=\"d-flex justify-content-between align-items-center\">\r\n-              <div>\r\n-                <h5 className=\"mb-1 fw-semibold\">{currentPage.label}</h5>\r\n-                <p className=\"text-muted mb-0 small\">{currentPage.description}</p>\r\n-              </div>\r\n-              <span className=\"badge bg-primary\">\r\n-                {sections.filter(s => visibleSections[selectedPage][s.key]).length} active\r\n-              </span>\r\n-            </div>\r\n-          </div>\r\n-          \r\n-          <div className=\"card-body p-0\">\r\n-            {sections.length === 0 ? (\r\n-              <div className=\"text-center py-5\">\r\n-                <i className=\"bi bi-grid\" style={{ fontSize: '3rem', color: '#6c757d' }}></i>\r\n-                <p className=\"mt-2 text-muted\">No sections configured for this page.</p>\r\n-              </div>\r\n-            ) : (\r\n-              <div className=\"table-responsive\">\r\n-                <table className=\"table table-hover mb-0\">\r\n-                  <thead className=\"table-light\">\r\n-                    <tr>\r\n-                      <th className=\"ps-4\">Section</th>\r\n-                      <th>Description</th>\r\n-                      <th>Order</th>\r\n-                      <th>Status</th>\r\n-                      <th className=\"text-center\">Actions</th>\r\n-                    </tr>\r\n-                  </thead>\r\n-                  <tbody>\r\n-                    {sections.map((section, index) => {\r\n-                      const isVisible = visibleSections[selectedPage][section.key]\r\n-                      const isCategorySection = section.key === 'giftCategories'\r\n-                      \r\n-                      return (\r\n-                        <tr key={section.key} className={isVisible ? '' : 'table-secondary'}>\r\n-                          <td className=\"ps-4\">\r\n-                            <div className=\"d-flex align-items-center\">\r\n-                              <div>\r\n-                                <div className=\"fw-semibold\">{section.label}</div>\r\n-                                {isCategorySection && categoryConfig.categoryIds.length > 0 && (\r\n-                                  <small className=\"text-muted\">\r\n-                                    {categoryConfig.categoryIds.length} categories selected\r\n-                                  </small>\r\n-                                )}\r\n-                              </div>\r\n-                            </div>\r\n-                          </td>\r\n-                          <td>\r\n-                            <span className=\"text-muted\">{section.description}</span>\r\n-                          </td>\r\n-                          <td>\r\n-                            <span className=\"badge bg-light text-dark\">{section.order}</span>\r\n-                          </td>\r\n-                          <td>\r\n-                            <div className=\"form-check form-switch\">\r\n-                              <input \r\n-                                className=\"form-check-input\" \r\n-                                type=\"checkbox\" \r\n-                                checked={isCategorySection ? categoryConfig.enabled : isVisible}\r\n-                                onChange={() => handleToggleSection(selectedPage, section.key)}\r\n-                                id={`toggle-${section.key}`}\r\n-                              />\r\n-                              <label className=\"form-check-label\" htmlFor={`toggle-${section.key}`}>\r\n-                                {isCategorySection ? (categoryConfig.enabled ? 'Enabled' : 'Disabled') : (isVisible ? 'Visible' : 'Hidden')}\r\n-                              </label>\r\n-                            </div>\r\n-                          </td>\r\n-                          <td className=\"text-center\">\r\n-                            <div className=\"btn-group btn-group-sm\">\r\n-                              {section.hasConfig && (\r\n-                                <button\r\n-                                  className=\"btn btn-outline-primary\"\r\n-                                  onClick={openCategoryConfig}\r\n-                                  title=\"Configure section\"\r\n-                                >\r\n-                                  <i className=\"bi bi-gear\"></i>\r\n-                                </button>\r\n-                              )}\r\n-                              <button\r\n-                                className=\"btn btn-outline-secondary\"\r\n-                                onClick={() => handleMoveSection(selectedPage, section.key, 'up')}\r\n-                                disabled={index === 0}\r\n-                                title=\"Move up\"\r\n-                              >\r\n-                                <i className=\"bi bi-arrow-up\"></i>\r\n-                              </button>\r\n-                              <button\r\n-                                className=\"btn btn-outline-secondary\"\r\n-                                onClick={() => handleMoveSection(selectedPage, section.key, 'down')}\r\n-                                disabled={index === sections.length - 1}\r\n-                                title=\"Move down\"\r\n-                              >\r\n-                                <i className=\"bi bi-arrow-down\"></i>\r\n-                              </button>\r\n-                            </div>\r\n-                          </td>\r\n-                        </tr>\r\n-                      )\r\n-                    })}\r\n-                  </tbody>\r\n-                </table>\r\n-              </div>\r\n-            )}\r\n-          </div>\r\n-        </div>\r\n-      </div>\r\n-    )\r\n-  }\r\n-\r\n-  // Render page sidebar\r\n-  const renderPageSidebar = () => (\r\n-    <div className=\"col-md-3\">\r\n-      <div className=\"card border-0 shadow-sm\">\r\n-        <div className=\"card-header bg-white border-bottom\">\r\n-          <h6 className=\"mb-0 fw-semibold\">\r\n-            <i className=\"bi bi-file-earmark-text me-2\"></i>\r\n-            Pages\r\n-          </h6>\r\n-        </div>\r\n-        <div className=\"card-body p-0\">\r\n-          <div className=\"list-group list-group-flush\">\r\n-            {PAGES.map((page) => {\r\n-              const isActive = selectedPage === page.key\r\n-              const activeCount = visibleSections[page.key] ? \r\n-                Object.values(visibleSections[page.key]).filter(Boolean).length : 0\r\n-              \r\n-              return (\r\n-                <button\r\n-                  key={page.key}\r\n-                  className={`list-group-item list-group-item-action border-0 ${isActive ? 'active' : ''}`}\r\n-                  onClick={() => setSelectedPage(page.key)}\r\n-                  disabled={loading}\r\n-                >\r\n-                  <div className=\"d-flex justify-content-between align-items-center\">\r\n-                    <div>\r\n-                      <div className=\"fw-semibold\">{page.label}</div>\r\n-                      <small className={isActive ? 'text-white-50' : 'text-muted'}>\r\n-                        {page.description}\r\n-                      </small>\r\n-                    </div>\r\n-                    <span className={`badge ${isActive ? 'bg-white text-primary' : 'bg-primary'}`}>\r\n-                      {activeCount}\r\n-                    </span>\r\n-                  </div>\r\n-                </button>\r\n-              )\r\n-            })}\r\n-          </div>\r\n-        </div>\r\n-      </div>\r\n-    </div>\r\n-  )\r\n-\r\n-  return (\r\n-    <div className=\"container-fluid\">\r\n-      {/* Page Header */}\r\n-      <div className=\"row mb-4\">\r\n-        <div className=\"col-12\">\r\n-          <div className=\"d-flex justify-content-between align-items-center\">\r\n-            <div>\r\n-              <h2 className=\"fw-bold text-dark mb-1\">Pages Management</h2>\r\n-              <p className=\"text-muted mb-0\">Control which sections appear on each page</p>\r\n-            </div>\r\n-            <div className=\"d-flex gap-2\">\r\n-              <button\r\n-                className=\"btn btn-outline-primary\"\r\n-                onClick={() => loadPageConfig(selectedPage)}\r\n-                disabled={loading}\r\n-              >\r\n-                <i className=\"bi bi-arrow-clockwise me-2\"></i>\r\n-                Refresh\r\n-              </button>\r\n-            </div>\r\n-          </div>\r\n-        </div>\r\n-      </div>\r\n-\r\n-      {/* Status Messages */}\r\n-      {error && (\r\n-        <div className=\"row mb-3\">\r\n-          <div className=\"col-12\">\r\n-            <div className=\"alert alert-danger d-flex align-items-center\" role=\"alert\">\r\n-              <i className=\"bi bi-exclamation-triangle-fill me-2\"></i>\r\n-              <div>{error}</div>\r\n-              <button\r\n-                type=\"button\"\r\n-                className=\"btn-close ms-auto\"\r\n-                onClick={() => setError('')}\r\n-              ></button>\r\n-            </div>\r\n-          </div>\r\n-        </div>\r\n-      )}\r\n-\r\n-      {success && (\r\n-        <div className=\"row mb-3\">\r\n-          <div className=\"col-12\">\r\n-            <div className=\"alert alert-success d-flex align-items-center\" role=\"alert\">\r\n-              <i className=\"bi bi-check-circle-fill me-2\"></i>\r\n-              <div>{success}</div>\r\n-              <button\r\n-                type=\"button\"\r\n-                className=\"btn-close ms-auto\"\r\n-                onClick={() => setSuccess('')}\r\n-              ></button>\r\n-            </div>\r\n-          </div>\r\n-        </div>\r\n-      )}\r\n-\r\n-      {/* Main Content */}\r\n-      <div className=\"row\">\r\n-        {renderPageSidebar()}\r\n-        {renderSections()}\r\n-      </div>\r\n-\r\n-      {/* Category Configuration Modal */}\r\n-      {renderCategoryConfigModal()}\r\n-\r\n-      {/* Loading Overlay */}\r\n-      {loading && (\r\n-        <div className=\"position-fixed top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center\" \r\n-             style={{ backgroundColor: 'rgba(0,0,0,0.5)', zIndex: 9999 }}>\r\n-          <div className=\"spinner-border text-primary\" role=\"status\">\r\n-            <span className=\"visually-hidden\">Loading...</span>\r\n-          </div>\r\n-        </div>\r\n-      )}\r\n-    </div>\r\n-  )\r\n-}\r\n"
                }
            ],
            "date": 1753107753818,
            "name": "Commit-0",
            "content": "'use client'\r\nimport React, { useState, useEffect } from 'react'\r\nimport { get, post, put } from '@/util/apiService'\r\n\r\nconst PAGES = [\r\n  { \r\n    key: \"home\", \r\n    label: \"Home Page\",\r\n    description: \"Manage sections displayed on the homepage\"\r\n  },\r\n  { \r\n    key: \"corporate\", \r\n    label: \"Corporate Page\",\r\n    description: \"Manage sections for corporate customers\"\r\n  }\r\n]\r\n\r\nexport default function PagesManagement({ onNavigate }) {\r\n  const [selectedPage, setSelectedPage] = useState(\"home\")\r\n  const [loading, setLoading] = useState(false)\r\n  const [error, setError] = useState('')\r\n  const [success, setSuccess] = useState('')\r\n\r\n  // Define sections for each page\r\n  const homeSections = [\r\n    { \r\n      key: \"giftCategories\", \r\n      label: \"Gift Categories\", \r\n      description: \"Display category grid with gifts\",\r\n      order: 1\r\n    },\r\n    { \r\n      key: \"slider\", \r\n      label: \"Main Slider\", \r\n      description: \"Hero banner with promotional slides\",\r\n      order: 2\r\n    },\r\n    { \r\n      key: \"services\", \r\n      label: \"Services Section\", \r\n      description: \"Highlight key services and benefits\",\r\n      order: 3\r\n    },\r\n    { \r\n      key: \"products\", \r\n      label: \"Featured Products\", \r\n      description: \"Showcase featured/trending products\",\r\n      order: 4\r\n    },\r\n    { \r\n      key: \"banner\", \r\n      label: \"Promotional Banner\", \r\n      description: \"Secondary promotional content\",\r\n      order: 5\r\n    },\r\n    { \r\n      key: \"dealProduct\", \r\n      label: \"Deal Products\", \r\n      description: \"Special offers and discounted items\",\r\n      order: 6\r\n    }\r\n  ]\r\n\r\n  const corporateSections = [\r\n    { \r\n      key: \"corporateBanner\", \r\n      label: \"Corporate Banner\", \r\n      description: \"Hero section for corporate clients\",\r\n      order: 1\r\n    },\r\n    { \r\n      key: \"corporateServices\", \r\n      label: \"Corporate Services\", \r\n      description: \"B2B services and solutions\",\r\n      order: 2\r\n    },\r\n    { \r\n      key: \"corporateTestimonials\", \r\n      label: \"Client Testimonials\", \r\n      description: \"Corporate client reviews and case studies\",\r\n      order: 3\r\n    },\r\n    { \r\n      key: \"corporatePartners\", \r\n      label: \"Partner Logos\", \r\n      description: \"Display trusted corporate partners\",\r\n      order: 4\r\n    }\r\n  ]\r\n\r\n  // Section visibility state\r\n  const [visibleSections, setVisibleSections] = useState({\r\n    home: {\r\n      giftCategories: true,\r\n      slider: true,\r\n      services: true,\r\n      products: true,\r\n      banner: true,\r\n      dealProduct: true,\r\n    },\r\n    corporate: {\r\n      corporateBanner: true,\r\n      corporateServices: true,\r\n      corporateTestimonials: false,\r\n      corporatePartners: false,\r\n    },\r\n  })\r\n\r\n  // Hardcoded admin token for testing\r\n  const ADMIN_TOKEN = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY4NzZhYTJmYzc3YWY4ODU3Njk1ZDA5MiIsInJvbGUiOiJhZG1pbiIsImlhdCI6MTc1MjYwNzMyMCwiZXhwIjoxNzUzMjEyMTIwfQ.ugFuaDCq_ewqIE-dZaql3BB91kaXBIxE0TQmqdYnagI'\r\n\r\n  // Load page sections configuration\r\n  const loadPageSections = async (pageKey) => {\r\n    try {\r\n      setLoading(true)\r\n      localStorage.setItem('authToken', ADMIN_TOKEN)\r\n      \r\n      // TODO: Replace with actual API call when backend is ready\r\n      // const response = await get(`/api/pages/${pageKey}/sections`)\r\n      // For now, use default state\r\n      console.log(`Loading sections for page: ${pageKey}`)\r\n      \r\n      setError('')\r\n    } catch (err) {\r\n      console.error('Load page sections error:', err)\r\n      setError('Failed to load page sections: ' + err.message)\r\n    } finally {\r\n      setLoading(false)\r\n    }\r\n  }\r\n\r\n  // Save page sections configuration\r\n  const savePageSections = async (pageKey, sections) => {\r\n    try {\r\n      setLoading(true)\r\n      localStorage.setItem('authToken', ADMIN_TOKEN)\r\n      \r\n      // TODO: Replace with actual API call when backend is ready\r\n      // const response = await put(`/api/pages/${pageKey}/sections`, { sections })\r\n      console.log(`Saving sections for page: ${pageKey}`, sections)\r\n      \r\n      setSuccess('Page sections updated successfully!')\r\n      setTimeout(() => setSuccess(''), 3000)\r\n      \r\n    } catch (err) {\r\n      console.error('Save page sections error:', err)\r\n      setError('Failed to save page sections: ' + err.message)\r\n    } finally {\r\n      setLoading(false)\r\n    }\r\n  }\r\n\r\n  // Toggle section visibility\r\n  const handleToggleSection = async (page, section) => {\r\n    const newVisibility = {\r\n      ...visibleSections,\r\n      [page]: {\r\n        ...visibleSections[page],\r\n        [section]: !visibleSections[page][section],\r\n      }\r\n    }\r\n    \r\n    setVisibleSections(newVisibility)\r\n    \r\n    // Auto-save changes\r\n    await savePageSections(page, newVisibility[page])\r\n  }\r\n\r\n  // Move section up/down\r\n  const handleMoveSection = async (page, sectionKey, direction) => {\r\n    const sections = page === \"home\" ? homeSections : corporateSections\r\n    const currentIndex = sections.findIndex(s => s.key === sectionKey)\r\n    \r\n    if (direction === 'up' && currentIndex > 0) {\r\n      // Move up logic - would need to update order\r\n      console.log(`Moving ${sectionKey} up`)\r\n    } else if (direction === 'down' && currentIndex < sections.length - 1) {\r\n      // Move down logic - would need to update order\r\n      console.log(`Moving ${sectionKey} down`)\r\n    }\r\n    \r\n    // TODO: Implement actual reordering\r\n    setSuccess('Section order updated!')\r\n    setTimeout(() => setSuccess(''), 2000)\r\n  }\r\n\r\n  // Load sections when page changes\r\n  useEffect(() => {\r\n    loadPageSections(selectedPage)\r\n  }, [selectedPage])\r\n\r\n  // Get sections for current page\r\n  const getCurrentSections = () => {\r\n    return selectedPage === \"home\" ? homeSections : corporateSections\r\n  }\r\n\r\n  // Render section controls\r\n  const renderSections = () => {\r\n    const sections = getCurrentSections()\r\n    const currentPage = PAGES.find(p => p.key === selectedPage)\r\n    \r\n    return (\r\n      <div className=\"col-md-9\">\r\n        <div className=\"card border-0 shadow-sm\">\r\n          <div className=\"card-header bg-white border-bottom\">\r\n            <div className=\"d-flex justify-content-between align-items-center\">\r\n              <div>\r\n                <h5 className=\"mb-1 fw-semibold\">{currentPage.label}</h5>\r\n                <p className=\"text-muted mb-0 small\">{currentPage.description}</p>\r\n              </div>\r\n              <span className=\"badge bg-primary\">{sections.filter(s => visibleSections[selectedPage][s.key]).length} active</span>\r\n            </div>\r\n          </div>\r\n          \r\n          <div className=\"card-body p-0\">\r\n            {sections.length === 0 ? (\r\n              <div className=\"text-center py-5\">\r\n                <i className=\"bi bi-grid\" style={{ fontSize: '3rem', color: '#6c757d' }}></i>\r\n                <p className=\"mt-2 text-muted\">No sections configured for this page.</p>\r\n              </div>\r\n            ) : (\r\n              <div className=\"table-responsive\">\r\n                <table className=\"table table-hover mb-0\">\r\n                  <thead className=\"table-light\">\r\n                    <tr>\r\n                      <th className=\"ps-4\">Section</th>\r\n                      <th>Description</th>\r\n                      <th>Order</th>\r\n                      <th>Status</th>\r\n                      <th className=\"text-center\">Actions</th>\r\n                    </tr>\r\n                  </thead>\r\n                  <tbody>\r\n                    {sections.map((section, index) => {\r\n                      const isVisible = visibleSections[selectedPage][section.key]\r\n                      return (\r\n                        <tr key={section.key} className={!isVisible ? 'table-secondary' : ''}>\r\n                          <td className=\"ps-4\">\r\n                            <div className=\"d-flex align-items-center\">\r\n                              <i className={`bi ${isVisible ? 'bi-eye' : 'bi-eye-slash'} me-2 ${isVisible ? 'text-success' : 'text-muted'}`}></i>\r\n                              <strong>{section.label}</strong>\r\n                            </div>\r\n                          </td>\r\n                          <td>\r\n                            <small className=\"text-muted\">{section.description}</small>\r\n                          </td>\r\n                          <td>\r\n                            <span className=\"badge bg-light text-dark\">{section.order}</span>\r\n                          </td>\r\n                          <td>\r\n                            <span className={`badge ${isVisible ? 'bg-success' : 'bg-secondary'}`}>\r\n                              {isVisible ? 'Visible' : 'Hidden'}\r\n                            </span>\r\n                          </td>\r\n                          <td className=\"text-center\">\r\n                            <div className=\"btn-group btn-group-sm\" role=\"group\">\r\n                              <button\r\n                                className={`btn ${isVisible ? 'btn-outline-warning' : 'btn-outline-success'}`}\r\n                                onClick={() => handleToggleSection(selectedPage, section.key)}\r\n                                title={isVisible ? 'Hide Section' : 'Show Section'}\r\n                                disabled={loading}\r\n                              >\r\n                                <i className={`bi ${isVisible ? 'bi-eye-slash' : 'bi-eye'}`}></i>\r\n                              </button>\r\n                              <button\r\n                                className=\"btn btn-outline-primary\"\r\n                                onClick={() => handleMoveSection(selectedPage, section.key, 'up')}\r\n                                title=\"Move Up\"\r\n                                disabled={loading || index === 0}\r\n                              >\r\n                                <i className=\"bi bi-arrow-up\"></i>\r\n                              </button>\r\n                              <button\r\n                                className=\"btn btn-outline-primary\"\r\n                                onClick={() => handleMoveSection(selectedPage, section.key, 'down')}\r\n                                title=\"Move Down\"\r\n                                disabled={loading || index === sections.length - 1}\r\n                              >\r\n                                <i className=\"bi bi-arrow-down\"></i>\r\n                              </button>\r\n                              <button\r\n                                className=\"btn btn-outline-secondary\"\r\n                                onClick={() => {/* TODO: Open section settings modal */}}\r\n                                title=\"Section Settings\"\r\n                                disabled={loading}\r\n                              >\r\n                                <i className=\"bi bi-gear\"></i>\r\n                              </button>\r\n                            </div>\r\n                          </td>\r\n                        </tr>\r\n                      )\r\n                    })}\r\n                  </tbody>\r\n                </table>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  // Render page sidebar\r\n  const renderPageSidebar = () => (\r\n    <div className=\"col-md-3\">\r\n      <div className=\"card border-0 shadow-sm\">\r\n        <div className=\"card-header bg-white border-bottom\">\r\n          <h6 className=\"mb-0 fw-semibold\">\r\n            <i className=\"bi bi-file-earmark-text me-2\"></i>\r\n            Pages\r\n          </h6>\r\n        </div>\r\n        <div className=\"card-body p-0\">\r\n          <div className=\"list-group list-group-flush\">\r\n            {PAGES.map((page) => {\r\n              const isActive = selectedPage === page.key\r\n              const activeCount = visibleSections[page.key] ? \r\n                Object.values(visibleSections[page.key]).filter(Boolean).length : 0\r\n              \r\n              return (\r\n                <button\r\n                  key={page.key}\r\n                  className={`list-group-item list-group-item-action border-0 ${isActive ? 'active' : ''}`}\r\n                  onClick={() => setSelectedPage(page.key)}\r\n                  disabled={loading}\r\n                >\r\n                  <div className=\"d-flex justify-content-between align-items-center\">\r\n                    <div>\r\n                      <div className=\"fw-semibold\">{page.label}</div>\r\n                      <small className={isActive ? 'text-white-50' : 'text-muted'}>\r\n                        {page.description}\r\n                      </small>\r\n                    </div>\r\n                    <span className={`badge ${isActive ? 'bg-white text-primary' : 'bg-primary'}`}>\r\n                      {activeCount}\r\n                    </span>\r\n                  </div>\r\n                </button>\r\n              )\r\n            })}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n\r\n  return (\r\n    <div className=\"container-fluid\">\r\n      {/* Page Header */}\r\n      <div className=\"row mb-4\">\r\n        <div className=\"col-12\">\r\n          <div className=\"d-flex justify-content-between align-items-center\">\r\n            <div>\r\n              <h2 className=\"fw-bold text-dark mb-1\">Pages Management</h2>\r\n              <p className=\"text-muted mb-0\">Control which sections appear on each page</p>\r\n            </div>\r\n            <div className=\"d-flex gap-2\">\r\n              <button\r\n                className=\"btn btn-outline-primary\"\r\n                onClick={() => loadPageSections(selectedPage)}\r\n                disabled={loading}\r\n              >\r\n                <i className=\"bi bi-arrow-clockwise me-2\"></i>\r\n                Refresh\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Status Messages */}\r\n      {error && (\r\n        <div className=\"row mb-3\">\r\n          <div className=\"col-12\">\r\n            <div className=\"alert alert-danger d-flex align-items-center\" role=\"alert\">\r\n              <i className=\"bi bi-exclamation-triangle-fill me-2\"></i>\r\n              <div>{error}</div>\r\n              <button\r\n                type=\"button\"\r\n                className=\"btn-close ms-auto\"\r\n                onClick={() => setError('')}\r\n              ></button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {success && (\r\n        <div className=\"row mb-3\">\r\n          <div className=\"col-12\">\r\n            <div className=\"alert alert-success d-flex align-items-center\" role=\"alert\">\r\n              <i className=\"bi bi-check-circle-fill me-2\"></i>\r\n              <div>{success}</div>\r\n              <button\r\n                type=\"button\"\r\n                className=\"btn-close ms-auto\"\r\n                onClick={() => setSuccess('')}\r\n              ></button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Main Content */}\r\n      <div className=\"row\">\r\n        {renderPageSidebar()}\r\n        {renderSections()}\r\n      </div>\r\n\r\n      {/* Loading Overlay */}\r\n      {loading && (\r\n        <div className=\"position-fixed top-0 start-0 w-100 h-100 d-flex align-items-center justify-content-center\" \r\n             style={{ backgroundColor: 'rgba(0,0,0,0.5)', zIndex: 9999 }}>\r\n          <div className=\"spinner-border text-primary\" role=\"status\">\r\n            <span className=\"visually-hidden\">Loading...</span>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  )\r\n}\r\n"
        }
    ]
}